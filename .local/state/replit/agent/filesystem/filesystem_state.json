{"file_contents":{"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport TablePage from \"@/pages/table\";\nimport SharedTablePage from \"@/pages/shared-table\";\nimport CustomTableList from \"@/pages/custom-table-list\";\nimport CustomTableView from \"@/pages/custom-table\";\nimport HelpPage from \"@/pages/help\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction Router() {\n  return (\n    <div className=\"min-h-screen pb-16 text-sm\">\n      <Switch>\n        <Route path=\"/\">\n          {() => <TablePage />}\n        </Route>\n        <Route path=\"/share/:shareId\">\n          {() => <SharedTablePage />}\n        </Route>\n        <Route path=\"/custom-tables\">\n          {() => <CustomTableList />}\n        </Route>\n        <Route path=\"/custom/:shareId\">\n          {() => <CustomTableView />}\n        </Route>\n        <Route path=\"/help\">\n          {() => <HelpPage />}\n        </Route>\n        <Route component={NotFound} />\n      </Switch>\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider>\n        <TooltipProvider>\n          <Toaster />\n          <Router />\n        </TooltipProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":1474},"client/src/components/media-upload-modal.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Image, Video, Upload, Plus, X, PlayCircle, FileImage, List, FolderOpen } from \"lucide-react\";\nimport { MediaWithCaption } from \"@shared/schema\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface MediaUploadModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSave: (media: MediaWithCaption) => void;\n  onSaveMultiple?: (mediaList: MediaWithCaption[]) => void;\n}\n\nexport function MediaUploadModal({ open, onOpenChange, onSave, onSaveMultiple }: MediaUploadModalProps) {\n  const [mode, setMode] = useState<\"single\" | \"album\">(\"single\");\n  const [mediaType, setMediaType] = useState<\"image\" | \"video\">(\"image\");\n  const [uploadMethod, setUploadMethod] = useState<\"url\" | \"file\">(\"url\");\n  const [url, setUrl] = useState(\"\");\n  const [caption, setCaption] = useState(\"\");\n  const [thumbnail, setThumbnail] = useState(\"\");\n  const [albumItems, setAlbumItems] = useState<MediaWithCaption[]>([]);\n  const [bulkUrls, setBulkUrls] = useState(\"\");\n  const [isProcessing, setIsProcessing] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n\n  const detectVideoType = (url: string) => {\n    if (url.includes('youtube.com') || url.includes('youtu.be')) return 'youtube';\n    if (url.includes('vimeo.com')) return 'vimeo';\n    if (url.includes('.mp4') || url.includes('.webm') || url.includes('.ogg')) return 'direct';\n    return 'unknown';\n  };\n\n  const fileToDataURL = (file: File): Promise<string> => {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => resolve(reader.result as string);\n      reader.onerror = reject;\n      reader.readAsDataURL(file);\n    });\n  };\n\n  const handleFileSelect = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = event.target.files;\n    if (!files || files.length === 0) return;\n\n    setIsProcessing(true);\n    \n    try {\n      if (mode === \"single\") {\n        const file = files[0];\n        const dataURL = await fileToDataURL(file);\n        \n        // Store the actual MIME type with the data URL\n        const urlWithType = dataURL.includes('data:') \n          ? dataURL.replace(/^data:([^;]+)/, `data:${file.type}`) \n          : dataURL;\n        \n        setUrl(urlWithType);\n        \n        if (file.type.startsWith('video/')) {\n          setMediaType('video');\n        } else {\n          setMediaType('image');\n        }\n        \n        toast({\n          title: \"File Loaded\",\n          description: `${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`,\n        });\n      } else {\n        // Album mode - process multiple files\n        const newItems: MediaWithCaption[] = [];\n        \n        for (const file of Array.from(files)) {\n          const dataURL = await fileToDataURL(file);\n          const type = file.type.startsWith('video/') ? 'video' : 'image';\n          \n          // Store the actual MIME type with the data URL\n          const urlWithType = dataURL.includes('data:') \n            ? dataURL.replace(/^data:([^;]+)/, `data:${file.type}`) \n            : dataURL;\n          \n          newItems.push({\n            url: urlWithType,\n            caption: file.name,\n            type: type,\n            mimeType: file.type // Store MIME type for later use\n          });\n        }\n        \n        setAlbumItems([...albumItems, ...newItems]);\n        \n        toast({\n          title: \"Files Loaded\",\n          description: `${files.length} file(s) added to album`,\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to load file(s)\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsProcessing(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  const handleSave = () => {\n    if (mode === \"single\") {\n      if (!url.trim()) return;\n\n      // Extract MIME type from data URL if available\n      const getMimeTypeFromDataURL = (dataUrl: string) => {\n        if (dataUrl.startsWith('data:')) {\n          const match = dataUrl.match(/^data:([^;]+)/);\n          return match ? match[1] : undefined;\n        }\n        return undefined;\n      };\n\n      const media: MediaWithCaption = {\n        url: url.trim(),\n        caption: caption.trim(),\n        type: mediaType,\n        ...(mediaType === \"video\" && thumbnail.trim() && { thumbnail: thumbnail.trim() }),\n        ...(getMimeTypeFromDataURL(url) && { mimeType: getMimeTypeFromDataURL(url) })\n      };\n\n      onSave(media);\n    } else {\n      if (albumItems.length === 0) return;\n      onSaveMultiple?.(albumItems);\n    }\n    \n    handleReset();\n  };\n\n  const addToAlbum = () => {\n    if (!url.trim()) return;\n\n    const media: MediaWithCaption = {\n      url: url.trim(),\n      caption: caption.trim(),\n      type: mediaType,\n      ...(mediaType === \"video\" && thumbnail.trim() && { thumbnail: thumbnail.trim() })\n    };\n\n    setAlbumItems([...albumItems, media]);\n    setUrl(\"\");\n    setCaption(\"\");\n    setThumbnail(\"\");\n  };\n\n  const removeFromAlbum = (index: number) => {\n    setAlbumItems(albumItems.filter((_, i) => i !== index));\n  };\n\n  const handleBulkAdd = () => {\n    const urls = bulkUrls.split('\\n').filter(line => line.trim());\n    const newItems: MediaWithCaption[] = urls.map(url => ({\n      url: url.trim(),\n      caption: '',\n      type: mediaType\n    }));\n    setAlbumItems([...albumItems, ...newItems]);\n    setBulkUrls('');\n  };\n\n  const handleReset = () => {\n    setUrl(\"\");\n    setCaption(\"\");\n    setThumbnail(\"\");\n    setMediaType(\"image\");\n    setAlbumItems([]);\n    setBulkUrls(\"\");\n    setMode(\"single\");\n    setUploadMethod(\"url\");\n    setIsProcessing(false);\n    onOpenChange(false);\n  };\n\n  const handleCancel = () => {\n    handleReset();\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-3m max-h-[90vh] flex flex-col bg-white/95 dark:bg-black/95 backdrop-blur-xl border border-gray-200 dark:border-white/10 shadow-2xl rounded-xl\">\n        <DialogHeader className=\"flex-shrink-0 text-center\">\n          <DialogTitle className=\"flex items-center justify-center gap-2 text-center text-sm font-semibold\">\n            {mode === \"single\" ? <Upload className=\"w-5 h-5\" /> : <List className=\"w-5 h-5\" />}\n            {mode === \"single\" ? \"Add Media\" : \"Add Album\"}\n          </DialogTitle>\n          <DialogDescription className=\"text-center text-muted-foreground text-sm mt-2\">\n            {mode === \"single\" ? \"Upload an image or video to the gallery\" : \"Create an album with multiple media items\"}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"mt-6 space-y-6 overflow-y-auto flex-1 pr-2 px-2\">\n          {/* Mode Selection */}\n          <div className=\"bg-gray-50 dark:bg-black/50 backdrop-blur-sm border border-gray-200 dark:border-white/15 rounded-lg p-4\">\n            <Label className=\"text-sm font-medium text-foreground/90 mb-3 block\">\n              üìÅ Upload Mode\n            </Label>\n            <Tabs value={mode} onValueChange={(value) => setMode(value as \"single\" | \"album\")} className=\"w-full\">\n              <TabsList className=\"grid w-full grid-cols-2 bg-gray-100 dark:bg-white/5\">\n                <TabsTrigger value=\"single\" className=\"flex items-center gap-2\">\n                  <FileImage className=\"w-4 h-4\" />\n                  Single\n                </TabsTrigger>\n                <TabsTrigger value=\"album\" className=\"flex items-center gap-2\">\n                  <List className=\"w-4 h-4\" />\n                  Album\n                </TabsTrigger>\n              </TabsList>\n              \n              <TabsContent value=\"single\" className=\"mt-4\">\n                <div className=\"space-y-4\">\n                  {/* Upload Method Selection */}\n                  <div className=\"space-y-3\">\n                    <Label className=\"text-sm font-medium text-foreground/90\">üì§ Upload Method</Label>\n                    <RadioGroup\n                      value={uploadMethod}\n                      onValueChange={(value) => {\n                        setUploadMethod(value as \"url\" | \"file\");\n                        setUrl(\"\");\n                      }}\n                      className=\"flex gap-6\"\n                    >\n                      <div className=\"flex items-center space-x-2\">\n                        <RadioGroupItem value=\"url\" id=\"method-url\" />\n                        <Label htmlFor=\"method-url\" className=\"flex items-center gap-2 cursor-pointer\">\n                          üîó URL\n                        </Label>\n                      </div>\n                      <div className=\"flex items-center space-x-2\">\n                        <RadioGroupItem value=\"file\" id=\"method-file\" />\n                        <Label htmlFor=\"method-file\" className=\"flex items-center gap-2 cursor-pointer\">\n                          <FolderOpen className=\"w-4 h-4 text-green-400\" />\n                          Upload from Gallery\n                        </Label>\n                      </div>\n                    </RadioGroup>\n                  </div>\n\n                  {/* Media Type Selection (only for URL method) */}\n                  {uploadMethod === \"url\" && (\n                    <div className=\"space-y-3\">\n                      <Label className=\"text-sm font-medium text-foreground/90\">üì∑ Media Type</Label>\n                      <RadioGroup\n                        value={mediaType}\n                        onValueChange={(value) => setMediaType(value as \"image\" | \"video\")}\n                        className=\"flex gap-6\"\n                      >\n                        <div className=\"flex items-center space-x-2\">\n                          <RadioGroupItem value=\"image\" id=\"image\" />\n                          <Label htmlFor=\"image\" className=\"flex items-center gap-2 cursor-pointer\">\n                            <Image className=\"w-4 h-4 text-blue-400\" />\n                            Image\n                          </Label>\n                        </div>\n                        <div className=\"flex items-center space-x-2\">\n                          <RadioGroupItem value=\"video\" id=\"video\" />\n                          <Label htmlFor=\"video\" className=\"flex items-center gap-2 cursor-pointer\">\n                            <Video className=\"w-4 h-4 text-purple-400\" />\n                            Video\n                          </Label>\n                        </div>\n                      </RadioGroup>\n                    </div>\n                  )}\n\n                  {/* File Upload */}\n                  {uploadMethod === \"file\" ? (\n                    <div className=\"space-y-2\">\n                      <Label className=\"text-sm font-medium text-foreground/90\">\n                        üìÅ Select File\n                      </Label>\n                      <input\n                        ref={fileInputRef}\n                        type=\"file\"\n                        accept=\"image/*,video/*\"\n                        onChange={handleFileSelect}\n                        className=\"hidden\"\n                      />\n                      <Button\n                        type=\"button\"\n                        onClick={() => fileInputRef.current?.click()}\n                        disabled={isProcessing}\n                        className=\"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white\"\n                      >\n                        <FolderOpen className=\"w-4 h-4 mr-2\" />\n                        {isProcessing ? \"Processing...\" : \"Choose from Gallery\"}\n                      </Button>\n                      {url && (\n                        <div className=\"mt-3 p-3 bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-500/30 rounded-lg\">\n                          <p className=\"text-xs text-green-700 dark:text-green-300\">\n                            ‚úÖ File loaded successfully! Add caption below and click \"Add\" to save.\n                          </p>\n                        </div>\n                      )}\n                    </div>\n                  ) : (\n                    /* URL Input */\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"url\" className=\"text-sm font-medium text-foreground/90\">\n                        üîó {mediaType === \"video\" ? \"Video URL\" : \"Image URL\"}\n                      </Label>\n                      <Input\n                        id=\"url\"\n                        type=\"url\"\n                        placeholder={mediaType === \"video\" \n                          ? \"YouTube, Vimeo, or direct video URL...\" \n                          : \"https://example.com/image.jpg\"}\n                        value={url}\n                        onChange={(e) => setUrl(e.target.value)}\n                        className=\"bg-white dark:bg-black/60 border-gray-300 dark:border-white/20 backdrop-blur-sm text-sm\"\n                      />\n                      {mediaType === \"video\" && url && (\n                        <p className=\"text-xs text-muted-foreground\">\n                          üé¨ Detected: {detectVideoType(url)} video\n                        </p>\n                      )}\n                    </div>\n                  )}\n\n                  {/* Video Thumbnail (only for videos) */}\n                  {mediaType === \"video\" && (\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"thumbnail\" className=\"text-sm font-medium text-foreground/90\">\n                        üñºÔ∏è Thumbnail URL (optional)\n                      </Label>\n                      <Input\n                        id=\"thumbnail\"\n                        type=\"url\"\n                        placeholder=\"https://example.com/thumbnail.jpg\"\n                        value={thumbnail}\n                        onChange={(e) => setThumbnail(e.target.value)}\n                        className=\"bg-white dark:bg-black/60 border-gray-300 dark:border-white/20 backdrop-blur-sm text-sm\"\n                      />\n                    </div>\n                  )}\n\n                  {/* Caption */}\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"caption\" className=\"text-sm font-medium text-foreground/90\">\n                      üìù Caption (optional)\n                    </Label>\n                    <Textarea\n                      id=\"caption\"\n                      placeholder=\"Enter a caption or description...\"\n                      value={caption}\n                      onChange={(e) => setCaption(e.target.value)}\n                      rows={2}\n                      className=\"bg-white dark:bg-black/60 border-gray-300 dark:border-white/20 backdrop-blur-sm text-sm\"\n                    />\n                  </div>\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"album\" className=\"mt-4\">\n                <div className=\"space-y-4\">\n                  {/* Upload from Gallery (Album mode) */}\n                  <div className=\"bg-green-50 dark:bg-black/20 backdrop-blur-sm border border-green-200 dark:border-white/10 rounded-lg p-3\">\n                    <Label className=\"text-sm font-medium text-foreground/90 mb-2 block\">üìÅ Upload from Gallery</Label>\n                    <input\n                      type=\"file\"\n                      accept=\"image/*,video/*\"\n                      multiple\n                      onChange={handleFileSelect}\n                      className=\"hidden\"\n                      id=\"album-file-input\"\n                    />\n                    <Button\n                      type=\"button\"\n                      onClick={() => document.getElementById('album-file-input')?.click()}\n                      disabled={isProcessing}\n                      className=\"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white\"\n                    >\n                      <FolderOpen className=\"w-4 h-4 mr-2\" />\n                      {isProcessing ? \"Processing...\" : \"Select Multiple Files\"}\n                    </Button>\n                  </div>\n\n                  {/* Album Builder */}\n                  <div className=\"space-y-3\">\n                    <Label className=\"text-sm font-medium text-foreground/90\">üì∑ Media Type for URL Input</Label>\n                    <RadioGroup\n                      value={mediaType}\n                      onValueChange={(value) => setMediaType(value as \"image\" | \"video\")}\n                      className=\"flex gap-6\"\n                    >\n                      <div className=\"flex items-center space-x-2\">\n                        <RadioGroupItem value=\"image\" id=\"album-image\" />\n                        <Label htmlFor=\"album-image\" className=\"flex items-center gap-2 cursor-pointer\">\n                          <Image className=\"w-4 h-4 text-blue-400\" />\n                          Images\n                        </Label>\n                      </div>\n                      <div className=\"flex items-center space-x-2\">\n                        <RadioGroupItem value=\"video\" id=\"album-video\" />\n                        <Label htmlFor=\"album-video\" className=\"flex items-center gap-2 cursor-pointer\">\n                          <Video className=\"w-4 h-4 text-purple-400\" />\n                          Videos\n                        </Label>\n                      </div>\n                    </RadioGroup>\n                  </div>\n\n                  {/* Single Item Add */}\n                  <div className=\"bg-blue-50 dark:bg-black/20 backdrop-blur-sm border border-blue-200 dark:border-white/10 rounded-lg p-3\">\n                    <Label className=\"text-sm font-medium text-foreground/90 mb-2 block\">Add URL Item to Album</Label>\n                    <div className=\"space-y-2\">\n                      <Input\n                        type=\"url\"\n                        placeholder={mediaType === \"video\" \n                          ? \"Video URL...\" \n                          : \"Image URL...\"}\n                        value={url}\n                        onChange={(e) => setUrl(e.target.value)}\n                        className=\"bg-white dark:bg-black/60 border-gray-300 dark:border-white/20 backdrop-blur-sm text-sm\"\n                      />\n                      <div className=\"flex gap-2\">\n                        <Input\n                          placeholder=\"Caption (optional)\"\n                          value={caption}\n                          onChange={(e) => setCaption(e.target.value)}\n                          className=\"flex-1 bg-white dark:bg-black/40 border-gray-300 dark:border-white/15 backdrop-blur-sm\"\n                        />\n                        <Button\n                          type=\"button\"\n                          onClick={addToAlbum}\n                          disabled={!url.trim()}\n                          className=\"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white\"\n                        >\n                          <Plus className=\"w-4 h-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Bulk Add */}\n                  <div className=\"bg-purple-50 dark:bg-black/20 backdrop-blur-sm border border-purple-200 dark:border-white/10 rounded-lg p-3\">\n                    <Label className=\"text-sm font-medium text-foreground/90 mb-2 block\">Bulk Add URLs</Label>\n                    <Textarea\n                      placeholder=\"Paste multiple URLs (one per line)...\"\n                      value={bulkUrls}\n                      onChange={(e) => setBulkUrls(e.target.value)}\n                      rows={3}\n                      className=\"bg-white dark:bg-black/60 border-gray-300 dark:border-white/20 backdrop-blur-sm text-sm\"\n                    />\n                    <Button\n                      type=\"button\"\n                      onClick={handleBulkAdd}\n                      disabled={!bulkUrls.trim()}\n                      className=\"mt-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white\"\n                      size=\"sm\"\n                    >\n                      <List className=\"w-4 h-4 mr-2\" />\n                      Add All\n                    </Button>\n                  </div>\n\n                  {/* Album Preview */}\n                  {albumItems.length > 0 && (\n                    <div className=\"bg-purple-50 dark:bg-black/20 backdrop-blur-sm border border-purple-200 dark:border-white/10 rounded-lg p-3\">\n                      <Label className=\"text-sm font-medium text-foreground/90 mb-3 block\">\n                        üìö Album Preview ({albumItems.length} items)\n                      </Label>\n                      <div className=\"space-y-2 max-h-40 overflow-y-auto\">\n                        {albumItems.map((item, index) => (\n                          <div key={index} className=\"flex items-center gap-2 p-2 bg-white dark:bg-white/5 rounded border border-purple-200 dark:border-white/10\">\n                            {item.type === \"video\" ? (\n                              <PlayCircle className=\"w-4 h-4 text-purple-400 flex-shrink-0\" />\n                            ) : (\n                              <Image className=\"w-4 h-4 text-blue-400 flex-shrink-0\" />\n                            )}\n                            <span className=\"text-xs text-foreground/70 truncate flex-1\">\n                              {item.caption || item.url}\n                            </span>\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => removeFromAlbum(index)}\n                              className=\"h-6 w-6 p-0 hover:bg-red-500/20\"\n                            >\n                              <X className=\"w-3 h-3\" />\n                            </Button>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </TabsContent>\n            </Tabs>\n          </div>\n        </div>\n\n        <DialogFooter className=\"space-x-3 flex-shrink-0 mt-6 border-t border-gray-200 dark:border-white/15 pt-4 bg-gray-50 dark:bg-black/50 backdrop-blur-sm rounded-b-xl -mx-6 -mb-6 px-6 py-4\">\n          <Button \n            variant=\"outline\" \n            onClick={handleCancel}\n            className=\"border-red-600 text-red-600 hover:bg-red-50 dark:border-red-500 dark:text-red-500 dark:hover:bg-red-950/30 backdrop-blur-sm\"\n          >\n            <X className=\"w-4 h-4 mr-2\" />\n            Cancel\n          </Button>\n          <Button \n            onClick={handleSave}\n            disabled={mode === \"single\" ? !url.trim() : albumItems.length === 0}\n            className=\"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white border-0 shadow-lg shadow-blue-500/30\"\n          >\n            <Upload className=\"w-4 h-4 mr-2\" />\n            {mode === \"single\" \n              ? `Add ${mediaType === \"video\" ? \"Video\" : \"Image\"}` \n              : `Add Album (${albumItems.length} items)`}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":23816},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/40 dark:bg-black/85 backdrop-blur-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 transition-all duration-300 ease-out\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border-2 border-border bg-card backdrop-blur-lg p-6 shadow-2xl duration-300 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-xl transition-all ease-out\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3547},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"server/db.ts":{"content":"import { Pool, neonConfig, type PoolConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nlet _pool: Pool | null = null;\nlet _db: ReturnType<typeof drizzle> | null = null;\n\nexport function initDb() {\n  if (_db) return _db;\n  \n  if (!process.env.DATABASE_URL) {\n    throw new Error(\n      \"DATABASE_URL must be set. Did you forget to provision a database?\",\n    );\n  }\n  \n  const poolConfig: PoolConfig = {\n    connectionString: process.env.DATABASE_URL,\n    connectionTimeoutMillis: 5000,\n  };\n  \n  _pool = new Pool(poolConfig);\n  _db = drizzle({ client: _pool, schema });\n  \n  return _db;\n}\n\nexport function getDb() {\n  if (!_db) {\n    return initDb();\n  }\n  return _db;\n}\n\n// Lazy getters for backward compatibility\nexport const pool = new Proxy({} as Pool, {\n  get(_target, prop) {\n    if (!_pool) initDb();\n    return (_pool as any)[prop];\n  }\n});\n\nexport const db = new Proxy({} as ReturnType<typeof drizzle>, {\n  get(_target, prop) {\n    if (!_db) initDb();\n    return (_db as any)[prop];\n  }\n});\n","size_bytes":1149},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/editable-description-list.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Plus, Trash2 } from \"lucide-react\";\n\ninterface DescriptionItem {\n  term: string;\n  definition: string;\n}\n\ninterface EditableDescriptionListProps {\n  value: string;\n  onSave: (newValue: string) => void;\n  isEditable?: boolean;\n}\n\nexport function EditableDescriptionList({ value, onSave, isEditable = true }: EditableDescriptionListProps) {\n  const parseItems = (text: string): DescriptionItem[] => {\n    if (!text.trim()) return [];\n    return text.split('\\n')\n      .map(line => line.trim())\n      .filter(line => line.length > 0)\n      .map((line, index) => {\n        // Check if line has format \"term : definition\"\n        if (line.includes(' : ')) {\n          const [term, ...defParts] = line.split(' : ');\n          return {\n            term: term.trim() || `Item ${index + 1}`,\n            definition: defParts.join(' : ').trim()\n          };\n        }\n        // Default format without term\n        return {\n          term: `Item ${index + 1}`,\n          definition: line\n        };\n      });\n  };\n\n  // Local state for editing - allows smooth typing\n  const [items, setItems] = useState<DescriptionItem[]>(parseItems(value));\n  const [lastValue, setLastValue] = useState(value);\n\n  // Only sync from parent when value actually changes externally\n  useEffect(() => {\n    // Only update if the incoming value is different from what we last synced\n    if (value !== lastValue) {\n      const currentSerialized = items.map(item => item.definition).join('\\n');\n      const incomingParsed = parseItems(value);\n      const incomingSerialized = incomingParsed.map(item => item.definition).join('\\n');\n      \n      // Only update if values are actually different (prevents unnecessary resets during typing)\n      if (currentSerialized !== incomingSerialized) {\n        setItems(incomingParsed);\n        setLastValue(value);\n      }\n    }\n  }, [value, lastValue, items]);\n\n  const serializeItems = (itemsToSerialize: DescriptionItem[]): string => {\n    return itemsToSerialize\n      .filter(item => item.definition.trim() || item.term.trim())\n      .map(item => {\n        // Save in format \"term : definition\"\n        if (item.term.trim() && item.definition.trim()) {\n          return `${item.term.trim()} : ${item.definition.trim()}`;\n        }\n        // If only definition, save as plain text\n        return item.definition.trim();\n      })\n      .join('\\n');\n  };\n\n  const handleAddItem = () => {\n    const newItems = [...items, { term: `Item ${items.length + 1}`, definition: '' }];\n    setItems(newItems);\n    const newValue = serializeItems(newItems);\n    onSave(newValue);\n  };\n\n  const handleRemoveItem = (index: number) => {\n    const newItems = items.filter((_, i) => i !== index);\n    setItems(newItems);\n    const newValue = serializeItems(newItems);\n    onSave(newValue);\n  };\n\n  const handleTermChange = (index: number, newTerm: string) => {\n    const newItems = [...items];\n    newItems[index].term = newTerm;\n    setItems(newItems);\n  };\n\n  const handleTermBlur = (index: number) => {\n    // Save when user leaves the term field\n    const newValue = serializeItems(items);\n    onSave(newValue);\n  };\n\n  const handleDefinitionChange = (index: number, newDefinition: string) => {\n    const newItems = [...items];\n    newItems[index].definition = newDefinition;\n    setItems(newItems);\n  };\n\n  // Save on blur instead of on every keystroke\n  const handleDefinitionBlur = (index: number) => {\n    const newValue = serializeItems(items);\n    onSave(newValue);\n  };\n\n  if (!isEditable) {\n    const displayItems = parseItems(value);\n    return (\n      <div className=\"space-y-2\">\n        {displayItems.length > 0 ? (\n          <dl className=\"space-y-2\" style={{fontSize: '10px'}}>\n            {displayItems.map((item, index) => (\n              <div key={index} className=\"flex items-start gap-3\">\n                <dt className=\"w-20 flex-shrink-0 font-semibold text-blue-600 dark:text-blue-400\">\n                  {item.term}\n                </dt>\n                <dd className=\"flex-1 text-gray-700 dark:text-gray-300 m-0\">\n                  {item.definition}\n                </dd>\n              </div>\n            ))}\n          </dl>\n        ) : (\n          <p className=\"text-muted-foreground\" style={{fontSize: '10px'}}>No information available</p>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-3\">\n      {items.length > 0 ? (\n        <div className=\"space-y-2\">\n          {items.map((item, index) => (\n            <div key={index} className=\"flex items-start gap-2\">\n              <Input\n                value={item.term}\n                onChange={(e) => handleTermChange(index, e.target.value)}\n                onBlur={() => handleTermBlur(index)}\n                className=\"w-24\"\n                style={{fontSize: '10px'}}\n                placeholder=\"Term\"\n                data-testid={`input-item-term-${index}`}\n              />\n              <Input\n                value={item.definition}\n                onChange={(e) => handleDefinitionChange(index, e.target.value)}\n                onBlur={() => handleDefinitionBlur(index)}\n                className=\"flex-1\"\n                style={{fontSize: '10px'}}\n                placeholder=\"Definition\"\n                data-testid={`input-item-definition-${index}`}\n              />\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"h-8 w-8 p-0 bg-transparent border-transparent hover:bg-transparent hover:border-transparent text-red-600 hover:text-red-700\"\n                onClick={() => handleRemoveItem(index)}\n                data-testid={`button-remove-item-${index}`}\n              >\n                <Trash2 className=\"w-3 h-3\" />\n              </Button>\n            </div>\n          ))}\n        </div>\n      ) : (\n        <p className=\"text-muted-foreground\" style={{fontSize: '10px'}}>No items yet. Click \"Add Item\" to start.</p>\n      )}\n      \n      <Button\n        variant=\"outline\"\n        size=\"sm\"\n        onClick={handleAddItem}\n        className=\"bg-transparent border-transparent hover:bg-transparent hover:border-transparent text-blue-600 hover:text-blue-700\"\n        style={{fontSize: '10px'}}\n        data-testid=\"button-add-item\"\n      >\n        <Plus className=\"w-3 h-3 mr-1\" />\n        Add Item\n      </Button>\n    </div>\n  );\n}\n","size_bytes":6449},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n    rollupOptions: {\n      output: {\n        manualChunks: {\n          'react-vendor': ['react', 'react-dom'],\n          'ui-vendor': ['@radix-ui/react-dialog', '@radix-ui/react-dropdown-menu', '@radix-ui/react-select'],\n          'map-vendor': ['leaflet', 'react-leaflet'],\n          'gallery-vendor': ['lightgallery'],\n        },\n      },\n    },\n    chunkSizeWarningLimit: 1000,\n    minify: 'esbuild',\n    sourcemap: false,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n  optimizeDeps: {\n    include: ['react', 'react-dom', 'lucide-react'],\n    exclude: [],\n  },\n});\n","size_bytes":1490},"client/src/components/mini-map.tsx":{"content":"import { useState, useEffect, useMemo, useCallback, memo } from \"react\";\nimport { MapContainer, TileLayer, Marker, Popup, useMap } from \"react-leaflet\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogTrigger,\n  DialogClose,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport { Maximize2, Filter, X, Navigation } from \"lucide-react\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport L from \"leaflet\";\n\n// Fix for default markers in Leaflet\ndelete (L.Icon.Default.prototype as any)._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl:\n    \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png\",\n  iconUrl:\n    \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png\",\n  shadowUrl:\n    \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png\",\n});\n\n// Function to get route color based on route code\nconst getRouteColor = (code?: string): string => {\n  if (!code) return 'black';\n  \n  const routeCode = code.toLowerCase().trim();\n  \n  // Color mapping for different routes\n  // KL Routes\n  if (routeCode.includes('kl 7') || routeCode.includes('kl7')) return 'blue';\n  if (routeCode.includes('kl 6') || routeCode.includes('kl6')) return 'green';\n  if (routeCode.includes('kl 4') || routeCode.includes('kl4')) return 'red';\n  if (routeCode.includes('kl 3') || routeCode.includes('kl3')) return 'orange';\n  if (routeCode.includes('kl 1') || routeCode.includes('kl1')) return 'violet';\n  if (routeCode.includes('kl 5') || routeCode.includes('kl5')) return 'yellow';\n  if (routeCode.includes('kl 9') || routeCode.includes('kl9')) return 'grey';\n  \n  // SL Routes\n  if (routeCode.includes('sl 1') || routeCode.includes('sl1')) return 'gold';\n  if (routeCode.includes('sl 2') || routeCode.includes('sl2')) return 'blue';\n  if (routeCode.includes('sl 3') || routeCode.includes('sl3')) return 'grey';\n  \n  // Set Routes\n  if (routeCode.includes('set 1') || routeCode.includes('set1')) return 'grey';\n  if (routeCode.includes('set 2') || routeCode.includes('set2')) return 'red';\n  if (routeCode.includes('set 3') || routeCode.includes('set3')) return 'orange';\n  \n  // Special locations\n  if (routeCode.includes('warehouse')) return 'black';\n  \n  // Default color for other routes\n  return 'black';\n};\n\n// Cached icons for better performance - avoid recreating on each render\nconst iconCache = new Map<string, L.Icon>();\n\n// Create custom colored marker from hex color using SVG\nconst createCustomColorIcon = (hexColor: string, isCurrent: boolean = false) => {\n  const cacheKey = `custom-${hexColor}-${isCurrent}`;\n  \n  if (!iconCache.has(cacheKey)) {\n    const svgIcon = `\n      <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 36\" width=\"24\" height=\"36\">\n        <path fill=\"${hexColor}\" stroke=\"#000\" stroke-width=\"1\" d=\"M12 0C7.6 0 4 3.6 4 8c0 5.4 8 16 8 16s8-10.6 8-16c0-4.4-3.6-8-8-8zm0 12c-2.2 0-4-1.8-4-4s1.8-4 4-4 4 1.8 4 4-1.8 4-4 4z\"/>\n      </svg>\n    `;\n    \n    const iconUrl = 'data:image/svg+xml;base64,' + btoa(svgIcon);\n    \n    iconCache.set(cacheKey, new L.Icon({\n      iconUrl: iconUrl,\n      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\n      iconSize: [12, 18],        // Smaller size\n      iconAnchor: [6, 18],        // Adjusted anchor\n      popupAnchor: [0, -16],      // Adjusted popup anchor\n      shadowSize: [15, 15],       // Reduced shadow\n      className: isCurrent ? 'current-location-marker' : ''\n    }));\n  }\n  \n  return iconCache.get(cacheKey)!;\n};\n\n// Create smaller colored marker icons (reduced from 18x30 to 12x20)\nconst createColoredIcon = (color: string, isCurrent: boolean = false) => {\n  const cacheKey = `${color}-${isCurrent}`;\n  \n  if (!iconCache.has(cacheKey)) {\n    iconCache.set(cacheKey, new L.Icon({\n      iconUrl: `https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${color}.png`,\n      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\n      iconSize: [12, 20],        // Reduced from [18, 30]\n      iconAnchor: [6, 20],        // Adjusted anchor\n      popupAnchor: [0, -18],      // Adjusted popup anchor\n      shadowSize: [15, 15],       // Reduced shadow\n      className: isCurrent ? 'current-location-marker' : ''\n    }));\n  }\n  \n  return iconCache.get(cacheKey)!;\n};\n\ninterface MapLocation {\n  latitude: number;\n  longitude: number;\n  label: string;\n  code?: string;\n  isCurrent?: boolean;\n  markerColor?: string;\n}\n\ninterface MiniMapProps {\n  locations: MapLocation[];\n  height?: string;\n  showFullscreenButton?: boolean;\n}\n\nfunction MapResizer({\n  center,\n  zoom,\n}: {\n  center: [number, number];\n  zoom: number;\n}) {\n  const map = useMap();\n\n  useEffect(() => {\n    if (!map || !map.getContainer()) return;\n    \n    try {\n      map.setView(center, zoom, { animate: true, duration: 0.5 });\n      \n      // Optimized delay for proper rendering\n      const timeout = setTimeout(() => {\n        try {\n          if (map?.getContainer()?.parentNode) {\n            map.invalidateSize({ animate: false });\n          }\n        } catch (sizeError: any) {\n          // Silently handle sizing errors during cleanup\n          console.debug('Map invalidateSize skipped:', sizeError?.message || 'Unknown error');\n        }\n      }, 100);\n\n      return () => clearTimeout(timeout);\n    } catch (error) {\n      console.warn('Map error:', error);\n    }\n  }, [map, center, zoom]);\n\n  return null;\n}\n\n// Component to handle \"back to current marker\" functionality\nfunction BackToCurrentButton({ \n  currentLocation \n}: { \n  currentLocation: MapLocation | undefined \n}) {\n  const map = useMap();\n\n  const handleBackToCurrent = useCallback(() => {\n    if (currentLocation && map) {\n      map.setView(\n        [currentLocation.latitude, currentLocation.longitude], \n        15, \n        { animate: true, duration: 0.8 }\n      );\n    }\n  }, [currentLocation, map]);\n\n  if (!currentLocation) return null;\n\n  return (\n    <div className=\"absolute top-4 right-4 z-[1000]\">\n      <Button\n        variant=\"outline\"\n        size=\"sm\"\n        onClick={handleBackToCurrent}\n        className=\"bg-white/95 hover:bg-white shadow-lg border-2 border-blue-500 hover:border-blue-600 backdrop-blur-sm\"\n        data-testid=\"button-back-to-current\"\n        title=\"Back to current location\"\n      >\n        <Navigation className=\"w-4 h-4 text-blue-500\" />\n      </Button>\n    </div>\n  );\n}\n\nexport const MiniMap = memo(function MiniMap({\n  locations,\n  height = \"500px\",\n  showFullscreenButton = true,\n}: MiniMapProps) {\n  const [fullscreenOpen, setFullscreenOpen] = useState(false);\n  const [selectedRoutes, setSelectedRoutes] = useState<string[]>([]);\n\n  // Get unique routes from locations\n  const uniqueRoutes = useMemo(() => {\n    const routes = locations\n      .map(loc => loc.code)\n      .filter((code): code is string => !!code)\n      .filter((code, index, arr) => arr.indexOf(code) === index)\n      .sort();\n    return routes;\n  }, [locations]);\n\n  // Initialize selectedRoutes with all routes\n  useEffect(() => {\n    if (uniqueRoutes.length > 0 && selectedRoutes.length === 0) {\n      setSelectedRoutes(uniqueRoutes);\n    }\n  }, [uniqueRoutes]);\n\n  const toggleRoute = (route: string) => {\n    setSelectedRoutes(prev => \n      prev.includes(route) \n        ? prev.filter(r => r !== route)\n        : [...prev, route]\n    );\n  };\n\n  const selectAllRoutes = () => {\n    setSelectedRoutes(uniqueRoutes);\n  };\n\n  const clearAllRoutes = () => {\n    setSelectedRoutes([]);\n  };\n\n  const MapContent = ({ isFullscreen = false }: { isFullscreen?: boolean }) => {\n    // For mini view: show only current location; for fullscreen: filter by selected routes\n    // Memoized to avoid recalculation on every render\n    const renderedLocations = useMemo(() => {\n      return isFullscreen \n        ? locations.filter(loc => !loc.code || selectedRoutes.includes(loc.code))\n        : locations.filter(l => l.isCurrent).length \n          ? locations.filter(l => l.isCurrent) \n          : [locations[0]];\n    }, [isFullscreen, selectedRoutes]);\n\n    // Find current location for \"back to current\" button\n    const currentLocation = useMemo(() => \n      locations.find(loc => loc.isCurrent), \n      [locations]\n    );\n\n    // Calculate center and zoom from rendered locations - memoized for performance\n    const center = useMemo((): [number, number] => {\n      if (renderedLocations.length === 0) return [3.139003, 101.686855];\n      const avgLat = renderedLocations.reduce((sum, loc) => sum + loc.latitude, 0) / renderedLocations.length;\n      const avgLng = renderedLocations.reduce((sum, loc) => sum + loc.longitude, 0) / renderedLocations.length;\n      return [avgLat, avgLng];\n    }, [renderedLocations]);\n\n    const zoom = useMemo((): number => {\n      if (renderedLocations.length <= 1) return 15;\n      const lats = renderedLocations.map((loc) => loc.latitude);\n      const lngs = renderedLocations.map((loc) => loc.longitude);\n      const latRange = Math.max(...lats) - Math.min(...lats);\n      const lngRange = Math.max(...lngs) - Math.min(...lngs);\n      const maxRange = Math.max(latRange, lngRange);\n      if (maxRange > 5) return 8;\n      if (maxRange > 2) return 10;\n      if (maxRange > 1) return 12;\n      if (maxRange > 0.5) return 13;\n      if (maxRange > 0.1) return 14;\n      return 15;\n    }, [renderedLocations]);\n\n    return (\n    <MapContainer\n      center={center}\n      zoom={zoom}\n      style={{ height: isFullscreen ? \"100%\" : height, width: \"100%\" }}\n      className=\"rounded-lg border border-border\"\n      preferCanvas={true}\n      zoomControl={isFullscreen}\n    >\n      <TileLayer\n        attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        updateWhenIdle={true}\n        updateWhenZooming={false}\n        keepBuffer={2}\n      />\n      <MapResizer center={center} zoom={zoom} />\n      {isFullscreen && <BackToCurrentButton currentLocation={currentLocation} />}\n      {renderedLocations.map((location, index) => {\n        // Use custom marker color if provided, otherwise use route-based color\n        const markerColor = location.markerColor || getRouteColor(location.code);\n        const markerIcon = location.markerColor && location.markerColor.startsWith('#')\n          ? createCustomColorIcon(location.markerColor, location.isCurrent)\n          : createColoredIcon(markerColor, location.isCurrent);\n        \n        return (\n          <Marker \n            key={`${location.latitude}-${location.longitude}-${index}`}\n            position={[location.latitude, location.longitude]}\n            icon={markerIcon}\n          >\n            <Popup>\n              <div className=\"text-center\">\n                <div className=\"font-semibold\">{location.label}</div>\n                {location.code && (\n                  <div className=\"text-sm font-medium\" style={{ color: markerColor === 'black' ? '#000' : markerColor }}>\n                    Route: {location.code}\n                  </div>\n                )}\n                <div className=\"text-xs text-muted-foreground mt-1\">\n                  {location.latitude.toFixed(6)}, {location.longitude.toFixed(6)}\n                </div>\n              </div>\n            </Popup>\n          </Marker>\n        );\n      })}\n    </MapContainer>\n    );\n  };\n\n  if (locations.length === 0) {\n    return (\n      <div\n        style={{ height }}\n        className=\"flex items-center justify-center bg-muted rounded-lg border border-border\"\n      >\n        <p className=\"text-sm text-muted-foreground\">\n          No location data available\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"relative\">\n      <div className=\"pointer-events-auto\">\n        <MapContent />\n      </div>\n      \n      {showFullscreenButton && (\n        <div className=\"absolute top-2 right-2 z-[1001] pointer-events-auto\">\n          <Dialog open={fullscreenOpen} onOpenChange={setFullscreenOpen}>\n            <DialogTrigger asChild>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"bg-white/95 hover:bg-white shadow-lg border-2 border-gray-400 backdrop-blur-sm pointer-events-auto\"\n                data-testid=\"button-fullscreen-map\"\n              >\n                <Maximize2 className=\"w-4 h-4 text-black\" />\n              </Button>\n            </DialogTrigger>\n            <DialogContent \n              className=\"max-w-[95vw] w-full p-6\"\n              style={{\n                height: 'min(90vh, calc(100dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom) - 40px))',\n                touchAction: 'pan-y',\n              }}\n            >\n              <DialogHeader \n                className=\"flex flex-row items-center justify-between space-y-0\"\n                style={{ paddingTop: 'max(0rem, env(safe-area-inset-top))' }}\n              >\n                <DialogTitle className=\"tracking-tight font-semibold text-[12px]\">\n                  Map View - {locations.length === 1 \n                    ? locations[0].label \n                    : `${locations.length} Locations`}\n                </DialogTitle>\n                <DialogDescription className=\"sr-only\">\n                  Interactive map showing delivery locations with route filters\n                </DialogDescription>\n                <div className=\"flex items-center gap-2\">\n                  <Popover>\n                    <PopoverTrigger asChild>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        data-testid=\"button-filter-routes\"\n                      >\n                        <Filter className=\"w-4 h-4 mr-2\" />\n                        Filter Routes ({selectedRoutes.length}/{uniqueRoutes.length})\n                      </Button>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-80\" align=\"end\">\n                      <div className=\"space-y-4\">\n                        <div className=\"flex items-center justify-between\">\n                          <h4 className=\"font-semibold text-sm\">Select Routes</h4>\n                          <div className=\"flex gap-2\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={selectAllRoutes}\n                              className=\"h-7 text-xs\"\n                            >\n                              All\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={clearAllRoutes}\n                              className=\"h-7 text-xs\"\n                            >\n                              Clear\n                            </Button>\n                          </div>\n                        </div>\n                        <div className=\"max-h-[300px] overflow-y-auto space-y-2\">\n                          {uniqueRoutes.map((route) => {\n                            const routeColor = getRouteColor(route);\n                            return (\n                              <div key={route} className=\"flex items-center space-x-2\">\n                                <Checkbox\n                                  id={`route-${route}`}\n                                  checked={selectedRoutes.includes(route)}\n                                  onCheckedChange={() => toggleRoute(route)}\n                                />\n                                <Label\n                                  htmlFor={`route-${route}`}\n                                  className=\"flex items-center gap-2 cursor-pointer flex-1\"\n                                >\n                                  <div \n                                    className=\"w-3 h-3 rounded-full\" \n                                    style={{ backgroundColor: routeColor === 'black' ? '#000' : routeColor }}\n                                  />\n                                  <span className=\"text-sm\">{route}</span>\n                                </Label>\n                              </div>\n                            );\n                          })}\n                        </div>\n                      </div>\n                    </PopoverContent>\n                  </Popover>\n                  <DialogClose asChild>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"pagination-button text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-300\"\n                      data-testid=\"button-close-map\"\n                    >\n                      <X className=\"w-4 h-4\" />\n                    </Button>\n                  </DialogClose>\n                </div>\n              </DialogHeader>\n              <div \n                className=\"mt-4\"\n                style={{\n                  height: 'min(calc(90vh - 100px), calc(100dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom) - 140px))',\n                  WebkitOverflowScrolling: 'touch',\n                  overscrollBehavior: 'contain',\n                }}\n              >\n                <MapContent isFullscreen />\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n      )}\n    </div>\n  );\n}, (prevProps, nextProps) => {\n  // Custom comparison function to prevent unnecessary re-renders\n  // Only re-render if locations array actually changed (deep comparison)\n  if (prevProps.locations.length !== nextProps.locations.length) return false;\n  if (prevProps.height !== nextProps.height) return false;\n  if (prevProps.showFullscreenButton !== nextProps.showFullscreenButton) return false;\n  \n  // Compare each location object\n  for (let i = 0; i < prevProps.locations.length; i++) {\n    const prev = prevProps.locations[i];\n    const next = nextProps.locations[i];\n    if (\n      prev.latitude !== next.latitude ||\n      prev.longitude !== next.longitude ||\n      prev.label !== next.label ||\n      prev.code !== next.code ||\n      prev.isCurrent !== next.isCurrent ||\n      prev.markerColor !== next.markerColor\n    ) {\n      return false;\n    }\n  }\n  \n  return true; // Props are equal, don't re-render\n});\n","size_bytes":18528},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"server/googleMaps.ts":{"content":"import type { TableRow } from \"@shared/schema\";\n\nconst GOOGLE_MAPS_API_KEY = process.env.GOOGLE_API_KEY;\nconst QL_KITCHEN_LOCATION = {\n  latitude: 3.0738,\n  longitude: 101.5183,\n};\n\ninterface MoneyObject {\n  currencyCode: string;\n  units?: string;\n  nanos?: number;\n}\n\ninterface TollInfo {\n  estimatedPrice?: MoneyObject[];\n}\n\ninterface RouteResponse {\n  routes?: Array<{\n    distanceMeters?: number;\n    duration?: string;\n    travelAdvisory?: {\n      tollInfo?: TollInfo;\n    };\n  }>;\n}\n\ninterface RouteCalculationResult {\n  distanceKm: number;\n  tollPrice: number;\n}\n\n/**\n * Calculate route distance and toll price from QL Kitchen to a destination using Google Maps Routes API\n * Optimized for lorry vehicle with shortest road routes\n * @param destination The destination row with latitude and longitude\n * @returns Object containing distance in kilometers and toll price in MYR\n */\nexport async function calculateRouteForLorry(destination: TableRow): Promise<RouteCalculationResult> {\n  if (!GOOGLE_MAPS_API_KEY) {\n    console.warn(\"Google Maps API key not configured\");\n    return { distanceKm: 0, tollPrice: 0 };\n  }\n\n  if (!destination.latitude || !destination.longitude) {\n    console.warn(`No coordinates for destination: ${destination.location}`);\n    return { distanceKm: 0, tollPrice: 0 };\n  }\n\n  try {\n    const url = \"https://routes.googleapis.com/directions/v2:computeRoutes\";\n    \n    const requestBody = {\n      origin: {\n        location: {\n          latLng: {\n            latitude: QL_KITCHEN_LOCATION.latitude,\n            longitude: QL_KITCHEN_LOCATION.longitude,\n          },\n        },\n      },\n      destination: {\n        location: {\n          latLng: {\n            latitude: parseFloat(destination.latitude.toString()),\n            longitude: parseFloat(destination.longitude.toString()),\n          },\n        },\n      },\n      travelMode: \"DRIVE\",\n      routingPreference: \"TRAFFIC_AWARE_OPTIMAL\", // Optimizes for shortest route considering traffic\n      computeAlternativeRoutes: false,\n      routeModifiers: {\n        vehicleInfo: {\n          emissionType: \"DIESEL\",\n        },\n        avoidTolls: false, // We want toll info for lorries\n        avoidHighways: false, // Lorries use highways\n        avoidFerries: true, // Avoid ferries for lorries when possible\n      },\n      extraComputations: [\"TOLLS\"],\n      units: \"METRIC\",\n    };\n\n    const response = await fetch(url, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"X-Goog-Api-Key\": GOOGLE_MAPS_API_KEY,\n        \"X-Goog-FieldMask\": \"routes.distanceMeters,routes.duration,routes.travelAdvisory.tollInfo\",\n      },\n      body: JSON.stringify(requestBody),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      console.error(`Google Maps API error: ${response.status} - ${errorText}`);\n      return { distanceKm: 0, tollPrice: 0 };\n    }\n\n    const data: RouteResponse = await response.json();\n    \n    if (!data.routes || data.routes.length === 0) {\n      console.warn(`No route found for destination: ${destination.location}`);\n      return { distanceKm: 0, tollPrice: 0 };\n    }\n\n    const route = data.routes[0];\n    \n    // Extract distance in kilometers\n    const distanceKm = route.distanceMeters ? Math.round((route.distanceMeters / 1000) * 10) / 10 : 0;\n    \n    // Extract toll information\n    const tollInfo = route.travelAdvisory?.tollInfo;\n    let tollPrice = 0;\n    \n    if (tollInfo && tollInfo.estimatedPrice && tollInfo.estimatedPrice.length > 0) {\n      // Google Maps returns toll prices in the Money object format\n      // estimatedPrice is an array of Money objects (usually one for MYR in Malaysia)\n      // Find MYR entry or use the first one\n      const myrToll = tollInfo.estimatedPrice.find(price => price.currencyCode === 'MYR') \n        || tollInfo.estimatedPrice[0];\n      \n      if (myrToll) {\n        // Convert Money object to decimal: units + (nanos / 1000000000)\n        const units = parseFloat(myrToll.units || '0');\n        const nanos = (myrToll.nanos || 0) / 1000000000;\n        tollPrice = units + nanos;\n        \n        // Apply class 1 lorry pricing adjustment if needed\n        // Google Maps may not have vehicle class-specific pricing,\n        // so we apply a multiplier based on Malaysian toll rates\n        // Class 1 lorries (under 3.5 tons) typically pay standard rates\n        const class1Multiplier = 1.0; // No adjustment needed for class 1\n        \n        tollPrice = Math.round(tollPrice * class1Multiplier * 100) / 100;\n      }\n    }\n    \n    return { distanceKm, tollPrice };\n  } catch (error) {\n    console.error(`Error calculating route for ${destination.location}:`, error);\n    return { distanceKm: 0, tollPrice: 0 };\n  }\n}\n\n/**\n * Legacy function for backward compatibility\n * @deprecated Use calculateRouteForLorry instead\n */\nexport async function calculateTollPrice(destination: TableRow): Promise<number> {\n  const result = await calculateRouteForLorry(destination);\n  return result.tollPrice;\n}\n\n/**\n * Calculate routes (distance and toll prices) for multiple destinations in batch\n * Uses lorry-optimized routing with shortest road preference\n * @param destinations Array of destination rows\n * @returns Object with distances and toll prices for each destination\n */\nexport async function calculateRoutesForDestinations(\n  destinations: TableRow[]\n): Promise<{ distances: Record<string, number>; tollPrices: Record<string, number> }> {\n  const distances: Record<string, number> = {};\n  const tollPrices: Record<string, number> = {};\n\n  // Process destinations in parallel with rate limiting\n  const batchSize = 5; // Process 5 at a time to avoid rate limits\n  \n  for (let i = 0; i < destinations.length; i += batchSize) {\n    const batch = destinations.slice(i, i + batchSize);\n    const promises = batch.map(async (dest) => {\n      const result = await calculateRouteForLorry(dest);\n      return { id: dest.id, distanceKm: result.distanceKm, toll: result.tollPrice };\n    });\n\n    const results = await Promise.all(promises);\n    results.forEach(({ id, distanceKm, toll }) => {\n      distances[id] = distanceKm;\n      tollPrices[id] = toll;\n    });\n\n    // Small delay between batches to respect rate limits\n    if (i + batchSize < destinations.length) {\n      await new Promise(resolve => setTimeout(resolve, 200));\n    }\n  }\n\n  return { distances, tollPrices };\n}\n\n/**\n * Legacy function for backward compatibility\n * @deprecated Use calculateRoutesForDestinations instead\n */\nexport async function calculateTollPricesForDestinations(\n  destinations: TableRow[]\n): Promise<Record<string, number>> {\n  const result = await calculateRoutesForDestinations(destinations);\n  return result.tollPrices;\n}\n","size_bytes":6735},"client/src/components/column-customization-modal.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { DragDropContext, Droppable, Draggable } from \"@hello-pangea/dnd\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { GripVertical, RotateCcw, X, CheckCheck, Columns3 } from \"lucide-react\";\nimport { TableColumn } from \"@shared/schema\";\n\ninterface ColumnCustomizationModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  columns: TableColumn[];\n  visibleColumns: string[];\n  onApplyChanges: (visibleColumns: string[], columnOrder: string[]) => void;\n  editMode?: boolean;\n}\n\ninterface ColumnItem {\n  id: string;\n  name: string;\n  dataKey: string;\n  visible: boolean;\n  isCore: boolean;\n}\n\nexport function ColumnCustomizationModal({\n  open,\n  onOpenChange,\n  columns,\n  visibleColumns,\n  onApplyChanges,\n  editMode = false,\n}: ColumnCustomizationModalProps) {\n  const [localColumns, setLocalColumns] = useState<ColumnItem[]>([]);\n  const [originalColumns, setOriginalColumns] = useState<ColumnItem[]>([]);\n\n  // Core columns that cannot be hidden (using column names since Action is UI-only)\n  const coreColumnNames = ['ID', 'No', 'Route', 'Code', 'Location', 'Delivery', 'Destination'];\n\n  useEffect(() => {\n    if (columns.length > 0) {\n      const columnsToHide = editMode \n        ? ['longitude', 'latitude', 'tollPrice'] // In edit mode, hide longitude, latitude, and tollPrice\n        : ['longitude', 'latitude', 'info', 'tollPrice']; // In view mode, also hide info column and tollPrice\n      \n      const columnItems: ColumnItem[] = columns\n        .filter(column => !columnsToHide.includes(column.dataKey))\n        .sort((a, b) => a.sortOrder - b.sortOrder)\n        .map(column => ({\n          id: column.id,\n          name: column.name,\n          dataKey: column.dataKey,\n          visible: visibleColumns.includes(column.id),\n          isCore: coreColumnNames.includes(column.name),\n        }));\n      setLocalColumns(columnItems);\n      setOriginalColumns(columnItems);\n    }\n  }, [columns, visibleColumns, editMode]);\n\n  const handleToggleVisibility = (columnId: string) => {\n    setLocalColumns(prev =>\n      prev.map(col =>\n        col.id === columnId ? { ...col, visible: !col.visible } : col\n      )\n    );\n  };\n\n  const handleDragEnd = (result: any) => {\n    if (!result.destination) return;\n\n    const reorderedColumns = Array.from(localColumns);\n    const [reorderedItem] = reorderedColumns.splice(result.source.index, 1);\n    reorderedColumns.splice(result.destination.index, 0, reorderedItem);\n\n    setLocalColumns(reorderedColumns);\n  };\n\n  const handleApply = () => {\n    const visibleIds = localColumns.filter(col => col.visible).map(col => col.id);\n    const columnOrder = localColumns.map(col => col.id);\n    onApplyChanges(visibleIds, columnOrder);\n    onOpenChange(false);\n  };\n\n  const handleReset = () => {\n    const columnsToHide = editMode \n      ? ['longitude', 'latitude', 'tollPrice'] // In edit mode, hide longitude, latitude, and tollPrice\n      : ['longitude', 'latitude', 'info', 'tollPrice']; // In view mode, also hide info column and tollPrice\n    \n    const resetColumns = columns\n      .filter(column => !columnsToHide.includes(column.dataKey))\n      .sort((a, b) => a.sortOrder - b.sortOrder)\n      .map(column => ({\n        id: column.id,\n        name: column.name,\n        dataKey: column.dataKey,\n        visible: true, // Show all columns by default\n        isCore: coreColumnNames.includes(column.name),\n      }));\n    setLocalColumns(resetColumns);\n  };\n\n  const visibleCount = localColumns.filter(col => col.visible).length;\n\n  // Check if there are changes compared to original state\n  const hasChanges = () => {\n    if (localColumns.length !== originalColumns.length) return true;\n    if (originalColumns.length === 0) return false; // No changes if no original data\n    \n    // Check visibility changes - compare by ID to handle order changes\n    for (const currentCol of localColumns) {\n      const originalCol = originalColumns.find(col => col.id === currentCol.id);\n      if (!originalCol || originalCol.visible !== currentCol.visible) {\n        return true;\n      }\n    }\n    \n    // Check order changes\n    const originalOrder = originalColumns.map(col => col.id);\n    const currentOrder = localColumns.map(col => col.id);\n    \n    if (originalOrder.length !== currentOrder.length) return true;\n    \n    for (let i = 0; i < originalOrder.length; i++) {\n      if (originalOrder[i] !== currentOrder[i]) {\n        return true;\n      }\n    }\n    \n    return false;\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-md bg-white/70 dark:bg-black/30 backdrop-blur-2xl border-2 border-gray-200/60 dark:border-white/10 shadow-[0_20px_60px_0_rgba(0,0,0,0.25)] rounded-3xl transition-smooth\">\n        {/* iOS Frosted Glass Layer */}\n        <div className=\"absolute inset-0 -z-10 rounded-3xl bg-gradient-to-br from-white/60 via-white/40 to-white/50 dark:from-black/40 dark:via-black/20 dark:to-black/30 backdrop-blur-3xl border-0 shadow-inner\" />\n        <DialogHeader>\n          <DialogTitle className=\"text-lg font-semibold flex items-center gap-2 text-blue-600 dark:text-blue-400\">\n            <Columns3 className=\"w-6 h-6\" />\n            Customize Columns\n            <span className=\"text-sm text-muted-foreground font-normal\">\n              ({visibleCount} of {localColumns.length} visible)\n            </span>\n          </DialogTitle>\n          <DialogDescription className=\"text-base\">\n            Toggle column visibility and drag to reorder them in your table.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n\n          <DragDropContext onDragEnd={handleDragEnd}>\n            <Droppable droppableId=\"column-customization\">\n              {(provided) => (\n                <div\n                  {...provided.droppableProps}\n                  ref={provided.innerRef}\n                  className=\"space-y-2 max-h-80 overflow-y-auto\"\n                >\n                  {localColumns.map((column, index) => (\n                    <Draggable\n                      key={column.id}\n                      draggableId={column.id}\n                      index={index}\n                    >\n                      {(provided, snapshot) => (\n                        <div\n                          ref={provided.innerRef}\n                          {...provided.draggableProps}\n                          className={`flex items-center justify-between p-3 rounded-lg border bg-muted/30 hover:bg-muted/50 transition-colors ${\n                            snapshot.isDragging ? 'shadow-lg border-blue-500 dark:border-blue-400' : 'border-border'\n                          } ${!column.visible ? 'opacity-60' : ''}`}\n                        >\n                          <div className=\"flex items-center gap-3\">\n                            <div\n                              {...provided.dragHandleProps}\n                              className=\"cursor-grab active:cursor-grabbing text-muted-foreground hover:text-foreground\"\n                            >\n                              <GripVertical className=\"w-4 h-4\" />\n                            </div>\n                            <Label\n                              htmlFor={`column-${column.id}`}\n                              className=\"text-sm font-medium cursor-pointer\"\n                            >\n                              {column.name}\n                            </Label>\n                          </div>\n                          <Switch\n                            id={`column-${column.id}`}\n                            checked={column.visible}\n                            onCheckedChange={() => handleToggleVisibility(column.id)}\n                            disabled={column.isCore && column.visible && visibleCount <= 1}\n                            data-testid={`switch-column-${column.dataKey}`}\n                          />\n                        </div>\n                      )}\n                    </Draggable>\n                  ))}\n                  {provided.placeholder}\n                </div>\n              )}\n            </Droppable>\n          </DragDropContext>\n\n          <div className=\"text-sm bg-blue-50/50 dark:bg-blue-950/30 p-3 rounded-lg border border-blue-200 dark:border-blue-800\">\n            <strong className=\"text-blue-900 dark:text-blue-100\">Tip:</strong> At least one column must remain visible. Core columns are recommended to stay visible for the best experience.\n          </div>\n        </div>\n\n        <DialogFooter className=\"flex justify-center\">\n          <div className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={handleReset}\n              size=\"sm\"\n              className=\"w-8 h-8 p-0\"\n              data-testid=\"button-reset-columns\"\n              title=\"Reset columns\"\n            >\n              <RotateCcw className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={() => onOpenChange(false)}\n              size=\"sm\"\n              className=\"w-8 h-8 p-0\"\n              data-testid=\"button-cancel-customize\"\n              title=\"Cancel\"\n            >\n              <X className=\"w-4 h-4\" />\n            </Button>\n            <Button \n              onClick={handleApply} \n              size=\"sm\" \n              className={`w-8 h-8 p-0 transition-all duration-200 ${hasChanges() ? 'bg-transparent border border-border/50 text-green-500 hover:text-green-400 hover:bg-green-500/10' : 'bg-transparent border border-border/50 text-muted-foreground hover:text-foreground hover:bg-background/50'}`} \n              data-testid=\"button-apply-customize\" \n              title=\"Apply changes\"\n            >\n              <CheckCheck className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":10102},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json({ limit: '50mb' }));\napp.use(express.urlencoded({ extended: false, limit: '50mb' }));\n\n// Health check endpoint for deployment verification - responds immediately without database\napp.get('/health', (_req: Request, res: Response) => {\n  res.status(200).json({ \n    status: 'ok', \n    timestamp: new Date().toISOString(),\n    uptime: process.uptime()\n  });\n});\n\n// CORS configuration\napp.use((req, res, next) => {\n  res.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, PATCH, OPTIONS');\n  res.header('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept, Authorization');\n  res.header('Access-Control-Allow-Credentials', 'true');\n  \n  if (req.method === 'OPTIONS') {\n    res.sendStatus(200);\n  } else {\n    next();\n  }\n});\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n// ALWAYS serve the app on the port specified in the environment variable PORT\n// Other ports are firewalled. Default to 5000 if not specified.\nconst port = parseInt(process.env.PORT || '5000', 10);\n\n// Graceful error handling for async initialization\n(async () => {\n  try {\n    // Register routes (returns HTTP server)\n    const server = await registerRoutes(app);\n\n    // Start listening IMMEDIATELY after routes are registered\n    // This ensures health check responds quickly\n    await new Promise<void>((resolve, reject) => {\n      server.on('error', (error: NodeJS.ErrnoException) => {\n        if (error.code === 'EADDRINUSE') {\n          log(`Port ${port} is already in use`, \"error\");\n          reject(error);\n        } else {\n          log(`Server error: ${error.message}`, \"error\");\n          reject(error);\n        }\n      });\n\n      server.listen({\n        port,\n        host: \"0.0.0.0\",\n        reusePort: true,\n      }, () => {\n        log(`Server successfully started on port ${port}`);\n        log(`Environment: ${app.get(\"env\")}`);\n        log(`Health check available at /health`);\n        resolve();\n      });\n    });\n\n    // Setup Vite AFTER server is listening (non-blocking)\n    if (app.get(\"env\") === \"development\") {\n      await setupVite(app, server);\n    } else {\n      serveStatic(app);\n    }\n\n    // Error handler middleware\n    app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n      const status = err.status || err.statusCode || 500;\n      const message = err.message || \"Internal Server Error\";\n\n      res.status(status).json({ message });\n      log(`Error ${status}: ${message}`, \"error\");\n    });\n\n    // Handle uncaught exceptions and rejections\n    process.on('uncaughtException', (error) => {\n      log(`Uncaught Exception: ${error.message}`, \"error\");\n      console.error(error);\n      process.exit(1);\n    });\n\n    process.on('unhandledRejection', (reason, promise) => {\n      log(`Unhandled Rejection at: ${promise}, reason: ${reason}`, \"error\");\n      console.error(reason);\n      process.exit(1);\n    });\n\n  } catch (error) {\n    // Catch block for async initialization errors\n    log(`Failed to initialize server: ${error instanceof Error ? error.message : 'Unknown error'}`, \"error\");\n    console.error(error);\n    process.exit(1);\n  }\n})();\n","size_bytes":4109},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"server/storage.ts":{"content":"import {\n  type TableRow,\n  type InsertTableRow,\n  type TableColumn,\n  type InsertTableColumn,\n  type ImageWithCaption,\n  type RouteOptimizationResult,\n  type InsertRouteOptimizationResult,\n  type LayoutPreferences,\n  type InsertLayoutPreferences,\n  type Page,\n  type InsertPage,\n  type GlobalSettings,\n  type InsertGlobalSettings,\n  type SharedTableState,\n  type InsertSharedTableState,\n  type SavedShareLink,\n  type InsertSavedShareLink,\n  type CustomTable,\n  type InsertCustomTable,\n  type CustomTableRow,\n  type InsertCustomTableRow,\n  tableRows,\n  tableColumns,\n  routeOptimizationResult,\n  layoutPreferences,\n  pages,\n  globalSettings,\n  sharedTableStates,\n  savedShareLinks,\n  customTables,\n  customTableRows,\n} from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\nimport { db } from \"./db\";\nimport { eq, asc, desc } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // Table rows\n  getTableRows(): Promise<TableRow[]>;\n  getTableRow(id: string): Promise<TableRow | undefined>;\n  getQlKitchenRow(): Promise<TableRow | undefined>;\n  createTableRow(row: InsertTableRow): Promise<TableRow>;\n  updateTableRow(\n    id: string,\n    updates: Partial<InsertTableRow>,\n  ): Promise<TableRow | undefined>;\n  deleteTableRow(id: string): Promise<boolean>;\n  reorderTableRows(rowIds: string[]): Promise<TableRow[]>;\n\n  // Table columns\n  getTableColumns(): Promise<TableColumn[]>;\n  getTableColumn(id: string): Promise<TableColumn | undefined>;\n  createTableColumn(column: InsertTableColumn): Promise<TableColumn>;\n  updateTableColumn(\n    id: string,\n    updates: Partial<InsertTableColumn>,\n  ): Promise<TableColumn | undefined>;\n  deleteTableColumn(id: string): Promise<boolean>;\n  reorderTableColumns(columnIds: string[]): Promise<TableColumn[]>;\n\n  // Route optimization results\n  getSavedRoutes(): Promise<RouteOptimizationResult[]>;\n  getSavedRoute(id: string): Promise<RouteOptimizationResult | undefined>;\n  saveRoute(route: InsertRouteOptimizationResult): Promise<RouteOptimizationResult>;\n  deleteSavedRoute(id: string): Promise<boolean>;\n\n  // Layout preferences\n  getLayoutPreferences(userId: string): Promise<LayoutPreferences | undefined>;\n  saveLayoutPreferences(userId: string, layout: InsertLayoutPreferences): Promise<LayoutPreferences>;\n\n  // Pages\n  getPages(): Promise<Page[]>;\n  getPage(id: string): Promise<Page | undefined>;\n  createPage(page: InsertPage): Promise<Page>;\n  updatePage(id: string, updates: Partial<InsertPage>): Promise<Page | undefined>;\n  deletePage(id: string): Promise<boolean>;\n\n  // Global settings\n  getGlobalSetting(key: string): Promise<GlobalSettings | undefined>;\n  setGlobalSetting(key: string, value: string): Promise<GlobalSettings>;\n\n  // Shared table states\n  createSharedTableState(state: InsertSharedTableState): Promise<SharedTableState>;\n  getSharedTableState(shareId: string): Promise<SharedTableState | undefined>;\n\n  // Saved share links\n  getSavedShareLinks(): Promise<SavedShareLink[]>;\n  getSavedShareLink(id: string): Promise<SavedShareLink | undefined>;\n  createSavedShareLink(link: InsertSavedShareLink): Promise<SavedShareLink>;\n  updateSavedShareLinkRemark(id: string, remark: string): Promise<SavedShareLink | undefined>;\n  deleteSavedShareLink(id: string): Promise<boolean>;\n\n  // Custom tables\n  getCustomTables(): Promise<CustomTable[]>;\n  getCustomTable(id: string): Promise<CustomTable | undefined>;\n  getCustomTableByShareId(shareId: string): Promise<CustomTable | undefined>;\n  getCustomTableRows(customTableId: string): Promise<TableRow[]>;\n  createCustomTable(table: InsertCustomTable, rowIds: string[]): Promise<CustomTable>;\n  updateCustomTable(id: string, updates: Partial<InsertCustomTable>): Promise<CustomTable | undefined>;\n  deleteCustomTable(id: string): Promise<boolean>;\n}\n\nexport class MemStorage implements IStorage {\n  private tableRows: Map<string, TableRow>;\n  private tableColumns: Map<string, TableColumn>;\n  private savedRoutes: Map<string, RouteOptimizationResult>;\n  private layoutPrefs: Map<string, LayoutPreferences>;\n  private pages: Map<string, Page>;\n  private sharedStates: Map<string, SharedTableState>;\n\n  constructor() {\n    this.tableRows = new Map();\n    this.tableColumns = new Map();\n    this.savedRoutes = new Map();\n    this.layoutPrefs = new Map();\n    this.pages = new Map();\n    this.sharedStates = new Map();\n\n    // Initialize with sample data\n    this.initializeData();\n    this.ensureCoreColumns();\n  }\n\n  private initializeData() {\n    // Initialize default columns - these are permanent core columns\n    const defaultColumns: TableColumn[] = [\n      {\n        id: randomUUID(),\n        name: \"ID\",\n        dataKey: \"id\",\n        type: \"text\",\n        sortOrder: 1,\n        isEditable: \"false\",\n        options: [] as string[],\n      },\n      {\n        id: randomUUID(),\n        name: \"No\",\n        dataKey: \"no\",\n        type: \"text\",\n        sortOrder: 2,\n        isEditable: \"false\",\n        options: [] as string[],\n      },\n      {\n        id: randomUUID(),\n        name: \"Route\",\n        dataKey: \"route\",\n        type: \"select\",\n        sortOrder: 3,\n        isEditable: \"true\",\n        options: [\n          \"KL 1\",\n          \"KL 2\",\n          \"KL 3\",\n          \"KL 4\",\n          \"KL 5\",\n          \"KL 6\",\n          \"KL 7\",\n          \"SL 1\",\n          \"SL 2\",\n          \"SL 3\",\n        ] as string[],\n      },\n      {\n        id: randomUUID(),\n        name: \"Code\",\n        dataKey: \"code\",\n        type: \"text\",\n        sortOrder: 4,\n        isEditable: \"true\",\n        options: [] as string[],\n      },\n      {\n        id: randomUUID(),\n        name: \"Location\",\n        dataKey: \"location\",\n        type: \"text\",\n        sortOrder: 5,\n        isEditable: \"true\",\n        options: [] as string[],\n      },\n      {\n        id: randomUUID(),\n        name: \"Delivery\",\n        dataKey: \"delivery\",\n        type: \"select\",\n        sortOrder: 6,\n        isEditable: \"true\",\n        options: [\"Daily\", \"Weekday\", \"Alt 1\", \"Alt 2\"] as string[],\n      },\n      {\n        id: randomUUID(),\n        name: \"Trip\",\n        dataKey: \"trip\",\n        type: \"select\",\n        sortOrder: 7,\n        isEditable: \"true\",\n        options: [\"Daily\", \"Weekday\", \"Alt 1\", \"Alt 2\"] as string[],\n      },\n      {\n        id: randomUUID(),\n        name: \"Parking\",\n        dataKey: \"tngRoute\",\n        type: \"currency\",\n        sortOrder: 8,\n        isEditable: \"true\",\n        options: [] as string[],\n      },\n      {\n        id: randomUUID(),\n        name: \"Info\",\n        dataKey: \"info\",\n        type: \"text\",\n        sortOrder: 9,\n        isEditable: \"true\",\n        options: [] as string[],\n      },\n      {\n        id: randomUUID(),\n        name: \"Images\",\n        dataKey: \"images\",\n        type: \"images\",\n        sortOrder: 10,\n        isEditable: \"false\",\n        options: [] as string[],\n      },\n      {\n        id: randomUUID(),\n        name: \"Kilometer\",\n        dataKey: \"kilometer\",\n        type: \"number\",\n        sortOrder: 11,\n        isEditable: \"false\",\n        options: [] as string[],\n      },\n      {\n        id: randomUUID(),\n        name: \"Toll Price\",\n        dataKey: \"tollPrice\",\n        type: \"currency\",\n        sortOrder: 12,\n        isEditable: \"false\",\n        options: [] as string[],\n      },\n      {\n        id: randomUUID(),\n        name: \"Latitude\",\n        dataKey: \"latitude\",\n        type: \"text\",\n        sortOrder: 13,\n        isEditable: \"true\",\n        options: [] as string[],\n      },\n      {\n        id: randomUUID(),\n        name: \"Longitude\",\n        dataKey: \"longitude\",\n        type: \"text\",\n        sortOrder: 14,\n        isEditable: \"true\",\n        options: [] as string[],\n      },\n    ];\n\n    defaultColumns.forEach((column) => {\n      this.tableColumns.set(column.id, column);\n    });\n\n    // Initialize sample rows\n    const defaultRows: TableRow[] = [\n      {\n        id: randomUUID(),\n        no: 999,\n        route: \"Warehouse\",\n        code: \"QL001\",\n        location: \"QL Kitchen\",\n        delivery: \"Daily\",\n        info: \"Special QL Kitchen warehouse route\",\n        tngSite: \"QL Central\",\n        tngRoute: \"0.00\",\n        destination: \"0.00\",\n        tollPrice: \"0.00\",\n        latitude: \"3.139003\",\n        longitude: \"101.686855\",\n        images: [],\n        qrCode: \"\",\n        sortOrder: -1,\n        active: true,\n        deliveryAlt: \"normal\",\n        markerColor: \"#3b82f6\",\n      },\n      {\n        id: randomUUID(),\n        no: 1,\n        route: \"KL-01\",\n        code: \"CODE001\",\n        location: \"Kuala Lumpur\",\n        delivery: \"Daily\",\n        info: \"Sample information for row 1\",\n        tngSite: \"TnG KL Central\",\n        tngRoute: \"15.50\",\n        destination: \"25.00\",\n        tollPrice: \"0.00\",\n        latitude: \"3.139003\",\n        longitude: \"101.686855\",\n        images: [\n          {\n            url: \"https://images.unsplash.com/photo-1559827260-dc66d52bef19?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\",\n            caption: \"Modern city skyline\",\n            type: \"image\",\n          },\n          {\n            url: \"https://images.unsplash.com/photo-1573167507387-4d8c0a67ceb2?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\",\n            caption: \"Urban landscape\",\n            type: \"image\",\n          },\n        ],\n        qrCode: \"\",\n        sortOrder: 0,\n        active: true,\n        deliveryAlt: \"normal\",\n        markerColor: \"#3b82f6\",\n      },\n      {\n        id: randomUUID(),\n        no: 2,\n        route: \"SG-02\",\n        code: \"CODE002\",\n        location: \"Selangor\",\n        delivery: \"Weekday\",\n        info: \"Details for Selangor route\",\n        tngSite: \"TnG Shah Alam\",\n        tngRoute: \"22.75\",\n        destination: \"18.50\",\n        tollPrice: \"0.00\",\n        latitude: \"3.085602\",\n        longitude: \"101.532303\",\n        images: [\n          {\n            url: \"https://images.unsplash.com/photo-1560472355-536de3962603?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\",\n            caption: \"Suburban area\",\n            type: \"image\",\n          },\n        ],\n        qrCode: \"\",\n        sortOrder: 1,\n        active: true,\n        deliveryAlt: \"normal\",\n        markerColor: \"#3b82f6\",\n      },\n      {\n        id: randomUUID(),\n        no: 3,\n        route: \"JB-03\",\n        code: \"CODE003\",\n        location: \"Johor Bahru\",\n        delivery: \"Alt 1\",\n        info: \"Information about Johor Bahru delivery\",\n        tngSite: \"TnG JB Plaza\",\n        tngRoute: \"8.90\",\n        destination: \"12.75\",\n        tollPrice: \"0.00\",\n        latitude: \"1.464651\",\n        longitude: \"103.761475\",\n        images: [],\n        qrCode: \"\",\n        sortOrder: 2,\n        active: true,\n        deliveryAlt: \"normal\",\n        markerColor: \"#3b82f6\",\n      },\n      {\n        id: randomUUID(),\n        no: 4,\n        route: \"PG-04\",\n        code: \"CODE004\",\n        location: \"Penang\",\n        delivery: \"Alt 2\",\n        info: \"Penang delivery information\",\n        tngSite: \"TnG Georgetown\",\n        tngRoute: \"32.40\",\n        destination: \"28.75\",\n        tollPrice: \"0.00\",\n        latitude: \"5.414184\",\n        longitude: \"100.329113\",\n        images: [\n          {\n            url: \"https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\",\n            caption: \"Georgetown bridge\",\n            type: \"image\",\n          },\n        ],\n        qrCode: \"\",\n        sortOrder: 3,\n        active: true,\n        deliveryAlt: \"normal\",\n        markerColor: \"#3b82f6\",\n      },\n      {\n        id: randomUUID(),\n        no: 5,\n        route: \"KT-05\",\n        code: \"CODE005\",\n        location: \"Kota Kinabalu\",\n        delivery: \"Daily\",\n        info: \"Extended delivery to East Malaysia\",\n        tngSite: \"TnG KK Mall\",\n        tngRoute: \"45.20\",\n        destination: \"35.60\",\n        tollPrice: \"0.00\",\n        latitude: \"5.974407\",\n        longitude: \"116.095692\",\n        images: [],\n        qrCode: \"\",\n        sortOrder: 4,\n        active: true,\n        deliveryAlt: \"normal\",\n        markerColor: \"#3b82f6\",\n      },\n    ];\n\n    defaultRows.forEach((row) => {\n      this.tableRows.set(row.id, row);\n    });\n  }\n\n  private ensureCoreColumns() {\n    const existingColumns = Array.from(this.tableColumns.values());\n    const kilometerColumn = existingColumns.find(col => col.dataKey === 'kilometer');\n    const tollPriceColumn = existingColumns.find(col => col.dataKey === 'tollPrice');\n    \n    if (!kilometerColumn) {\n      const infoColumn = existingColumns.find(col => col.dataKey === 'info');\n      const infoSortOrder = infoColumn ? infoColumn.sortOrder : 6;\n      \n      // Create Kilometer column right after Info\n      const kilometerCol: TableColumn = {\n        id: randomUUID(),\n        name: \"Kilometer\",\n        dataKey: \"kilometer\",\n        type: \"number\",\n        sortOrder: infoSortOrder + 1,\n        isEditable: \"false\",\n        options: [],\n      };\n      \n      this.tableColumns.set(kilometerCol.id, kilometerCol);\n      \n      // Adjust sortOrder of subsequent columns\n      existingColumns.forEach(col => {\n        if (col.sortOrder > infoSortOrder) {\n          col.sortOrder += 1;\n          this.tableColumns.set(col.id, col);\n        }\n      });\n    }\n    \n    if (!tollPriceColumn) {\n      const kilometerCol = existingColumns.find(col => col.dataKey === 'kilometer') || \n                           Array.from(this.tableColumns.values()).find(col => col.dataKey === 'kilometer');\n      const kilometerSortOrder = kilometerCol ? kilometerCol.sortOrder : 11;\n      \n      // Create Toll Price column right after Kilometer\n      const tollPriceCol: TableColumn = {\n        id: randomUUID(),\n        name: \"Toll Price\",\n        dataKey: \"tollPrice\",\n        type: \"currency\",\n        sortOrder: kilometerSortOrder + 1,\n        isEditable: \"false\",\n        options: [],\n      };\n      \n      this.tableColumns.set(tollPriceCol.id, tollPriceCol);\n      \n      // Adjust sortOrder of subsequent columns\n      const currentColumns = Array.from(this.tableColumns.values());\n      currentColumns.forEach(col => {\n        if (col.sortOrder > kilometerSortOrder && col.id !== tollPriceCol.id) {\n          col.sortOrder += 1;\n          this.tableColumns.set(col.id, col);\n        }\n      });\n    }\n  }\n\n  // Table rows methods\n  async getTableRows(): Promise<TableRow[]> {\n    return Array.from(this.tableRows.values()).sort((a, b) => {\n      // QL Kitchen always at top\n      if (a.sortOrder === -1) return -1;\n      if (b.sortOrder === -1) return 1;\n      \n      // Sort by code numerically\n      const codeA = parseInt(a.code || \"0\") || 0;\n      const codeB = parseInt(b.code || \"0\") || 0;\n      return codeA - codeB;\n    });\n  }\n\n  async getTableRow(id: string): Promise<TableRow | undefined> {\n    return this.tableRows.get(id);\n  }\n\n  async getQlKitchenRow(): Promise<TableRow | undefined> {\n    return Array.from(this.tableRows.values()).find(\n      row => row.location === \"QL Kitchen\" && row.sortOrder === -1\n    );\n  }\n\n  async createTableRow(insertRow: InsertTableRow): Promise<TableRow> {\n    const id = randomUUID();\n    const maxSortOrder = Math.max(\n      ...Array.from(this.tableRows.values()).map((r) => r.sortOrder),\n      -1,\n    );\n    const row: TableRow = {\n      no: insertRow.no || 0,\n      route: insertRow.route || \"\",\n      code: insertRow.code || \"\",\n      location: insertRow.location || \"\",\n      delivery: insertRow.delivery || \"\",\n      info: insertRow.info || \"\",\n      tngSite: insertRow.tngSite || \"\",\n      tngRoute: insertRow.tngRoute || \"\",\n      destination: insertRow.destination || \"0.00\",\n      tollPrice: insertRow.tollPrice || \"0.00\",\n      latitude: insertRow.latitude || null,\n      longitude: insertRow.longitude || null,\n      images: (insertRow.images as ImageWithCaption[]) || [],\n      qrCode: insertRow.qrCode || \"\",\n      id,\n      sortOrder: maxSortOrder + 1,\n      active: insertRow.active !== undefined ? insertRow.active : true,\n      deliveryAlt: insertRow.deliveryAlt || \"normal\",\n      markerColor: insertRow.markerColor || \"#3b82f6\",\n    };\n    this.tableRows.set(id, row);\n    return row;\n  }\n\n  async updateTableRow(\n    id: string,\n    updates: Partial<InsertTableRow>,\n  ): Promise<TableRow | undefined> {\n    const existingRow = this.tableRows.get(id);\n    if (!existingRow) return undefined;\n\n    const updatedRow = { ...existingRow, ...updates } as TableRow;\n    this.tableRows.set(id, updatedRow);\n    return updatedRow;\n  }\n\n  async deleteTableRow(id: string): Promise<boolean> {\n    return this.tableRows.delete(id);\n  }\n\n  async reorderTableRows(rowIds: string[]): Promise<TableRow[]> {\n    rowIds.forEach((id, index) => {\n      const row = this.tableRows.get(id);\n      if (row) {\n        row.sortOrder = index;\n        this.tableRows.set(id, row);\n      }\n    });\n    return this.getTableRows();\n  }\n\n  // Table columns methods\n  async getTableColumns(): Promise<TableColumn[]> {\n    return Array.from(this.tableColumns.values()).sort(\n      (a, b) => a.sortOrder - b.sortOrder,\n    );\n  }\n\n  async getTableColumn(id: string): Promise<TableColumn | undefined> {\n    return this.tableColumns.get(id);\n  }\n\n  async createTableColumn(\n    insertColumn: InsertTableColumn,\n  ): Promise<TableColumn> {\n    const id = randomUUID();\n    const maxSortOrder = Math.max(\n      ...Array.from(this.tableColumns.values()).map((c) => c.sortOrder),\n      -1,\n    );\n    const column: TableColumn = {\n      name: insertColumn.name,\n      dataKey: insertColumn.dataKey,\n      type: insertColumn.type || \"text\",\n      isEditable: insertColumn.isEditable || \"true\",\n      options: (insertColumn.options || []) as string[],\n      id,\n      sortOrder: maxSortOrder + 1,\n    };\n    this.tableColumns.set(id, column);\n    return column;\n  }\n\n  async updateTableColumn(\n    id: string,\n    updates: Partial<InsertTableColumn>,\n  ): Promise<TableColumn | undefined> {\n    const existingColumn = this.tableColumns.get(id);\n    if (!existingColumn) return undefined;\n\n    const updatedColumn = { ...existingColumn, ...updates } as TableColumn;\n    this.tableColumns.set(id, updatedColumn);\n    return updatedColumn;\n  }\n\n  async deleteTableColumn(id: string): Promise<boolean> {\n    // Get the column to check if it's a core column\n    const column = this.tableColumns.get(id);\n    if (!column) return false;\n    \n    // Prevent deletion of core columns (based on dataKey)\n    const coreDataKeys = [\n      \"id\",\n      \"no\", \n      \"route\",\n      \"code\",\n      \"location\",\n      \"trip\",\n      \"info\",\n      \"tngRoute\",\n      \"latitude\",\n      \"longitude\",\n      \"kilometer\",\n      \"images\",\n    ];\n    if (coreDataKeys.includes(column.dataKey)) {\n      return false; // Cannot delete core columns\n    }\n    return this.tableColumns.delete(id);\n  }\n\n  async reorderTableColumns(columnIds: string[]): Promise<TableColumn[]> {\n    columnIds.forEach((id, index) => {\n      const column = this.tableColumns.get(id);\n      if (column) {\n        column.sortOrder = index;\n        this.tableColumns.set(id, column);\n      }\n    });\n    return this.getTableColumns();\n  }\n\n  // Route optimization results methods\n  async getSavedRoutes(): Promise<RouteOptimizationResult[]> {\n    return Array.from(this.savedRoutes.values()).sort(\n      (a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n    );\n  }\n\n  async getSavedRoute(id: string): Promise<RouteOptimizationResult | undefined> {\n    return this.savedRoutes.get(id);\n  }\n\n  async saveRoute(route: InsertRouteOptimizationResult): Promise<RouteOptimizationResult> {\n    const id = randomUUID();\n    const savedRoute: RouteOptimizationResult = {\n      id,\n      ...route,\n      originalOrder: [...route.originalOrder] as string[],\n      optimizedOrder: [...route.optimizedOrder] as string[],\n      algorithm: route.algorithm || \"nearest_neighbor\",\n      createdAt: new Date(),\n    };\n    this.savedRoutes.set(id, savedRoute);\n    return savedRoute;\n  }\n\n  async deleteSavedRoute(id: string): Promise<boolean> {\n    return this.savedRoutes.delete(id);\n  }\n\n  // Layout preferences methods\n  async getLayoutPreferences(userId: string): Promise<LayoutPreferences | undefined> {\n    return this.layoutPrefs.get(userId);\n  }\n\n  async saveLayoutPreferences(userId: string, layout: InsertLayoutPreferences): Promise<LayoutPreferences> {\n    const existingLayout = this.layoutPrefs.get(userId);\n    const id = existingLayout?.id || randomUUID();\n    const savedLayout: LayoutPreferences = {\n      id,\n      userId,\n      columnOrder: Array.from(layout.columnOrder || []) as string[],\n      columnVisibility: { ...(layout.columnVisibility || {}) },\n      creatorName: layout.creatorName || existingLayout?.creatorName || \"Somebody\",\n      creatorUrl: layout.creatorUrl || existingLayout?.creatorUrl || \"\",\n      updatedAt: new Date(),\n    };\n    this.layoutPrefs.set(userId, savedLayout);\n    return savedLayout;\n  }\n\n  // Pages methods\n  async getPages(): Promise<Page[]> {\n    return Array.from(this.pages.values()).sort((a, b) => a.sortOrder - b.sortOrder);\n  }\n\n  async getPage(id: string): Promise<Page | undefined> {\n    return this.pages.get(id);\n  }\n\n  async createPage(page: InsertPage): Promise<Page> {\n    const id = randomUUID();\n    const newPage: Page = {\n      id,\n      title: page.title || \"\",\n      description: page.description || \"\",\n      sortOrder: page.sortOrder || this.pages.size,\n    };\n    this.pages.set(id, newPage);\n    return newPage;\n  }\n\n  async updatePage(id: string, updates: Partial<InsertPage>): Promise<Page | undefined> {\n    const page = this.pages.get(id);\n    if (!page) return undefined;\n\n    const updatedPage: Page = {\n      ...page,\n      ...updates,\n    };\n    this.pages.set(id, updatedPage);\n    return updatedPage;\n  }\n\n  async deletePage(id: string): Promise<boolean> {\n    return this.pages.delete(id);\n  }\n\n  async getGlobalSetting(key: string): Promise<GlobalSettings | undefined> {\n    // For in-memory storage, return default values\n    if (key === 'footerCompanyName') {\n      return {\n        id: randomUUID(),\n        key: 'footerCompanyName',\n        value: 'App v1.0.0',\n        updatedAt: new Date(),\n      };\n    }\n    return undefined;\n  }\n\n  async setGlobalSetting(key: string, value: string): Promise<GlobalSettings> {\n    // For in-memory storage, just return the setting\n    return {\n      id: randomUUID(),\n      key,\n      value,\n      updatedAt: new Date(),\n    };\n  }\n\n  // Shared table states methods\n  async createSharedTableState(state: InsertSharedTableState): Promise<SharedTableState> {\n    const id = randomUUID();\n    const sharedState: SharedTableState = {\n      id,\n      shareId: state.shareId,\n      tableState: {\n        filters: {\n          searchTerm: state.tableState.filters.searchTerm,\n          routeFilters: Array.from(state.tableState.filters.routeFilters) as string[],\n          deliveryFilters: Array.from(state.tableState.filters.deliveryFilters) as string[],\n        },\n        sorting: state.tableState.sorting,\n        columnVisibility: { ...state.tableState.columnVisibility },\n        columnOrder: Array.from(state.tableState.columnOrder) as string[],\n      },\n      createdAt: new Date(),\n      expiresAt: state.expiresAt || null,\n    };\n    this.sharedStates.set(state.shareId, sharedState);\n    return sharedState;\n  }\n\n  async getSharedTableState(shareId: string): Promise<SharedTableState | undefined> {\n    return this.sharedStates.get(shareId);\n  }\n\n  // Saved share links methods (in-memory)\n  private savedLinks: Map<string, SavedShareLink> = new Map();\n\n  async getSavedShareLinks(): Promise<SavedShareLink[]> {\n    return Array.from(this.savedLinks.values()).sort((a, b) => \n      b.createdAt.getTime() - a.createdAt.getTime()\n    );\n  }\n\n  async getSavedShareLink(id: string): Promise<SavedShareLink | undefined> {\n    return this.savedLinks.get(id);\n  }\n\n  async createSavedShareLink(link: InsertSavedShareLink): Promise<SavedShareLink> {\n    const id = randomUUID();\n    const saved: SavedShareLink = {\n      id,\n      shareId: link.shareId,\n      url: link.url,\n      remark: link.remark || \"\",\n      createdAt: new Date(),\n    };\n    this.savedLinks.set(id, saved);\n    return saved;\n  }\n\n  async updateSavedShareLinkRemark(id: string, remark: string): Promise<SavedShareLink | undefined> {\n    const link = this.savedLinks.get(id);\n    if (link) {\n      const updated = { ...link, remark };\n      this.savedLinks.set(id, updated);\n      return updated;\n    }\n    return undefined;\n  }\n\n  async deleteSavedShareLink(id: string): Promise<boolean> {\n    return this.savedLinks.delete(id);\n  }\n\n  // Custom tables methods (in-memory)\n  private customTablesMap: Map<string, CustomTable> = new Map();\n  private customTableRowsMap: Map<string, CustomTableRow[]> = new Map();\n\n  async getCustomTables(): Promise<CustomTable[]> {\n    return Array.from(this.customTablesMap.values()).sort((a, b) => \n      b.createdAt.getTime() - a.createdAt.getTime()\n    );\n  }\n\n  async getCustomTable(id: string): Promise<CustomTable | undefined> {\n    return this.customTablesMap.get(id);\n  }\n\n  async getCustomTableByShareId(shareId: string): Promise<CustomTable | undefined> {\n    return Array.from(this.customTablesMap.values()).find(\n      table => table.shareId === shareId\n    );\n  }\n\n  async getCustomTableRows(customTableId: string): Promise<TableRow[]> {\n    const customRows = this.customTableRowsMap.get(customTableId) || [];\n    return customRows\n      .map(cr => this.tableRows.get(cr.tableRowId))\n      .filter((row): row is TableRow => row !== undefined)\n      .sort((a, b) => {\n        const aRow = customRows.find(cr => cr.tableRowId === a.id);\n        const bRow = customRows.find(cr => cr.tableRowId === b.id);\n        return (aRow?.sortOrder || 0) - (bRow?.sortOrder || 0);\n      });\n  }\n\n  async createCustomTable(table: InsertCustomTable, rowIds: string[]): Promise<CustomTable> {\n    const id = randomUUID();\n    const customTable: CustomTable = {\n      id,\n      name: table.name,\n      shareId: table.shareId,\n      description: table.description || \"\",\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    this.customTablesMap.set(id, customTable);\n\n    // Create associations\n    const tableRowsAssoc = rowIds.map((rowId, index) => ({\n      id: randomUUID(),\n      customTableId: id,\n      tableRowId: rowId,\n      sortOrder: index,\n      createdAt: new Date(),\n    }));\n    this.customTableRowsMap.set(id, tableRowsAssoc);\n\n    return customTable;\n  }\n\n  async updateCustomTable(id: string, updates: Partial<InsertCustomTable>): Promise<CustomTable | undefined> {\n    const table = this.customTablesMap.get(id);\n    if (table) {\n      const updated = { ...table, ...updates, updatedAt: new Date() };\n      this.customTablesMap.set(id, updated);\n      return updated;\n    }\n    return undefined;\n  }\n\n  async deleteCustomTable(id: string): Promise<boolean> {\n    this.customTableRowsMap.delete(id);\n    return this.customTablesMap.delete(id);\n  }\n}\n\n// Database Storage Implementation\nexport class DatabaseStorage implements IStorage {\n  constructor() {\n    // Initialize with sample data if tables are empty\n    this.initializeData().catch(console.error);\n    this.ensureCoreColumns().catch(console.error);\n  }\n\n  private async initializeData() {\n    try {\n      // Check if data already exists\n      const existingColumns = await db.select().from(tableColumns);\n      const existingRows = await db.select().from(tableRows);\n\n      if (existingColumns.length === 0) {\n        // Initialize default columns - these are permanent core columns\n        const defaultColumns: Omit<TableColumn, \"id\">[] = [\n          {\n            name: \"ID\",\n            dataKey: \"id\",\n            type: \"text\",\n            sortOrder: 1,\n            isEditable: \"false\",\n            options: [] as string[],\n          },\n          {\n            name: \"No\",\n            dataKey: \"no\",\n            type: \"text\",\n            sortOrder: 2,\n            isEditable: \"false\",\n            options: [] as string[],\n          },\n          {\n            name: \"Route\",\n            dataKey: \"route\",\n            type: \"select\",\n            sortOrder: 3,\n            isEditable: \"true\",\n            options: [\n              \"KL 1\",\n              \"KL 2\",\n              \"KL 3\",\n              \"KL 4\",\n              \"KL 5\",\n              \"KL 6\",\n              \"KL 7\",\n              \"SL 1\",\n              \"SL 2\",\n              \"SL 3\",\n            ] as string[],\n          },\n          {\n            name: \"Code\",\n            dataKey: \"code\",\n            type: \"text\",\n            sortOrder: 4,\n            isEditable: \"true\",\n            options: [] as string[],\n          },\n          {\n            name: \"Location\",\n            dataKey: \"location\",\n            type: \"text\",\n            sortOrder: 5,\n            isEditable: \"true\",\n            options: [] as string[],\n          },\n          {\n            name: \"Delivery\",\n            dataKey: \"delivery\",\n            type: \"select\",\n            sortOrder: 6,\n            isEditable: \"true\",\n            options: [\"Daily\", \"Weekday\", \"Alt 1\", \"Alt 2\"] as string[],\n          },\n          {\n            name: \"Trip\",\n            dataKey: \"trip\",\n            type: \"select\",\n            sortOrder: 7,\n            isEditable: \"true\",\n            options: [\"Daily\", \"Weekday\", \"Alt 1\", \"Alt 2\"] as string[],\n          },\n          {\n            name: \"Parking\",\n            dataKey: \"tngRoute\",\n            type: \"currency\",\n            sortOrder: 8,\n            isEditable: \"true\",\n            options: [] as string[],\n          },\n          {\n            name: \"Info\",\n            dataKey: \"info\",\n            type: \"text\",\n            sortOrder: 9,\n            isEditable: \"true\",\n            options: [] as string[],\n          },\n          {\n            name: \"Images\",\n            dataKey: \"images\",\n            type: \"images\",\n            sortOrder: 10,\n            isEditable: \"false\",\n            options: [] as string[],\n          },\n          {\n            name: \"Kilometer\",\n            dataKey: \"kilometer\",\n            type: \"number\",\n            sortOrder: 11,\n            isEditable: \"false\",\n            options: [] as string[],\n          },\n          {\n            name: \"Toll Price\",\n            dataKey: \"tollPrice\",\n            type: \"currency\",\n            sortOrder: 12,\n            isEditable: \"false\",\n            options: [] as string[],\n          },\n          {\n            name: \"Latitude\",\n            dataKey: \"latitude\",\n            type: \"text\",\n            sortOrder: 13,\n            isEditable: \"true\",\n            options: [] as string[],\n          },\n          {\n            name: \"Longitude\",\n            dataKey: \"longitude\",\n            type: \"text\",\n            sortOrder: 14,\n            isEditable: \"true\",\n            options: [] as string[],\n          },\n        ];\n\n        const columnsWithOrder = defaultColumns;\n        await db.insert(tableColumns).values(columnsWithOrder);\n      }\n\n      // Always ensure QL Kitchen row exists\n      const qlKitchenExists = existingRows.some(row => \n        row.route === \"Warehouse\" && row.location === \"QL Kitchen\" && row.sortOrder === -1\n      );\n\n      if (!qlKitchenExists) {\n        try {\n          // Add QL Kitchen row\n          await db.insert(tableRows).values({\n            no: 999,\n            route: \"Warehouse\",\n            code: \"QL001\",\n            location: \"QL Kitchen\",\n            delivery: \"Daily\",\n            info: \"Special QL Kitchen warehouse route\",\n            tngSite: \"QL Central\",\n            tngRoute: \"0.00\",\n            destination: \"0.00\",\n            tollPrice: \"0.00\",\n            latitude: \"3.139003\",\n            longitude: \"101.686855\",\n            images: [],\n            qrCode: \"\",\n            sortOrder: -1,\n            active: true,\n            deliveryAlt: \"normal\",\n            markerColor: \"#3b82f6\",\n          });\n        } catch (error: any) {\n          // If constraint error for duplicate sort_order, ignore it as the row already exists\n          if (error.code !== '23505' || !error.detail?.includes('sort_order')) {\n            throw error;\n          }\n        }\n      }\n\n      if (existingRows.length === 0) {\n        // Initialize sample rows\n        const defaultRows: Omit<TableRow, \"id\" | \"sortOrder\">[] = [\n          {\n            no: 1,\n            route: \"KL-01\",\n            code: \"CODE001\",\n            location: \"Kuala Lumpur\",\n            delivery: \"Daily\",\n            info: \"Sample information for row 1\",\n            tngSite: \"TnG KL Central\",\n            tngRoute: \"15.50\",\n            destination: \"25.00\",\n            tollPrice: \"0.00\",\n            latitude: \"3.139003\",\n            longitude: \"101.686855\",\n            images: [\n              {\n                url: \"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\",\n                caption: \"KL city center\",\n                type: \"image\",\n              },\n              {\n                url: \"https://images.unsplash.com/photo-1596394516093-501ba68a0ba6?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\",\n                caption: \"Petronas Towers\",\n                type: \"image\",\n              },\n            ],\n            qrCode: \"https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://maps.google.com/?q=3.139003,101.686855\",\n            active: true,\n            deliveryAlt: \"normal\",\n            markerColor: \"#3b82f6\",\n          },\n          {\n            no: 2,\n            route: \"SG-02\",\n            code: \"CODE002\",\n            location: \"Selangor\",\n            delivery: \"Weekday\",\n            info: \"Details for Selangor route\",\n            tngSite: \"TnG Shah Alam\",\n            tngRoute: \"22.75\",\n            destination: \"18.50\",\n            tollPrice: \"0.00\",\n            latitude: \"3.085602\",\n            longitude: \"101.532303\",\n            images: [\n              {\n                url: \"https://images.unsplash.com/photo-1605649487212-183a9c785351?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\",\n                caption: \"Selangor district\",\n                type: \"image\",\n              },\n            ],\n            qrCode: \"https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://maps.google.com/?q=3.085602,101.532303\",\n            active: true,\n            deliveryAlt: \"normal\",\n            markerColor: \"#3b82f6\",\n          },\n          {\n            no: 3,\n            route: \"JB-03\",\n            code: \"CODE003\",\n            location: \"Johor Bahru\",\n            delivery: \"Alt 1\",\n            info: \"Information about Johor Bahru delivery\",\n            tngSite: \"TnG JB Plaza\",\n            tngRoute: \"8.90\",\n            destination: \"12.75\",\n            tollPrice: \"0.00\",\n            latitude: \"1.464651\",\n            longitude: \"103.761475\",\n            images: [],\n            qrCode: \"https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://fmvending.web.app/location/JB-03\",\n            active: true,\n            deliveryAlt: \"normal\",\n            markerColor: \"#3b82f6\",\n          },\n          {\n            no: 4,\n            route: \"PG-04\",\n            code: \"CODE004\",\n            location: \"Penang\",\n            delivery: \"Alt 2\",\n            info: \"Penang delivery information\",\n            tngSite: \"TnG Georgetown\",\n            tngRoute: \"32.40\",\n            destination: \"28.75\",\n            tollPrice: \"0.00\",\n            latitude: \"5.414184\",\n            longitude: \"100.329113\",\n            images: [\n              {\n                url: \"https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=600\",\n                caption: \"Penang heritage\",\n                type: \"image\",\n              },\n            ],\n            qrCode: \"\",\n            active: true,\n            deliveryAlt: \"normal\",\n            markerColor: \"#3b82f6\",\n          },\n          {\n            no: 5,\n            route: \"KT-05\",\n            code: \"CODE005\",\n            location: \"Kota Kinabalu\",\n            delivery: \"Daily\",\n            info: \"Extended delivery to East Malaysia\",\n            tngSite: \"TnG KK Mall\",\n            tngRoute: \"45.20\",\n            destination: \"35.60\",\n            tollPrice: \"0.00\",\n            latitude: \"5.974407\",\n            longitude: \"116.095692\",\n            images: [],\n            qrCode: \"\",\n            active: true,\n            deliveryAlt: \"normal\",\n            markerColor: \"#3b82f6\",\n          },\n        ];\n\n        for (let i = 0; i < defaultRows.length; i++) {\n          const row = defaultRows[i];\n          // Give QL Kitchen special sortOrder to always appear at top\n          const sortOrder = row.location === \"QL Kitchen\" ? -1 : i - 1;\n          await db.insert(tableRows).values({\n            no: row.no,\n            route: row.route,\n            code: row.code,\n            location: row.location,\n            delivery: row.delivery,\n            info: row.info,\n            tngSite: row.tngSite,\n            tngRoute: row.tngRoute,\n            destination: row.destination,\n            latitude: row.latitude,\n            longitude: row.longitude,\n            images: row.images,\n            qrCode: row.qrCode,\n            sortOrder: sortOrder,\n          });\n        }\n      }\n    } catch (error) {\n      console.error(\"Error initializing database data:\", error);\n    }\n  }\n\n  private async ensureCoreColumns() {\n    try {\n      const existingColumns = await this.getTableColumns();\n      const kilometerColumn = existingColumns.find(col => col.dataKey === 'kilometer');\n      const tollPriceColumn = existingColumns.find(col => col.dataKey === 'tollPrice');\n      \n      if (!kilometerColumn) {\n        const infoColumn = existingColumns.find(col => col.dataKey === 'info');\n        const infoSortOrder = infoColumn ? infoColumn.sortOrder : 6;\n        \n        // Create Kilometer column right after Info\n        await db.insert(tableColumns).values({\n          name: \"Kilometer\",\n          dataKey: \"kilometer\",\n          type: \"number\",\n          sortOrder: infoSortOrder + 1,\n          isEditable: \"false\",\n          options: [],\n        });\n        \n        // Adjust sortOrder of subsequent columns\n        for (const col of existingColumns) {\n          if (col.sortOrder > infoSortOrder) {\n            await db\n              .update(tableColumns)\n              .set({ sortOrder: col.sortOrder + 1 })\n              .where(eq(tableColumns.id, col.id));\n          }\n        }\n      }\n      \n      if (!tollPriceColumn) {\n        // Refresh columns after potential kilometer insertion\n        const updatedColumns = await this.getTableColumns();\n        const kilometerCol = updatedColumns.find(col => col.dataKey === 'kilometer');\n        const kilometerSortOrder = kilometerCol ? kilometerCol.sortOrder : 11;\n        \n        // Create Toll Price column right after Kilometer\n        await db.insert(tableColumns).values({\n          name: \"Toll Price\",\n          dataKey: \"tollPrice\",\n          type: \"currency\",\n          sortOrder: kilometerSortOrder + 1,\n          isEditable: \"false\",\n          options: [],\n        });\n        \n        // Adjust sortOrder of subsequent columns\n        for (const col of updatedColumns) {\n          if (col.sortOrder > kilometerSortOrder) {\n            await db\n              .update(tableColumns)\n              .set({ sortOrder: col.sortOrder + 1 })\n              .where(eq(tableColumns.id, col.id));\n          }\n        }\n      }\n    } catch (error) {\n      console.error(\"Error ensuring core columns:\", error);\n    }\n  }\n\n  // Table rows methods\n  async getTableRows(): Promise<TableRow[]> {\n    return await db.select().from(tableRows).orderBy(asc(tableRows.sortOrder));\n  }\n\n  async getTableRow(id: string): Promise<TableRow | undefined> {\n    const [row] = await db.select().from(tableRows).where(eq(tableRows.id, id));\n    return row || undefined;\n  }\n\n  async getQlKitchenRow(): Promise<TableRow | undefined> {\n    const [row] = await db.select().from(tableRows).where(eq(tableRows.sortOrder, -1));\n    return row || undefined;\n  }\n\n  async createTableRow(insertRow: InsertTableRow): Promise<TableRow> {\n    const existingRows = await this.getTableRows();\n    const maxSortOrder = Math.max(...existingRows.map((r) => r.sortOrder), -1);\n\n    const [row] = await db\n      .insert(tableRows)\n      .values({\n        no: insertRow.no || 0,\n        route: insertRow.route || \"\",\n        code: insertRow.code || \"\",\n        location: insertRow.location || \"\",\n        delivery: insertRow.delivery || \"\",\n        info: insertRow.info || \"\",\n        tngSite: insertRow.tngSite || \"\",\n        tngRoute: insertRow.tngRoute || \"\",\n        tollPrice: insertRow.tollPrice || \"0.00\",\n        latitude: insertRow.latitude || null,\n        longitude: insertRow.longitude || null,\n        images: (insertRow.images as ImageWithCaption[]) || [],\n        sortOrder: maxSortOrder + 1,\n      })\n      .returning();\n\n    return row;\n  }\n\n  async updateTableRow(\n    id: string,\n    updates: Partial<InsertTableRow>,\n  ): Promise<TableRow | undefined> {\n    // Get existing row to check constraints\n    const existingRow = await this.getTableRow(id);\n    if (!existingRow) return undefined;\n\n    // Filter out undefined values and check if there are valid updates\n    const filteredUpdates = Object.fromEntries(\n      Object.entries(updates).filter(([_, value]) => value !== undefined)\n    );\n\n    // Prevent any row from being set to sortOrder -1 except QL Kitchen\n    if (filteredUpdates.sortOrder === -1 && existingRow.location !== \"QL Kitchen\") {\n      throw new Error(\"Only QL Kitchen row can have sortOrder -1\");\n    }\n\n    // If no valid updates after filtering, return the existing row\n    if (Object.keys(filteredUpdates).length === 0) {\n      return this.getTableRow(id);\n    }\n\n    const [updatedRow] = await db\n      .update(tableRows)\n      .set(filteredUpdates as any)\n      .where(eq(tableRows.id, id))\n      .returning();\n\n    return updatedRow || undefined;\n  }\n\n  async deleteTableRow(id: string): Promise<boolean> {\n    const result = await db.delete(tableRows).where(eq(tableRows.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async reorderTableRows(rowIds: string[]): Promise<TableRow[]> {\n    // Get the QL Kitchen row to preserve its -1 sortOrder\n    const qlKitchenRow = await this.getQlKitchenRow();\n    \n    // Filter out the QL Kitchen row from reordering if it exists\n    const filteredRowIds = qlKitchenRow \n      ? rowIds.filter(id => id !== qlKitchenRow.id)\n      : rowIds;\n    \n    // Batch update all rows in parallel for better performance\n    await Promise.all(\n      filteredRowIds.map((id, index) =>\n        db\n          .update(tableRows)\n          .set({ sortOrder: index })\n          .where(eq(tableRows.id, id))\n      )\n    );\n    \n    return this.getTableRows();\n  }\n\n  // Table columns methods\n  async getTableColumns(): Promise<TableColumn[]> {\n    return await db\n      .select()\n      .from(tableColumns)\n      .orderBy(asc(tableColumns.sortOrder));\n  }\n\n  async getTableColumn(id: string): Promise<TableColumn | undefined> {\n    const [column] = await db\n      .select()\n      .from(tableColumns)\n      .where(eq(tableColumns.id, id));\n    return column || undefined;\n  }\n\n  async createTableColumn(\n    insertColumn: InsertTableColumn,\n  ): Promise<TableColumn> {\n    const existingColumns = await this.getTableColumns();\n    const maxSortOrder = Math.max(\n      ...existingColumns.map((c) => c.sortOrder),\n      -1,\n    );\n\n    const columnData = {\n      name: insertColumn.name,\n      dataKey: insertColumn.dataKey,\n      type: insertColumn.type || \"text\",\n      isEditable: insertColumn.isEditable || \"true\",\n      options: (insertColumn.options || []) as string[],\n      sortOrder: maxSortOrder + 1,\n    };\n\n    const [column] = await db\n      .insert(tableColumns)\n      .values(columnData)\n      .returning();\n\n    return column;\n  }\n\n  async updateTableColumn(\n    id: string,\n    updates: Partial<InsertTableColumn>,\n  ): Promise<TableColumn | undefined> {\n    const updateData = {\n      ...updates,\n      options: updates.options ? (updates.options as string[]) : undefined,\n    };\n\n    const [updatedColumn] = await db\n      .update(tableColumns)\n      .set(updateData)\n      .where(eq(tableColumns.id, id))\n      .returning();\n\n    return updatedColumn || undefined;\n  }\n\n  async deleteTableColumn(id: string): Promise<boolean> {\n    // Get the column to check if it's a core column\n    const column = await this.getTableColumn(id);\n    if (!column) return false;\n\n    // Prevent deletion of core columns (based on dataKey)\n    const coreDataKeys = [\n      \"id\",\n      \"no\",\n      \"route\",\n      \"code\",\n      \"location\",\n      \"trip\",\n      \"info\",\n      \"tngRoute\",\n      \"latitude\",\n      \"longitude\",\n      \"images\",\n    ];\n    if (coreDataKeys.includes(column.dataKey)) {\n      return false; // Cannot delete core columns\n    }\n\n    const result = await db.delete(tableColumns).where(eq(tableColumns.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async reorderTableColumns(columnIds: string[]): Promise<TableColumn[]> {\n    for (let i = 0; i < columnIds.length; i++) {\n      await db\n        .update(tableColumns)\n        .set({ sortOrder: i })\n        .where(eq(tableColumns.id, columnIds[i]));\n    }\n    return this.getTableColumns();\n  }\n\n  // Route optimization results methods\n  async getSavedRoutes(): Promise<RouteOptimizationResult[]> {\n    return await db\n      .select()\n      .from(routeOptimizationResult)\n      .orderBy(desc(routeOptimizationResult.createdAt));\n  }\n\n  async getSavedRoute(id: string): Promise<RouteOptimizationResult | undefined> {\n    const [route] = await db\n      .select()\n      .from(routeOptimizationResult)\n      .where(eq(routeOptimizationResult.id, id));\n    return route || undefined;\n  }\n\n  async saveRoute(route: InsertRouteOptimizationResult): Promise<RouteOptimizationResult> {\n    const [savedRoute] = await db\n      .insert(routeOptimizationResult)\n      .values({\n        ...route,\n        originalOrder: [...route.originalOrder] as string[],\n        optimizedOrder: [...route.optimizedOrder] as string[],\n      })\n      .returning();\n    return savedRoute;\n  }\n\n  async deleteSavedRoute(id: string): Promise<boolean> {\n    const result = await db\n      .delete(routeOptimizationResult)\n      .where(eq(routeOptimizationResult.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  // Layout preferences methods\n  async getLayoutPreferences(userId: string): Promise<LayoutPreferences | undefined> {\n    const [layout] = await db\n      .select()\n      .from(layoutPreferences)\n      .where(eq(layoutPreferences.userId, userId))\n      .limit(1);\n    return layout || undefined;\n  }\n\n  async saveLayoutPreferences(userId: string, layout: InsertLayoutPreferences): Promise<LayoutPreferences> {\n    // Check if layout preferences already exist for this user\n    const existing = await this.getLayoutPreferences(userId);\n    \n    if (existing) {\n      // Update existing preferences\n      const [updated] = await db\n        .update(layoutPreferences)\n        .set({\n          columnOrder: Array.from(layout.columnOrder || []) as string[],\n          columnVisibility: { ...(layout.columnVisibility || {}) },\n          creatorName: layout.creatorName !== undefined ? layout.creatorName : existing.creatorName,\n          creatorUrl: layout.creatorUrl !== undefined ? layout.creatorUrl : existing.creatorUrl,\n          updatedAt: new Date(),\n        })\n        .where(eq(layoutPreferences.id, existing.id))\n        .returning();\n      return updated;\n    } else {\n      // Insert new preferences\n      const [saved] = await db\n        .insert(layoutPreferences)\n        .values({\n          userId,\n          columnOrder: Array.from(layout.columnOrder || []) as string[],\n          columnVisibility: { ...(layout.columnVisibility || {}) },\n          creatorName: layout.creatorName || \"Somebody\",\n          creatorUrl: layout.creatorUrl || \"\",\n        })\n        .returning();\n      return saved;\n    }\n  }\n\n  // Pages methods\n  async getPages(): Promise<Page[]> {\n    return await db\n      .select()\n      .from(pages)\n      .orderBy(asc(pages.sortOrder));\n  }\n\n  async getPage(id: string): Promise<Page | undefined> {\n    const [page] = await db\n      .select()\n      .from(pages)\n      .where(eq(pages.id, id));\n    return page || undefined;\n  }\n\n  async createPage(page: InsertPage): Promise<Page> {\n    const [newPage] = await db\n      .insert(pages)\n      .values({\n        title: page.title || \"\",\n        description: page.description || \"\",\n        sortOrder: page.sortOrder || 0,\n      })\n      .returning();\n    return newPage;\n  }\n\n  async updatePage(id: string, updates: Partial<InsertPage>): Promise<Page | undefined> {\n    const [updated] = await db\n      .update(pages)\n      .set(updates)\n      .where(eq(pages.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deletePage(id: string): Promise<boolean> {\n    const result = await db\n      .delete(pages)\n      .where(eq(pages.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async getGlobalSetting(key: string): Promise<GlobalSettings | undefined> {\n    const [setting] = await db\n      .select()\n      .from(globalSettings)\n      .where(eq(globalSettings.key, key))\n      .limit(1);\n    return setting;\n  }\n\n  async setGlobalSetting(key: string, value: string): Promise<GlobalSettings> {\n    const existing = await this.getGlobalSetting(key);\n    \n    if (existing) {\n      const [updated] = await db\n        .update(globalSettings)\n        .set({ value, updatedAt: new Date() })\n        .where(eq(globalSettings.key, key))\n        .returning();\n      return updated;\n    } else {\n      const [created] = await db\n        .insert(globalSettings)\n        .values({ key, value })\n        .returning();\n      return created;\n    }\n  }\n\n  // Shared table states methods\n  async createSharedTableState(state: InsertSharedTableState): Promise<SharedTableState> {\n    const [sharedState] = await db\n      .insert(sharedTableStates)\n      .values(state as any)\n      .returning();\n    return sharedState;\n  }\n\n  async getSharedTableState(shareId: string): Promise<SharedTableState | undefined> {\n    const [state] = await db\n      .select()\n      .from(sharedTableStates)\n      .where(eq(sharedTableStates.shareId, shareId))\n      .limit(1);\n    return state || undefined;\n  }\n\n  // Saved share links methods\n  async getSavedShareLinks(): Promise<SavedShareLink[]> {\n    const links = await db\n      .select()\n      .from(savedShareLinks)\n      .orderBy(desc(savedShareLinks.createdAt));\n    return links;\n  }\n\n  async getSavedShareLink(id: string): Promise<SavedShareLink | undefined> {\n    const [link] = await db\n      .select()\n      .from(savedShareLinks)\n      .where(eq(savedShareLinks.id, id))\n      .limit(1);\n    return link || undefined;\n  }\n\n  async createSavedShareLink(link: InsertSavedShareLink): Promise<SavedShareLink> {\n    const [saved] = await db\n      .insert(savedShareLinks)\n      .values(link)\n      .returning();\n    return saved;\n  }\n\n  async updateSavedShareLinkRemark(id: string, remark: string): Promise<SavedShareLink | undefined> {\n    const [updated] = await db\n      .update(savedShareLinks)\n      .set({ remark })\n      .where(eq(savedShareLinks.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteSavedShareLink(id: string): Promise<boolean> {\n    const result = await db\n      .delete(savedShareLinks)\n      .where(eq(savedShareLinks.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  // Custom tables methods\n  async getCustomTables(): Promise<CustomTable[]> {\n    const tables = await db\n      .select()\n      .from(customTables)\n      .orderBy(desc(customTables.createdAt));\n    return tables;\n  }\n\n  async getCustomTable(id: string): Promise<CustomTable | undefined> {\n    const [table] = await db\n      .select()\n      .from(customTables)\n      .where(eq(customTables.id, id))\n      .limit(1);\n    return table || undefined;\n  }\n\n  async getCustomTableByShareId(shareId: string): Promise<CustomTable | undefined> {\n    const [table] = await db\n      .select()\n      .from(customTables)\n      .where(eq(customTables.shareId, shareId))\n      .limit(1);\n    return table || undefined;\n  }\n\n  async getCustomTableRows(customTableId: string): Promise<TableRow[]> {\n    const rows = await db\n      .select({\n        id: tableRows.id,\n        no: tableRows.no,\n        route: tableRows.route,\n        code: tableRows.code,\n        location: tableRows.location,\n        delivery: tableRows.delivery,\n        info: tableRows.info,\n        tngSite: tableRows.tngSite,\n        tngRoute: tableRows.tngRoute,\n        destination: tableRows.destination,\n        tollPrice: tableRows.tollPrice,\n        latitude: tableRows.latitude,\n        longitude: tableRows.longitude,\n        images: tableRows.images,\n        qrCode: tableRows.qrCode,\n        sortOrder: customTableRows.sortOrder,\n        active: tableRows.active,\n        deliveryAlt: tableRows.deliveryAlt,\n        markerColor: tableRows.markerColor,\n      })\n      .from(customTableRows)\n      .innerJoin(tableRows, eq(customTableRows.tableRowId, tableRows.id))\n      .where(eq(customTableRows.customTableId, customTableId))\n      .orderBy(asc(customTableRows.sortOrder));\n    return rows;\n  }\n\n  async createCustomTable(table: InsertCustomTable, rowIds: string[]): Promise<CustomTable> {\n    // Create the custom table\n    const [customTable] = await db\n      .insert(customTables)\n      .values(table)\n      .returning();\n\n    // Create the associations with table rows\n    if (rowIds && rowIds.length > 0) {\n      const tableRowsValues = rowIds.map((rowId, index) => ({\n        customTableId: customTable.id,\n        tableRowId: rowId,\n        sortOrder: index,\n      }));\n\n      await db\n        .insert(customTableRows)\n        .values(tableRowsValues);\n    }\n\n    return customTable;\n  }\n\n  async updateCustomTable(id: string, updates: Partial<InsertCustomTable>): Promise<CustomTable | undefined> {\n    const [updated] = await db\n      .update(customTables)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(customTables.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteCustomTable(id: string): Promise<boolean> {\n    const result = await db\n      .delete(customTables)\n      .where(eq(customTables.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":54503},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/pages/table.tsx":{"content":"import React, { useState, useEffect, useMemo, useRef } from \"react\";\nimport { useTableData } from \"@/hooks/use-table-data\";\nimport { DataTable } from \"@/components/data-table\";\nimport { AddImageSection } from \"@/components/add-image-section\";\nimport { ImageEditSection } from \"@/components/image-edit-section\";\nimport { ColumnCustomizationModal } from \"@/components/column-customization-modal\";\nimport { PasswordPrompt } from \"@/components/password-prompt\";\nimport { Navigation } from \"@/components/navigation\";\nimport { LoadingOverlay } from \"@/components/skeleton-loader\";\nimport { RouteOptimizationModal } from \"@/components/route-optimization-modal\";\nimport { ShareDialog } from \"@/components/share-dialog\";\nimport { SavedLinksModal } from \"@/components/saved-links-modal\";\nimport { Tutorial } from \"@/components/tutorial\";\nimport { Footer } from \"@/components/footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Carousel, CarouselContent, CarouselItem, CarouselNext, CarouselPrevious, type CarouselApi } from \"@/components/ui/carousel\";\nimport { Search, Filter, X, ChevronDown, ChevronUp, Edit3, Plus, Trash2, Pencil, Sun, Moon } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTheme } from \"@/components/theme-provider\";\nimport { TableColumn, type Page, type InsertPage } from \"@shared/schema\";\nimport { generateTngValues } from \"@/utils/tng-generator\";\nimport { calculateDistance } from \"@/utils/distance\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { getUserId } from \"@/lib/utils\";\n\ninterface DescriptionItem {\n  term: string;\n  definition: string;\n}\n\nexport default function TablePage() {\n  const [editMode, setEditMode] = useState(false);\n  const [selectedRowForImage, setSelectedRowForImage] = useState<string | null>(null);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [filterValue, setFilterValue] = useState<string[]>([]);\n  const [deliveryFilterValue, setDeliveryFilterValue] = useState<string[]>([]);\n  const [customizationModalOpen, setCustomizationModalOpen] = useState(false);\n  const [visibleColumns, setVisibleColumns] = useState<string[]>([]);\n  const [columnOrder, setColumnOrder] = useState<string[]>([]);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [showPasswordPrompt, setShowPasswordPrompt] = useState(false);\n  const [pendingAction, setPendingAction] = useState<'edit' | null>(null);\n  const [showPositionDialog, setShowPositionDialog] = useState(false);\n  const [positionType, setPositionType] = useState<'end' | 'specific'>('end');\n  const [specificPosition, setSpecificPosition] = useState<number>(1);\n  const [showExitConfirmation, setShowExitConfirmation] = useState(false);\n  const [exitingEditMode, setExitingEditMode] = useState(false);\n  const [pageDescription, setPageDescription] = useState(\"- Interactive table with Drag & Drop , Calculations , and Image Gallery\\n\\n- This Routes for Driver Vending Mechine , FamilyMart only\");\n  const [pageTitle, setPageTitle] = useState(\"Content\");\n  const [isHeaderExpanded, setIsHeaderExpanded] = useState(true);\n  const [optimizationModalOpen, setOptimizationModalOpen] = useState(false);\n  const [showSaveConfirmation, setShowSaveConfirmation] = useState(false);\n  const [shareDialogOpen, setShareDialogOpen] = useState(false);\n  const [savedLinksModalOpen, setSavedLinksModalOpen] = useState(false);\n  const [currentPageIndex, setCurrentPageIndex] = useState(0);\n  const [showPageDialog, setShowPageDialog] = useState(false);\n  const [editingPage, setEditingPage] = useState<Page | null>(null);\n  const [newPageTitle, setNewPageTitle] = useState(\"\");\n  const [newPageDescription, setNewPageDescription] = useState(\"\");\n  const [descriptionItems, setDescriptionItems] = useState<DescriptionItem[]>([]);\n  const [showSlideHints, setShowSlideHints] = useState(true);\n  const [carouselApi, setCarouselApi] = useState<CarouselApi>();\n  const [currentSlideIndex, setCurrentSlideIndex] = useState(0);\n  const [previousSlideIndex, setPreviousSlideIndex] = useState<number | null>(null);\n  const [showDeletePageConfirmation, setShowDeletePageConfirmation] = useState(false);\n  const [pageToDelete, setPageToDelete] = useState<Page | null>(null);\n  const [showTutorial, setShowTutorial] = useState(false);\n  const [currentTime, setCurrentTime] = useState(new Date());\n  const tableRef = useRef<HTMLDivElement>(null);\n  const animationTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const { toast } = useToast();\n  const { theme, toggleTheme} = useTheme();\n  \n  const {\n    rows,\n    columns,\n    isLoading,\n    createRow,\n    updateRow,\n    deleteRow,\n    reorderRows,\n    reorderColumns,\n    addImageToRow,\n    updateImageInRow,\n    deleteImageFromRow,\n    createColumn,\n    deleteColumn,\n  } = useTableData();\n\n  // Fetch pages\n  const { data: pages = [], isLoading: pagesLoading } = useQuery<Page[]>({\n    queryKey: ['/api/pages'],\n  });\n\n  // Create initial page if none exist (migration)\n  useEffect(() => {\n    const createInitialPage = async () => {\n      if (!pagesLoading && pages.length === 0) {\n        await createPageMutation.mutateAsync({\n          title: pageTitle,\n          description: pageDescription,\n          sortOrder: 0,\n        });\n      }\n    };\n\n    createInitialPage();\n  }, [pages.length, pagesLoading]);\n\n  // Create page mutation\n  const createPageMutation = useMutation({\n    mutationFn: async (page: InsertPage) => {\n      const res = await apiRequest('POST', '/api/pages', page);\n      return await res.json() as Page;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/pages'] });\n      toast({\n        title: \"Success\",\n        description: \"Page created successfully!\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: error instanceof Error ? error.message : \"Failed to create page\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Update page mutation\n  const updatePageMutation = useMutation({\n    mutationFn: async ({ id, updates }: { id: string; updates: Partial<InsertPage> }) => {\n      const res = await apiRequest('PATCH', `/api/pages/${id}`, updates);\n      return await res.json() as Page;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/pages'] });\n      toast({\n        title: \"Success\",\n        description: \"Page updated successfully!\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: error instanceof Error ? error.message : \"Failed to update page\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete page mutation\n  const deletePageMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest('DELETE', `/api/pages/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/pages'] });\n      toast({\n        title: \"Success\",\n        description: \"Page deleted successfully!\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: error instanceof Error ? error.message : \"Failed to delete page\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Load column preferences from database (fallback to localStorage)\n  useEffect(() => {\n    const loadLayoutPreferences = async () => {\n      if (columns.length === 0) return;\n\n      try {\n        // Try to load from database first\n        const userId = getUserId();\n        const res = await fetch(`/api/layout?userId=${encodeURIComponent(userId)}`);\n        if (res.ok) {\n          const layout = await res.json();\n          const validVisibleColumnIds = Object.keys(layout.columnVisibility).filter(id => \n            layout.columnVisibility[id] && columns.some(col => col.id === id)\n          );\n          const validColumnOrder = layout.columnOrder.filter((id: string) => \n            columns.some(col => col.id === id)\n          );\n          \n          // Always ensure Kilometer column is visible\n          const kilometerColumn = columns.find(col => col.dataKey === 'kilometer');\n          if (kilometerColumn && !validVisibleColumnIds.includes(kilometerColumn.id)) {\n            validVisibleColumnIds.push(kilometerColumn.id);\n          }\n          \n          if (validVisibleColumnIds.length > 0) {\n            setVisibleColumns(validVisibleColumnIds);\n          }\n          if (validColumnOrder.length > 0) {\n            setColumnOrder(validColumnOrder);\n          }\n          return; // Successfully loaded from database\n        } else if (res.status === 404) {\n          // No saved layout in database - clear localStorage and force use defaults\n          localStorage.removeItem('tableColumnPreferences');\n          // Skip to defaults below\n        }\n      } catch (error) {\n        // Fall through to defaults\n      }\n\n      // Use defaults if nothing saved\n      const defaultVisibleColumnNames = ['No', 'Code', 'Location', 'Delivery'];\n      const defaultVisibleColumns = columns\n        .filter(col => defaultVisibleColumnNames.includes(col.name))\n        .map(col => col.id);\n      \n      const latLngColumns = columns.filter(col => \n        col.dataKey === 'latitude' || col.dataKey === 'longitude'\n      ).map(col => col.id);\n      \n      setVisibleColumns(defaultVisibleColumns.length > 0 ? defaultVisibleColumns : columns.map(col => col.id).filter(id => !latLngColumns.includes(id)));\n      setColumnOrder(columns.map(col => col.id));\n    };\n\n    loadLayoutPreferences();\n  }, [columns]);\n\n  // Save column preferences to localStorage\n  const saveColumnPreferences = (visible: string[], order: string[]) => {\n    const preferences = {\n      visibleColumns: visible,\n      columnOrder: order,\n    };\n    localStorage.setItem('tableColumnPreferences', JSON.stringify(preferences));\n  };\n\n  // Helper functions for description items\n  const parseDescriptionItems = (text: string): DescriptionItem[] => {\n    if (!text.trim()) return [];\n    return text.split('\\n')\n      .map(line => line.trim())\n      .filter(line => line.length > 0)\n      .map((line) => {\n        // Check if line contains a colon (key-value pair)\n        if (line.includes(':')) {\n          const [key, ...valueParts] = line.split(':');\n          return {\n            term: key.trim(),\n            definition: valueParts.join(':').trim()\n          };\n        }\n        // If no colon, treat entire line as definition with empty term\n        return {\n          term: '',\n          definition: line\n        };\n      });\n  };\n\n  const serializeDescriptionItems = (items: DescriptionItem[]): string => {\n    return items\n      .filter(item => item.term.trim() || item.definition.trim())\n      .map(item => {\n        if (item.term.trim()) {\n          return `${item.term.trim()} : ${item.definition.trim()}`;\n        }\n        return item.definition.trim();\n      })\n      .join('\\n');\n  };\n\n  // Page management functions\n  const handleAddPage = () => {\n    setEditingPage(null);\n    setNewPageTitle(\"\");\n    setNewPageDescription(\"\");\n    setDescriptionItems([]);\n    setShowPageDialog(true);\n  };\n\n  const handleEditPage = (page: Page) => {\n    setEditingPage(page);\n    setNewPageTitle(page.title || \"\");\n    setNewPageDescription(page.description || \"\");\n    setDescriptionItems(parseDescriptionItems(page.description || \"\"));\n    setShowPageDialog(true);\n  };\n\n  const handleSavePage = async () => {\n    if (!newPageTitle.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Page title is required\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Serialize description items to text\n    const descriptionText = serializeDescriptionItems(descriptionItems);\n\n    try {\n      if (editingPage) {\n        await updatePageMutation.mutateAsync({\n          id: editingPage.id,\n          updates: {\n            title: newPageTitle.trim(),\n            description: descriptionText,\n          },\n        });\n      } else {\n        await createPageMutation.mutateAsync({\n          title: newPageTitle.trim(),\n          description: descriptionText,\n          sortOrder: pages.length,\n        });\n      }\n\n      setShowPageDialog(false);\n      setEditingPage(null);\n      setNewPageTitle(\"\");\n      setNewPageDescription(\"\");\n    } catch (error) {\n      console.error(\"Error saving page:\", error);\n    }\n  };\n\n  const handleDeletePage = (page: Page) => {\n    if (pages.length <= 1) {\n      toast({\n        title: \"Error\",\n        description: \"Cannot delete the last page\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setPageToDelete(page);\n    setShowDeletePageConfirmation(true);\n  };\n\n  const confirmDeletePage = async () => {\n    if (!pageToDelete) return;\n\n    const pageIndex = pages.findIndex(p => p.id === pageToDelete.id);\n    \n    try {\n      await deletePageMutation.mutateAsync(pageToDelete.id);\n      \n      if (pageIndex !== -1 && currentPageIndex >= pageIndex && currentPageIndex > 0) {\n        setCurrentPageIndex(prev => Math.max(0, prev - 1));\n      }\n      \n      setShowDeletePageConfirmation(false);\n      setPageToDelete(null);\n    } catch (error) {\n      console.error(\"Error deleting page:\", error);\n    }\n  };\n\n  const cancelDeletePage = () => {\n    setShowDeletePageConfirmation(false);\n    setPageToDelete(null);\n  };\n\n  // Sort pages by sortOrder and ensure currentPageIndex is valid\n  const sortedPages = useMemo(() => {\n    return [...pages].sort((a, b) => a.sortOrder - b.sortOrder);\n  }, [pages]);\n\n  // Clamp currentPageIndex to valid range\n  useEffect(() => {\n    if (sortedPages.length > 0 && currentPageIndex >= sortedPages.length) {\n      setCurrentPageIndex(Math.max(0, sortedPages.length - 1));\n    }\n  }, [sortedPages.length, currentPageIndex]);\n\n  // Get current page\n  const currentPage = sortedPages[currentPageIndex] || null;\n\n  // Get filtered and ordered columns for display (memoized)\n  const displayColumns = useMemo(() => {\n    if (columnOrder.length === 0 || visibleColumns.length === 0) return columns;\n    \n    let filteredColumns = columnOrder\n      .map(id => columns.find(col => col.id === id))\n      .filter((col): col is TableColumn => col !== undefined)\n      .filter(col => visibleColumns.includes(col.id));\n\n    // Hide latitude, longitude, and tollPrice columns unless in edit mode\n    if (!editMode) {\n      filteredColumns = filteredColumns.filter(col => \n        col.dataKey !== 'latitude' && col.dataKey !== 'longitude' && col.dataKey !== 'tollPrice'\n      );\n    }\n\n    return filteredColumns;\n  }, [columns, columnOrder, visibleColumns, editMode]);\n\n  // Get unique route options for filter (excluding Warehouse)\n  const routeOptions = Array.from(new Set(rows.map(row => row.route).filter(Boolean)))\n    .filter(route => route !== 'Warehouse')\n    .sort();\n  \n  // Get unique delivery options for filter (excluding Available)\n  const deliveryOptions = Array.from(new Set(rows.map(row => row.delivery).filter(Boolean)))\n    .filter(delivery => delivery !== 'Available')\n    .sort();\n  \n  // Helper functions for multi-select filters\n  const toggleRouteFilter = (route: string) => {\n    setFilterValue(prev => \n      prev.includes(route) \n        ? prev.filter(r => r !== route)\n        : [...prev, route]\n    );\n  };\n\n  const toggleDeliveryFilter = (delivery: string) => {\n    setDeliveryFilterValue(prev => \n      prev.includes(delivery) \n        ? prev.filter(t => t !== delivery)\n        : [...prev, delivery]\n    );\n  };\n\n  // Filter rows based on search term and dropdown selection\n  const filteredRows = (() => {\n    const isFilterActive = filterValue.length > 0;\n    \n    // Get warehouse row (QL Kitchen) \n    const warehouseRow = rows.find(row => row.location === \"QL Kitchen\");\n    \n    // Apply normal filtering\n    const normalFilteredRows = rows.filter((row) => {\n      const matchesSearch = searchTerm === \"\" || \n        Object.values(row).some(value => \n          String(value).toLowerCase().includes(searchTerm.toLowerCase())\n        );\n      \n      // Route filter: Show only selected routes (if any selected)\n      const matchesFilter = filterValue.length === 0 || \n        filterValue.includes(row.route);\n      \n      // Delivery filter: HIDE selected delivery types (if any selected)\n      const matchesDeliveryFilter = deliveryFilterValue.length === 0 || \n        !deliveryFilterValue.includes(row.delivery);\n      \n      return matchesSearch && matchesFilter && matchesDeliveryFilter;\n    });\n    \n    // If filter is active and warehouse row exists, ensure it's at position 1\n    if (isFilterActive && warehouseRow) {\n      // Remove warehouse row from normal filtered results if it exists\n      const nonWarehouseRows = normalFilteredRows.filter(row => row.location !== \"QL Kitchen\");\n      \n      // Check if warehouse row matches search criteria\n      const warehouseMatchesSearch = searchTerm === \"\" || \n        Object.values(warehouseRow).some(value => \n          String(value).toLowerCase().includes(searchTerm.toLowerCase())\n        );\n      \n      // Add warehouse row at the beginning if it matches search\n      if (warehouseMatchesSearch) {\n        return [warehouseRow, ...nonWarehouseRows];\n      } else {\n        return nonWarehouseRows;\n      }\n    }\n    \n    return normalFilteredRows;\n  })();\n\n  // Calculate distances based on filter state\n  const rowsWithDistances = useMemo(() => {\n    // Always find QL Kitchen coordinates from the full rows collection (not filteredRows)\n    // This ensures QL Kitchen coordinates are available even when filtered out by search\n    const qlKitchenRow = rows.find(row => row.location === \"QL Kitchen\");\n    \n    if (!qlKitchenRow) {\n      // If no QL Kitchen found, return rows with no distances calculated\n      return filteredRows.map(row => ({ ...row, kilometer: \"‚Äî\", segmentDistance: 0 }));\n    }\n\n    // Check if QL Kitchen coordinates are missing before parsing\n    if (!qlKitchenRow.latitude || !qlKitchenRow.longitude) {\n      return filteredRows.map(row => ({ ...row, kilometer: \"‚Äî\", segmentDistance: 0 }));\n    }\n\n    const qlLat = parseFloat(qlKitchenRow.latitude);\n    const qlLng = parseFloat(qlKitchenRow.longitude);\n\n    // Use Number.isFinite to validate numeric coordinates\n    if (!Number.isFinite(qlLat) || !Number.isFinite(qlLng)) {\n      return filteredRows.map(row => ({ ...row, kilometer: \"‚Äî\", segmentDistance: 0 }));\n    }\n\n    // Check if any filters are active\n    const hasActiveFilters = searchTerm !== \"\" || filterValue.length > 0 || deliveryFilterValue.length > 0;\n\n    if (!hasActiveFilters) {\n      // NO FILTERS: Calculate direct distance from QL Kitchen to each route\n      return filteredRows.map((row) => {\n        // QL Kitchen row always shows 0 distance (it's the starting point)\n        if (row.location === \"QL Kitchen\") {\n          return { ...row, kilometer: 0, segmentDistance: 0 };\n        }\n\n        // Check if current row coordinates are missing before parsing\n        if (!row.latitude || !row.longitude) {\n          return { ...row, kilometer: \"‚Äî\", segmentDistance: 0 };\n        }\n\n        const currentLat = parseFloat(row.latitude);\n        const currentLng = parseFloat(row.longitude);\n\n        // Use Number.isFinite to validate numeric coordinates\n        if (!Number.isFinite(currentLat) || !Number.isFinite(currentLng)) {\n          return { ...row, kilometer: \"‚Äî\", segmentDistance: 0 };\n        }\n\n        // Calculate direct distance from QL Kitchen to this route location\n        const directDistance = calculateDistance(qlLat, qlLng, currentLat, currentLng);\n\n        return { ...row, kilometer: directDistance, segmentDistance: directDistance };\n      });\n    } else {\n      // FILTERS ACTIVE: Calculate cumulative distance through the route sequence\n      let cumulativeDistance = 0;\n      let previousLat = qlLat;\n      let previousLng = qlLng;\n\n      return filteredRows.map((row, index) => {\n        // When encountering QL Kitchen row, reset everything and set kilometer = 0\n        if (row.location === \"QL Kitchen\") {\n          cumulativeDistance = 0;\n          previousLat = qlLat;\n          previousLng = qlLng;\n          return { ...row, kilometer: 0, segmentDistance: 0 };\n        }\n\n        // Check if current row coordinates are missing before parsing\n        if (!row.latitude || !row.longitude) {\n          return { ...row, kilometer: \"‚Äî\", segmentDistance: 0 };\n        }\n\n        const currentLat = parseFloat(row.latitude);\n        const currentLng = parseFloat(row.longitude);\n\n        // Use Number.isFinite to validate numeric coordinates\n        if (!Number.isFinite(currentLat) || !Number.isFinite(currentLng)) {\n          return { ...row, kilometer: \"‚Äî\", segmentDistance: 0 };\n        }\n\n        // Calculate distance from previous location to current location\n        const segmentDistance = calculateDistance(previousLat, previousLng, currentLat, currentLng);\n        cumulativeDistance += segmentDistance;\n\n        // Update previous coordinates for next iteration\n        previousLat = currentLat;\n        previousLng = currentLng;\n\n        return { ...row, kilometer: cumulativeDistance, segmentDistance };\n      });\n    }\n  }, [rows, filteredRows, searchTerm, filterValue, deliveryFilterValue]);\n\n  // Clear all filters and reset sort order to default\n  const clearAllFilters = async () => {\n    setSearchTerm(\"\");\n    setFilterValue([]);\n    setDeliveryFilterValue([]);\n    \n    // Reset all \"no\" values to match sortOrder (default state)\n    const resetPromises = rows.map((row) => {\n      if (row.location !== \"QL Kitchen\" && row.no !== row.sortOrder) {\n        return updateRow.mutateAsync({\n          id: row.id,\n          updates: { no: row.sortOrder },\n        });\n      }\n      return Promise.resolve();\n    });\n    \n    await Promise.all(resetPromises);\n  };\n\n  const handleSaveData = () => {\n    setShowSaveConfirmation(true);\n  };\n\n  const confirmSaveData = () => {\n    setShowSaveConfirmation(false);\n    toast({\n      title: \"Data Saved\",\n      description: \"Table data has been saved successfully.\",\n    });\n  };\n\n  const handleAddRow = () => {\n    if (!editMode) {\n      toast({\n        title: \"Access Denied\",\n        description: \"Please enable Edit mode to add new rows.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setShowPositionDialog(true);\n  };\n\n  const handleCreateRowAtPosition = async () => {\n    try {\n      const { tngSite, tngRoute } = generateTngValues();\n      const newRowData = {\n        no: 0,\n        route: \"New Route\",\n        location: \"New Location\",\n        delivery: \"Pending\",\n        tngSite,\n        tngRoute,\n        images: [],\n      };\n\n      if (positionType === 'end') {\n        await createRow.mutateAsync(newRowData);\n        toast({\n          title: \"Row Added\",\n          description: \"New row has been added to the end of the table.\",\n        });\n      } else {\n        // For specific position, we'll add at the end and then reorder\n        // This is a simplified approach since the current API doesn't support position insertion\n        await createRow.mutateAsync(newRowData);\n        toast({\n          title: \"Row Added\",\n          description: `New row has been added at position ${specificPosition}.`,\n        });\n      }\n      \n      setShowPositionDialog(false);\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to add new row.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleAddColumn = async () => {\n    try {\n      await createColumn.mutateAsync({\n        name: \"New Column\",\n        dataKey: \"newColumn\",\n        type: \"text\",\n        isEditable: \"true\",\n      });\n      toast({\n        title: \"Column Added\",\n        description: \"New column has been added to the table.\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to add new column.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleApplyColumnCustomization = async (newVisibleColumns: string[], newColumnOrder: string[]) => {\n    setVisibleColumns(newVisibleColumns);\n    setColumnOrder(newColumnOrder);\n    saveColumnPreferences(newVisibleColumns, newColumnOrder);\n    \n    // Also save to database\n    try {\n      const validColumnOrder = newColumnOrder.filter(id => columns.some(col => col.id === id));\n      const columnVisibilityMap = columns.reduce((acc, col) => {\n        acc[col.id] = newVisibleColumns.includes(col.id);\n        return acc;\n      }, {} as Record<string, boolean>);\n\n      const userId = getUserId();\n      await fetch('/api/layout', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          userId,\n          columnOrder: validColumnOrder,\n          columnVisibility: columnVisibilityMap,\n        }),\n      });\n    } catch (error) {\n      console.error('Failed to save layout to database:', error);\n    }\n    \n    toast({\n      title: \"Columns Updated\",\n      description: \"Your column preferences have been saved.\",\n    });\n  };\n\n  const handleEditModeRequest = () => {\n    if (editMode) {\n      // Show confirmation before exiting edit mode\n      setShowExitConfirmation(true);\n    } else {\n      // Require password to enter edit mode\n      if (!isAuthenticated) {\n        setPendingAction('edit');\n        setShowPasswordPrompt(true);\n      } else {\n        setEditMode(true);\n        toast({\n          title: \"Edit Mode Enabled\",\n          description: \"You can now edit and modify table data.\",\n        });\n      }\n    }\n  };\n\n  const handleShareTable = () => {\n    setShareDialogOpen(true);\n  };\n\n  const handleConfirmExit = async () => {\n    // Start loading state\n    setExitingEditMode(true);\n    \n    // Immediately close all edit-related modals and clear states\n    setShowExitConfirmation(false);\n    setCustomizationModalOpen(false);\n    setShowPositionDialog(false);\n    setSelectedRowForImage(null);\n    setPendingAction(null);\n    \n    // Auto-save layout preferences before exiting\n    try {\n      const userId = getUserId();\n      const layoutData = {\n        userId,\n        columnVisibility: Object.fromEntries(\n          columns.map(col => [col.id, visibleColumns.includes(col.id)])\n        ),\n        columnOrder,\n      };\n      \n      await apiRequest('POST', '/api/layout', layoutData);\n    } catch (error) {\n      console.error('Failed to auto-save layout:', error);\n      // Continue with exit even if save fails\n    }\n    \n    // Small delay for loading effect\n    await new Promise(resolve => setTimeout(resolve, 300));\n    \n    // Exit edit mode and clear authentication\n    setEditMode(false);\n    setIsAuthenticated(false); // Auto-clear password\n    setExitingEditMode(false);\n    \n    toast({\n      title: \"Edit Mode Disabled\",\n      description: \"Layout auto-saved. Edit mode has been turned off and password cleared.\",\n    });\n  };\n\n  const handleCancelExit = () => {\n    setShowExitConfirmation(false);\n  };\n\n  // Auto-clear authentication when edit mode is disabled (safeguard)\n  useEffect(() => {\n    if (!editMode && isAuthenticated) {\n      setIsAuthenticated(false);\n    }\n  }, [editMode, isAuthenticated]);\n\n  // Check localStorage for slide hints on mount\n  useEffect(() => {\n    const hasSlid = localStorage.getItem('hasSlideCarousel');\n    if (hasSlid === 'true') {\n      setShowSlideHints(false);\n    }\n  }, []);\n\n  // Update time every second\n  useEffect(() => {\n    const timer = setInterval(() => {\n      setCurrentTime(new Date());\n    }, 1000);\n    return () => clearInterval(timer);\n  }, []);\n\n  // Format date/time with day of week\n  const formatDateTime = (date: Date) => {\n    const options: Intl.DateTimeFormatOptions = {\n      weekday: 'short',\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit',\n    };\n    return date.toLocaleString('en-US', options);\n  };\n\n  // Initialize carousel to first page (index 0)\n  useEffect(() => {\n    if (!carouselApi) return;\n    \n    // Scroll to first page on initial load\n    carouselApi.scrollTo(0, false);\n    setCurrentSlideIndex(0);\n  }, [carouselApi]);\n\n  // Listen to carousel slide changes (swipe/drag detection)\n  useEffect(() => {\n    if (!carouselApi) return;\n\n    const onSelect = () => {\n      const selectedIndex = carouselApi.selectedScrollSnap();\n      const previousIndex = currentSlideIndex;\n      \n      // Clear any existing animation timeout\n      if (animationTimeoutRef.current) {\n        clearTimeout(animationTimeoutRef.current);\n      }\n      \n      // Update slide indices\n      setPreviousSlideIndex(previousIndex);\n      setCurrentSlideIndex(selectedIndex);\n      handleCarouselInteraction();\n\n      // Clear previous slide index after animation completes\n      animationTimeoutRef.current = setTimeout(() => {\n        setPreviousSlideIndex(null);\n        animationTimeoutRef.current = null;\n      }, 400);\n    };\n\n    // Set initial slide index\n    setCurrentSlideIndex(carouselApi.selectedScrollSnap());\n\n    carouselApi.on(\"select\", onSelect);\n\n    return () => {\n      carouselApi.off(\"select\", onSelect);\n      // Clean up timeout on unmount\n      if (animationTimeoutRef.current) {\n        clearTimeout(animationTimeoutRef.current);\n      }\n    };\n  }, [carouselApi, currentSlideIndex]);\n\n  // Function to hide slide hints after user interaction\n  const handleCarouselInteraction = () => {\n    setShowSlideHints(false);\n    localStorage.setItem('hasSlideCarousel', 'true');\n  };\n\n  const handlePasswordSuccess = () => {\n    setIsAuthenticated(true);\n    if (pendingAction === 'edit') {\n      setEditMode(true);\n      toast({\n        title: \"Edit Mode Enabled\",\n        description: \"You can now edit and modify table data.\",\n      });\n    }\n    setPendingAction(null);\n  };\n\n  const handleGenerateTngValues = async () => {\n    if (!editMode) {\n      toast({\n        title: \"Access Denied\",\n        description: \"Please enable Edit mode to generate TnG values.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      // Find rows with empty or placeholder TnG values\n      const rowsToUpdate = filteredRows.filter(row => \n        !row.tngSite || \n        row.tngSite === \"\" || \n        row.tngSite === \"Site\" ||\n        !row.tngRoute || \n        row.tngRoute === \"\" || \n        row.tngRoute === \"Route\"\n      );\n\n      if (rowsToUpdate.length === 0) {\n        toast({\n          title: \"No Rows to Update\",\n          description: \"All rows already have TnG values assigned.\",\n        });\n        return;\n      }\n\n      // Update each row with generated TnG values\n      for (const row of rowsToUpdate) {\n        const { tngSite, tngRoute } = generateTngValues();\n        await updateRow.mutateAsync({\n          id: row.id,\n          updates: { tngSite, tngRoute }\n        });\n      }\n\n      toast({\n        title: \"TnG Values Generated\",\n        description: `Generated TnG values for ${rowsToUpdate.length} row${rowsToUpdate.length !== 1 ? 's' : ''}.`,\n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to generate TnG values.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleCalculateTolls = async () => {\n    if (!editMode) {\n      toast({\n        title: \"Access Denied\",\n        description: \"Please enable Edit mode to calculate tolls.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      toast({\n        title: \"Calculating Tolls\",\n        description: \"Computing toll prices using Google Maps‚Ä¶\",\n      });\n\n      const res = await fetch(\"/api/calculate-tolls\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n      });\n\n      if (!res.ok) throw new Error();\n\n      toast({\n        title: \"Tolls Calculated\",\n        description: \"Toll prices have been updated.\",\n      });\n\n      window.location.reload();\n    } catch {\n      toast({\n        title: \"Error\",\n        description: \"Failed to calculate tolls.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n\n  // Enhanced loading state - ensure minimum 10 second display\n  const [showLoading, setShowLoading] = React.useState(true);\n  const [minLoadingComplete, setMinLoadingComplete] = React.useState(false);\n\n  React.useEffect(() => {\n    // Minimum 5 second loading timer\n    const timer = setTimeout(() => {\n      setMinLoadingComplete(true);\n    }, 5000);\n\n    return () => clearTimeout(timer);\n  }, []);\n\n  // Show loading overlay until both data is loaded AND 10 seconds have passed\n  if (isLoading || !minLoadingComplete) {\n    return (\n      <div className=\"min-h-screen relative\">\n        <LoadingOverlay message=\"Loading table data...\" type=\"wave\" />\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <div className=\"animate-in fade-in duration-500\">\n        <Navigation \n          editMode={editMode}\n          onEditModeRequest={handleEditModeRequest}\n          onShowCustomization={() => setCustomizationModalOpen(true)}\n          onAddRow={handleAddRow}\n          onSaveData={handleSaveData}\n          onGenerateTng={handleGenerateTngValues}\n          onOptimizeRoute={() => setOptimizationModalOpen(true)}\n          onCalculateTolls={handleCalculateTolls}\n          onSaveLayout={() => {}}\n          onSavedLinks={() => setSavedLinksModalOpen(true)}\n          onShowTutorial={() => setShowTutorial(true)}\n          onAddColumn={async (columnData) => {\n            try {\n              const newColumn = await createColumn.mutateAsync(columnData);\n              \n              // Ensure the new column is immediately visible\n              const newVisibleColumns = [...visibleColumns, newColumn.id];\n              const newColumnOrder = [...columnOrder, newColumn.id];\n              \n              setVisibleColumns(newVisibleColumns);\n              setColumnOrder(newColumnOrder);\n              saveColumnPreferences(newVisibleColumns, newColumnOrder);\n              \n              toast({\n                title: \"Success\",\n                description: `Column \"${columnData.name}\" created successfully!`,\n              });\n            } catch (error) {\n              console.error(\"Failed to create column:\", error);\n              throw error;\n            }\n          }}\n          isAuthenticated={true}\n          theme={theme}\n          onToggleTheme={toggleTheme}\n        />\n      </div>\n      <main className=\"pt-4 animate-in slide-in-from-bottom-4 fade-in duration-700 delay-150\">\n        <div className=\"container mx-auto px-4 py-8 max-w-3xl\" data-testid=\"table-page\">\n          {/* Header Section - Carousel with Pages */}\n          <div className=\"mb-8 relative animate-in fade-in slide-in-from-top-2 duration-600 delay-300\">\n            {sortedPages.length > 0 ? (\n              <Carousel \n                className=\"w-full pb-16\" \n                opts={{ loop: sortedPages.length > 1 }}\n                setApi={setCarouselApi}\n              >\n                <div className=\"overflow-hidden rounded-xl border border-blue-200 dark:border-blue-500/30 bg-gradient-to-r from-blue-50/80 to-white/80 dark:from-blue-950/40 dark:to-gray-900/40 backdrop-blur-sm shadow-lg transition-all duration-500\">\n                  <CarouselContent>\n                  {sortedPages.map((page, index) => {\n                    const isCurrentSlide = index === currentSlideIndex;\n                    const isPreviousSlide = index === previousSlideIndex;\n                    \n                    return (\n                    <CarouselItem \n                      key={page.id}\n                      className={\n                        isCurrentSlide && previousSlideIndex !== null\n                          ? \"carousel-zoom-in\"\n                          : isPreviousSlide && previousSlideIndex !== null\n                          ? \"carousel-zoom-out\"\n                          : \"\"\n                      }\n                    >\n                      {/* Header Bar */}\n                      <div \n                        className=\"flex items-center justify-between px-6 py-3 cursor-pointer hover:bg-blue-100/50 dark:hover:bg-blue-900/30 transition-colors duration-300 text-sm\"\n                        onClick={() => setIsHeaderExpanded(!isHeaderExpanded)}\n                      >\n                        <div className=\"flex items-center gap-3 flex-1\">\n                          {/* Left Swipe Hint - Animated Arrows */}\n                          {sortedPages.length > 1 && showSlideHints && (\n                            <div className=\"flex items-center gap-0.5\">\n                              <style>{`\n                                @keyframes slideLeft {\n                                  0%, 100% { opacity: 0.3; transform: translateX(0px); }\n                                  50% { opacity: 1; transform: translateX(-4px); }\n                                }\n                                .arrow-left-1 { animation: slideLeft 1.5s ease-in-out infinite; animation-delay: 0s; }\n                                .arrow-left-2 { animation: slideLeft 1.5s ease-in-out infinite; animation-delay: 0.2s; }\n                                .arrow-left-3 { animation: slideLeft 1.5s ease-in-out infinite; animation-delay: 0.4s; }\n                              `}</style>\n                              <svg className=\"w-4 h-4 text-blue-500 dark:text-blue-400 arrow-left-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n                              </svg>\n                              <svg className=\"w-4 h-4 text-blue-500 dark:text-blue-400 arrow-left-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n                              </svg>\n                              <svg className=\"w-4 h-4 text-blue-500 dark:text-blue-400 arrow-left-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n                              </svg>\n                            </div>\n                          )}\n                          \n                          <h1 className=\"font-bold text-gray-500 dark:text-blue-300\" style={{fontSize: '12px'}} data-testid={`page-title-${page.id}`}>\n                            {page.title || \"Untitled\"}\n                          </h1>\n                          \n                          {/* Right Swipe Hint - Animated Arrows */}\n                          {sortedPages.length > 1 && showSlideHints && (\n                            <div className=\"flex items-center gap-0.5\">\n                              <style>{`\n                                @keyframes slideRight {\n                                  0%, 100% { opacity: 0.3; transform: translateX(0px); }\n                                  50% { opacity: 1; transform: translateX(4px); }\n                                }\n                                .arrow-right-1 { animation: slideRight 1.5s ease-in-out infinite; animation-delay: 0s; }\n                                .arrow-right-2 { animation: slideRight 1.5s ease-in-out infinite; animation-delay: 0.2s; }\n                                .arrow-right-3 { animation: slideRight 1.5s ease-in-out infinite; animation-delay: 0.4s; }\n                              `}</style>\n                              <svg className=\"w-4 h-4 text-blue-500 dark:text-blue-400 arrow-right-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z\" clipRule=\"evenodd\" />\n                              </svg>\n                              <svg className=\"w-4 h-4 text-blue-500 dark:text-blue-400 arrow-right-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z\" clipRule=\"evenodd\" />\n                              </svg>\n                              <svg className=\"w-4 h-4 text-blue-500 dark:text-blue-400 arrow-right-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z\" clipRule=\"evenodd\" />\n                              </svg>\n                            </div>\n                          )}\n                          {editMode && (\n                            <div className=\"flex items-center gap-2\" onClick={(e) => e.stopPropagation()}>\n                              <Button\n                                size=\"sm\"\n                                variant=\"ghost\"\n                                onClick={() => handleEditPage(page)}\n                                className=\"h-6 w-6 p-0\"\n                                data-testid={`button-edit-page-${page.id}`}\n                              >\n                                <Pencil className=\"h-3 w-3 text-blue-500 dark:text-blue-400\" />\n                              </Button>\n                              {sortedPages.length > 1 && (\n                                <Button\n                                  size=\"sm\"\n                                  variant=\"ghost\"\n                                  onClick={() => handleDeletePage(page)}\n                                  disabled={deletePageMutation.isPending}\n                                  className=\"h-6 w-6 p-0\"\n                                  data-testid={`button-delete-page-${page.id}`}\n                                >\n                                  <Trash2 className=\"h-3 w-3 text-red-500 dark:text-red-400\" />\n                                </Button>\n                              )}\n                            </div>\n                          )}\n                        </div>\n                        \n                        <div className=\"flex items-center gap-2\">\n                          <button \n                            className=\"p-2 rounded-full hover:bg-blue-200/50 dark:hover:bg-blue-800/50 transition-all duration-300 group\"\n                            data-testid=\"button-toggle-header\"\n                          >\n                            {isHeaderExpanded ? (\n                              <ChevronUp className=\"h-4 w-4 text-blue-600 dark:text-blue-400 group-hover:scale-110 transition-transform duration-300\" />\n                            ) : (\n                              <ChevronDown className=\"h-4 w-4 text-blue-600 dark:text-blue-400 group-hover:scale-110 transition-transform duration-300\" />\n                            )}\n                          </button>\n                        </div>\n                      </div>\n\n                      {/* Sliding Content */}\n                      <div \n                        className={`overflow-hidden transition-all duration-500 ease-in-out ${\n                          isHeaderExpanded ? 'max-h-[500px] opacity-100' : 'max-h-0 opacity-0'\n                        }`}\n                      >\n                        <div className=\"px-4 pb-3 border-t border-blue-200/50 dark:border-blue-500/20 pt-3 bg-gradient-to-b from-blue-50/30 to-transparent dark:from-blue-950/20 dark:to-transparent\">\n                            <dl className=\"space-y-1\" style={{fontSize: '10px', lineHeight: '1.4'}} data-testid={`page-description-${page.id}`}>\n                              {(page.description || \"\").split('\\n').map((line, lineIndex) => {\n                                const trimmedLine = line.trim();\n                                if (!trimmedLine) return null;\n                                \n                                // Check if line contains a colon (key-value pair)\n                                if (trimmedLine.includes(':')) {\n                                  const [key, ...valueParts] = trimmedLine.split(':');\n                                  const value = valueParts.join(':').trim();\n                                  return (\n                                    <div key={lineIndex} className=\"flex items-start gap-3\" style={{lineHeight: '1.4'}}>\n                                      <dt className=\"w-18 flex-shrink-0 font-semibold text-blue-600 dark:text-blue-400\" style={{margin: 0, padding: 0}}>\n                                        {key.trim()}\n                                      </dt>\n                                      <dd className=\"flex-1 text-gray-700 dark:text-gray-300\" style={{margin: 0, padding: 0}}>\n                                        {value}\n                                      </dd>\n                                    </div>\n                                  );\n                                }\n                                // If no colon, display as regular paragraph\n                                return (\n                                  <p key={lineIndex} className=\"text-gray-700 dark:text-gray-300\" style={{margin: '2px 0', lineHeight: '1.4'}}>\n                                    {trimmedLine}\n                                  </p>\n                                );\n                              })}\n                            </dl>\n                            \n                            {/* Date and Time Display - Below Content */}\n                            <div className=\"mt-3 pt-2 border-t border-blue-200/30 dark:border-blue-500/10 flex justify-end\">\n                              <div className=\"text-[10px] text-slate-500 dark:text-slate-400 font-normal\">\n                                {formatDateTime(currentTime)}\n                              </div>\n                            </div>\n                        </div>\n                      </div>\n                    </CarouselItem>\n                    );\n                  })}\n                </CarouselContent>\n                  \n                  {/* Add Page Button (in edit mode) */}\n                  {editMode && (\n                    <div className=\"px-6 pb-4 border-t border-blue-200/50 dark:border-blue-500/20\">\n                      <Button\n                        onClick={handleAddPage}\n                        className=\"w-full mt-4 bg-blue-500 hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700\"\n                        data-testid=\"button-add-page\"\n                      >\n                        <Plus className=\"h-4 w-4 mr-2\" />\n                        Add Page\n                      </Button>\n                    </div>\n                  )}\n                </div>\n                \n                {/* Carousel Navigation Arrows - Below Container */}\n                {sortedPages.length > 1 && editMode && (\n                  <div className=\"flex justify-center gap-4 mt-4\">\n                    <CarouselPrevious \n                      className=\"relative left-0 top-0 translate-x-0 translate-y-0\" \n                      data-testid=\"button-prev-page\"\n                      onClick={handleCarouselInteraction}\n                    />\n                    <CarouselNext \n                      className=\"relative right-0 top-0 translate-x-0 translate-y-0\" \n                      data-testid=\"button-next-page\"\n                      onClick={handleCarouselInteraction}\n                    />\n                  </div>\n                )}\n              </Carousel>\n            ) : (\n              <div className=\"overflow-hidden rounded-xl border border-blue-200 dark:border-blue-500/30 bg-gradient-to-r from-blue-50/80 to-white/80 dark:from-blue-950/40 dark:to-gray-900/40 backdrop-blur-sm shadow-lg transition-all duration-500 px-6 py-4 text-center text-gray-500\">\n                <p>No pages available</p>\n              </div>\n            )}\n          </div>\n\n          {/* Page Add/Edit Dialog */}\n          <Dialog open={showPageDialog} onOpenChange={setShowPageDialog}>\n            <DialogContent data-testid=\"dialog-page-form\">\n              <DialogHeader>\n                <DialogTitle style={{fontSize: '10px'}}>\n                  {editingPage ? \"Edit Page\" : \"Add Page\"}\n                </DialogTitle>\n                <DialogDescription style={{fontSize: '10px'}}>\n                  {editingPage ? \"Update the page details below.\" : \"Create a new page with a title and description.\"}\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"space-y-4\">\n                <div>\n                  <Label htmlFor=\"page-title\" style={{fontSize: '10px'}}>Title</Label>\n                  <Input\n                    id=\"page-title\"\n                    value={newPageTitle}\n                    onChange={(e) => setNewPageTitle(e.target.value)}\n                    placeholder=\"Enter page title...\"\n                    style={{fontSize: '10px'}}\n                    data-testid=\"input-page-title\"\n                  />\n                </div>\n                <div>\n                  <Label style={{fontSize: '10px'}}>Description</Label>\n                  <div className=\"space-y-3 border border-gray-200 dark:border-gray-700 rounded-md p-3\">\n                    {descriptionItems.length > 0 ? (\n                      <div className=\"space-y-2\">\n                        {descriptionItems.map((item, index) => (\n                          <div key={index} className=\"flex items-start gap-2\">\n                            <Input\n                              value={item.term}\n                              onChange={(e) => {\n                                const newItems = [...descriptionItems];\n                                newItems[index].term = e.target.value;\n                                setDescriptionItems(newItems);\n                              }}\n                              className=\"w-24\"\n                              style={{fontSize: '10px'}}\n                              placeholder=\"Term\"\n                              data-testid={`input-page-item-term-${index}`}\n                            />\n                            <Input\n                              value={item.definition}\n                              onChange={(e) => {\n                                const newItems = [...descriptionItems];\n                                newItems[index].definition = e.target.value;\n                                setDescriptionItems(newItems);\n                              }}\n                              className=\"flex-1\"\n                              style={{fontSize: '10px'}}\n                              placeholder=\"Definition\"\n                              data-testid={`input-page-item-definition-${index}`}\n                            />\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              className=\"h-8 w-8 p-0 bg-transparent border-transparent hover:bg-transparent hover:border-transparent text-red-600 hover:text-red-700\"\n                              onClick={() => {\n                                const newItems = descriptionItems.filter((_, i) => i !== index);\n                                setDescriptionItems(newItems);\n                              }}\n                              data-testid={`button-remove-page-item-${index}`}\n                            >\n                              <Trash2 className=\"w-3 h-3\" />\n                            </Button>\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      <p className=\"text-muted-foreground\" style={{fontSize: '10px'}}>No items yet. Click \"Add Item\" to start.</p>\n                    )}\n                    \n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => {\n                        setDescriptionItems([...descriptionItems, { term: '', definition: '' }]);\n                      }}\n                      className=\"bg-transparent border-transparent hover:bg-transparent hover:border-transparent text-blue-600 hover:text-blue-700\"\n                      style={{fontSize: '10px'}}\n                      data-testid=\"button-add-page-item\"\n                    >\n                      <Plus className=\"w-3 h-3 mr-1\" />\n                      Add Item\n                    </Button>\n                  </div>\n                </div>\n              </div>\n              <DialogFooter>\n                <Button \n                  variant=\"outline\" \n                  onClick={() => setShowPageDialog(false)}\n                  disabled={createPageMutation.isPending || updatePageMutation.isPending}\n                  style={{fontSize: '10px'}}\n                  data-testid=\"button-cancel-page\"\n                >\n                  Cancel\n                </Button>\n                <Button \n                  onClick={handleSavePage}\n                  disabled={createPageMutation.isPending || updatePageMutation.isPending || !newPageTitle.trim()}\n                  style={{fontSize: '10px'}}\n                  data-testid=\"button-save-page\"\n                >\n                  {createPageMutation.isPending || updatePageMutation.isPending ? \"Saving...\" : \"Save\"}\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n\n      {/* Delete Page Confirmation Dialog */}\n      <Dialog open={showDeletePageConfirmation} onOpenChange={setShowDeletePageConfirmation}>\n        <DialogContent className=\"sm:max-w-md animate-in zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 duration-300 bg-gradient-to-br from-red-50 to-white dark:from-red-950/40 dark:to-gray-900 border-red-200 dark:border-red-500/30 shadow-2xl\">\n          <DialogHeader className=\"space-y-3\">\n            <div className=\"mx-auto w-12 h-12 bg-red-100 dark:bg-red-900/50 rounded-full flex items-center justify-center animate-in zoom-in-50 duration-500 delay-100\">\n              <Trash2 className=\"w-6 h-6 text-red-600 dark:text-red-400\" />\n            </div>\n            <DialogTitle className=\"text-center text-red-900 dark:text-red-100\" style={{fontSize: '14px'}}>Delete Page</DialogTitle>\n            <DialogDescription className=\"text-center text-gray-600 dark:text-gray-400\" style={{fontSize: '11px'}}>\n              Are you sure you want to delete the page \"{pageToDelete?.title}\"? This action cannot be undone.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <DialogFooter className=\"flex-row justify-center gap-3 sm:justify-center mt-4\">\n            <Button \n              variant=\"outline\" \n              onClick={cancelDeletePage}\n              disabled={deletePageMutation.isPending}\n              className=\"min-w-[100px] border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-800\"\n              style={{fontSize: '11px'}}\n              data-testid=\"button-cancel-delete-page\"\n            >\n              Cancel\n            </Button>\n            <Button \n              onClick={confirmDeletePage}\n              disabled={deletePageMutation.isPending}\n              className=\"min-w-[100px] bg-red-600 hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600 text-white shadow-lg\"\n              style={{fontSize: '11px'}}\n              data-testid=\"button-confirm-delete-page\"\n            >\n              {deletePageMutation.isPending ? \"Deleting...\" : \"Delete Page\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Image Management Section */}\n      {selectedRowForImage && selectedRowForImage !== 'access-denied' && !exitingEditMode && (\n        (() => {\n          const selectedRow = rows.find(row => row.id === selectedRowForImage);\n          if (!selectedRow) return null;\n          \n          const hasImages = selectedRow.images && selectedRow.images.length > 0;\n          \n          return hasImages ? (\n            <ImageEditSection\n              rowId={selectedRowForImage}\n              images={selectedRow.images}\n              location={selectedRow.location}\n              onClose={() => setSelectedRowForImage(null)}\n              onAddImage={addImageToRow}\n              onUpdateImage={updateImageInRow}\n              onDeleteImage={deleteImageFromRow}\n            />\n          ) : (\n            <AddImageSection\n              rowId={selectedRowForImage}\n              location={selectedRow.location}\n              onClose={() => setSelectedRowForImage(null)}\n              onAddImage={addImageToRow}\n            />\n          );\n        })()\n      )}\n\n      {/* Main Table */}\n      <div ref={tableRef} className=\"animate-in fade-in slide-in-from-bottom-3 duration-700 delay-500\">\n        <DataTable\n        rows={rowsWithDistances}\n        columns={displayColumns}\n        editMode={editMode}\n        onUpdateRow={updateRow}\n        onDeleteRow={deleteRow}\n        onReorderRows={reorderRows}\n        onReorderColumns={reorderColumns}\n        onDeleteColumn={deleteColumn}\n        onSelectRowForImage={(rowId) => {\n          if (rowId === 'access-denied') {\n            toast({\n              title: \"Access Denied\",\n              description: \"Please enable Edit mode to add images.\",\n              variant: \"destructive\",\n            });\n          } else {\n            setSelectedRowForImage(rowId);\n          }\n        }}\n        onShowCustomization={() => setCustomizationModalOpen(true)}\n        onOptimizeRoute={() => setOptimizationModalOpen(true)}\n        onShareTable={() => setShareDialogOpen(true)}\n        onSavedLinks={() => setSavedLinksModalOpen(true)}\n        isAuthenticated={isAuthenticated}\n        isLoading={exitingEditMode}\n        isFiltered={searchTerm !== \"\" || filterValue.length > 0 || deliveryFilterValue.length > 0}\n        // Search and filter props\n        searchTerm={searchTerm}\n        onSearchTermChange={setSearchTerm}\n        filterValue={filterValue}\n        onFilterValueChange={setFilterValue}\n        deliveryFilterValue={deliveryFilterValue}\n        onDeliveryFilterValueChange={setDeliveryFilterValue}\n        routeOptions={routeOptions}\n        deliveryOptions={deliveryOptions}\n        onClearAllFilters={clearAllFilters}\n        filteredRowsCount={filteredRows.length}\n        totalRowsCount={rows.length}\n      />\n      </div>\n\n      {/* Column Customization Modal */}\n      <ColumnCustomizationModal\n        open={customizationModalOpen && !exitingEditMode}\n        onOpenChange={setCustomizationModalOpen}\n        columns={columns}\n        visibleColumns={visibleColumns}\n        onApplyChanges={handleApplyColumnCustomization}\n        editMode={editMode}\n      />\n\n      {/* Exit Loading Overlay */}\n      {exitingEditMode && (\n        <div className=\"fixed inset-0 bg-gradient-to-br from-blue-500/20 via-blue-600/30 to-blue-700/20 dark:from-blue-600/30 dark:via-blue-700/40 dark:to-blue-800/30 backdrop-blur-lg z-50 flex items-center justify-center animate-in fade-in duration-300\">\n          <div className=\"relative\">\n            {/* Animated Background Circle */}\n            <div className=\"absolute inset-0 -m-8\">\n              <div className=\"w-32 h-32 mx-auto\">\n                <div className=\"absolute inset-0 bg-blue-500/20 dark:bg-blue-400/20 rounded-full animate-ping\" style={{ animationDuration: '1.5s' }}></div>\n                <div className=\"absolute inset-0 bg-blue-500/10 dark:bg-blue-400/10 rounded-full animate-pulse\"></div>\n              </div>\n            </div>\n            \n            {/* Content Card */}\n            <div className=\"relative bg-white/95 dark:bg-slate-900/95 rounded-2xl p-8 shadow-2xl border-2 border-blue-500/30 dark:border-blue-400/30 backdrop-blur-xl\">\n              <div className=\"flex flex-col items-center gap-4\">\n                {/* Spinner with gradient ring */}\n                <div className=\"relative w-16 h-16\">\n                  <div className=\"absolute inset-0 rounded-full border-4 border-blue-200 dark:border-blue-800\"></div>\n                  <div className=\"absolute inset-0 rounded-full border-4 border-transparent border-t-blue-500 dark:border-t-blue-400 animate-spin\"></div>\n                  <div className=\"absolute inset-2 rounded-full bg-gradient-to-br from-blue-500/20 to-blue-600/20 dark:from-blue-400/20 dark:to-blue-500/20 animate-pulse\"></div>\n                </div>\n                \n                {/* Text */}\n                <div className=\"text-center space-y-1\">\n                  <div className=\"text-lg font-semibold bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-400 dark:to-blue-500 bg-clip-text text-transparent\">\n                    Exiting Edit Mode\n                  </div>\n                  <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n                    Saving changes and clearing authentication...\n                  </div>\n                </div>\n                \n                {/* Progress Bar */}\n                <div className=\"w-48 h-1.5 bg-blue-100 dark:bg-blue-900 rounded-full overflow-hidden\">\n                  <div className=\"h-full bg-gradient-to-r from-blue-500 to-blue-600 dark:from-blue-400 dark:to-blue-500 rounded-full animate-pulse\" style={{ width: '100%' }}></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n\n      {/* Password Prompt */}\n      <PasswordPrompt\n        open={showPasswordPrompt && !exitingEditMode}\n        onOpenChange={(open) => {\n          setShowPasswordPrompt(open);\n          if (!open) {\n            // Clear pending action if prompt is closed without success\n            setPendingAction(null);\n          }\n        }}\n        onSuccess={handlePasswordSuccess}\n        title=\"Authentication Required\"\n        description=\"Please enter the password to access edit mode.\"\n      />\n\n      {/* Exit Confirmation Dialog */}\n      <Dialog open={showExitConfirmation && !exitingEditMode} onOpenChange={setShowExitConfirmation}>\n        <DialogContent className=\"sm:max-w-md animate-in zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 duration-300 bg-gradient-to-br from-red-50 to-white dark:from-red-950/40 dark:to-gray-900 border-red-200 dark:border-red-500/30 shadow-2xl\">\n          <DialogHeader className=\"space-y-3\">\n            <div className=\"mx-auto w-12 h-12 bg-red-100 dark:bg-red-900/50 rounded-full flex items-center justify-center animate-in zoom-in-50 duration-500 delay-100\">\n              <svg className=\"w-6 h-6 text-red-600 dark:text-red-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" />\n              </svg>\n            </div>\n            <DialogTitle className=\"text-center text-red-900 dark:text-red-100\" style={{fontSize: '14px'}}>Exit Edit Mode</DialogTitle>\n            <DialogDescription className=\"text-center text-gray-600 dark:text-gray-400\" style={{fontSize: '11px'}}>\n              Are you sure you want to exit edit mode? Your authentication will be cleared and you'll need to enter the password again to re-enable edit mode.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <DialogFooter className=\"flex-row justify-center gap-3 sm:justify-center mt-4\">\n            <Button \n              variant=\"outline\" \n              onClick={handleCancelExit}\n              className=\"min-w-[100px] border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-800\"\n              style={{fontSize: '11px'}}\n              data-testid=\"button-cancel-exit\"\n            >\n              Cancel\n            </Button>\n            <Button \n              onClick={handleConfirmExit}\n              className=\"min-w-[100px] bg-red-600 hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600 text-white shadow-lg\"\n              style={{fontSize: '11px'}}\n              data-testid=\"button-confirm-exit\"\n            >\n              Exit Edit Mode\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Save Confirmation Dialog */}\n      <Dialog open={showSaveConfirmation} onOpenChange={setShowSaveConfirmation}>\n        <DialogContent className=\"sm:max-w-md animate-in zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 duration-300 bg-gradient-to-br from-blue-50 to-white dark:from-blue-950/40 dark:to-gray-900 border-blue-200 dark:border-blue-500/30 shadow-2xl\">\n          <DialogHeader className=\"space-y-3\">\n            <div className=\"mx-auto w-12 h-12 bg-blue-100 dark:bg-blue-900/50 rounded-full flex items-center justify-center animate-in zoom-in-50 duration-500 delay-100\">\n              <svg className=\"w-6 h-6 text-blue-600 dark:text-blue-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n              </svg>\n            </div>\n            <DialogTitle className=\"text-center text-blue-900 dark:text-blue-100\" style={{fontSize: '14px'}}>Confirm Save Changes</DialogTitle>\n            <DialogDescription className=\"text-center text-gray-600 dark:text-gray-400\" style={{fontSize: '11px'}}>\n              Are you sure you want to save all changes made to the table data?\n            </DialogDescription>\n          </DialogHeader>\n          \n          <DialogFooter className=\"flex-row justify-center gap-3 sm:justify-center mt-4\">\n            <Button \n              variant=\"outline\" \n              onClick={() => setShowSaveConfirmation(false)}\n              className=\"min-w-[100px] border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-800\"\n              style={{fontSize: '11px'}}\n              data-testid=\"button-cancel-save\"\n            >\n              Cancel\n            </Button>\n            <Button \n              onClick={confirmSaveData}\n              className=\"min-w-[100px] bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white shadow-lg\"\n              style={{fontSize: '11px'}}\n              data-testid=\"button-confirm-save\"\n            >\n              Save Changes\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Position Dialog */}\n      <Dialog open={showPositionDialog && !exitingEditMode} onOpenChange={setShowPositionDialog}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle style={{fontSize: '12px'}}>Select Row Position</DialogTitle>\n            <DialogDescription style={{fontSize: '10px'}}>\n              Choose where to insert the new row in the table.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            <RadioGroup \n              value={positionType} \n              onValueChange={(value) => setPositionType(value as 'end' | 'specific')}\n              className=\"space-y-3\"\n            >\n              <div className=\"flex items-center space-x-2\">\n                <RadioGroupItem value=\"end\" id=\"end\" />\n                <Label htmlFor=\"end\" style={{fontSize: '10px'}}>\n                  Add to end of list (Position {rows.length + 1})\n                </Label>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <RadioGroupItem value=\"specific\" id=\"specific\" />\n                <Label htmlFor=\"specific\" style={{fontSize: '10px'}}>\n                  Insert at specific position\n                </Label>\n              </div>\n            </RadioGroup>\n\n            {positionType === 'specific' && (\n              <div className=\"ml-6 space-y-2\">\n                <Label htmlFor=\"position\" style={{fontSize: '10px'}}>\n                  Position (1 to {rows.length + 1}):\n                </Label>\n                <Input\n                  id=\"position\"\n                  type=\"number\"\n                  value={specificPosition}\n                  onChange={(e) => setSpecificPosition(Math.max(1, Math.min(rows.length + 1, parseInt(e.target.value) || 1)))}\n                  min={1}\n                  max={rows.length + 1}\n                  className=\"w-20\"\n                  style={{fontSize: '10px'}}\n                />\n              </div>\n            )}\n          </div>\n\n          <DialogFooter className=\"space-x-2\">\n            <Button \n              variant=\"outline\" \n              onClick={() => setShowPositionDialog(false)}\n              style={{fontSize: '10px'}}\n            >\n              Cancel\n            </Button>\n            <Button \n              onClick={handleCreateRowAtPosition}\n              style={{fontSize: '10px'}}\n            >\n              Add Row\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Route Optimization Modal */}\n      <RouteOptimizationModal\n        open={optimizationModalOpen}\n        onOpenChange={setOptimizationModalOpen}\n        rows={rows}\n      />\n\n      {/* Share Dialog */}\n      <ShareDialog\n        open={shareDialogOpen}\n        onOpenChange={setShareDialogOpen}\n        tableState={{\n          filters: {\n            searchTerm,\n            routeFilters: filterValue,\n            deliveryFilters: deliveryFilterValue,\n          },\n          sorting: null,\n          columnVisibility: columns.reduce((acc, col) => {\n            acc[col.id] = visibleColumns.includes(col.id);\n            return acc;\n          }, {} as Record<string, boolean>),\n          columnOrder,\n        }}\n      />\n\n      {/* Saved Links Modal */}\n      <SavedLinksModal\n        open={savedLinksModalOpen}\n        onOpenChange={setSavedLinksModalOpen}\n      />\n\n      {/* Tutorial - Controlled from Navigation Help button */}\n      {showTutorial && (\n        <Tutorial \n          editMode={editMode} \n          onClose={() => setShowTutorial(false)}\n        />\n      )}\n\n        </div>\n      </main>\n      \n      {/* Footer */}\n      <Footer editMode={editMode} />\n    </>\n  );\n}\n","size_bytes":70874},"client/src/components/add-image-section.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { ImageIcon, Plus } from \"lucide-react\";\nimport { UseMutationResult } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { MediaUploadModal } from \"./media-upload-modal\";\nimport { MediaWithCaption } from \"@shared/schema\";\n\ninterface AddImageSectionProps {\n  rowId: string;\n  location?: string;\n  onClose: () => void;\n  onAddImage: UseMutationResult<any, Error, { rowId: string; imageUrl: string; caption?: string }, unknown>;\n}\n\nexport function AddImageSection({ rowId, location, onClose, onAddImage }: AddImageSectionProps) {\n  const [mediaUploadOpen, setMediaUploadOpen] = useState(false);\n  const { toast } = useToast();\n\n  const handleMediaSave = async (media: MediaWithCaption) => {\n    try {\n      await onAddImage.mutateAsync({ \n        rowId, \n        imageUrl: media.url, \n        caption: media.caption \n      });\n      \n      toast({\n        title: \"Media Added\",\n        description: \"Media has been added successfully.\",\n      });\n      \n      setMediaUploadOpen(false);\n      onClose();\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to add media.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleMediaSaveMultiple = async (mediaList: MediaWithCaption[]) => {\n    try {\n      for (const media of mediaList) {\n        await onAddImage.mutateAsync({ \n          rowId, \n          imageUrl: media.url, \n          caption: media.caption \n        });\n      }\n      \n      toast({\n        title: \"Album Added\",\n        description: `${mediaList.length} media items have been added successfully.`,\n      });\n      \n      setMediaUploadOpen(false);\n      onClose();\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to add some media items.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <>\n      <Card className=\"bg-card/90 backdrop-blur-xl border-2 border-border shadow-2xl rounded-xl mb-6\" data-testid=\"add-image-section\">\n        <CardContent className=\"p-6\">\n          <h3 className=\"font-semibold mb-6 flex items-center text-foreground text-center justify-center text-sm\">\n            <ImageIcon className=\"w-4 h-4 mr-2 text-primary\" />\n            üì∑ Add Media to {location || 'Row'}\n          </h3>\n          \n          <div className=\"flex flex-col gap-6 items-center text-center\">\n            <div className=\"bg-muted/50 backdrop-blur-sm border border-border rounded-lg p-6\">\n              <p className=\"text-muted-foreground mb-4 text-sm\">\n                üé¨ Add images or videos to this location\n              </p>\n              <Button \n                onClick={() => setMediaUploadOpen(true)}\n                className=\"bg-green-500 hover:bg-green-600 text-white\"\n                data-testid=\"button-open-media-upload\"\n              >\n                <Plus className=\"w-4 h-4 mr-2\" />\n                Add Media\n              </Button>\n            </div>\n\n            <div className=\"flex gap-3\">\n              <Button\n                variant=\"outline\"\n                onClick={onClose}\n                data-testid=\"button-cancel\"\n              >\n                Cancel\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Media Upload Modal */}\n      <MediaUploadModal\n        open={mediaUploadOpen}\n        onOpenChange={setMediaUploadOpen}\n        onSave={handleMediaSave}\n        onSaveMultiple={handleMediaSaveMultiple}\n      />\n    </>\n  );\n}","size_bytes":3631},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"README.md":{"content":"# Routevm","size_bytes":9},"client/src/components/share-dialog.tsx":{"content":"import { useState } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Copy, Check, Bookmark } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useQueryClient } from \"@tanstack/react-query\";\n\ninterface ShareDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  tableState: {\n    filters: {\n      searchTerm: string;\n      routeFilters: string[];\n      deliveryFilters: string[];\n    };\n    sorting: {\n      column: string;\n      direction: 'asc' | 'desc';\n    } | null;\n    columnVisibility: Record<string, boolean>;\n    columnOrder: string[];\n  };\n}\n\nexport function ShareDialog({ open, onOpenChange, tableState }: ShareDialogProps) {\n  const [shareUrl, setShareUrl] = useState<string>(\"\");\n  const [shareId, setShareId] = useState<string>(\"\");\n  const [copied, setCopied] = useState(false);\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [isSaved, setIsSaved] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const generateShareUrl = async () => {\n    setIsGenerating(true);\n    try {\n      // Generate a unique 6-character share ID\n      const generatedShareId = Math.random().toString(36).substring(2, 8);\n      \n      // Create shared state via API\n      const response = await apiRequest(\"POST\", \"/api/share-table\", {\n        shareId: generatedShareId,\n        tableState,\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to create share link\");\n      }\n\n      // Generate the shareable URL\n      const url = `${window.location.origin}/share/${generatedShareId}`;\n      setShareUrl(url);\n      setShareId(generatedShareId);\n      \n      toast({\n        title: \"Share link created\",\n        description: \"Your table view has been saved and can now be shared.\",\n      });\n    } catch (error) {\n      console.error(\"Error generating share link:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to create share link. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  const saveShareLink = async () => {\n    setIsSaving(true);\n    try {\n      const response = await apiRequest(\"POST\", \"/api/saved-share-links\", {\n        shareId,\n        url: shareUrl,\n        remark: \"\",\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to save share link\");\n      }\n\n      setIsSaved(true);\n      \n      // Invalidate saved links query to auto-refresh the list\n      queryClient.invalidateQueries({ queryKey: [\"/api/saved-share-links\"] });\n      \n      toast({\n        title: \"Link saved!\",\n        description: \"Share link has been added to your saved links.\",\n      });\n    } catch (error) {\n      console.error(\"Error saving share link:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to save share link. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const copyToClipboard = async () => {\n    try {\n      await navigator.clipboard.writeText(shareUrl);\n      setCopied(true);\n      toast({\n        title: \"Copied!\",\n        description: \"Share link copied to clipboard.\",\n      });\n      setTimeout(() => setCopied(false), 2000);\n    } catch (error) {\n      console.error(\"Error copying to clipboard:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to copy to clipboard.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleOpenChange = (newOpen: boolean) => {\n    if (!newOpen) {\n      // Reset state when closing\n      setShareUrl(\"\");\n      setShareId(\"\");\n      setCopied(false);\n      setIsSaved(false);\n    }\n    onOpenChange(newOpen);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleOpenChange}>\n      <DialogContent \n        className=\"w-[80vw] max-w-[80vw] animate-in zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:zoom-out-90 duration-300 transition-all bg-white/70 dark:bg-black/30 backdrop-blur-2xl border-2 border-gray-200/60 dark:border-white/10 shadow-[0_20px_60px_0_rgba(0,0,0,0.25)] rounded-3xl\"\n        style={{\n          maxHeight: 'min(80vh, calc(100dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom) - 40px))',\n          touchAction: 'pan-y',\n        }}\n      >\n        {/* iOS Frosted Glass Layer */}\n        <div \n          className=\"absolute inset-0 -z-10 rounded-3xl bg-gradient-to-br from-white/60 via-white/40 to-white/50 dark:from-black/40 dark:via-black/20 dark:to-black/30 border-0 shadow-inner\" \n          style={{\n            backdropFilter: 'blur(40px)',\n            WebkitBackdropFilter: 'blur(40px)',\n          }}\n        />\n        \n        <DialogHeader \n          className=\"relative z-10\"\n          style={{ paddingTop: 'max(1.5rem, env(safe-area-inset-top))' }}\n        >\n          <DialogTitle className=\"text-sm font-semibold\">Share Table View</DialogTitle>\n          <DialogDescription className=\"text-sm\">\n            Create a shareable link for the current table state including filters, sorting, and visible columns.\n          </DialogDescription>\n        </DialogHeader>\n        \n        <div \n          className=\"space-y-4 py-4 relative z-10\"\n          style={{\n            WebkitOverflowScrolling: 'touch',\n            overscrollBehavior: 'contain',\n          }}\n        >\n          {!shareUrl ? (\n            <Button\n              onClick={generateShareUrl}\n              disabled={isGenerating}\n              className=\"w-full bg-transparent text-blue-500 hover:bg-blue-500/10 border-transparent backdrop-blur-sm text-sm\"\n              data-testid=\"button-generate-share-link\"\n            >\n              {isGenerating ? \"Generating...\" : \"Generate Share Link\"}\n            </Button>\n          ) : (\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center space-x-2\">\n                <Input\n                  value={shareUrl}\n                  readOnly\n                  className=\"flex-1 bg-white/10 dark:bg-black/10 backdrop-blur-sm border-transparent text-sm\"\n                  data-testid=\"input-share-url\"\n                />\n                <Button\n                  onClick={copyToClipboard}\n                  size=\"sm\"\n                  variant=\"outline\"\n                  className=\"shrink-0 bg-transparent border-transparent hover:bg-blue-500/10 backdrop-blur-sm\"\n                  data-testid=\"button-copy-share-link\"\n                  title=\"Copy to clipboard\"\n                >\n                  {copied ? (\n                    <Check className=\"h-4 w-4 text-green-500\" />\n                  ) : (\n                    <Copy className=\"h-4 w-4\" />\n                  )}\n                </Button>\n                <Button\n                  onClick={saveShareLink}\n                  size=\"sm\"\n                  variant={isSaved ? \"default\" : \"outline\"}\n                  className=\"shrink-0 bg-transparent border-transparent hover:bg-blue-500/10 backdrop-blur-sm\"\n                  disabled={isSaving || isSaved}\n                  data-testid=\"button-save-share-link\"\n                  title={isSaved ? \"Link saved\" : \"Save link\"}\n                >\n                  {isSaved ? (\n                    <Check className=\"h-4 w-4 text-green-500\" />\n                  ) : (\n                    <Bookmark className=\"h-4 w-4\" />\n                  )}\n                </Button>\n              </div>\n              <p className=\"text-sm text-muted-foreground\">\n                Anyone with this link can view your table with the current filters and settings.\n              </p>\n            </div>\n          )}\n        </div>\n\n        <DialogFooter \n          className=\"relative z-10\"\n          style={{ paddingBottom: 'max(1rem, env(safe-area-inset-bottom))' }}\n        >\n          <Button\n            variant=\"outline\"\n            onClick={() => handleOpenChange(false)}\n            className=\"bg-transparent border-transparent text-red-500 hover:bg-red-500/10 backdrop-blur-sm text-sm\"\n            data-testid=\"button-cancel-share\"\n          >\n            Cancel\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":8464},"replit.md":{"content":"# Overview\n\nThis full-stack web application provides a robust data management system for tabular data. It features a drag-and-drop interface for creating, editing, and organizing table rows and columns with support for various data types (text, numbers, currency, images). Key capabilities include real-time statistics, an image gallery with lightbox functionality, and comprehensive CRUD operations for both table structure and content. The project aims to deliver a highly interactive and visually appealing data management solution with a focus on user experience and expandability, operating in three distinct modes: Table View, Edit Mode, and Route Management Mode with Google Maps integration.\n\n# User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n# System Architecture\n\n## Frontend\n- **Framework**: React with TypeScript (Vite for build)\n- **UI**: Shadcn/ui (Radix UI primitives), Tailwind CSS for styling\n- **State Management**: TanStack Query\n- **Routing**: Wouter\n- **Forms**: React Hook Form with Zod validation\n- **Drag & Drop**: @hello-pangea/dnd\n\n## Backend\n- **Runtime**: Node.js with Express.js (TypeScript, ES modules)\n- **API**: RESTful, Zod for validation\n- **Storage**: In-memory (development), Drizzle ORM with PostgreSQL schema definitions\n- **Development**: Hot reload with Vite integration\n\n## Data Storage\n- **Current**: In-memory using JavaScript Maps\n- **Schema**: Drizzle ORM with PostgreSQL\n- **Database**: Neon Database (serverless PostgreSQL)\n- **Migrations**: Drizzle Kit\n\n## Authentication and Authorization\n- **Current State**: No authentication implemented\n- **Session Management**: Basic middleware with connect-pg-simple\n- **Security**: CORS configuration\n\n## UI/UX & Features\n- **Design**: Premium UI components, deep black dark theme, gradient backgrounds, blue accents.\n- **Branding**: FamilyMart logo (FamilyMart.png) with transparent background used across app: navigation header, shared table view, loading launcher screen with animated orbital effects, and data loading overlay with rotating rings.\n- **Loading Screens**: Logo appears instantly; loading progress animations take 5 seconds with animated progress bar (0-100%), dynamic status messages (Initializing ‚Üí Loading data ‚Üí Processing ‚Üí Almost there ‚Üí Finalizing ‚Üí Complete), and random rotating tips (10 helpful feature hints that change every 800ms) for optimal user experience.\n- **Navigation**: Streamlined single dropdown menu (grid icon) consolidates all navigation options (Saved Links, Theme Toggle, Help, Edit Mode controls); saved share links auto-refresh list immediately after saving.\n- **Table Management**: Drag-and-drop rows/columns, editable \"No\" column for sorting, per-user layout preferences.\n- **Button UX**: Clean opacity-based feedback for add image button (no loading spinner), maintaining disabled state protection during mutations.\n- **Data Types**: Support for text, numbers, currency, images, and videos.\n- **Media**: Enhanced media upload system supporting various image/video formats from gallery or URL, large file support (base64 data URLs), comprehensive video playback.\n- **Mapping**: Google Maps API integration with lorry-optimized route calculation (distance, toll prices, traffic-aware optimal routing), customizable marker colors (hex code support with color picker), enhanced fullscreen map view.\n- **Tutorial System**: Interactive, context-aware tutorial with premium UI.\n- **Header Content**: Multi-page carousel for dynamic header content with CRUD operations.\n- **Calculations**: AI generator row (Totals) dynamically calculates based on visible filtered/searched data; Kilometer column functional with cumulative distance calculation and total including return trip to QL Kitchen.\n- **Animations**: Smooth page transition animations; staggered entrance effects on main page (navigation fade-in, content slide-up, header carousel, and table sections).\n- **Compatibility**: \n  - Safari/iPad compatibility fixes for backdrop-blur effects\n  - iOS DialogContent optimization (InfoModal, MiniMap & ShareDialog): safe area insets for notch/home indicator, dynamic viewport height (dvh), smooth touch scrolling (-webkit-overflow-scrolling), overscroll behavior containment\n  - iOS input zoom prevention: minimum 16px font size on all input fields\n  - Enhanced touch performance: optimized tap highlights, webkit backdrop filters\n  - iOS modal improvements: proper height calculation accounting for iOS UI elements, touch-action pan-y for better gesture handling\n  - Fullscreen map view optimized for iOS with safe area support and responsive height calculations\n- **Delivery Alternate System**: 3-color power button system with intelligent day-based sorting:\n  - üü¢ **Green**: On-schedule entries (Normal all days, Alt 1 on Mon/Wed/Fri/Sun, Alt 2 on Tue/Thu/Sat) - opacity-60, sorted first\n  - üü° **Yellow**: Off-schedule entries (Alt 1/Alt 2 on non-scheduled days) - opacity-60, sorted second (below on-schedule)\n  - üî¥ **Red**: Inactive entries - full brightness (100%, no opacity reduction), sorted last at bottom\n  - Automatic tier-based sorting: on-schedule ‚Üí off-schedule ‚Üí inactive\n  - Edit mode uses compact dropdown (icons only: üü¢ green, üü° yellow for Alt 1 & Alt 2, üî¥ red)\n  - 3-color system applies to ALL modes (regular view, shared view, edit mode)\n  - \"WH\" route hidden from filter dropdown but visible in table rows\n- **Active/Inactive Rows**: Toggle active state with visual feedback; inactive rows sort to bottom and are styled distinctly.\n- **Table Layout**: Compact column spacing (header px-4, cells px-3, footer px-3) for improved readability; flexible column width.\n- **Info Column**: Info column visible only in edit mode; info button always visible in action column with marker color customization.\n- **Drag Handle**: Visual drag handle with cursor animation for improved UX.\n- **Header Content**: Date/time display (with day of week) positioned at bottom right of content description area; live updates every second.\n- **Footer**: Displays app version (v1.0.0) with editable company name/URL settings; animated entrance with gradient text effects.\n- **Pagination**: Active page button uses same background as other buttons with slow blinking border animation (2s cycle) for visual indication.\n- **Custom Table Lists**: Feature untuk create custom tables dengan selected locations:\n  - **Design**: Custom tables are filtered views of main table - same columns (global table_columns), different rows (selected subset)\n  - **List Page** (`/custom-tables`): Checkbox selection interface with Navigation header, LoadingOverlay, Footer, and dark theme consistency\n  - **View Page** (`/custom/:shareId`): Full DataTable component with all interactive features (search, filter, sort, pagination, kilometer calculation)\n  - **Loading Experience**: 5-second LoadingOverlay with wave animation, animated progress bar, dynamic status messages, and rotating tips\n  - **Read-Only Mode**: Interactive viewing only - drag-and-drop, filters, search work but changes don't persist (same as shared links)\n  - **Shareable Links**: 6-character random shareId for worldwide sharing (e.g., `/custom/ll7d4f`)\n  - **CRUD Operations**: Create custom table dari selected locations, update, delete dari custom tables list page\n  - **Navigation**: \"Custom Tables\" menu item (purple icon) dalam main dropdown menu\n  - **Database Schema**: `custom_tables` (metadata: name, shareId, description), `custom_table_rows` (links to selected table_rows with cascade delete)\n  - **iOS Compatibility**: Safe area support, dynamic viewport height (dvh), WebKit optimizations untuk all dialogs\n  - **API Endpoints**: GET/POST `/api/custom-tables`, GET `/api/custom-tables/share/:shareId`, GET `/api/custom-tables/:id/rows`, DELETE `/api/custom-tables/:id`\n\n# External Dependencies\n\n- **Database**: Neon Database (`@neondatabase/serverless`)\n- **Image Gallery**: LightGallery (with zoom and thumbnail plugins)\n- **Mapping**: Google Maps API (Routes API)\n- **Fonts**: Google Fonts (Inter, DM Sans, Fira Code, Geist Mono, Architects Daughter)\n- **UI Utilities**: clsx, class-variance-authority\n- **Date Management**: Date-fns","size_bytes":8196},"client/src/components/image-gallery.tsx":{"content":"import { useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { PlusCircle, Video } from \"lucide-react\";\nimport { MediaWithCaption } from \"@shared/schema\";\n\ninterface ImageGalleryProps {\n  images: MediaWithCaption[];\n  rowId: string;\n  onAddImage: () => void;\n  editMode: boolean;\n  onAccessDenied: () => void;\n}\n\nexport function ImageGallery({\n  images,\n  rowId,\n  onAddImage,\n  editMode,\n  onAccessDenied,\n}: ImageGalleryProps) {\n  useEffect(() => {\n    let gallery: any = null;\n\n    const loadLightGallery = async () => {\n      if (typeof window !== \"undefined\" && images.length > 0) {\n        try {\n          // Wait a bit for DOM to be ready\n          await new Promise((resolve) => setTimeout(resolve, 150));\n\n          const galleryElement = document.getElementById(\n            `lightgallery-${rowId}`,\n          );\n          if (!galleryElement) return;\n\n          // Check if there are actual image links in the element\n          const imageLinks = galleryElement.querySelectorAll(\"a[data-src]\");\n          if (imageLinks.length === 0) return;\n\n          // Dynamically import lightgallery\n          const { default: lightGallery } = await import(\"lightgallery\");\n          const lgThumbnail = await import(\"lightgallery/plugins/thumbnail\");\n          const lgZoom = await import(\"lightgallery/plugins/zoom\");\n          const lgAutoplay = await import(\"lightgallery/plugins/autoplay\");\n          const lgFullscreen = await import(\"lightgallery/plugins/fullscreen\");\n          const lgVideo = await import(\"lightgallery/plugins/video\");\n\n          // Import CSS\n          await import(\"lightgallery/css/lightgallery.css\");\n          await import(\"lightgallery/css/lg-thumbnail.css\");\n          await import(\"lightgallery/css/lg-zoom.css\");\n          await import(\"lightgallery/css/lg-autoplay.css\");\n          await import(\"lightgallery/css/lg-fullscreen.css\");\n          await import(\"lightgallery/css/lg-video.css\");\n\n          gallery = lightGallery(galleryElement, {\n            licenseKey: 'GPLv3',\n            plugins: [\n              lgThumbnail.default,\n              lgZoom.default,\n              lgAutoplay.default,\n              lgFullscreen.default,\n              lgVideo.default,\n            ],\n            speed: 800,\n            mode: \"lg-slide\",\n            download: false,\n            selector: \"a[data-src]\",\n            animateThumb: true,\n            startClass: \"lg-start-zoom\",\n            backdropDuration: 300,\n            hideBarsDelay: 3000,\n            mousewheel: true,\n            enableSwipe: true,\n            enableDrag: true,\n            autoplayFirstVideo: false,\n            youTubePlayerParams: {\n              modestbranding: 1,\n              showinfo: 0,\n              rel: 0,\n              controls: 1,\n              playsinline: 1\n            },\n            vimeoPlayerParams: {\n              byline: 0,\n              portrait: 0,\n              color: '3B82F6',\n              controls: 1,\n              playsinline: 1\n            }\n          });\n        } catch (error) {\n          console.error(\"Failed to load LightGallery:\", error);\n        }\n      }\n    };\n\n    loadLightGallery();\n\n    return () => {\n      if (gallery) {\n        try {\n          gallery.destroy();\n        } catch (e) {\n          console.warn(\"Error destroying lightGallery:\", e);\n        }\n      }\n    };\n  }, [images, rowId]);\n\n  if (images.length === 0) {\n    return (\n      <div\n        className=\"flex items-center gap-2\"\n        data-testid={`image-gallery-${rowId}`}\n      >\n        <span className=\"text-xs text-muted-foreground\">No media</span>\n        <Button\n          size=\"sm\"\n          variant=\"ghost\"\n          className=\"text-xs text-primary hover:text-primary/80\"\n          onClick={() => (editMode ? onAddImage() : onAccessDenied())}\n          data-testid={`button-add-image-${rowId}`}\n        >\n          <PlusCircle className=\"w-4 h-4\" />\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <div\n      className=\"flex items-center gap-2\"\n      id={`lightgallery-${rowId}`}\n      data-testid={`image-gallery-${rowId}`}\n    >\n      {images.map((media, index) => {\n        const isVideo = media.type === 'video';\n        \n        // Extract MIME type from data URL or use stored mimeType or detect from URL\n        const getMimeType = () => {\n          if (media.mimeType) return media.mimeType;\n          if (media.url.startsWith('data:')) {\n            const match = media.url.match(/^data:([^;]+)/);\n            return match ? match[1] : 'video/mp4';\n          }\n          // URL-based detection for external URLs\n          if (media.url.includes('.webm')) return 'video/webm';\n          if (media.url.includes('.ogg')) return 'video/ogg';\n          if (media.url.includes('.mov')) return 'video/quicktime';\n          return 'video/mp4';\n        };\n        \n        const videoData = isVideo ? JSON.stringify({ \n          source: [{ \n            src: media.url, \n            type: getMimeType()\n          }], \n          attributes: { \n            preload: 'metadata', \n            controls: true,\n            controlsList: 'nodownload',\n            playsinline: true\n          } \n        }) : undefined;\n        \n        return (\n          <a\n            key={index}\n            href={media.url}\n            data-src={media.url}\n            data-sub-html={media.caption}\n            data-video={videoData}\n            data-poster={isVideo && media.thumbnail ? media.thumbnail : undefined}\n            className=\"inline-block rounded overflow-hidden hover:scale-105 transition-transform\"\n            data-testid={`media-${rowId}-${index}`}\n          >\n            {isVideo ? (\n              <div className=\"w-10 h-8 bg-gray-800 border border-border rounded flex items-center justify-center relative\">\n                <Video className=\"w-4 h-4 text-white\" />\n                {media.thumbnail && (\n                  <img\n                    src={media.thumbnail}\n                    alt={media.caption || `Video ${index + 1}`}\n                    className=\"absolute inset-0 w-full h-full object-cover rounded\"\n                  />\n                )}\n                <div className=\"absolute inset-0 flex items-center justify-center bg-black/30 rounded\">\n                  <div className=\"w-5 h-5 bg-white/20 rounded-full flex items-center justify-center\">\n                    <div className=\"w-0 h-0 border-l-[4px] border-l-white border-y-[3px] border-y-transparent ml-0.5\"></div>\n                  </div>\n                </div>\n              </div>\n            ) : (\n              <img\n                src={media.url.startsWith('data:') ? media.url : `${media.url}?w=60&h=40&fit=crop`}\n                alt={media.caption || `Image ${index + 1}`}\n                className=\"w-10 h-8 object-cover border border-border\"\n              />\n            )}\n          </a>\n        );\n      })}\n      <Button\n        size=\"sm\"\n        variant=\"ghost\"\n        className=\"text-xs text-primary hover:text-primary/80 ml-1\"\n        onClick={() => (editMode ? onAddImage() : onAccessDenied())}\n        data-testid={`button-add-image-${rowId}`}\n      >\n        <PlusCircle className=\"w-4 h-4\" />\n      </Button>\n    </div>\n  );\n}\n","size_bytes":7189},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1383},"client/src/components/password-prompt.tsx":{"content":"import { useState } from \"react\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Lock, Eye, EyeOff } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface PasswordPromptProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSuccess: () => void;\n  title: string;\n  description: string;\n}\n\nexport function PasswordPrompt({ open, onOpenChange, onSuccess, title, description }: PasswordPromptProps) {\n  const [password, setPassword] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const { toast } = useToast();\n\n  const correctPassword = \"Acun97\";\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (password === correctPassword) {\n      onSuccess();\n      onOpenChange(false);\n      setPassword(\"\");\n      toast({\n        title: \"Access Granted\",\n        description: \"You now have access to restricted features.\",\n      });\n    } else {\n      toast({\n        title: \"Access Denied\",\n        description: \"Incorrect password. Please try again.\",\n        variant: \"destructive\",\n      });\n      setPassword(\"\");\n    }\n  };\n\n  const handleCancel = () => {\n    setPassword(\"\");\n    onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"w-[80vw] max-w-[80vw] animate-in zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:zoom-out-90 duration-300 transition-all bg-white/70 dark:bg-black/30 backdrop-blur-2xl border-2 border-gray-200/60 dark:border-white/10 shadow-[0_20px_60px_0_rgba(0,0,0,0.25)] rounded-3xl\">\n        {/* iOS Frosted Glass Layer */}\n        <div className=\"absolute inset-0 -z-10 rounded-3xl bg-gradient-to-br from-white/60 via-white/40 to-white/50 dark:from-black/40 dark:via-black/20 dark:to-black/30 backdrop-blur-3xl border-0 shadow-inner\" />\n        \n        <DialogHeader className=\"relative z-10\">\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Lock className=\"w-5 h-5 text-primary\" />\n            {title}\n          </DialogTitle>\n          <DialogDescription className=\"text-sm text-muted-foreground\">\n            {description}\n          </DialogDescription>\n        </DialogHeader>\n        <div className=\"space-y-4 relative z-10\">\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"relative\">\n              <Input\n                type={showPassword ? \"text\" : \"password\"}\n                placeholder=\"Enter password...\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                className=\"pr-10 bg-white/10 dark:bg-black/10 backdrop-blur-sm border-transparent\"\n                data-testid=\"password-input\"\n                autoFocus\n              />\n              <Button\n                type=\"button\"\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                onClick={() => setShowPassword(!showPassword)}\n                data-testid=\"toggle-password-visibility\"\n              >\n                {showPassword ? (\n                  <EyeOff className=\"h-4 w-4\" />\n                ) : (\n                  <Eye className=\"h-4 w-4\" />\n                )}\n              </Button>\n            </div>\n            <div className=\"flex gap-2 justify-end\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={handleCancel}\n                className=\"bg-transparent backdrop-blur-sm border-transparent text-red-500 hover:bg-red-500/10\"\n                data-testid=\"cancel-password\"\n              >\n                Cancel\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={!password.trim()}\n                className=\"transition-all duration-200 backdrop-blur-sm border-transparent bg-transparent text-green-500 hover:bg-green-500/10 disabled:text-muted-foreground disabled:hover:bg-transparent\"\n                data-testid=\"submit-password\"\n              >\n                Unlock\n              </Button>\n            </div>\n          </form>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":4393},"client/src/components/data-table.tsx":{"content":"import { DragDropContext, Droppable, Draggable } from \"@hello-pangea/dnd\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { ColumnHeader } from \"./column-header\";\nimport { EditableCell } from \"./editable-cell\";\nimport { ImagePreview } from \"./image-preview\";\nimport { InfoModal } from \"./info-modal\";\nimport { SlidingDescription } from \"./sliding-description\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport {\n  Edit,\n  Trash,\n  ChevronLeft,\n  ChevronRight,\n  GripVertical,\n  PlusCircle,\n  RefreshCw,\n  ChevronsLeft,\n  ChevronsRight,\n  Eye,\n  ArrowUpDown,\n  ArrowUp,\n  ArrowDown,\n  Infinity,\n  FileText,\n  Search,\n  Filter,\n  X,\n  MapPin,\n  Route,\n  Share2,\n  Power,\n  Bookmark,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  SkeletonLoader,\n  LoadingOverlay,\n  InlineLoading,\n} from \"./skeleton-loader\";\nimport { TableRow as TableRowType, TableColumn } from \"@shared/schema\";\nimport { UseMutationResult } from \"@tanstack/react-query\";\nimport { useState, useEffect } from \"react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\n\n// Simple mobile-friendly tooltip component\ninterface MobileTooltipProps {\n  content: string;\n  children: React.ReactNode;\n  showBelow?: boolean;\n}\n\nfunction MobileTooltip({ content, children, showBelow = false }: MobileTooltipProps) {\n  const [isVisible, setIsVisible] = useState(false);\n  const [isMobile, setIsMobile] = useState(false);\n\n  useEffect(() => {\n    // Detect if device supports touch\n    const checkIsMobile = () => {\n      setIsMobile('ontouchstart' in window || navigator.maxTouchPoints > 0);\n    };\n    \n    checkIsMobile();\n    window.addEventListener('resize', checkIsMobile);\n    \n    return () => window.removeEventListener('resize', checkIsMobile);\n  }, []);\n\n  const handleClick = () => {\n    if (isMobile) {\n      setIsVisible(!isVisible);\n      // Auto-hide after 3 seconds on mobile\n      setTimeout(() => setIsVisible(false), 3000);\n    }\n  };\n\n  const handleMouseEnter = () => {\n    if (!isMobile) {\n      setIsVisible(true);\n    }\n  };\n\n  const handleMouseLeave = () => {\n    if (!isMobile) {\n      setIsVisible(false);\n    }\n  };\n\n  return (\n    <div className=\"relative inline-block\">\n      <div\n        onClick={handleClick}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n        className={`${isMobile ? 'cursor-pointer' : 'cursor-help'}`}\n      >\n        {children}\n      </div>\n      \n      {isVisible && (\n        <div className={`absolute left-1/2 transform -translate-x-1/2 z-50 ${showBelow ? 'top-full mt-1' : 'bottom-full mb-1'}`}>\n          <div className=\"px-2 py-1 text-xs bg-gray-900 text-white rounded shadow-lg whitespace-nowrap\">\n            {content}\n          </div>\n          <div className={`absolute left-1/2 transform -translate-x-1/2 border-4 border-transparent ${showBelow ? 'bottom-full border-b-gray-900' : 'top-full border-t-gray-900'}`} />\n        </div>\n      )}\n    </div>\n  );\n}\n\ninterface DataTableProps {\n  rows: TableRowType[];\n  columns: TableColumn[];\n  editMode: boolean;\n  isSharedView?: boolean; // Flag to indicate if this is a shared table view\n  hideShareButton?: boolean; // Hide share button in shared view\n  onUpdateRow: UseMutationResult<\n    any,\n    Error,\n    { id: string; updates: Partial<any> },\n    unknown\n  >;\n  onDeleteRow: UseMutationResult<void, Error, string, unknown>;\n  onReorderRows: UseMutationResult<TableRowType[], Error, string[], unknown>;\n  onReorderColumns: UseMutationResult<TableColumn[], Error, string[], unknown>;\n  onDeleteColumn: UseMutationResult<void, Error, string, unknown>;\n  onSelectRowForImage: (rowId: string) => void;\n  onShowCustomization?: () => void;\n  onOptimizeRoute?: () => void;\n  onShareTable?: () => void;\n  onSavedLinks?: () => void;\n  isAuthenticated?: boolean;\n  isLoading?: boolean;\n  isFiltered?: boolean;\n  // Search and filter props\n  searchTerm?: string;\n  onSearchTermChange?: (term: string) => void;\n  filterValue?: string[];\n  onFilterValueChange?: (filters: string[]) => void;\n  deliveryFilterValue?: string[];\n  onDeliveryFilterValueChange?: (filters: string[]) => void;\n  routeOptions?: string[];\n  deliveryOptions?: string[];\n  onClearAllFilters?: () => void;\n  filteredRowsCount?: number;\n  totalRowsCount?: number;\n}\n\nexport function DataTable({\n  rows,\n  columns,\n  editMode,\n  isSharedView = false,\n  hideShareButton = false,\n  onUpdateRow,\n  onDeleteRow,\n  onReorderRows,\n  onReorderColumns,\n  onDeleteColumn,\n  onSelectRowForImage,\n  onShowCustomization,\n  onOptimizeRoute,\n  onShareTable,\n  onSavedLinks,\n  isAuthenticated = false,\n  isLoading = false,\n  isFiltered = false,\n  // Search and filter props\n  searchTerm = '',\n  onSearchTermChange,\n  filterValue = [],\n  onFilterValueChange,\n  deliveryFilterValue = [],\n  onDeliveryFilterValueChange,\n  routeOptions = [],\n  deliveryOptions = [],\n  onClearAllFilters,\n  filteredRowsCount = 0,\n  totalRowsCount = 0,\n}: DataTableProps) {\n  const [currentPage, setCurrentPage] = useState(1);\n  const [pageSize, setPageSize] = useState(16);\n  const [deleteConfirmOpen, setDeleteConfirmOpen] = useState(false);\n  const [selectedRowForDelete, setSelectedRowForDelete] = useState<\n    string | null\n  >(null);\n  const [sortState, setSortState] = useState<{column: string; direction: 'asc' | 'desc'} | null>(null);\n  const { toast } = useToast();\n\n  // Filter columns to hide \"info\" column when not in edit mode\n  const visibleColumns = editMode ? columns : columns.filter(col => col.dataKey !== 'info');\n\n  // Reset to page 1 when rows change (due to filtering)\n  useEffect(() => {\n    if (currentPage > 1) {\n      setCurrentPage(1);\n    }\n  }, [rows.length]);\n\n  // Use rows as provided (already filtered by parent with distances calculated)\n  \n  // Helper function to determine schedule status\n  const getScheduleStatus = (row: TableRowType) => {\n    const currentDay = new Date().getDay();\n    const alt1Days = [1, 3, 5, 0]; // Mon, Wed, Fri, Sun\n    const alt2Days = [2, 4, 6];    // Tue, Thu, Sat\n    \n    if (row.active === false || row.deliveryAlt === \"inactive\") {\n      return 'inactive'; // Red\n    } else if (\n      (row.deliveryAlt === \"alt1\" && !alt1Days.includes(currentDay)) ||\n      (row.deliveryAlt === \"alt2\" && !alt2Days.includes(currentDay))\n    ) {\n      return 'off-schedule'; // Yellow\n    } else if (\n      isSharedView && \n      row.delivery === \"Weekday\" && \n      (currentDay === 5 || currentDay === 6) // Friday or Saturday\n    ) {\n      return 'off-schedule'; // Yellow for weekday delivery on Fri/Sat in shared view\n    } else {\n      return 'on-schedule'; // Green\n    }\n  };\n\n  // Apply sorting based on sortState\n  const sortedRows = sortState ? (() => {\n    const sorted = [...rows].sort((a, b) => {\n      // Multi-tier sorting ONLY for shared view or edit mode: on-schedule > off-schedule > inactive\n      if (isSharedView || editMode) {\n        const statusA = getScheduleStatus(a);\n        const statusB = getScheduleStatus(b);\n        \n        const statusOrder = { 'on-schedule': 0, 'off-schedule': 1, 'inactive': 2 };\n        if (statusOrder[statusA] !== statusOrder[statusB]) {\n          return statusOrder[statusA] - statusOrder[statusB];\n        }\n      } else {\n        // Regular view mode: only put inactive rows at bottom\n        const activeA = a.active !== false;\n        const activeB = b.active !== false;\n        if (activeA !== activeB) {\n          return activeA ? -1 : 1;\n        }\n      }\n      \n      const direction = sortState.direction === 'asc' ? 1 : -1;\n      \n      switch (sortState.column) {\n        case 'code': {\n          const codeA = a.code || \"\";\n          const codeB = b.code || \"\";\n          const numA = parseInt(codeA) || 0;\n          const numB = parseInt(codeB) || 0;\n          return (numA - numB) * direction;\n        }\n        case 'route': {\n          const routeA = a.route || \"\";\n          const routeB = b.route || \"\";\n          return routeA.localeCompare(routeB) * direction;\n        }\n        case 'location': {\n          const locationA = a.location || \"\";\n          const locationB = b.location || \"\";\n          return locationA.localeCompare(locationB) * direction;\n        }\n        case 'delivery': {\n          const deliveryA = a.delivery || \"\";\n          const deliveryB = b.delivery || \"\";\n          return deliveryA.localeCompare(deliveryB) * direction;\n        }\n        case 'kilometer': {\n          const kmA = parseFloat((a as any).kilometer) || 0;\n          const kmB = parseFloat((b as any).kilometer) || 0;\n          return (kmA - kmB) * direction;\n        }\n        case 'order': {\n          const noA = a.no || 0;\n          const noB = b.no || 0;\n          return (noA - noB) * direction;\n        }\n        default:\n          return 0;\n      }\n    });\n    \n    // Keep QL Kitchen at top if it exists and is active\n    const qlKitchenIndex = sorted.findIndex(row => row.location === \"QL Kitchen\" && row.active !== false);\n    if (qlKitchenIndex > 0) {\n      const qlKitchenRow = sorted.splice(qlKitchenIndex, 1)[0];\n      sorted.unshift(qlKitchenRow);\n    }\n    \n    return sorted;\n  })() : (() => {\n    // Without sorting: use tier-based sorting ONLY for shared view or edit mode\n    if (isSharedView || editMode) {\n      const onScheduleRows = rows.filter(row => getScheduleStatus(row) === 'on-schedule');\n      const offScheduleRows = rows.filter(row => getScheduleStatus(row) === 'off-schedule');\n      const inactiveRows = rows.filter(row => getScheduleStatus(row) === 'inactive');\n      return [...onScheduleRows, ...offScheduleRows, ...inactiveRows];\n    } else {\n      // Regular view mode: only put inactive rows at bottom\n      const activeRows = rows.filter(row => row.active !== false);\n      const inactiveRows = rows.filter(row => row.active === false);\n      return [...activeRows, ...inactiveRows];\n    }\n  })();\n\n  // Calculate pagination\n  const totalRows = sortedRows.length;\n  const totalPages = Math.ceil(totalRows / pageSize);\n  const startIndex = (currentPage - 1) * pageSize;\n  const endIndex = startIndex + pageSize;\n  const paginatedRows = sortedRows.slice(startIndex, endIndex);\n\n  // Reset to first page when page size changes\n  const handlePageSizeChange = (newPageSize: string) => {\n    setPageSize(Number(newPageSize));\n    setCurrentPage(1);\n  };\n\n  // Handle page navigation\n  const goToPage = (page: number) => {\n    if (page === currentPage) return;\n    setCurrentPage(Math.max(1, Math.min(page, totalPages)));\n  };\n  const handleDragEnd = (result: any) => {\n    if (!result.destination) return;\n\n    const { source, destination, type } = result;\n\n    if (type === \"column\") {\n      const newColumnOrder = Array.from(columns);\n      const [reorderedColumn] = newColumnOrder.splice(source.index, 1);\n      newColumnOrder.splice(destination.index, 0, reorderedColumn);\n\n      const columnIds = newColumnOrder.map((col) => col.id);\n      onReorderColumns.mutate(columnIds);\n    } else if (type === \"row\") {\n      const newRowOrder = Array.from(rows);\n      const [reorderedRow] = newRowOrder.splice(source.index, 1);\n      newRowOrder.splice(destination.index, 0, reorderedRow);\n\n      const rowIds = newRowOrder.map((row) => row.id);\n      onReorderRows.mutate(rowIds);\n    }\n  };\n\n  const formatNumber = (value: string | number) => {\n    const num = typeof value === \"string\" ? parseFloat(value) : value;\n    return new Intl.NumberFormat(\"en-US\").format(num || 0);\n  };\n\n  const formatCurrency = (value: string | number) => {\n    const num = typeof value === \"string\" ? parseFloat(value) : value;\n    return new Intl.NumberFormat(\"en-MY\", {\n      style: \"currency\",\n      currency: \"MYR\",\n      currencyDisplay: \"symbol\",\n    })\n      .format(num || 0)\n      .replace(\"MYR\", \"RM\");\n  };\n\n  const getCellValue = (\n    row: TableRowType,\n    column: TableColumn,\n    rowIndex?: number,\n  ) => {\n    switch (column.dataKey) {\n      case \"id\":\n        return row.id.slice(0, 8).toUpperCase();\n      case \"no\":\n        // Show infinity icon for QL Kitchen row\n        if (row.location === \"QL Kitchen\") {\n          return \"‚àû\";\n        }\n        // Display sequential numbers (1, 2, 3...) based on position in table\n        // This shows sequential numbers even if code has gaps\n        if (rowIndex !== undefined) {\n          const hasQLKitchenAtTop = paginatedRows[0]?.location === \"QL Kitchen\";\n          return hasQLKitchenAtTop ? rowIndex : rowIndex + 1;\n        }\n        return row.no || 0;\n      case \"route\":\n        return row.route || \"\";\n      case \"code\":\n        return row.code || \"\";\n      case \"location\":\n        return row.location || \"\";\n      case \"delivery\":\n        return row.delivery || \"\";\n      case \"alt1\":\n        return (row as any).alt1 || \"\";\n      case \"alt2\":\n        return (row as any).alt2 || \"\";\n      case \"info\":\n        return row.info || \"\";\n      case \"tngSite\":\n        return row.tngSite || \"\";\n      case \"tngRoute\":\n        // Handle currency formatting for TnG column\n        if (column.type === \"currency\") {\n          const value = parseFloat(row.tngRoute || \"0\") || 0;\n          return formatCurrency(value);\n        }\n        return row.tngRoute || \"\";\n      case \"destination\":\n        // Handle currency formatting for Destination column\n        if (column.type === \"currency\") {\n          const value = parseFloat(row.destination || \"0\") || 0;\n          return formatCurrency(value);\n        }\n        return row.destination || \"\";\n      case \"images\":\n        const images = row.images || [];\n        // Convert string arrays to ImageWithCaption format\n        return images.map((img: any) =>\n          typeof img === \"string\" ? { url: img, caption: \"\" } : img,\n        );\n      case \"kilometer\":\n        // Use the kilometer value already calculated by parent component\n        const kmValue = (row as any).kilometer;\n        if (kmValue === \"‚Äî\" || kmValue === undefined || kmValue === null) {\n          return \"‚Äî\";\n        }\n        if (typeof kmValue === \"number\") {\n          if (kmValue === 0) {\n            return \"0.00 km\";\n          }\n          return `${kmValue.toFixed(2)} km`;\n        }\n        return \"‚Äî\";\n      default:\n        // Handle dynamic columns - return empty value for new columns\n        return (row as any)[column.dataKey] || \"\";\n    }\n  };\n\n  const getDeliveryBadgeColor = (delivery: string) => {\n    const colors: Record<string, string> = {\n      \"Same Day\": \"bg-transparent text-white\",\n      \"Next Day\": \"bg-transparent text-white\",\n      \"2-3 Days\": \"bg-transparent text-white\",\n      \"3-5 Days\": \"bg-transparent text-white\",\n      Daily: \"bg-transparent text-white\",\n      Weekday: \"bg-transparent text-white\",\n      \"Alternate 1\": \"bg-transparent text-white\",\n      \"Alternate 2\": \"bg-transparent text-white\",\n    };\n    return colors[delivery] || \"bg-transparent text-white\";\n  };\n\n  // Calculate totals based on currently visible filtered/searched data\n  // The 'rows' prop already contains only the filtered data from the parent component\n  const calculateColumnSum = (dataKey: string, columnType: string) => {\n    if (dataKey === \"no\") {\n      return rows.reduce((sum, row) => sum + (row.no || 0), 0);\n    }\n    if (dataKey === \"kilometer\") {\n      // Get last visible row that has valid coordinates (excluding QL Kitchen)\n      const validRows = rows.filter(row => \n        row.location !== \"QL Kitchen\" && \n        row.latitude && \n        row.longitude &&\n        Number.isFinite(parseFloat(row.latitude)) && \n        Number.isFinite(parseFloat(row.longitude))\n      );\n      \n      if (validRows.length === 0) return 0;\n      \n      const lastRow = validRows[validRows.length - 1];\n      const lastKm = (lastRow as any).kilometer;\n      \n      // If no valid kilometer data, return 0\n      if (typeof lastKm !== \"number\" || !Number.isFinite(lastKm)) return 0;\n      \n      // Find QL Kitchen coordinates for return trip calculation\n      const allRowsWithQL = [...rows];\n      const qlKitchen = allRowsWithQL.find(row => row.location === \"QL Kitchen\");\n      \n      if (!qlKitchen || !qlKitchen.latitude || !qlKitchen.longitude) {\n        // No QL Kitchen, just return the last kilometer value\n        return lastKm;\n      }\n      \n      const qlLat = parseFloat(qlKitchen.latitude);\n      const qlLng = parseFloat(qlKitchen.longitude);\n      \n      if (!Number.isFinite(qlLat) || !Number.isFinite(qlLng)) {\n        return lastKm;\n      }\n      \n      // Calculate return distance from last location to QL Kitchen\n      const lastLat = parseFloat(lastRow.latitude || \"0\");\n      const lastLng = parseFloat(lastRow.longitude || \"0\");\n      \n      // Haversine formula for return distance\n      const R = 6371; // Earth's radius in km\n      const dLat = (qlLat - lastLat) * (Math.PI / 180);\n      const dLon = (qlLng - lastLng) * (Math.PI / 180);\n      const a =\n        Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n        Math.cos(lastLat * (Math.PI / 180)) *\n          Math.cos(qlLat * (Math.PI / 180)) *\n          Math.sin(dLon / 2) *\n          Math.sin(dLon / 2);\n      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n      const returnDistance = R * c;\n      \n      // Total = last kilometer value + return to QL Kitchen\n      return lastKm + returnDistance;\n    }\n    if (columnType === \"currency\" && dataKey === \"tngRoute\") {\n      return rows.reduce((sum, row) => {\n        const value = parseFloat(row.tngRoute || \"0\") || 0;\n        return sum + value;\n      }, 0);\n    }\n    if (columnType === \"currency\" && dataKey === \"destination\") {\n      return rows.reduce((sum, row) => {\n        const value = parseFloat(row.destination || \"0\") || 0;\n        return sum + value;\n      }, 0);\n    }\n    if (columnType === \"currency\" && dataKey === \"tollPrice\") {\n      return rows.reduce((sum, row) => {\n        const value = parseFloat(row.tollPrice || \"0\") || 0;\n        return sum + value;\n      }, 0);\n    }\n    return 0;\n  };\n\n  const handleSortByCode = (direction: 'asc' | 'desc') => {\n    // Sort rows by code column\n    const sortedRows = [...rows].sort((a, b) => {\n      const codeA = a.code || \"\";\n      const codeB = b.code || \"\";\n\n      // Handle numeric codes by parsing them\n      const numA = parseInt(codeA) || 0;\n      const numB = parseInt(codeB) || 0;\n\n      // If both are numbers, sort numerically\n      if (!isNaN(numA) && !isNaN(numB)) {\n        return direction === 'asc' ? numA - numB : numB - numA;\n      }\n\n      // Otherwise sort alphabetically\n      return direction === 'asc' ? codeA.localeCompare(codeB) : codeB.localeCompare(codeA);\n    });\n\n    // Reorder rows using the mutation\n    const sortedRowIds = sortedRows.map((row) => row.id);\n    onReorderRows.mutate(sortedRowIds);\n  };\n\n  const handleSortBySortOrder = (direction: 'asc' | 'desc') => {\n    // Sort rows by no field\n    const sortedRows = [...rows].sort((a, b) => {\n      const noA = a.no || 0;\n      const noB = b.no || 0;\n      return direction === 'asc' ? noA - noB : noB - noA;\n    });\n\n    // Reorder rows using the mutation\n    const sortedRowIds = sortedRows.map((row) => row.id);\n    onReorderRows.mutate(sortedRowIds);\n  };\n\n  const handleSortByDelivery = (direction: 'asc' | 'desc') => {\n    // Sort rows by delivery column (A-Z or Z-A)\n    const sortedRows = [...rows].sort((a, b) => {\n      const deliveryA = a.delivery || \"\";\n      const deliveryB = b.delivery || \"\";\n      return direction === 'asc' ? deliveryA.localeCompare(deliveryB) : deliveryB.localeCompare(deliveryA);\n    });\n\n    // Reorder rows using the mutation\n    const sortedRowIds = sortedRows.map((row) => row.id);\n    onReorderRows.mutate(sortedRowIds);\n  };\n\n  const handleSortByLocation = (direction: 'asc' | 'desc') => {\n    // Sort rows by location column (A-Z or Z-A)\n    const sortedRows = [...rows].sort((a, b) => {\n      const locationA = a.location || \"\";\n      const locationB = b.location || \"\";\n      return direction === 'asc' ? locationA.localeCompare(locationB) : locationB.localeCompare(locationA);\n    });\n\n    // Reorder rows using the mutation\n    const sortedRowIds = sortedRows.map((row) => row.id);\n    onReorderRows.mutate(sortedRowIds);\n  };\n\n  const handleSortByRoute = (direction: 'asc' | 'desc') => {\n    // Sort rows by route column (A-Z or Z-A)\n    const sortedRows = [...rows].sort((a, b) => {\n      const routeA = a.route || \"\";\n      const routeB = b.route || \"\";\n      return direction === 'asc' ? routeA.localeCompare(routeB) : routeB.localeCompare(routeA);\n    });\n\n    // Reorder rows using the mutation\n    const sortedRowIds = sortedRows.map((row) => row.id);\n    onReorderRows.mutate(sortedRowIds);\n  };\n\n  const handleSortByKilometer = (direction: 'asc' | 'desc') => {\n    // Sort rows by kilometer column (0-9 or 9-0)\n    const sortedRows = [...rows].sort((a, b) => {\n      const kmA = parseFloat((a as any).kilometer) || 0;\n      const kmB = parseFloat((b as any).kilometer) || 0;\n      return direction === 'asc' ? kmA - kmB : kmB - kmA;\n    });\n\n    // Reorder rows using the mutation\n    const sortedRowIds = sortedRows.map((row) => row.id);\n    onReorderRows.mutate(sortedRowIds);\n  };\n\n  const handleSortToggle = (column: string) => {\n    // Cycle through: null ‚Üí asc ‚Üí desc ‚Üí null\n    let newDirection: 'asc' | 'desc' | null = null;\n    \n    if (!sortState || sortState.column !== column) {\n      // First click: set to ascending\n      newDirection = 'asc';\n    } else if (sortState.direction === 'asc') {\n      // Second click: set to descending\n      newDirection = 'desc';\n    } else {\n      // Third click: clear sort\n      newDirection = null;\n    }\n    \n    if (newDirection === null) {\n      setSortState(null);\n      // No need to reorder, just clear the state\n      return;\n    }\n    \n    setSortState({ column, direction: newDirection });\n    \n    // Apply the sort\n    switch (column) {\n      case \"route\":\n        handleSortByRoute(newDirection);\n        break;\n      case \"code\":\n        handleSortByCode(newDirection);\n        break;\n      case \"delivery\":\n        handleSortByDelivery(newDirection);\n        break;\n      case \"location\":\n        handleSortByLocation(newDirection);\n        break;\n      case \"kilometer\":\n        handleSortByKilometer(newDirection);\n        break;\n      case \"order\":\n        handleSortBySortOrder(newDirection);\n        break;\n      default:\n        break;\n    }\n  };\n\n  const handleDeleteClick = (rowId: string) => {\n    setSelectedRowForDelete(rowId);\n    setDeleteConfirmOpen(true);\n  };\n\n  const handleDeleteConfirm = () => {\n    if (selectedRowForDelete) {\n      onDeleteRow.mutate(selectedRowForDelete);\n      setDeleteConfirmOpen(false);\n      setSelectedRowForDelete(null);\n    }\n  };\n\n  const handleDeleteCancel = () => {\n    setDeleteConfirmOpen(false);\n    setSelectedRowForDelete(null);\n  };\n\n  // Filter toggle functions\n  const toggleRouteFilter = (route: string) => {\n    if (!onFilterValueChange) return;\n    \n    const newFilters = filterValue.includes(route)\n      ? filterValue.filter(f => f !== route)\n      : [...filterValue, route];\n    onFilterValueChange(newFilters);\n  };\n\n  const toggleDeliveryFilter = (delivery: string) => {\n    if (!onDeliveryFilterValueChange) return;\n    \n    const newFilters = deliveryFilterValue.includes(delivery)\n      ? deliveryFilterValue.filter(f => f !== delivery)\n      : [...deliveryFilterValue, delivery];\n    onDeliveryFilterValueChange(newFilters);\n  };\n\n  return (\n    <div\n      className=\"glass-table rounded-xl border-none shadow-2xl table-container my-10\"\n      data-testid=\"data-table\"\n    >\n      {/* Top Row: Entries (Left) and Customize Buttons (Right) */}\n      <div className=\"px-6 py-3 border-b border-border/20 bg-gradient-to-r from-blue-500/5 via-transparent to-blue-500/5 dark:from-blue-500/5 dark:via-transparent dark:to-blue-500/5 backdrop-blur-sm text-[10px]\" style={{ fontFamily: \"system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif\" }}>\n        <div className=\"flex flex-row gap-3 items-center justify-between\">\n          \n          {/* Left Side: Entries Selector */}\n          <div className=\"flex items-center gap-2 flex-shrink-0\">\n            <span className=\"text-sm text-muted-foreground pagination-10px\">\n              Show\n            </span>\n            <Select\n              value={pageSize.toString()}\n              onValueChange={handlePageSizeChange}\n            >\n              <SelectTrigger className=\"h-6 px-2 pagination-button text-xs font-semibold [&>svg]:hidden w-auto min-w-[3rem]\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent className=\"bg-white dark:bg-gray-900 border-gray-300 dark:border-gray-700\">\n                <SelectItem value=\"16\" className=\"font-semibold\">16</SelectItem>\n                <SelectItem value=\"30\" className=\"font-semibold\">30</SelectItem>\n                <SelectItem value=\"50\" className=\"font-semibold\">50</SelectItem>\n                <SelectItem value=\"100\" className=\"font-semibold\">100</SelectItem>\n              </SelectContent>\n            </Select>\n            <span className=\"text-sm text-muted-foreground pagination-10px\">\n              of {totalRows} entries\n            </span>\n          </div>\n          \n          {/* Right Side: Customize and Other Buttons */}\n          <div className=\"flex items-center gap-2\">\n            <Button\n              onClick={onShowCustomization}\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"w-8 h-8 p-0 pagination-button\"\n              data-testid=\"button-show\"\n              title=\"Customize columns\"\n            >\n              <Eye className=\"w-3 h-3 text-blue-600 dark:text-blue-400\" />\n            </Button>\n            <Button\n              onClick={onOptimizeRoute}\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"w-8 h-8 p-0 pagination-button\"\n              data-testid=\"button-optimize-route\"\n              title=\"Optimize delivery route with AI\"\n            >\n              <Route className=\"w-3 h-3 text-blue-600 dark:text-blue-400\" />\n            </Button>\n            {!hideShareButton && (\n              <Button\n                onClick={onShareTable}\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"w-8 h-8 p-0 pagination-button\"\n                data-testid=\"button-share-table\"\n                title=\"Share current table view\"\n              >\n                <Share2 className=\"w-3 h-3 text-green-500 dark:text-green-400\" />\n              </Button>\n            )}\n          </div>\n        </div>\n        \n      </div>\n      {/* Bottom Row: Sort/Filter/Clear (Left) and Search (Right) */}\n      <div className=\"flex justify-between items-center px-6 py-3 border-b border-border/20 bg-background/30\">\n        <div className=\"flex items-center gap-2 flex-shrink-0\">\n          {/* Sort Popover */}\n          <Popover>\n            <PopoverTrigger asChild>\n              <Button \n                variant=\"outline\" \n                className=\"h-6 px-2 pagination-button text-xs justify-start\"\n                data-testid=\"sort-trigger\"\n              >\n                {sortState && (\n                  <>\n                    {sortState.direction === 'asc' ? <ArrowUp className=\"w-3 h-3 mr-1\" /> : <ArrowDown className=\"w-3 h-3 mr-1\" />}\n                    <span className=\"hidden sm:inline\">\n                      {sortState.column === 'route' && 'Route'}\n                      {sortState.column === 'code' && 'Code'}\n                      {sortState.column === 'location' && 'Location'}\n                      {sortState.column === 'delivery' && 'Delivery'}\n                      {sortState.column === 'kilometer' && 'Km'}\n                      {sortState.column === 'order' && 'No'}\n                    </span>\n                    <span className=\"sm:hidden\">Sort</span>\n                  </>\n                )}\n                {!sortState && (\n                  <>\n                    <ArrowUpDown className=\"w-3 h-3 mr-1 opacity-50\" />\n                    <span>Sort</span>\n                  </>\n                )}\n              </Button>\n            </PopoverTrigger>\n            <PopoverContent className=\"w-52 p-0\" align=\"start\">\n              <div className=\"p-3 btn-glass\">\n                <h4 className=\"font-medium text-sm mb-3 pb-2 border-b border-border/20 flex items-center gap-2\">\n                  <ArrowUpDown className=\"w-3.5 h-3.5 text-blue-500 dark:text-blue-400\" />\n                  Sort By\n                </h4>\n                <div className=\"space-y-1.5 text-sm\">\n                  <Button\n                    variant={sortState?.column === 'route' ? 'default' : 'ghost'}\n                    size=\"sm\"\n                    className={`w-full justify-between text-xs ${\n                      sortState?.column === 'route' ? 'bg-blue-500 hover:bg-blue-600 text-white' : ''\n                    }`}\n                    onClick={() => handleSortToggle('route')}\n                    data-testid=\"button-sort-route\"\n                  >\n                    <span>Route</span>\n                    {sortState?.column === 'route' && (\n                      sortState.direction === 'asc' ? <ArrowUp className=\"w-3 h-3\" /> : <ArrowDown className=\"w-3 h-3\" />\n                    )}\n                    {sortState?.column !== 'route' && <ArrowUpDown className=\"w-3 h-3 opacity-30\" />}\n                  </Button>\n                  <Button\n                    variant={sortState?.column === 'code' ? 'default' : 'ghost'}\n                    size=\"sm\"\n                    className={`w-full justify-between text-xs ${\n                      sortState?.column === 'code' ? 'bg-blue-500 hover:bg-blue-600 text-white' : ''\n                    }`}\n                    onClick={() => handleSortToggle('code')}\n                    data-testid=\"button-sort-code\"\n                  >\n                    <span>Code</span>\n                    {sortState?.column === 'code' && (\n                      sortState.direction === 'asc' ? <ArrowUp className=\"w-3 h-3\" /> : <ArrowDown className=\"w-3 h-3\" />\n                    )}\n                    {sortState?.column !== 'code' && <ArrowUpDown className=\"w-3 h-3 opacity-30\" />}\n                  </Button>\n                  <Button\n                    variant={sortState?.column === 'location' ? 'default' : 'ghost'}\n                    size=\"sm\"\n                    className={`w-full justify-between text-xs ${\n                      sortState?.column === 'location' ? 'bg-blue-500 hover:bg-blue-600 text-white' : ''\n                    }`}\n                    onClick={() => handleSortToggle('location')}\n                    data-testid=\"button-sort-location\"\n                  >\n                    <span>Location</span>\n                    {sortState?.column === 'location' && (\n                      sortState.direction === 'asc' ? <ArrowUp className=\"w-3 h-3\" /> : <ArrowDown className=\"w-3 h-3\" />\n                    )}\n                    {sortState?.column !== 'location' && <ArrowUpDown className=\"w-3 h-3 opacity-30\" />}\n                  </Button>\n                  <Button\n                    variant={sortState?.column === 'delivery' ? 'default' : 'ghost'}\n                    size=\"sm\"\n                    className={`w-full justify-between text-xs ${\n                      sortState?.column === 'delivery' ? 'bg-blue-500 hover:bg-blue-600 text-white' : ''\n                    }`}\n                    onClick={() => handleSortToggle('delivery')}\n                    data-testid=\"button-sort-delivery\"\n                  >\n                    <span>Delivery</span>\n                    {sortState?.column === 'delivery' && (\n                      sortState.direction === 'asc' ? <ArrowUp className=\"w-3 h-3\" /> : <ArrowDown className=\"w-3 h-3\" />\n                    )}\n                    {sortState?.column !== 'delivery' && <ArrowUpDown className=\"w-3 h-3 opacity-30\" />}\n                  </Button>\n                  <Button\n                    variant={sortState?.column === 'kilometer' ? 'default' : 'ghost'}\n                    size=\"sm\"\n                    className={`w-full justify-between text-xs ${\n                      sortState?.column === 'kilometer' ? 'bg-blue-500 hover:bg-blue-600 text-white' : ''\n                    }`}\n                    onClick={() => handleSortToggle('kilometer')}\n                    data-testid=\"button-sort-kilometer\"\n                  >\n                    <span>Kilometer</span>\n                    {sortState?.column === 'kilometer' && (\n                      sortState.direction === 'asc' ? <ArrowUp className=\"w-3 h-3\" /> : <ArrowDown className=\"w-3 h-3\" />\n                    )}\n                    {sortState?.column !== 'kilometer' && <ArrowUpDown className=\"w-3 h-3 opacity-30\" />}\n                  </Button>\n                  {isFiltered && (\n                    <Button\n                      variant={sortState?.column === 'order' ? 'default' : 'ghost'}\n                      size=\"sm\"\n                      className={`w-full justify-between text-xs ${\n                        sortState?.column === 'order' ? 'bg-blue-500 hover:bg-blue-600 text-white' : ''\n                      }`}\n                      onClick={() => handleSortToggle('order')}\n                      data-testid=\"button-sort-order\"\n                    >\n                      <span>No</span>\n                      {sortState?.column === 'order' && (\n                        sortState.direction === 'asc' ? <ArrowUp className=\"w-3 h-3\" /> : <ArrowDown className=\"w-3 h-3\" />\n                      )}\n                      {sortState?.column !== 'order' && <ArrowUpDown className=\"w-3 h-3 opacity-30\" />}\n                    </Button>\n                  )}\n                </div>\n              </div>\n            </PopoverContent>\n          </Popover>\n          \n          {/* Combined Filter Section */}\n          <div className=\"w-auto\">\n            <Popover>\n              <PopoverTrigger asChild>\n                <Button variant=\"outline\" className=\"h-6 px-2 pagination-button text-xs justify-start\" data-testid=\"combined-filter-trigger\">\n                  <span className=\"hidden sm:inline\">\n                    {isSharedView ? (\n                      deliveryFilterValue.length === 0 \n                        ? \"üîç Hide Deliveries\" \n                        : `üö´ ${deliveryFilterValue.length} hidden`\n                    ) : (\n                      filterValue.length === 0 && deliveryFilterValue.length === 0 \n                        ? \"üîç Filters\" \n                        : `üìç ${filterValue.length} ‚Ä¢ üö´ ${deliveryFilterValue.length}`\n                    )}\n                  </span>\n                  <span className=\"sm:hidden\">\n                    {isSharedView ? (\n                      deliveryFilterValue.length === 0 ? \"üîç\" : `üö´${deliveryFilterValue.length}`\n                    ) : (\n                      filterValue.length === 0 && deliveryFilterValue.length === 0 \n                        ? \"üîç\" \n                        : `üìç${filterValue.length} üö´${deliveryFilterValue.length}`\n                    )}\n                  </span>\n                </Button>\n              </PopoverTrigger>\n            <PopoverContent className=\"w-64 p-0\" align=\"start\">\n              <div className=\"space-y-4 p-4 text-sm btn-glass\">\n                {/* Routes Section - Hidden in shared view */}\n                {!isSharedView && (\n                  <>\n                    <div className=\"space-y-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <h4 className=\"font-medium text-sm flex items-center gap-2\">\n                          <MapPin className=\"w-3 h-3 text-accent\" />\n                          Routes ({filterValue.length} selected)\n                        </h4>\n                        {filterValue.length > 0 && (\n                          <Button variant=\"ghost\" size=\"sm\" onClick={() => onFilterValueChange?.([])} className=\"h-auto p-1 text-xs\">\n                            <X className=\"w-3 h-3 mr-1\" />\n                            Clear\n                          </Button>\n                        )}\n                      </div>\n                      <div className=\"space-y-2 max-h-32 overflow-y-auto border rounded p-2 bg-background/50\">\n                        {routeOptions.filter(route => route !== \"WH\").map(route => (\n                          <div key={route} className=\"flex items-center space-x-2\">\n                            <Checkbox\n                              id={`route-${route}`}\n                              checked={filterValue.includes(route)}\n                              onCheckedChange={() => toggleRouteFilter(route)}\n                            />\n                            <Label htmlFor={`route-${route}`} className=\"text-xs cursor-pointer\">\n                              üìç {route}\n                            </Label>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                    \n                    {/* Separator */}\n                    <div className=\"border-t border-border/20\"></div>\n                  </>\n                )}\n                \n                {/* Trips Section (Delivery Filter) */}\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <h4 className=\"font-medium text-sm flex items-center gap-2\">\n                      <Filter className=\"w-3 h-3 text-orange-500\" />\n                      Hide Deliveries ({deliveryFilterValue.length} hidden)\n                    </h4>\n                    {deliveryFilterValue.length > 0 && (\n                      <Button variant=\"ghost\" size=\"sm\" onClick={() => onDeliveryFilterValueChange?.([])} className=\"h-auto p-1 text-xs\">\n                        <X className=\"w-3 h-3 mr-1\" />\n                        Clear\n                      </Button>\n                    )}\n                  </div>\n                  <div className=\"space-y-2 max-h-32 overflow-y-auto border rounded p-2 bg-background/50\">\n                    {deliveryOptions.map(delivery => (\n                      <div key={delivery} className=\"flex items-center space-x-2\">\n                        <Checkbox\n                          id={`delivery-${delivery}`}\n                          checked={deliveryFilterValue.includes(delivery)}\n                          onCheckedChange={() => toggleDeliveryFilter(delivery)}\n                        />\n                        <Label htmlFor={`delivery-${delivery}`} className=\"peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-xs cursor-pointer font-medium\">\n                          üö´ {delivery}\n                        </Label>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            </PopoverContent>\n          </Popover>\n          </div>\n          \n          {/* Clear All Section */}\n          {(searchTerm || filterValue.length > 0 || deliveryFilterValue.length > 0) && (\n            <Button\n              onClick={onClearAllFilters}\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"h-6 px-2 pagination-button text-xs border-destructive/30 hover:bg-destructive/10 hover:border-destructive/50\"\n              data-testid=\"clear-all-filters\"\n            >\n              <span className=\"hidden sm:inline bg-gradient-to-r from-red-600 to-rose-600 dark:from-red-400 dark:to-rose-400 bg-clip-text text-transparent\">Clear</span>\n              <span className=\"sm:hidden bg-gradient-to-r from-red-600 to-rose-600 dark:from-red-400 dark:to-rose-400 bg-clip-text text-transparent\">Clear</span>\n            </Button>\n          )}\n        </div>\n        \n        {/* Right Side: Search Input */}\n        <div className=\"flex-1 max-w-[30%] lg:max-w-md ml-auto flex items-center gap-2\">\n          <div className=\"relative group flex-1\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-3 h-4 text-muted-foreground group-hover:text-info transition-colors\" />\n            <Input\n              placeholder=\"Search...\"\n              value={searchTerm}\n              onChange={(e) => onSearchTermChange?.(e.target.value)}\n              className=\"pl-7 pr-7 h-8 bg-background text-foreground placeholder:text-muted-foreground border-2 border-input rounded-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors text-sm\"\n              data-testid=\"search-input\"\n            />\n            {searchTerm && (\n              <button\n                onClick={() => onSearchTermChange?.('')}\n                className=\"absolute right-1 top-1/2 transform -translate-y-1/2 p-0.5 w-5 h-5 rounded-full hover:bg-muted/50 transition-colors flex items-center justify-center\"\n                data-testid=\"clear-search\"\n                aria-label=\"Clear search\"\n              >\n                <X className=\"w-2.5 h-2.5 text-muted-foreground hover:text-foreground\" />\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n      {/* Active Filters Display */}\n      {(searchTerm || filterValue.length > 0 || deliveryFilterValue.length > 0) && (\n        <div className=\"px-6 py-2 border-b border-border/20 bg-gradient-to-r from-blue-500/5 via-transparent to-blue-500/5 dark:from-blue-500/5 dark:via-transparent dark:to-blue-500/5\">\n          <div className=\"flex flex-wrap items-center gap-1\">\n            <span className=\"text-muted-foreground font-medium text-xs\">Active:</span>\n            {searchTerm && (\n              <div className=\"flex items-center gap-0.5 px-2 py-0.5 bg-primary/10 border border-primary/20 rounded-full text-primary text-xs\">\n                <Search className=\"w-2.5 h-2.5\" />\n                <span>\"{searchTerm}\"</span>\n                <button onClick={() => onSearchTermChange?.('')} className=\"ml-0.5 p-0.5 hover:text-primary/70 flex items-center justify-center rounded-full hover:bg-primary/10\" aria-label=\"Remove text filter\">\n                  <X className=\"w-2.5 h-2.5\" />\n                </button>\n              </div>\n            )}\n            {filterValue.map(route => (\n              <div key={route} className=\"flex items-center gap-0.5 px-2 py-0.5 bg-transparent border border-transparent rounded-full text-gray-400 text-xs\">\n                <Filter className=\"w-2.5 h-2.5\" />\n                <span>{route}</span>\n                <button onClick={() => toggleRouteFilter(route)} className=\"ml-0.5 p-0.5 hover:text-red-600 flex items-center justify-center rounded-full hover:bg-red-500/10\" aria-label={`Remove route filter: ${route}`}>\n                  <X className=\"w-2.5 h-2.5 text-red-500\" />\n                </button>\n              </div>\n            ))}\n            {deliveryFilterValue.map(delivery => (\n              <div key={delivery} className=\"flex items-center gap-0.5 px-2 py-0.5 bg-transparent border border-transparent rounded-full text-gray-400 text-xs\">\n                <Filter className=\"w-2.5 h-2.5\" />\n                <span>{delivery}</span>\n                <button onClick={() => toggleDeliveryFilter(delivery)} className=\"ml-0.5 p-0.5 hover:text-red-600 flex items-center justify-center rounded-full hover:bg-red-500/10\" aria-label={`Remove delivery filter: ${delivery}`}>\n                  <X className=\"w-2.5 h-2.5 text-red-500\" />\n                </button>\n              </div>\n            ))}\n            <div className=\"ml-auto text-muted-foreground text-xs\">\n              {filteredRowsCount} of {totalRowsCount} results\n            </div>\n          </div>\n        </div>\n      )}\n      <div className=\"overflow-x-auto w-full\">\n        <DragDropContext onDragEnd={handleDragEnd}>\n          <Table className=\"min-w-full\">\n            <TableHeader className=\"table-header-glass sticky top-0 z-20 bg-white dark:bg-slate-900 border-b-2 border-yellow-400/30\">\n              <Droppable\n                droppableId=\"columns\"\n                direction=\"horizontal\"\n                type=\"column\"\n              >\n                {(provided) => (\n                  <TableRow\n                    ref={provided.innerRef}\n                    {...provided.droppableProps}\n                  >\n                    {visibleColumns.map((column, index) => (\n                      <Draggable\n                        key={column.id}\n                        draggableId={column.id}\n                        index={index}\n                      >\n                        {(provided) => (\n                          <TableHead\n                            ref={provided.innerRef}\n                            {...provided.draggableProps}\n                            className=\"px-4 py-3 text-center table-header-footer-12px font-medium text-blue-700 dark:text-blue-300 tracking-wide border-b border-border sticky top-0 bg-white dark:bg-slate-900 shadow-sm whitespace-nowrap\"\n                            style={{\n                              textAlign: \"center\",\n                              textDecoration: \"normal\",\n                              fontSize: \"10px\",\n                              ...(column.dataKey === \"location\" && {\n                                minWidth: `${120 + 15}px`,\n                              }),\n                            }}\n                            colSpan={column.dataKey === \"location\" ? 3 : 1}\n                            data-testid={`column-header-${column.dataKey}`}\n                          >\n                            <ColumnHeader\n                              column={column}\n                              dragHandleProps={provided.dragHandleProps}\n                              onDelete={() => onDeleteColumn.mutate(column.id)}\n                              isAuthenticated={isAuthenticated}\n                              editMode={editMode}\n                            />\n                          </TableHead>\n                        )}\n                      </Draggable>\n                    ))}\n                    <TableHead\n                      className=\"px-4 py-3 text-center table-header-footer-12px font-semibold tracking-wide border-b border-border sticky top-0 bg-white dark:bg-slate-900 shadow-sm whitespace-nowrap\"\n                      style={{\n                        textAlign: \"center\",\n                        textDecoration: \"normal\",\n                        fontSize: \"10px\",\n                      }}\n                    >\n                      <span className=\"bg-gradient-to-r from-red-600 to-rose-600 dark:from-red-400 dark:to-rose-400 bg-clip-text text-transparent\">\n                        Actions\n                      </span>\n                    </TableHead>\n                    {provided.placeholder}\n                  </TableRow>\n                )}\n              </Droppable>\n            </TableHeader>\n            <Droppable droppableId=\"rows\" type=\"row\">\n              {(provided) => (\n                <TableBody\n                  ref={provided.innerRef}\n                  {...provided.droppableProps}\n                  className=\"pt-2 motion-layer zoom-in\"\n                  key={`page-${currentPage}`}\n                >\n                  {isLoading\n                    ? Array.from({ length: Math.min(pageSize, 5) }).map(\n                        (_, index) => (\n                          <tr\n                            key={`skeleton-${index}`}\n                            className={`skeleton-row fade-in-stagger odd:bg-white dark:odd:bg-gray-900/50 even:bg-blue-50/50 dark:even:bg-blue-900/20 backdrop-blur-sm hover:bg-muted/60 table-cell-unique-transition`}\n                          >\n                            {/* Actions column */}\n                            <td className=\"p-3 w-16\">\n                              <div className=\"flex gap-3 justify-center\">\n                                <div className=\"skeleton w-8 h-8 rounded-md bg-gradient-to-r from-gray-500/20 to-slate-500/20 animate-pulse\" />\n                                <div className=\"skeleton w-8 h-8 rounded-md bg-gradient-to-r from-blue-500/20 to-purple-500/20 animate-pulse\" style={{animationDelay: \"0.1s\"}} />\n                                <div className=\"skeleton w-8 h-8 rounded-md bg-gradient-to-r from-green-500/20 to-blue-500/20 animate-pulse\" style={{animationDelay: \"0.2s\"}} />\n                                <div className=\"skeleton w-8 h-8 rounded-md bg-gradient-to-r from-yellow-500/20 to-green-500/20 animate-pulse\" style={{animationDelay: \"0.3s\"}} />\n                                <div className=\"skeleton w-8 h-8 rounded-md bg-gradient-to-r from-red-500/20 to-yellow-500/20 animate-pulse\" style={{animationDelay: \"0.4s\"}} />\n                                <div className=\"skeleton w-8 h-8 rounded-md bg-gradient-to-r from-green-500/20 to-emerald-500/20 animate-pulse\" style={{animationDelay: \"0.5s\"}} />\n                              </div>\n                            </td>\n\n                            {/* Dynamic columns - cleaner skeleton */}\n                            {visibleColumns.map((column) => (\n                              <td\n                                key={column.id}\n                                className=\"p-3\"\n                                colSpan={column.dataKey === \"location\" ? 3 : 1}\n                              >\n                                {column.dataKey === \"images\" ? (\n                                  <div className=\"skeleton w-12 h-8 rounded mx-auto bg-gradient-to-r from-blue-400/20 to-purple-400/20 animate-pulse\" />\n                                ) : column.dataKey === \"delivery\" ? (\n                                  <div className=\"skeleton w-16 h-6 rounded-full mx-auto bg-gradient-to-r from-green-400/20 to-blue-400/20 animate-pulse\" />\n                                ) : column.dataKey === \"location\" ? (\n                                  <div className=\"skeleton w-32 h-4 mx-auto bg-gradient-to-r from-yellow-400/20 to-green-400/20 animate-pulse\" />\n                                ) : (\n                                  <div className=\"skeleton w-20 h-4 mx-auto bg-gradient-to-r from-cyan-400/20 to-blue-400/20 animate-pulse\" />\n                                )}\n                              </td>\n                            ))}\n                          </tr>\n                        ),\n                      )\n                    : paginatedRows.map((row, index) => (\n                        <Draggable\n                          key={row.id}\n                          draggableId={row.id}\n                          index={index}\n                        >\n                          {(provided, snapshot) => (\n                            <TableRow\n                              ref={provided.innerRef}\n                              {...provided.draggableProps}\n                              className={`table-row-glass group ${\n                                (() => {\n                                  // Apply 3-color styling ONLY for shared view or edit mode\n                                  if (isSharedView || editMode) {\n                                    const status = getScheduleStatus(row);\n                                    if (status === 'inactive') {\n                                      return \"bg-gray-100/60 dark:bg-gray-800/40 opacity-50\";\n                                    } else if (status === 'off-schedule') {\n                                      return row.location === \"QL Kitchen\" \n                                        ? \"bg-gradient-to-r from-gray-100/80 to-slate-100/80 dark:from-gray-800/60 dark:to-slate-800/60 opacity-60\" \n                                        : \"odd:bg-white dark:odd:bg-gray-900/50 even:bg-blue-50/50 dark:even:bg-blue-900/20 opacity-60\";\n                                    } else {\n                                      return row.location === \"QL Kitchen\" \n                                        ? \"bg-gradient-to-r from-gray-100/80 to-slate-100/80 dark:from-gray-800/60 dark:to-slate-800/60\" \n                                        : \"odd:bg-white dark:odd:bg-gray-900/50 even:bg-blue-50/50 dark:even:bg-blue-900/20\";\n                                    }\n                                  } else {\n                                    // Regular view mode: standard styling\n                                    if (row.active === false) {\n                                      return \"bg-gray-100/60 dark:bg-gray-800/40 opacity-50\";\n                                    } else {\n                                      return row.location === \"QL Kitchen\" \n                                        ? \"bg-gradient-to-r from-gray-100/80 to-slate-100/80 dark:from-gray-800/60 dark:to-slate-800/60\" \n                                        : \"odd:bg-white dark:odd:bg-gray-900/50 even:bg-blue-50/50 dark:even:bg-blue-900/20\";\n                                    }\n                                  }\n                                })()\n                              } hover:bg-blue-100/60 dark:hover:bg-blue-800/30 table-cell-unique-transition ${\n                                snapshot.isDragging ? \"drag-elevate\" : \"\"\n                              }`}\n                              data-testid={`table-row-${row.id}`}\n                            >\n                              {visibleColumns.map((column) => (\n                                <TableCell\n                                  key={column.id}\n                                  className=\"p-4 align-middle [&:has([role=checkbox])]:pr-0 px-3 py-3 table-cell-10px text-center text-[12px] bg-transparent text-foreground whitespace-nowrap font-normal table-zoom-in\"\n                                  style={{\n                                    minWidth: \"100px\",\n                                    ...(column.dataKey === \"location\" && {\n                                      minWidth: `${120 + 15}px`,\n                                      fontSize: \"10px\",\n                                    }),\n                                    ...(column.dataKey === \"delivery\" && {\n                                      minWidth: \"110px\",\n                                      fontSize: \"10px\",\n                                      fontWeight: \"normal\",\n                                    }),\n                                    ...(column.dataKey === \"id\" && {\n                                      minWidth: \"120px\",\n                                    }),\n                                    ...(column.dataKey === \"code\" && {\n                                      minWidth: \"100px\",\n                                    }),\n                                    ...(column.dataKey === \"route\" && {\n                                      minWidth: \"90px\",\n                                    }),\n                                    ...(column.dataKey === \"no\" && {\n                                      minWidth: \"70px\",\n                                    }),\n                                    ...(column.dataKey === \"kilometer\" && {\n                                      minWidth: \"80px\",\n                                    }),\n                                    ...(column.dataKey === \"tollPrice\" && {\n                                      minWidth: \"90px\",\n                                    }),\n                                    ...(column.dataKey === \"tngRoute\" && {\n                                      minWidth: \"90px\",\n                                    }),\n                                    ...(column.dataKey === \"images\" && {\n                                      minWidth: \"120px\",\n                                    }),\n                                    ...(column.type === \"currency\" && !column.dataKey.match(/tollPrice|tngRoute/) && {\n                                      minWidth: \"100px\",\n                                    }),\n                                  }}\n                                  colSpan={\n                                    column.dataKey === \"location\" ? 3 : 1\n                                  }\n                                  data-testid={`cell-${row.id}-${column.dataKey}`}\n                                >\n                                  <div className=\"w-[98%] mx-auto text-center\">\n                                  {column.dataKey === \"images\" ? (\n                                    <ImagePreview\n                                      images={row.images}\n                                      rowId={row.id}\n                                      onAddImage={() =>\n                                        onSelectRowForImage(row.id)\n                                      }\n                                      editMode={editMode}\n                                      onAccessDenied={() =>\n                                        onSelectRowForImage(\"access-denied\")\n                                      }\n                                    />\n                                  ) : column.dataKey === \"info\" ? (\n                                    row.info && row.info.trim() ? (\n                                      <InfoModal\n                                        info={row.info}\n                                        rowId={row.id}\n                                        code={row.code}\n                                        route={row.route}\n                                        location={row.location}\n                                        latitude={row.latitude ? String(row.latitude) : undefined}\n                                        longitude={row.longitude ? String(row.longitude) : undefined}\n                                        qrCode={row.qrCode || undefined}\n                                        no={row.no}\n                                        markerColor={row.markerColor || undefined}\n                                        onUpdateRow={(updates) =>\n                                          onUpdateRow.mutate({\n                                            id: row.id,\n                                            updates,\n                                          })\n                                        }\n                                        editMode={false}\n                                        allRows={rows}\n                                        iconType=\"info\"\n                                      />\n                                    ) : (\n                                      <span className=\"text-muted-foreground\">‚Äî</span>\n                                    )\n                                  ) : column.dataKey === \"delivery\" ? (\n                                    editMode && column.isEditable === \"true\" ? (\n                                      <EditableCell\n                                        value={getCellValue(row, column, index)}\n                                        type=\"select\"\n                                        options={deliveryOptions}\n                                        dataKey={column.dataKey}\n                                        onSave={(value) =>\n                                          onUpdateRow.mutate({\n                                            id: row.id,\n                                            updates: {\n                                              [column.dataKey]: value,\n                                            },\n                                          })\n                                        }\n                                      />\n                                    ) : (\n                                      <span className=\"text-[9px] text-gray-500 dark:text-gray-400 font-medium\">\n                                        {getCellValue(row, column, index) || '‚Äî'}\n                                      </span>\n                                    )\n                                  ) : column.dataKey === \"id\" ? (\n                                    <span className=\"font-mono text-slate-600 dark:text-slate-300\" style={{ fontSize: '10px' }}>\n                                      {getCellValue(row, column, index)}\n                                    </span>\n                                  ) : column.dataKey === \"no\" && editMode && row.location !== \"QL Kitchen\" ? (\n                                    <EditableCell\n                                      value={String(row.no || 0)}\n                                      type=\"number\"\n                                      dataKey={column.dataKey}\n                                      onSave={(value) =>\n                                        onUpdateRow.mutate({\n                                          id: row.id,\n                                          updates: { no: parseInt(value) || 0 },\n                                        })\n                                      }\n                                    />\n                                  ) : editMode &&\n                                    column.isEditable === \"true\" ? (\n                                    <EditableCell\n                                      value={getCellValue(row, column, index)}\n                                      type={column.type}\n                                      options={column.options || undefined}\n                                      dataKey={column.dataKey}\n                                      onSave={(value) =>\n                                        onUpdateRow.mutate({\n                                          id: row.id,\n                                          updates: { [column.dataKey]: value },\n                                        })\n                                      }\n                                    />\n                                  ) : (\n                                    <span className=\"text-[9px] text-gray-500 dark:text-gray-400 font-medium\">\n                                      {column.dataKey === \"kilometer\" ? (\n                                        <MobileTooltip\n                                          content={(() => {\n                                            const segmentDistance = (row as any).segmentDistance;\n                                            if (segmentDistance && typeof segmentDistance === \"number\" && segmentDistance > 0) {\n                                              return `${segmentDistance.toFixed(2)} km`;\n                                            }\n                                            return \"Starting point\";\n                                          })()}\n                                          showBelow={index === 0 && index !== paginatedRows.length - 1}\n                                        >\n                                          <span className=\"cursor-help\">\n                                            {getCellValue(row, column, index)}\n                                          </span>\n                                        </MobileTooltip>\n                                      ) : (\n                                        getCellValue(row, column, index)\n                                      )}\n                                    </span>\n                                  )}\n                                  </div>\n                                </TableCell>\n                              ))}\n                              <TableCell\n                                className=\"px-4 py-2 text-sm text-center text-foreground\"\n                                style={{ textAlign: \"center\" }}\n                              >\n                                <div className=\"flex flex-col items-center gap-1\">\n                                  <div className=\"flex items-center gap-3\">\n                                    <div\n                                      {...provided.dragHandleProps}\n                                      className={`p-2 rounded ${\n                                        snapshot.isDragging ? \"cursor-grabbing\" : editMode ? \"cursor-grab\" : \"cursor-default\"\n                                      } text-gray-500 dark:text-gray-400 hover:text-blue-500 dark:hover:text-blue-400 transition-all`}\n                                      title={editMode ? \"Drag to reorder\" : \"\"}\n                                      data-testid={`drag-handle-${row.id}`}\n                                    >\n                                      <GripVertical className=\"w-4 h-4\" />\n                                    </div>\n                                    <div className=\"flex items-center gap-3 opacity-60 group-hover:opacity-100 transition-opacity\">\n                                    {editMode && (\n                                      <>\n                                        <Button\n                                          size=\"sm\"\n                                          variant=\"ghost\"\n                                          className={`bg-transparent border-transparent hover:bg-transparent hover:border-transparent text-blue-400 dark:text-blue-300 hover:text-blue-500 dark:hover:text-blue-400 ${\n                                            onUpdateRow.isPending &&\n                                            onUpdateRow.variables?.id === row.id\n                                              ? \"opacity-50\"\n                                              : \"\"\n                                          }`}\n                                          onClick={() => {\n                                            if (editMode) {\n                                              onSelectRowForImage(row.id);\n                                            } else {\n                                              onSelectRowForImage(\n                                                \"access-denied\",\n                                              );\n                                            }\n                                          }}\n                                          disabled={\n                                            onUpdateRow.isPending &&\n                                            onUpdateRow.variables?.id === row.id\n                                          }\n                                          data-testid={`button-add-image-${row.id}`}\n                                          title=\"Add image\"\n                                        >\n                                          <PlusCircle className=\"w-4 h-4\" />\n                                        </Button>\n                                      <Button\n                                        size=\"sm\"\n                                        variant=\"ghost\"\n                                        className={`bg-transparent border-transparent hover:bg-transparent hover:border-transparent ${!isAuthenticated ? \"opacity-50 cursor-not-allowed\" : \"text-blue-400 dark:text-blue-300 hover:text-blue-500 dark:hover:text-blue-400\"} ${\n                                          onDeleteRow.isPending &&\n                                          onDeleteRow.variables === row.id\n                                            ? \"mutation-loading\"\n                                            : \"\"\n                                        }`}\n                                        onClick={() =>\n                                          isAuthenticated &&\n                                          handleDeleteClick(row.id)\n                                        }\n                                        disabled={\n                                          !isAuthenticated ||\n                                          (onDeleteRow.isPending &&\n                                            onDeleteRow.variables === row.id)\n                                        }\n                                        data-testid={`button-delete-row-${row.id}`}\n                                        title={\n                                          !isAuthenticated\n                                            ? \"Authentication required to delete rows\"\n                                            : \"Delete row\"\n                                        }\n                                      >\n                                        {onDeleteRow.isPending &&\n                                        onDeleteRow.variables === row.id ? (\n                                          <InlineLoading type=\"particles\" />\n                                        ) : (\n                                          <Trash className=\"w-4 h-4\" />\n                                        )}\n                                      </Button>\n                                      </>\n                                    )}\n                                    <InfoModal\n                                      info={row.info || \"\"}\n                                      rowId={row.id}\n                                      code={row.code}\n                                      route={row.route}\n                                      location={row.location}\n                                      latitude={row.latitude ? String(row.latitude) : undefined}\n                                      longitude={row.longitude ? String(row.longitude) : undefined}\n                                      qrCode={row.qrCode || undefined}\n                                      no={row.no}\n                                      markerColor={row.markerColor || undefined}\n                                      onUpdateRow={(updates) =>\n                                        onUpdateRow.mutate({\n                                          id: row.id,\n                                          updates,\n                                        })\n                                      }\n                                      editMode={editMode}\n                                      allRows={rows}\n                                      iconType={editMode ? \"filetext\" : \"info\"}\n                                    />\n                                    {editMode ? (\n                                      <Select\n                                        value={row.deliveryAlt || \"normal\"}\n                                        onValueChange={(value) => {\n                                          const nextActive = value !== \"inactive\";\n                                          onUpdateRow.mutate({\n                                            id: row.id,\n                                            updates: { deliveryAlt: value, active: nextActive },\n                                          });\n                                        }}\n                                        disabled={\n                                          onUpdateRow.isPending &&\n                                          onUpdateRow.variables?.id === row.id\n                                        }\n                                      >\n                                        <SelectTrigger \n                                          className={`h-8 w-16 text-xs border-transparent bg-transparent ${\n                                            (() => {\n                                              // Apply 3-color styling ONLY for shared view or edit mode\n                                              if (isSharedView || editMode) {\n                                                const status = getScheduleStatus(row);\n                                                \n                                                if (status === 'inactive') {\n                                                  // Red for inactive\n                                                  return \"text-red-500 dark:text-red-400\";\n                                                } else if (status === 'off-schedule') {\n                                                  // Yellow for off-schedule (with opacity)\n                                                  return \"opacity-60 text-yellow-500 dark:text-yellow-400\";\n                                                } else {\n                                                  // Green for on-schedule\n                                                  return \"text-green-500 dark:text-green-400\";\n                                                }\n                                              } else {\n                                                // Regular view mode: 3-color system (green, yellow, red)\n                                                if (row.deliveryAlt === \"inactive\") {\n                                                  return \"text-red-500 dark:text-red-400\";\n                                                } else if (row.deliveryAlt === \"alt1\" || row.deliveryAlt === \"alt2\") {\n                                                  return \"text-yellow-500 dark:text-yellow-400\";\n                                                } else {\n                                                  return \"text-green-500 dark:text-green-400\";\n                                                }\n                                              }\n                                            })()\n                                          }`}\n                                          data-testid={`select-delivery-alt-${row.id}`}\n                                        >\n                                          <SelectValue />\n                                        </SelectTrigger>\n                                        <SelectContent>\n                                          <SelectItem value=\"normal\">\n                                            <span className=\"text-green-600 dark:text-green-400\">üü¢</span>\n                                          </SelectItem>\n                                          <SelectItem value=\"alt1\">\n                                            <span className=\"text-yellow-600 dark:text-yellow-400\">üü°</span>\n                                          </SelectItem>\n                                          <SelectItem value=\"alt2\">\n                                            <span className=\"text-yellow-600 dark:text-yellow-400\">üü°</span>\n                                          </SelectItem>\n                                          <SelectItem value=\"inactive\">\n                                            <span className=\"text-red-500 dark:text-red-400\">üî¥</span>\n                                          </SelectItem>\n                                        </SelectContent>\n                                      </Select>\n                                    ) : (\n                                      <Button\n                                        size=\"sm\"\n                                        variant=\"ghost\"\n                                        className={`border-transparent bg-transparent hover:bg-transparent cursor-not-allowed ${\n                                          (() => {\n                                            // Apply 3-color styling ONLY for shared view or edit mode\n                                            if (isSharedView || editMode) {\n                                              const status = getScheduleStatus(row);\n                                              \n                                              if (status === 'inactive') {\n                                                // Red for inactive - NO opacity reduction\n                                                return \"text-red-500 dark:text-red-400 hover:text-red-600 dark:hover:text-red-300\";\n                                              } else if (status === 'off-schedule') {\n                                                // Yellow for off-schedule (with opacity for disabled look)\n                                                return \"opacity-40 text-yellow-500 dark:text-yellow-400 hover:text-yellow-600 dark:hover:text-yellow-500\";\n                                              } else {\n                                                // Green for on-schedule - slight opacity\n                                                return \"opacity-60 text-green-500 dark:text-green-400 hover:text-green-600 dark:hover:text-green-500\";\n                                              }\n                                            } else {\n                                              // Regular view mode: 3-color system (green, yellow, red)\n                                              if (row.deliveryAlt === \"inactive\") {\n                                                return \"text-red-500 dark:text-red-400 hover:text-red-600 dark:hover:text-red-300\";\n                                              } else if (row.deliveryAlt === \"alt1\" || row.deliveryAlt === \"alt2\") {\n                                                return \"opacity-60 text-yellow-500 dark:text-yellow-400 hover:text-yellow-600 dark:hover:text-yellow-500\";\n                                              } else {\n                                                return \"opacity-60 text-green-500 dark:text-green-400 hover:text-green-600 dark:hover:text-green-500\";\n                                              }\n                                            }\n                                          })()\n                                        }`}\n                                        disabled={true}\n                                        data-testid={`button-toggle-active-${row.id}`}\n                                        title={\n                                          row.deliveryAlt === \"alt1\"\n                                            ? \"Delivery Alt 1 (Mon, Wed, Fri, Sun)\"\n                                            : row.deliveryAlt === \"alt2\"\n                                            ? \"Delivery Alt 2 (Tue, Thu, Sat)\"\n                                            : row.deliveryAlt === \"inactive\"\n                                            ? \"Inactive\"\n                                            : \"Normal Delivery (Every Day)\"\n                                        }\n                                      >\n                                        <Power className=\"w-4 h-4\" />\n                                      </Button>\n                                    )}\n                                    </div>\n                                  </div>\n                                </div>\n                              </TableCell>\n                            </TableRow>\n                          )}\n                        </Draggable>\n                      ))}\n                  {provided.placeholder}\n                </TableBody>\n              )}\n            </Droppable>\n            <tfoot>\n              <TableRow>\n                {visibleColumns.map((column, index) => (\n                  <TableCell\n                    key={column.id}\n                    className=\"px-3 py-3 text-center table-header-footer-12px font-semibold tracking-wide border-t border-border sticky bottom-0 bg-white dark:bg-slate-900 shadow-sm whitespace-nowrap\"\n                    style={{\n                      textAlign: \"center\",\n                      fontSize: \"10px\",\n                    }}\n                    colSpan={column.dataKey === \"location\" ? 3 : 1}\n                  >\n                    {index === 0 ? (\n                      <span className=\"font-semibold bg-gradient-to-r from-blue-600 to-cyan-600 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent\" style={{fontSize: '11px'}}>Totals</span>\n                    ) : column.dataKey === \"no\" ? (\n                      <span className=\"font-semibold bg-gradient-to-r from-blue-600 to-cyan-600 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent\">‚Äî</span>\n                    ) : column.dataKey === \"kilometer\" ? (\n                      <span className=\"font-semibold bg-gradient-to-r from-blue-600 to-cyan-600 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent\">\n                        {(() => {\n                          const total = calculateColumnSum(\"kilometer\", column.type);\n                          return total > 0 ? `${total.toFixed(2)} km` : \"‚Äî\";\n                        })()}\n                      </span>\n                    ) : column.dataKey === \"tngRoute\" &&\n                      column.type === \"currency\" ? (\n                      <span className=\"font-semibold bg-gradient-to-r from-blue-600 to-cyan-600 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent\">\n                        {formatCurrency(\n                          calculateColumnSum(\"tngRoute\", column.type),\n                        )}\n                      </span>\n                    ) : column.dataKey === \"tollPrice\" &&\n                      column.type === \"currency\" ? (\n                      <span className=\"font-semibold bg-gradient-to-r from-blue-600 to-cyan-600 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent\">\n                        {formatCurrency(\n                          calculateColumnSum(\"tollPrice\", column.type),\n                        )}\n                      </span>\n                    ) : (\n                      <span className=\"font-semibold bg-gradient-to-r from-blue-600 to-cyan-600 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent\">‚Äî</span>\n                    )}\n                  </TableCell>\n                ))}\n                <TableCell className=\"px-3 py-3 text-center table-header-footer-12px font-semibold tracking-wide border-t border-border sticky bottom-0 bg-white dark:bg-slate-900 shadow-sm text-foreground whitespace-nowrap\" style={{ textAlign: \"center\", fontSize: '10px' }}>\n                  <span className=\"font-semibold bg-gradient-to-r from-blue-600 to-cyan-600 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent\">‚Äî</span>\n                </TableCell>\n              </TableRow>\n            </tfoot>\n          </Table>\n\n          {/* Pagination Controls */}\n          <div className=\"flex flex-col items-center gap-2 px-4 py-2 border-t border-blue-200 dark:border-blue-500/20 transition-smooth-fast\">\n            <div className=\"flex items-center gap-1.5\">\n              {/* Show First button only when currentPage > 3 (has 3+ pages before) */}\n              {currentPage > 3 && (\n                <Button\n                  variant=\"outline\"\n                  size=\"xs\"\n                  onClick={() => goToPage(1)}\n                  className=\"pagination-button\"\n                  data-testid=\"button-first-page\"\n                >\n                  <ChevronsLeft className=\"h-3 w-3\" />\n                </Button>\n              )}\n\n              <div className=\"flex items-center gap-1\">\n                {(() => {\n                  // Calculate sliding window of max 6 pages\n                  const maxButtons = 6;\n                  \n                  // If total pages <= maxButtons, show all pages\n                  if (totalPages <= maxButtons) {\n                    const pages = [];\n                    for (let i = 1; i <= totalPages; i++) {\n                      pages.push(i);\n                    }\n                    \n                    return pages.map((pageNum) => {\n                      const isCurrentPage = pageNum === currentPage;\n                      return (\n                        <Button\n                          key={pageNum}\n                          variant=\"outline\"\n                          size=\"xs\"\n                          onClick={() => goToPage(pageNum)}\n                          className={`pagination-button page-number ${\n                            isCurrentPage ? \"active\" : \"\"\n                          }`}\n                          data-testid={`button-page-${pageNum}`}\n                        >\n                          {pageNum}\n                        </Button>\n                      );\n                    });\n                  }\n                  \n                  // For more than maxButtons pages, calculate sliding window\n                  let startPage = Math.max(1, currentPage - 3);\n                  let endPage = Math.min(totalPages, startPage + maxButtons - 1);\n\n                  // Adjust if we're near the end to always show maxButtons\n                  if (endPage - startPage < maxButtons - 1) {\n                    startPage = Math.max(1, endPage - maxButtons + 1);\n                  }\n\n                  const pages = [];\n                  for (let i = startPage; i <= endPage; i++) {\n                    pages.push(i);\n                  }\n\n                  return pages.map((pageNum) => {\n                    const isCurrentPage = pageNum === currentPage;\n\n                    return (\n                      <Button\n                        key={pageNum}\n                        variant=\"outline\"\n                        size=\"xs\"\n                        onClick={() => goToPage(pageNum)}\n                        className={`pagination-button page-number ${\n                          isCurrentPage ? \"active\" : \"\"\n                        }`}\n                        data-testid={`button-page-${pageNum}`}\n                      >\n                        {pageNum}\n                      </Button>\n                    );\n                  });\n                })()}\n              </div>\n\n              {/* Show Last button only when (totalPages - currentPage) >= 3 (has 3+ pages after) */}\n              {(totalPages - currentPage) >= 3 && (\n                <Button\n                  variant=\"outline\"\n                  size=\"xs\"\n                  onClick={() => goToPage(totalPages)}\n                  className=\"pagination-button\"\n                  data-testid=\"button-last-page\"\n                >\n                  <ChevronsRight className=\"h-3 w-3\" />\n                </Button>\n              )}\n            </div>\n\n            <div className=\"text-[10px] font-medium text-muted-foreground whitespace-nowrap\">\n              {currentPage} of {totalPages}\n            </div>\n          </div>\n        </DragDropContext>\n      </div>\n      {/* Delete Confirmation Dialog */}\n      <Dialog open={deleteConfirmOpen} onOpenChange={setDeleteConfirmOpen}>\n        <DialogContent className=\"sm:max-w-[425px] transition-smooth-fast\">\n          <DialogHeader>\n            <DialogTitle>Confirm Deletion</DialogTitle>\n            <DialogDescription>\n              Are you sure you want to delete this row? This action cannot be\n              undone.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={handleDeleteCancel}\n              data-testid=\"button-cancel-delete\"\n            >\n              Cancel\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={handleDeleteConfirm}\n              data-testid=\"button-confirm-delete\"\n            >\n              Delete\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":87252},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/60 dark:bg-black/85 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4453},"client/src/index.css":{"content":"\n/* Leaflet Map Styles */\n@import url('https://unpkg.com/leaflet@1.7.1/dist/leaflet.css');\n\n/* Add black outline to map markers */\n.leaflet-marker-icon {\n  filter: drop-shadow(0 0 1px rgba(0, 0, 0, 0.6));\n}\n\n/* iOS Improvements */\n@supports (padding: max(0px)) {\n  /* iOS Safe Area Support */\n  body {\n    padding-top: env(safe-area-inset-top);\n    padding-bottom: env(safe-area-inset-bottom);\n    padding-left: env(safe-area-inset-left);\n    padding-right: env(safe-area-inset-right);\n  }\n}\n\n/* Prevent iOS input zoom - requires minimum 16px font size */\ninput[type=\"text\"],\ninput[type=\"number\"],\ninput[type=\"email\"],\ninput[type=\"tel\"],\ninput[type=\"url\"],\ninput[type=\"search\"],\ninput[type=\"password\"],\ninput[type=\"color\"],\nselect,\ntextarea {\n  font-size: max(16px, 1em);\n}\n\n/* iOS Smooth Scrolling */\n* {\n  -webkit-overflow-scrolling: touch;\n}\n\n/* Improve iOS touch performance */\nbutton,\na,\ninput,\nselect,\ntextarea {\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);\n  -webkit-touch-callout: none;\n}\n\n/* iOS Modal Overlay */\n[data-radix-scroll-area-viewport] {\n  overscroll-behavior: contain;\n  -webkit-overflow-scrolling: touch;\n}\n\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  /* Light Theme - Clean & Modern with improved contrast (Dimmed) */\n  --background: hsl(210, 20%, 90%);\n  --foreground: hsl(222, 50%, 10%);\n  --card: hsl(210, 15%, 94%);\n  --card-foreground: hsl(222, 50%, 10%);\n  --popover: hsl(210, 15%, 94%);\n  --popover-foreground: hsl(222, 50%, 10%);\n  --primary: hsl(217, 85%, 52%);\n  --primary-foreground: hsl(0, 0%, 100%);\n  --secondary: hsl(210, 35%, 88%);\n  --secondary-foreground: hsl(222, 50%, 10%);\n  --muted: hsl(210, 30%, 86%);\n  --muted-foreground: hsl(215, 18%, 40%);\n  --accent: hsl(210, 35%, 87%);\n  --accent-foreground: hsl(222, 50%, 10%);\n  --destructive: hsl(0, 84%, 60%);\n  --destructive-foreground: hsl(0, 0%, 98%);\n  --border: hsl(214, 25%, 80%);\n  --input: hsl(214, 25%, 82%);\n  --ring: hsl(217, 85%, 52%);\n  --chart-1: hsl(217, 85%, 52%);\n  --chart-2: hsl(142, 76%, 36%);\n  --chart-3: hsl(38, 92%, 50%);\n  --chart-4: hsl(280, 65%, 60%);\n  --chart-5: hsl(340, 82%, 52%);\n  --sidebar: hsl(210, 20%, 90%);\n  --sidebar-foreground: hsl(222, 50%, 10%);\n  --sidebar-primary: hsl(217, 85%, 52%);\n  --sidebar-primary-foreground: hsl(0, 0%, 100%);\n  --sidebar-accent: hsl(210, 35%, 87%);\n  --sidebar-accent-foreground: hsl(222, 50%, 10%);\n  --sidebar-border: hsl(214, 25%, 80%);\n  --sidebar-ring: hsl(217, 85%, 52%);\n  \n  /* Light glass effect variables (Dimmed) */\n  --glass-bg: rgba(240, 242, 245, 0.85);\n  --glass-border: rgba(59, 130, 246, 0.25);\n  --glass-hover: rgba(245, 247, 250, 0.95);\n  --font-sans: 'Helvetica Neue', sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;\n  --radius: 8px;\n  --shadow-2xs: 0px 1px 2px rgba(0, 0, 0, 0.04);\n  --shadow-xs: 0px 1px 3px rgba(0, 0, 0, 0.08);\n  --shadow-sm: 0px 2px 4px rgba(0, 0, 0, 0.08), 0px 1px 2px rgba(0, 0, 0, 0.04);\n  --shadow: 0px 4px 6px rgba(0, 0, 0, 0.08), 0px 2px 4px rgba(0, 0, 0, 0.04);\n  --shadow-md: 0px 6px 12px rgba(0, 0, 0, 0.1), 0px 2px 6px rgba(0, 0, 0, 0.06);\n  --shadow-lg: 0px 10px 20px rgba(0, 0, 0, 0.12), 0px 4px 8px rgba(0, 0, 0, 0.08);\n  --shadow-xl: 0px 20px 40px rgba(0, 0, 0, 0.15), 0px 8px 16px rgba(0, 0, 0, 0.1);\n  --shadow-2xl: 0px 25px 50px rgba(0, 0, 0, 0.18);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n}\n\n.dark {\n  /* Dark Theme - Deep Black with premium contrast */\n  --background: hsl(0, 0%, 0%);\n  --foreground: hsl(0, 0%, 98%);\n  --card: hsl(0, 0%, 4%);\n  --card-foreground: hsl(0, 0%, 98%);\n  --popover: hsl(0, 0%, 4%);\n  --popover-foreground: hsl(0, 0%, 98%);\n  --primary: hsl(217, 85%, 58%);\n  --primary-foreground: hsl(0, 0%, 100%);\n  --secondary: hsl(0, 0%, 8%);\n  --secondary-foreground: hsl(0, 0%, 95%);\n  --muted: hsl(0, 0%, 10%);\n  --muted-foreground: hsl(0, 0%, 65%);\n  --accent: hsl(0, 0%, 12%);\n  --accent-foreground: hsl(0, 0%, 95%);\n  --destructive: hsl(0, 70%, 50%);\n  --destructive-foreground: hsl(0, 0%, 98%);\n  --border: hsl(0, 0%, 15%);\n  --input: hsl(0, 0%, 8%);\n  --ring: hsl(217, 85%, 58%);\n  --sidebar: hsl(0, 0%, 2%);\n  --sidebar-foreground: hsl(0, 0%, 98%);\n  --sidebar-primary: hsl(217, 85%, 58%);\n  --sidebar-primary-foreground: hsl(0, 0%, 100%);\n  --sidebar-accent: hsl(0, 0%, 12%);\n  --sidebar-accent-foreground: hsl(0, 0%, 95%);\n  --sidebar-border: hsl(0, 0%, 15%);\n  --sidebar-ring: hsl(217, 85%, 58%);\n  \n  /* Dark frosted glass effects for deep black mode */\n  --glass-bg: rgba(0, 0, 0, 0.8);\n  --glass-border: rgba(255, 255, 255, 0.12);\n  --glass-hover: rgba(0, 0, 0, 0.9);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  html {\n    @apply h-full text-sm;\n  }\n\n  body {\n    @apply font-sans antialiased text-foreground h-full;\n    font-family: 'Helvetica Neue', sans-serif;\n    background-color: var(--background);\n  }\n\n  /* Glass morphism utilities */\n  .glass {\n    background: var(--glass-bg);\n    backdrop-filter: blur(24px) saturate(1.4);\n    -webkit-backdrop-filter: blur(24px) saturate(1.4);\n    border: 1px solid var(--glass-border);\n    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.1);\n  }\n  \n  .dark .glass {\n    backdrop-filter: blur(24px) saturate(1.4) brightness(0.8);\n    -webkit-backdrop-filter: blur(24px) saturate(1.4) brightness(0.8);\n    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.1);\n  }\n\n  .glass-card {\n    background-color: var(--card);\n    border: 1px solid var(--border);\n    box-shadow: var(--shadow-md);\n  }\n\n  .glass-hover:hover {\n    background: var(--glass-hover);\n    border-color: var(--primary);\n    box-shadow: var(--shadow-xl);\n  }\n  \n  .dark .glass-hover:hover {\n    border-color: rgba(255, 255, 255, 0.15);\n  }\n\n  .glass-table {\n    background: rgba(255, 255, 255, 0.3);\n    backdrop-filter: blur(40px) saturate(1.5);\n    -webkit-backdrop-filter: blur(40px) saturate(1.5);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    border-radius: 24px;\n    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.12);\n  }\n  \n  .dark .glass-table {\n    background: rgba(0, 0, 0, 0.3);\n    backdrop-filter: blur(40px) saturate(1.5) brightness(0.9);\n    -webkit-backdrop-filter: blur(40px) saturate(1.5) brightness(0.9);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.12);\n  }\n\n  /* iOS Frosted Glass Inputs */\n  .glass-input {\n    background: rgba(255, 255, 255, 0.2);\n    backdrop-filter: blur(20px) saturate(1.3);\n    -webkit-backdrop-filter: blur(20px) saturate(1.3);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    color: var(--foreground) !important;\n    box-shadow: 0 4px 16px 0 rgba(0, 0, 0, 0.08);\n    border-radius: 16px;\n    transition: all 0.3s ease;\n  }\n  \n  .dark .glass-input {\n    background: rgba(0, 0, 0, 0.2);\n    backdrop-filter: blur(20px) saturate(1.3) brightness(0.9);\n    -webkit-backdrop-filter: blur(20px) saturate(1.3) brightness(0.9);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    box-shadow: 0 4px 16px 0 rgba(0, 0, 0, 0.12);\n  }\n\n  .glass-input:focus {\n    background: rgba(255, 255, 255, 0.3);\n    border-color: rgba(255, 255, 255, 0.3);\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1), 0 4px 16px 0 rgba(0, 0, 0, 0.12);\n    color: var(--foreground) !important;\n  }\n  \n  .dark .glass-input:focus {\n    background: rgba(0, 0, 0, 0.3);\n    border-color: rgba(255, 255, 255, 0.2);\n    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1), 0 4px 16px 0 rgba(0, 0, 0, 0.15);\n  }\n\n  .glass-input::placeholder {\n    color: hsl(var(--muted-foreground)) !important;\n    opacity: 0.7;\n  }\n\n  /* Matte Glass Utilities */\n  .glass-matte {\n    background: rgba(0, 0, 0, 0.15);\n    backdrop-filter: blur(24px) saturate(1.3) brightness(0.9);\n    -webkit-backdrop-filter: blur(24px) saturate(1.3) brightness(0.9);\n    border: 1px solid rgba(255, 255, 255, 0.06);\n    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.7), inset 0 1px 0 rgba(255, 255, 255, 0.04);\n  }\n\n  .glass-matte-dark {\n    background: rgba(0, 0, 0, 0.25);\n    backdrop-filter: blur(20px) saturate(1.1) brightness(0.8);\n    -webkit-backdrop-filter: blur(20px) saturate(1.1) brightness(0.8);\n    border: 1px solid rgba(255, 255, 255, 0.04);\n    box-shadow: 0 16px 48px rgba(0, 0, 0, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.02);\n  }\n\n  .glass-button {\n    background: var(--glass-bg);\n    border: 1px solid var(--glass-border);\n    box-shadow: var(--shadow-md);\n  }\n  \n  .dark .glass-button {\n    backdrop-filter: blur(16px) saturate(1.2);\n    -webkit-backdrop-filter: blur(16px) saturate(1.2);\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.03);\n  }\n\n  .glass-button:hover {\n    background: var(--glass-hover);\n    border-color: var(--primary);\n    box-shadow: var(--shadow-xl);\n  }\n  \n  .dark .glass-button:hover {\n    border-color: rgba(255, 255, 255, 0.12);\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.05);\n  }\n\n  .glass-panel {\n    background: rgba(0, 0, 0, 0.1);\n    backdrop-filter: blur(28px) saturate(1.4) brightness(0.95);\n    -webkit-backdrop-filter: blur(28px) saturate(1.4) brightness(0.95);\n    border: 1px solid rgba(255, 255, 255, 0.08);\n    border-radius: 12px;\n    box-shadow: 0 16px 56px rgba(0, 0, 0, 0.7), inset 0 1px 0 rgba(255, 255, 255, 0.06);\n  }\n}\n\n/* Custom table styles with glass effect */\n.drag-handle {\n  cursor: grab;\n}\n\n.drag-handle:active {\n  cursor: grabbing;\n}\n\n.drag-handle:hover {\n  background: var(--muted);\n  border-radius: 4px;\n}\n\n.dark .drag-handle:hover {\n  background: rgba(255, 255, 255, 0.1);\n}\n\n.dragging {\n  opacity: 0.7;\n  transform: scale(0.98);\n}\n\n.drop-zone {\n  background: linear-gradient(90deg, var(--primary) 0%, transparent 100%);\n  backdrop-filter: blur(8px);\n  -webkit-backdrop-filter: blur(8px);\n}\n\n.cell-editing {\n  background: rgba(99, 102, 241, 0.15);\n  border: 2px solid var(--primary);\n  backdrop-filter: blur(8px);\n  -webkit-backdrop-filter: blur(8px);\n  box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);\n}\n\n.table-container {\n  box-shadow: var(--shadow-lg);\n}\n\n/* Dark Mode table effects */\n.table-row-glass {\n  background-color: transparent;\n}\n\n.table-row-glass:hover {\n  background-color: var(--muted);\n}\n\n.table-header-glass {\n  background-color: transparent;\n  border-bottom: 1px solid var(--border);\n}\n\n/* Table header footer style matching */\n.table-header-footer-blue {\n  color: #60a5fa !important;\n  text-shadow: 0 0 1px #60a5fa !important;\n  font-weight: bold !important;\n}\n\n.dark .table-header-footer-blue {\n  color: #60a5fa !important;\n  text-shadow: 0 0 1px #60a5fa !important;\n  font-weight: bold !important;\n}\n\n/* iOS Frosted Glass buttons */\n.btn-glass {\n  background: rgba(255, 255, 255, 0.2);\n  backdrop-filter: blur(20px) saturate(1.3);\n  -webkit-backdrop-filter: blur(20px) saturate(1.3);\n  border: 1px solid rgba(255, 255, 255, 0.2);\n  transition: all 0.3s ease;\n}\n\n.dark .btn-glass {\n  background: rgba(0, 0, 0, 0.2);\n  backdrop-filter: blur(20px) saturate(1.3) brightness(0.9);\n  -webkit-backdrop-filter: blur(20px) saturate(1.3) brightness(0.9);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.btn-glass:hover {\n  background: rgba(255, 255, 255, 0.3);\n  border-color: rgba(255, 255, 255, 0.3);\n  box-shadow: 0 4px 16px 0 rgba(0, 0, 0, 0.12);\n}\n\n.dark .btn-glass:hover {\n  background: rgba(0, 0, 0, 0.3);\n  border-color: rgba(255, 255, 255, 0.15);\n}\n\n.btn-glass-primary {\n  background-color: var(--primary);\n  color: var(--primary-foreground);\n  border: 1px solid var(--primary);\n}\n\n.btn-glass-primary:hover {\n  background-color: var(--primary);\n  opacity: 0.9;\n  box-shadow: var(--shadow);\n}\n\n/* LightGallery overrides with glass effect */\n.lg-backdrop {\n  background-color: rgba(0, 0, 0, 0.9);\n  backdrop-filter: blur(20px);\n  -webkit-backdrop-filter: blur(20px);\n}\n\n.lg-toolbar {\n  background: rgba(0, 0, 0, 0.4);\n  backdrop-filter: blur(16px);\n  -webkit-backdrop-filter: blur(16px);\n  border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n/* iOS Frosted Glass Statistics cards */\n.stats-card-glass {\n  background: rgba(255, 255, 255, 0.3);\n  backdrop-filter: blur(40px) saturate(1.5);\n  -webkit-backdrop-filter: blur(40px) saturate(1.5);\n  border: 1px solid rgba(255, 255, 255, 0.2);\n  box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.12);\n  transition: all 0.3s ease;\n}\n\n.dark .stats-card-glass {\n  background: rgba(0, 0, 0, 0.3);\n  backdrop-filter: blur(40px) saturate(1.5) brightness(0.9);\n  -webkit-backdrop-filter: blur(40px) saturate(1.5) brightness(0.9);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.stats-card-glass:hover {\n  background: rgba(255, 255, 255, 0.4);\n  border-color: rgba(255, 255, 255, 0.3);\n  box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.18);\n  transform: translateY(-2px);\n}\n\n.dark .stats-card-glass:hover {\n  background: rgba(0, 0, 0, 0.4);\n  border-color: rgba(255, 255, 255, 0.15);\n}\n\n/* Badge glass effects */\n.badge-glass {\n  background: var(--muted);\n  border: 1px solid var(--border);\n}\n\n.dark .badge-glass {\n  background: rgba(255, 255, 255, 0.08);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  border: 1px solid rgba(255, 255, 255, 0.12);\n}\n\n/* Table cell custom font size */\n.table-cell-10px {\n  font-size: 10px;\n  font-weight: normal;\n}\n\n/* Table header and footer font size */\n.table-header-footer-12px {\n  font-size: 12px;\n}\n\n/* Footer total blue styling - highly specific to override all other styles */\ntfoot tr td .footer-total-blue,\ntfoot tr th .footer-total-blue,\n.footer-total-blue {\n  color: #60a5fa !important;\n  text-shadow: 0 0 1px #60a5fa !important;\n  font-weight: bold !important;\n}\n\n/* Even more specific override for dark theme */\n.dark tfoot tr td .footer-total-blue,\n.dark tfoot tr th .footer-total-blue,\nhtml.dark tfoot tr td .footer-total-blue,\nhtml.dark tfoot tr th .footer-total-blue {\n  color: #60a5fa !important;\n  text-shadow: 0 0 1px #60a5fa !important;\n  font-weight: bold !important;\n}\n\n/* Pagination font size */\n.pagination-10px {\n  font-size: 10px;\n}\n\n/* Smart pagination transitions */\n.pagination-transition {\n  background: linear-gradient(to right, rgb(59, 130, 246, 0.05), rgb(147, 197, 253, 0.05));\n  backdrop-filter: blur(8px);\n  -webkit-backdrop-filter: blur(8px);\n}\n\n.dark .pagination-transition {\n  background: linear-gradient(to right, rgba(59, 130, 246, 0.1), rgba(147, 197, 253, 0.1));\n  border-color: rgba(59, 130, 246, 0.2);\n}\n\n.pagination-button {\n  position: relative;\n  overflow: hidden;\n  background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(239, 246, 255, 0.9));\n  border-color: rgb(191, 219, 254);\n  color: rgb(37, 99, 235);\n  font-weight: 500;\n}\n\n.dark .pagination-button {\n  background: linear-gradient(135deg, rgba(30, 58, 138, 0.3), rgba(59, 130, 246, 0.2));\n  border-color: rgba(59, 130, 246, 0.4);\n  color: rgb(147, 197, 253);\n}\n\n.pagination-button.page-number {\n  color: rgb(113, 113, 122);\n}\n\n.dark .pagination-button.page-number {\n  color: rgb(212, 212, 216);\n}\n\n.pagination-button:hover {\n  box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);\n  background: linear-gradient(135deg, rgba(255, 255, 255, 1), rgba(219, 234, 254, 1));\n  border-color: rgb(59, 130, 246);\n}\n\n.dark .pagination-button:hover {\n  box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);\n  background: linear-gradient(135deg, rgba(30, 58, 138, 0.5), rgba(59, 130, 246, 0.3));\n  border-color: rgba(59, 130, 246, 0.6);\n}\n\n.pagination-button.active {\n  /* Same background as normal button */\n  background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(239, 246, 255, 0.9));\n  color: rgb(37, 99, 235);\n  font-weight: 600;\n  /* Slow blinking border animation */\n  animation: pagination-border-blink 2s ease-in-out infinite;\n}\n\n.dark .pagination-button.active {\n  /* Same background as normal button in dark mode */\n  background: linear-gradient(135deg, rgba(30, 58, 138, 0.3), rgba(59, 130, 246, 0.2));\n  color: rgb(147, 197, 253);\n  /* Slow blinking border animation */\n  animation: pagination-border-blink-dark 2s ease-in-out infinite;\n}\n\n/* Slow blinking border animation for light mode */\n@keyframes pagination-border-blink {\n  0%, 100% {\n    border-color: rgb(191, 219, 254);\n    box-shadow: none;\n  }\n  50% {\n    border-color: rgb(59, 130, 246);\n    box-shadow: 0 0 8px rgba(59, 130, 246, 0.4);\n  }\n}\n\n/* Slow blinking border animation for dark mode */\n@keyframes pagination-border-blink-dark {\n  0%, 100% {\n    border-color: rgba(59, 130, 246, 0.4);\n    box-shadow: none;\n  }\n  50% {\n    border-color: rgba(59, 130, 246, 0.8);\n    box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);\n  }\n}\n\n/* Disable transitions during drag for better performance */\n.react-beautiful-dnd-dragging * {\n  transition: none !important;\n}\n\n.react-beautiful-dnd-drag-handle:active {\n  transition: none !important;\n}\n\n/* Modal Zoom Animations */\n@keyframes modal-zoom-in {\n  0% {\n    opacity: 0;\n    transform: scale(0.8);\n  }\n  100% {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n\n@keyframes modal-zoom-out {\n  0% {\n    opacity: 1;\n    transform: scale(1);\n  }\n  100% {\n    opacity: 0;\n    transform: scale(0.8);\n  }\n}\n\n/* Apply zoom animation to all dialog content */\n[data-state=\"open\"] > * {\n  animation: modal-zoom-in 0.2s ease-out;\n}\n\n[data-state=\"closed\"] > * {\n  animation: modal-zoom-out 0.15s ease-in;\n}\n\n/* AWESOME Loading Animations */\n.skeleton {\n  background: linear-gradient(110deg, \n    var(--muted) 8%, \n    var(--primary) 18%, \n    var(--muted) 33%);\n  background-size: 200% 100%;\n  animation: shimmer-wave 1.8s ease-in-out infinite;\n  border-radius: 4px;\n  position: relative;\n  overflow: hidden;\n}\n\n.skeleton::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, \n    transparent 0%, \n    rgba(255, 255, 255, 0.1) 50%, \n    transparent 100%);\n  animation: skeleton-shine 2s ease-in-out infinite;\n}\n\n.skeleton-pulse {\n  background: var(--muted);\n  animation: skeleton-pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n  border-radius: 4px;\n}\n\n.skeleton-row {\n  background: linear-gradient(110deg, \n    rgba(255, 255, 255, 0.05) 8%, \n    rgba(255, 255, 255, 0.15) 18%, \n    rgba(255, 255, 255, 0.05) 33%);\n  background-size: 200% 100%;\n  animation: shimmer-glass 2.2s ease-in-out infinite;\n  backdrop-filter: blur(4px);\n  -webkit-backdrop-filter: blur(4px);\n  border-radius: 8px;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.loading-dots {\n  display: inline-flex;\n  gap: 4px;\n  align-items: center;\n}\n\n.loading-dots::after {\n  content: '';\n  width: 4px;\n  height: 4px;\n  border-radius: 50%;\n  background: var(--primary);\n  animation: loading-dots 1.5s infinite;\n}\n\n.loading-spinner {\n  width: 16px;\n  height: 16px;\n  position: relative;\n  display: inline-block;\n}\n\n.loading-spinner::before,\n.loading-spinner::after {\n  content: '';\n  position: absolute;\n  border-radius: 50%;\n  animation: spin-awesome 1.2s ease-in-out infinite;\n}\n\n.loading-spinner::before {\n  width: 16px;\n  height: 16px;\n  border: 2px solid transparent;\n  border-top: 2px solid var(--primary);\n  border-right: 2px solid var(--primary);\n}\n\n.loading-spinner::after {\n  width: 12px;\n  height: 12px;\n  border: 2px solid transparent;\n  border-top: 2px solid var(--muted-foreground);\n  top: 2px;\n  left: 2px;\n  animation-direction: reverse;\n  animation-duration: 0.8s;\n}\n\n.loading-spinner-lg {\n  width: 32px;\n  height: 32px;\n  position: relative;\n  display: inline-block;\n}\n\n.loading-spinner-lg::before {\n  content: '';\n  position: absolute;\n  width: 32px;\n  height: 32px;\n  border: 3px solid transparent;\n  border-top: 3px solid var(--primary);\n  border-right: 3px solid var(--primary);\n  border-radius: 50%;\n  animation: spin-glow 1.5s ease-in-out infinite;\n  box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);\n}\n\n.loading-spinner-lg::after {\n  content: '';\n  position: absolute;\n  width: 20px;\n  height: 20px;\n  border: 2px solid transparent;\n  border-bottom: 2px solid var(--muted-foreground);\n  border-left: 2px solid var(--muted-foreground);\n  border-radius: 50%;\n  top: 6px;\n  left: 6px;\n  animation: spin-glow 1s ease-in-out infinite reverse;\n  box-shadow: 0 0 10px rgba(156, 163, 175, 0.3);\n}\n\n.fade-in-stagger {\n  opacity: 0;\n  animation: fade-in-up 0.6s ease-out forwards;\n}\n\n.fade-in-stagger:nth-child(1) { animation-delay: 0.1s; }\n.fade-in-stagger:nth-child(2) { animation-delay: 0.2s; }\n.fade-in-stagger:nth-child(3) { animation-delay: 0.3s; }\n.fade-in-stagger:nth-child(4) { animation-delay: 0.4s; }\n.fade-in-stagger:nth-child(5) { animation-delay: 0.5s; }\n.fade-in-stagger:nth-child(6) { animation-delay: 0.6s; }\n.fade-in-stagger:nth-child(7) { animation-delay: 0.7s; }\n.fade-in-stagger:nth-child(8) { animation-delay: 0.8s; }\n\n.table-loading-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.85);\n  backdrop-filter: blur(8px);\n  -webkit-backdrop-filter: blur(8px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 50;\n  animation: fade-in 0.3s ease-out;\n}\n\n.mutation-loading {\n  position: relative;\n  overflow: hidden;\n}\n\n.mutation-loading::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, \n    transparent, \n    rgba(255, 255, 255, 0.4), \n    transparent);\n  animation: sweep 1.5s infinite;\n}\n\n.dark .mutation-loading::after {\n  background: linear-gradient(90deg, \n    transparent, \n    rgba(255, 255, 255, 0.1), \n    transparent);\n}\n\n/* Enhanced Keyframe Animations */\n@keyframes shimmer-wave {\n  0% {\n    background-position: -200% 0;\n  }\n  100% {\n    background-position: 200% 0;\n  }\n}\n\n@keyframes shimmer-glass {\n  0% {\n    background-position: -200% 0;\n    opacity: 0.6;\n  }\n  50% {\n    opacity: 0.8;\n  }\n  100% {\n    background-position: 200% 0;\n    opacity: 0.6;\n  }\n}\n\n@keyframes skeleton-pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n\n@keyframes loading-dots {\n  0%, 80%, 100% {\n    transform: scale(0);\n    opacity: 0.5;\n  }\n  40% {\n    transform: scale(1);\n    opacity: 1;\n  }\n}\n\n@keyframes fade-in-up {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n@keyframes fade-in {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n@keyframes sweep {\n  0% {\n    left: -100%;\n  }\n  100% {\n    left: 100%;\n  }\n}\n\n/* New Awesome Loading Animations */\n.loading-morphing {\n  width: 40px;\n  height: 40px;\n  position: relative;\n  display: inline-block;\n}\n\n.loading-morphing::before {\n  content: '';\n  position: absolute;\n  width: 40px;\n  height: 40px;\n  background: var(--primary);\n  border-radius: 50%;\n  animation: morph 2s ease-in-out infinite;\n  box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);\n}\n\n.loading-wave {\n  display: flex;\n  gap: 4px;\n  align-items: center;\n  justify-content: center;\n}\n\n.loading-wave .wave-dot {\n  width: 6px;\n  height: 6px;\n  background: var(--primary);\n  border-radius: 50%;\n  animation: wave 1.4s ease-in-out infinite;\n}\n\n.loading-wave .wave-dot:nth-child(1) { animation-delay: 0s; }\n.loading-wave .wave-dot:nth-child(2) { animation-delay: 0.1s; }\n.loading-wave .wave-dot:nth-child(3) { animation-delay: 0.2s; }\n.loading-wave .wave-dot:nth-child(4) { animation-delay: 0.3s; }\n.loading-wave .wave-dot:nth-child(5) { animation-delay: 0.4s; }\n\n.loading-particles {\n  width: 50px;\n  height: 50px;\n  position: relative;\n  display: inline-block;\n}\n\n.loading-particles::before,\n.loading-particles::after {\n  content: '';\n  position: absolute;\n  width: 8px;\n  height: 8px;\n  background: var(--primary);\n  border-radius: 50%;\n  animation: particles 2s ease-in-out infinite;\n}\n\n.loading-particles::before {\n  top: 0;\n  left: 0;\n  animation-delay: 0s;\n}\n\n.loading-particles::after {\n  bottom: 0;\n  right: 0;\n  animation-delay: 1s;\n  background: var(--muted-foreground);\n}\n\n.loading-pulse-glow {\n  width: 40px;\n  height: 40px;\n  position: relative;\n  display: inline-block;\n}\n\n.loading-pulse-glow::before {\n  content: '';\n  position: absolute;\n  width: 40px;\n  height: 40px;\n  background: var(--primary);\n  border-radius: 50%;\n  animation: pulse-glow 2s ease-in-out infinite;\n}\n\n.loading-triple-bounce {\n  width: 70px;\n  display: inline-block;\n  text-align: center;\n}\n\n.loading-triple-bounce .bounce {\n  width: 8px;\n  height: 8px;\n  background: var(--primary);\n  border-radius: 100%;\n  display: inline-block;\n  animation: triple-bounce 1.4s ease-in-out infinite both;\n  margin: 0 2px;\n}\n\n.loading-triple-bounce .bounce:nth-child(1) { animation-delay: -0.32s; }\n.loading-triple-bounce .bounce:nth-child(2) { animation-delay: -0.16s; }\n\n.loading-orbit {\n  width: 40px;\n  height: 40px;\n  position: relative;\n  display: inline-block;\n}\n\n.loading-orbit::before,\n.loading-orbit::after {\n  content: '';\n  position: absolute;\n  width: 8px;\n  height: 8px;\n  border-radius: 50%;\n  animation: orbit 2s linear infinite;\n}\n\n.loading-orbit::before {\n  background: var(--primary);\n  transform-origin: 20px 20px;\n}\n\n.loading-orbit::after {\n  background: var(--muted-foreground);\n  animation-delay: 1s;\n  transform-origin: 20px 20px;\n}\n\n.loading-orbit-reverse {\n  width: 40px;\n  height: 40px;\n  position: relative;\n  display: inline-block;\n}\n\n.loading-orbit-reverse::before {\n  content: '';\n  position: absolute;\n  width: 6px;\n  height: 6px;\n  border-radius: 50%;\n  background: var(--primary);\n  animation: orbit-reverse 3s linear infinite;\n  transform-origin: 20px 20px;\n}\n\n/* Keyframes for new animations */\n@keyframes skeleton-shine {\n  0% {\n    transform: translateX(-100%);\n  }\n  100% {\n    transform: translateX(100%);\n  }\n}\n\n@keyframes spin-awesome {\n  0% {\n    transform: rotate(0deg);\n    border-top-color: var(--primary);\n    border-right-color: transparent;\n  }\n  25% {\n    border-top-color: transparent;\n    border-right-color: var(--primary);\n  }\n  50% {\n    border-right-color: transparent;\n    border-bottom-color: var(--primary);\n  }\n  75% {\n    border-bottom-color: transparent;\n    border-left-color: var(--primary);\n  }\n  100% {\n    transform: rotate(360deg);\n    border-left-color: transparent;\n    border-top-color: var(--primary);\n  }\n}\n\n@keyframes spin-glow {\n  0% {\n    transform: rotate(0deg);\n    box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);\n  }\n  50% {\n    box-shadow: 0 0 25px rgba(59, 130, 246, 0.8);\n  }\n  100% {\n    transform: rotate(360deg);\n    box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);\n  }\n}\n\n@keyframes morph {\n  0%, 100% {\n    border-radius: 50%;\n    transform: rotate(0deg) scale(1);\n  }\n  25% {\n    border-radius: 0;\n    transform: rotate(45deg) scale(1.1);\n  }\n  50% {\n    border-radius: 50%;\n    transform: rotate(90deg) scale(0.8);\n  }\n  75% {\n    border-radius: 0;\n    transform: rotate(135deg) scale(1.1);\n  }\n}\n\n@keyframes wave {\n  0%, 40%, 100% {\n    transform: scaleY(0.4);\n    opacity: 0.5;\n  }\n  20% {\n    transform: scaleY(1);\n    opacity: 1;\n  }\n}\n\n@keyframes particles {\n  0%, 100% {\n    transform: translate(0, 0) scale(1);\n    opacity: 1;\n  }\n  25% {\n    transform: translate(30px, 0) scale(0.5);\n    opacity: 0.7;\n  }\n  50% {\n    transform: translate(30px, 30px) scale(1);\n    opacity: 0.5;\n  }\n  75% {\n    transform: translate(0, 30px) scale(0.5);\n    opacity: 0.7;\n  }\n}\n\n@keyframes pulse-glow {\n  0%, 100% {\n    transform: scale(1);\n    box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);\n    opacity: 1;\n  }\n  50% {\n    transform: scale(1.2);\n    box-shadow: 0 0 30px rgba(59, 130, 246, 0.9);\n    opacity: 0.8;\n  }\n}\n\n@keyframes triple-bounce {\n  0%, 80%, 100% {\n    transform: scale(0);\n  }\n  40% {\n    transform: scale(1);\n  }\n}\n\n@keyframes orbit {\n  0% {\n    transform: rotate(0deg) translateX(20px) rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg) translateX(20px) rotate(-360deg);\n  }\n}\n\n@keyframes orbit-reverse {\n  0% {\n    transform: rotate(360deg) translateX(20px) rotate(-360deg);\n  }\n  100% {\n    transform: rotate(0deg) translateX(20px) rotate(0deg);\n  }\n}\n\n/* Ripple Loading Animation - Custom Table Page */\n.loading-ripple {\n  width: 60px;\n  height: 60px;\n  position: relative;\n  display: inline-block;\n}\n\n.loading-ripple::before,\n.loading-ripple::after {\n  content: '';\n  position: absolute;\n  border: 3px solid var(--primary);\n  border-radius: 50%;\n  animation: ripple 1.5s ease-out infinite;\n  opacity: 0;\n}\n\n.loading-ripple::before {\n  width: 60px;\n  height: 60px;\n  animation-delay: 0s;\n}\n\n.loading-ripple::after {\n  width: 60px;\n  height: 60px;\n  animation-delay: 0.75s;\n}\n\n@keyframes ripple {\n  0% {\n    width: 0;\n    height: 0;\n    opacity: 1;\n    border-width: 3px;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n  }\n  100% {\n    width: 60px;\n    height: 60px;\n    opacity: 0;\n    border-width: 0;\n    top: 0;\n    left: 0;\n    transform: translate(0, 0);\n  }\n}\n\n/* Loading launcher animations */\n@keyframes loading-progress {\n  0% {\n    width: 0%;\n  }\n  50% {\n    width: 70%;\n  }\n  100% {\n    width: 100%;\n  }\n}\n\n.loading-progress-bar {\n  animation: loading-progress 2s cubic-bezier(0.4, 0, 0.2, 1) infinite;\n}\n\n@keyframes loading-text-dots {\n  0%, 20% {\n    content: 'Loading';\n  }\n  40% {\n    content: 'Loading.';\n  }\n  60% {\n    content: 'Loading..';\n  }\n  80%, 100% {\n    content: 'Loading...';\n  }\n}\n\n.loading-dots-text::after {\n  content: '';\n  animation: loading-text-dots 1.5s steps(1) infinite;\n}\n\n/* Mobile Optimizations */\n@media (max-width: 768px) {\n  /* Optimize table headers for mobile */\n  .table-header-footer-12px {\n    font-size: 10px;\n    padding: 8px 6px;\n  }\n  \n  /* Optimize table cells for mobile */\n  .table-cell-10px {\n    font-size: 9px;\n    padding: 8px 4px;\n  }\n  \n  /* Better readable text on mobile */\n  .text-blue-700 {\n    color: #1d4ed8 !important; /* Darker blue for better contrast on mobile */\n  }\n  \n  /* Optimize pagination for mobile */\n  .pagination-10px {\n    font-size: 9px;\n  }\n  \n  /* Better button sizes on mobile */\n  .pagination-button {\n    min-width: 32px;\n    height: 32px;\n  }\n}\n\n/* Small mobile devices */\n@media (max-width: 480px) {\n  /* Even more compact headers */\n  .table-header-footer-12px {\n    font-size: 9px;\n    padding: 6px 4px;\n  }\n  \n  /* Compact cells */\n  .table-cell-10px {\n    font-size: 8px;\n    padding: 6px 3px;\n  }\n  \n  /* Smaller pagination */\n  .pagination-button {\n    min-width: 28px;\n    height: 28px;\n    font-size: 8px;\n  }\n}\n\n/* Smooth Motion Utilities Layer - GPU-accelerated transitions */\n@layer utilities {\n  /* Core smooth transition utilities */\n  .transition-smooth {\n    transition: opacity 250ms cubic-bezier(0.22, 1, 0.36, 1),\n                transform 250ms cubic-bezier(0.22, 1, 0.36, 1);\n  }\n\n  .transition-smooth-fast {\n    transition: opacity 150ms cubic-bezier(0.22, 1, 0.36, 1),\n                transform 150ms cubic-bezier(0.22, 1, 0.36, 1);\n  }\n\n  .transition-smooth-slow {\n    transition: opacity 300ms cubic-bezier(0.22, 1, 0.36, 1),\n                transform 300ms cubic-bezier(0.22, 1, 0.36, 1);\n  }\n\n  /* Variant that preserves color/background transitions */\n  .transition-smooth-with-color {\n    transition: opacity 250ms cubic-bezier(0.22, 1, 0.36, 1),\n                transform 250ms cubic-bezier(0.22, 1, 0.36, 1),\n                background-color 250ms cubic-bezier(0.22, 1, 0.36, 1),\n                color 250ms cubic-bezier(0.22, 1, 0.36, 1),\n                border-color 250ms cubic-bezier(0.22, 1, 0.36, 1);\n  }\n\n  /* Motion layer for heavy animated lists - GPU optimization */\n  .motion-layer {\n    contain: paint;\n    backface-visibility: hidden;\n  }\n\n  /* Will-change helper - use sparingly, toggle during interaction */\n  .will-change-motion {\n    will-change: transform, opacity;\n  }\n\n  /* Pagination zoom transitions - Smooth zoom in/out page changes */\n  .zoom-in {\n    animation: zoom-in 300ms cubic-bezier(0.16, 1, 0.3, 1);\n  }\n\n  .zoom-out {\n    animation: zoom-out 200ms cubic-bezier(0.16, 1, 0.3, 1);\n  }\n  \n  /* Table cell zoom transitions */\n  .table-zoom-in {\n    animation: table-zoom-in 250ms cubic-bezier(0.22, 1, 0.36, 1);\n  }\n\n  /* Drag elevation */\n  .drag-elevate {\n    transform: scale(1.02);\n    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);\n    z-index: 100;\n  }\n\n  /* Unique table cell transition - Elastic bounce with glow */\n  .table-cell-unique-transition {\n    transition: all 400ms cubic-bezier(0.68, -0.55, 0.265, 1.55),\n                background-color 300ms cubic-bezier(0.4, 0, 0.2, 1),\n                box-shadow 350ms cubic-bezier(0.4, 0, 0.2, 1);\n  }\n\n  .table-cell-unique-transition:hover {\n    transform: scale(1.01) translateY(-1px);\n    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);\n  }\n\n  .dark .table-cell-unique-transition:hover {\n    box-shadow: 0 4px 12px rgba(96, 165, 250, 0.25);\n  }\n\n  /* Respect user's motion preferences */\n  @media (prefers-reduced-motion: reduce) {\n    .transition-smooth,\n    .transition-smooth-fast,\n    .transition-smooth-slow,\n    .transition-smooth-with-color,\n    .table-cell-unique-transition,\n    .zoom-in,\n    .zoom-out,\n    .table-zoom-in {\n      transition: none;\n      animation: none;\n    }\n    \n    /* Disable shadcn animate-in/out for accessibility */\n    .animate-in,\n    .animate-out {\n      animation: none !important;\n    }\n    \n    /* Disable drag elevation scale for reduced motion */\n    .drag-elevate {\n      transform: none;\n    }\n  }\n}\n\n/* Zoom animation keyframes - Smooth zoom in/out transitions */\n@keyframes zoom-in {\n  0% {\n    opacity: 0;\n    transform: scale(0.95);\n  }\n  100% {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n\n@keyframes zoom-out {\n  0% {\n    opacity: 1;\n    transform: scale(1);\n  }\n  100% {\n    opacity: 0;\n    transform: scale(1.05);\n  }\n}\n\n@keyframes table-zoom-in {\n  0% {\n    opacity: 0;\n    transform: scale(0.97);\n  }\n  100% {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n\n/* Carousel zoom in/out transitions */\n@keyframes carousel-zoom-in {\n  0% {\n    opacity: 0;\n    transform: scale(0.92) translateY(10px);\n    filter: blur(4px);\n  }\n  60% {\n    opacity: 0.8;\n  }\n  100% {\n    opacity: 1;\n    transform: scale(1) translateY(0);\n    filter: blur(0);\n  }\n}\n\n@keyframes carousel-zoom-out {\n  0% {\n    opacity: 1;\n    transform: scale(1) translateY(0);\n    filter: blur(0);\n  }\n  40% {\n    opacity: 0.6;\n  }\n  100% {\n    opacity: 0;\n    transform: scale(0.92) translateY(-10px);\n    filter: blur(4px);\n  }\n}\n\n.carousel-zoom-in {\n  animation: carousel-zoom-in 600ms cubic-bezier(0.34, 1.56, 0.64, 1);\n}\n\n.carousel-zoom-out {\n  animation: carousel-zoom-out 400ms cubic-bezier(0.34, 1.56, 0.64, 1);\n}\n\n/* Carousel items transition */\n.embla__slide {\n  transition: opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1),\n              transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);\n}\n","size_bytes":34495},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, decimal, jsonb, integer, uniqueIndex, timestamp, boolean } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Media type with caption and type support (images and videos)\nexport const mediaSchema = z.object({\n  url: z.string(),\n  caption: z.string().optional().default(\"\"),\n  type: z.enum([\"image\", \"video\"]).default(\"image\"),\n  thumbnail: z.string().optional(), // For video thumbnails\n  mimeType: z.string().optional(), // MIME type for uploaded files\n});\n\nexport type MediaWithCaption = z.infer<typeof mediaSchema>;\n\n// Keep backward compatibility\nexport const imageSchema = mediaSchema;\nexport type ImageWithCaption = MediaWithCaption;\n\nexport const tableRows = pgTable(\"table_rows\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  no: integer(\"no\").notNull().default(0),\n  route: text(\"route\").notNull().default(\"\"),\n  code: text(\"code\").notNull().default(\"\"),\n  location: text(\"location\").notNull().default(\"\"),\n  delivery: text(\"delivery\").notNull().default(\"\"),\n  info: text(\"info\").notNull().default(\"\"),\n  tngSite: text(\"tng_site\").notNull().default(\"\"),\n  tngRoute: text(\"tng_route\").notNull().default(\"\"),\n  destination: text(\"destination\").notNull().default(\"0.00\"),\n  tollPrice: text(\"toll_price\").notNull().default(\"0.00\"),\n  latitude: decimal(\"latitude\", { precision: 10, scale: 8 }),\n  longitude: decimal(\"longitude\", { precision: 11, scale: 8 }),\n  images: jsonb(\"images\").$type<MediaWithCaption[]>().notNull().default([]),\n  qrCode: text(\"qr_code\").default(\"\"),\n  sortOrder: integer(\"sort_order\").notNull().default(0),\n  active: boolean(\"active\").notNull().default(true),\n  deliveryAlt: text(\"delivery_alt\").notNull().default(\"normal\"),\n  markerColor: text(\"marker_color\").notNull().default(\"#3b82f6\"),\n}, (table) => ({\n  uniqueSpecialSort: uniqueIndex(\"ux_one_special_sortorder\").on(table.sortOrder).where(sql`${table.sortOrder} = -1`)\n}));\n\nexport const tableColumns = pgTable(\"table_columns\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  dataKey: text(\"data_key\").notNull(),\n  type: text(\"type\").notNull().default(\"text\"), // text, number, currency, images, select\n  sortOrder: integer(\"sort_order\").notNull().default(0),\n  isEditable: text(\"is_editable\").notNull().default(\"true\"),\n  options: jsonb(\"options\").$type<string[]>().default([]),\n});\n\nexport const insertTableRowSchema = createInsertSchema(tableRows, {\n  latitude: z.union([z.string(), z.number()]).transform(val => val === null || val === undefined ? null : String(val)).optional().nullable(),\n  longitude: z.union([z.string(), z.number()]).transform(val => val === null || val === undefined ? null : String(val)).optional().nullable(),\n}).omit({\n  id: true,\n  sortOrder: true,\n});\n\nexport const insertTableColumnSchema = createInsertSchema(tableColumns).omit({\n  id: true,\n  sortOrder: true,\n});\n\n// Route Optimization Schema\nexport const routeOptimizationResult = pgTable(\"route_optimization_result\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  originalOrder: jsonb(\"original_order\").$type<string[]>().notNull(),\n  optimizedOrder: jsonb(\"optimized_order\").$type<string[]>().notNull(),\n  originalDistance: decimal(\"original_distance\", { precision: 8, scale: 2 }).notNull(),\n  optimizedDistance: decimal(\"optimized_distance\", { precision: 8, scale: 2 }).notNull(),\n  timeSaved: decimal(\"time_saved\", { precision: 8, scale: 2 }).notNull(),\n  fuelSaved: decimal(\"fuel_saved\", { precision: 8, scale: 2 }).notNull(),\n  algorithm: text(\"algorithm\").notNull().default(\"nearest_neighbor\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertRouteOptimizationSchema = createInsertSchema(routeOptimizationResult).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Layout preferences for saving column visibility and order (per-user)\nexport const layoutPreferences = pgTable(\"layout_preferences\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\").notNull().default(\"default\"),\n  columnOrder: jsonb(\"column_order\").$type<string[]>().notNull().default([]),\n  columnVisibility: jsonb(\"column_visibility\").$type<Record<string, boolean>>().notNull().default({}),\n  creatorName: text(\"creator_name\").notNull().default(\"Somebody\"),\n  creatorUrl: text(\"creator_url\").notNull().default(\"\"),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n}, (table) => ({\n  userIdIdx: uniqueIndex(\"layout_user_id_idx\").on(table.userId)\n}));\n\nexport const insertLayoutPreferencesSchema = createInsertSchema(layoutPreferences).omit({\n  id: true,\n  updatedAt: true,\n});\n\n// Pages for header carousel\nexport const pages = pgTable(\"pages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull().default(\"\"),\n  description: text(\"description\").notNull().default(\"\"),\n  sortOrder: integer(\"sort_order\").notNull().default(0),\n});\n\nexport const insertPageSchema = createInsertSchema(pages).omit({\n  id: true,\n});\n\n// Global settings for footer and other app-wide configurations\nexport const globalSettings = pgTable(\"global_settings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  key: text(\"key\").notNull().unique(),\n  value: text(\"value\").notNull().default(\"\"),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const insertGlobalSettingsSchema = createInsertSchema(globalSettings).omit({\n  id: true,\n  updatedAt: true,\n});\n\n// Shared table states for shareable view-only URLs\nexport const sharedTableStates = pgTable(\"shared_table_states\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  shareId: text(\"share_id\").notNull().unique(),\n  tableState: jsonb(\"table_state\").$type<{\n    filters: {\n      searchTerm: string;\n      routeFilters: string[];\n      deliveryFilters: string[];\n    };\n    sorting: {\n      column: string;\n      direction: 'asc' | 'desc';\n    } | null;\n    columnVisibility: Record<string, boolean>;\n    columnOrder: string[];\n  }>().notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  expiresAt: timestamp(\"expires_at\"),\n});\n\nexport const insertSharedTableStateSchema = createInsertSchema(sharedTableStates).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Saved share links for users to bookmark their generated share links\nexport const savedShareLinks = pgTable(\"saved_share_links\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  shareId: text(\"share_id\").notNull(),\n  url: text(\"url\").notNull(),\n  remark: text(\"remark\").notNull().default(\"\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertSavedShareLinkSchema = createInsertSchema(savedShareLinks).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertTableRow = z.infer<typeof insertTableRowSchema>;\nexport type TableRow = typeof tableRows.$inferSelect;\nexport type InsertTableColumn = z.infer<typeof insertTableColumnSchema>;\nexport type TableColumn = typeof tableColumns.$inferSelect;\nexport type RouteOptimizationResult = typeof routeOptimizationResult.$inferSelect;\nexport type InsertRouteOptimizationResult = z.infer<typeof insertRouteOptimizationSchema>;\nexport type LayoutPreferences = typeof layoutPreferences.$inferSelect;\nexport type InsertLayoutPreferences = z.infer<typeof insertLayoutPreferencesSchema>;\nexport type Page = typeof pages.$inferSelect;\nexport type InsertPage = z.infer<typeof insertPageSchema>;\nexport type GlobalSettings = typeof globalSettings.$inferSelect;\nexport type InsertGlobalSettings = z.infer<typeof insertGlobalSettingsSchema>;\nexport type SharedTableState = typeof sharedTableStates.$inferSelect;\nexport type InsertSharedTableState = z.infer<typeof insertSharedTableStateSchema>;\nexport type SavedShareLink = typeof savedShareLinks.$inferSelect;\nexport type InsertSavedShareLink = z.infer<typeof insertSavedShareLinkSchema>;\n\n// Custom Tables - User-created tables with selected locations\nexport const customTables = pgTable(\"custom_tables\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  shareId: text(\"share_id\").notNull().unique(),\n  description: text(\"description\").notNull().default(\"\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Custom Table Rows - Many-to-many relationship between custom tables and table rows\nexport const customTableRows = pgTable(\"custom_table_rows\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  customTableId: varchar(\"custom_table_id\").notNull().references(() => customTables.id, { onDelete: 'cascade' }),\n  tableRowId: varchar(\"table_row_id\").notNull().references(() => tableRows.id, { onDelete: 'cascade' }),\n  sortOrder: integer(\"sort_order\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertCustomTableSchema = createInsertSchema(customTables).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertCustomTableRowSchema = createInsertSchema(customTableRows).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type CustomTable = typeof customTables.$inferSelect;\nexport type InsertCustomTable = z.infer<typeof insertCustomTableSchema>;\nexport type CustomTableRow = typeof customTableRows.$inferSelect;\nexport type InsertCustomTableRow = z.infer<typeof insertCustomTableRowSchema>;\n\n// Route Optimization Types\nexport interface RouteOptimizationRequest {\n  rowIds?: string[];\n  startLocation?: { latitude: number; longitude: number };\n  algorithm?: 'nearest_neighbor' | 'genetic' | 'simulated_annealing';\n  prioritizeDelivery?: boolean;\n  maxDistance?: number;\n  vehicleSpecs?: {\n    type: string; // e.g., \"lorry refrigerator 1 ton\"\n    fuelType: string; // e.g., \"diesel\"\n    tollClass: number; // e.g., 1 for class 1 lorry\n  };\n}\n\nexport interface RouteOptimizationResponse {\n  originalOrder: string[];\n  optimizedOrder: string[];\n  originalDistance: number;\n  optimizedDistance: number;\n  timeSaved: number; // in minutes\n  fuelSaved: number; // in liters\n  distanceSaved: number;\n  algorithm: string;\n  optimizationFactors: {\n    distanceReduction: number;\n    timeEfficiency: number;\n    fuelEfficiency: number;\n  };\n}\n","size_bytes":10383},"client/src/components/statistics-cards.tsx":{"content":"import { Images } from \"lucide-react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { TableRow } from \"@shared/schema\";\n\ninterface StatisticsCardsProps {\n  rows: TableRow[];\n  isLoading?: boolean;\n}\n\nexport function StatisticsCards({ rows, isLoading = false }: StatisticsCardsProps) {\n\n  const countImages = () => {\n    return rows.reduce((count, row) => count + row.images.length, 0);\n  };\n\n\n  if (isLoading) {\n    return (\n      <div className=\"grid grid-cols-1 gap-4 mb-6\" data-testid=\"statistics-cards\">\n        <Card className={`stats-card-glass border-none rounded-3xl fade-in-stagger`}>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-2\">\n                <div className=\"skeleton w-16 h-3\" />\n                <div className=\"skeleton w-12 h-3\" />\n              </div>\n              <div className=\"skeleton w-6 h-6 rounded\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"grid grid-cols-1 gap-4 mb-6\" data-testid=\"statistics-cards\">\n      <Card className=\"stats-card-glass border-none rounded-3xl fade-in-stagger\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-muted-foreground\" style={{fontSize: '11px'}} data-testid=\"text-images-count-label\">Images</p>\n              <p className=\"font-bold text-purple-400\" style={{fontSize: '11px'}} data-testid=\"text-images-count-value\">\n                {countImages()}\n              </p>\n            </div>\n            <Images className=\"text-purple-400 text-2xl\" />\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":1775},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\nimport \"leaflet/dist/leaflet.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":192},"client/src/components/image-preview.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { PlusCircle, Images, Edit, ImageOff, Video } from \"lucide-react\";\nimport { MediaWithCaption } from \"@shared/schema\";\n\ninterface ImagePreviewProps {\n  images: MediaWithCaption[];\n  rowId: string;\n  onAddImage: () => void;\n  editMode: boolean;\n  onAccessDenied: () => void;\n}\n\nexport function ImagePreview({ images, rowId, onAddImage, editMode, onAccessDenied }: ImagePreviewProps) {\n  const [lightGallery, setLightGallery] = useState<any>(null);\n\n  useEffect(() => {\n    let gallery: any = null;\n    \n    const loadLightGallery = async () => {\n      if (typeof window !== 'undefined' && images.length > 0) {\n        try {\n          // Wait a bit for DOM to be ready\n          await new Promise(resolve => setTimeout(resolve, 150));\n          \n          const galleryElement = document.getElementById(`lightgallery-preview-${rowId}`);\n          if (!galleryElement) {\n            console.warn('Gallery element not found:', `lightgallery-preview-${rowId}`);\n            return;\n          }\n          \n          // Check if there are actual image links in the element\n          const imageLinks = galleryElement.querySelectorAll('a[data-src]');\n          if (imageLinks.length === 0) {\n            console.warn('No image links found for lightGallery');\n            return;\n          }\n\n          // Dynamically import lightgallery\n          const { default: lightGallery } = await import('lightgallery');\n          const lgThumbnail = await import('lightgallery/plugins/thumbnail');\n          const lgZoom = await import('lightgallery/plugins/zoom');\n          const lgAutoplay = await import('lightgallery/plugins/autoplay');\n          const lgFullscreen = await import('lightgallery/plugins/fullscreen');\n          const lgVideo = await import('lightgallery/plugins/video');\n          \n          // Import CSS\n          await import('lightgallery/css/lightgallery.css');\n          await import('lightgallery/css/lg-thumbnail.css');\n          await import('lightgallery/css/lg-zoom.css');\n          await import('lightgallery/css/lg-autoplay.css');\n          await import('lightgallery/css/lg-fullscreen.css');\n          await import('lightgallery/css/lg-video.css');\n\n          gallery = lightGallery(galleryElement, {\n            licenseKey: 'GPLv3',\n            plugins: [lgThumbnail.default, lgZoom.default, lgAutoplay.default, lgFullscreen.default, lgVideo.default],\n            speed: 800,\n            mode: 'lg-slide',\n            download: false,\n            selector: 'a[data-src]',\n            animateThumb: true,\n            startClass: 'lg-start-zoom',\n            backdropDuration: 300,\n            hideBarsDelay: 2000,\n            mousewheel: true,\n            enableSwipe: true,\n            enableDrag: true,\n            autoplayFirstVideo: false,\n            youTubePlayerParams: {\n              modestbranding: 1,\n              showinfo: 0,\n              rel: 0,\n              controls: 1\n            },\n            vimeoPlayerParams: {\n              byline: 0,\n              portrait: 0,\n              color: 'A90707'\n            }\n          });\n          setLightGallery(gallery);\n        } catch (error) {\n          console.error('Failed to load LightGallery:', error);\n          // Fallback: just open image in new tab\n          const fallbackHandler = (e: Event) => {\n            e.preventDefault();\n            const target = e.target as HTMLElement;\n            const link = target.closest('a[data-src]') as HTMLAnchorElement;\n            if (link) {\n              window.open(link.dataset.src, '_blank');\n            }\n          };\n          \n          const galleryElement = document.getElementById(`lightgallery-preview-${rowId}`);\n          if (galleryElement) {\n            galleryElement.addEventListener('click', fallbackHandler);\n          }\n        }\n      }\n    };\n\n    // Add a small delay to ensure DOM is ready\n    const timeoutId = setTimeout(loadLightGallery, 100);\n\n    return () => {\n      clearTimeout(timeoutId);\n      if (gallery) {\n        try {\n          gallery.destroy();\n        } catch (e) {\n          console.warn('Error destroying lightGallery:', e);\n        }\n      }\n    };\n  }, [images, rowId]);\n\n  if (images.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center gap-2\" data-testid={`image-preview-${rowId}`}>\n        <ImageOff className=\"w-4 h-4 text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex items-center justify-center gap-2\" data-testid={`image-preview-${rowId}`}>\n      <div id={`lightgallery-preview-${rowId}`} className=\"flex items-center gap-1\">\n        {/* Show only the first media item as preview */}\n        <div className=\"flex flex-col items-center gap-1\">\n          <a\n            href={images[0].url}\n            data-src={images[0].url}\n            data-sub-html={images[0].caption}\n            data-video={images[0].type === 'video' ? JSON.stringify({ source: [{ src: images[0].url, type: 'video/mp4' }], attributes: { preload: false, controls: true } }) : undefined}\n            data-poster={images[0].type === 'video' ? images[0].thumbnail : undefined}\n            className=\"relative inline-block rounded overflow-hidden hover:scale-105 transition-transform cursor-pointer\"\n            data-testid={`media-preview-${rowId}-0`}\n            title={images[0].caption || (images[0].type === 'video' ? \"Video\" : \"Image\")}\n            onClick={(e) => {\n              // Fallback handler if LightGallery isn't working\n              if (!lightGallery) {\n                e.preventDefault();\n                window.open(images[0].url, '_blank');\n              }\n            }}\n          >\n            {images[0].type === 'video' ? (\n              <div className=\"w-10 h-8 bg-gray-800 border border-border rounded flex items-center justify-center\">\n                <Video className=\"w-4 h-4 text-white\" />\n                {images[0].thumbnail && (\n                  <img\n                    src={images[0].thumbnail}\n                    alt={images[0].caption || \"Video thumbnail\"}\n                    className=\"absolute inset-0 w-full h-full object-cover rounded\"\n                  />\n                )}\n              </div>\n            ) : (\n              <img\n                src={images[0].url}\n                alt={images[0].caption || \"Image preview\"}\n                className=\"w-10 h-8 object-cover border border-border\"\n                onError={(e) => {\n                  const target = e.target as HTMLImageElement;\n                  target.style.display = 'none';\n                  console.warn('Failed to load image:', images[0].url);\n                }}\n              />\n            )}\n            {/* Show count indicator if there are multiple media items */}\n            {images.length > 1 && (\n              <div className=\"absolute -top-1 -right-1 bg-primary text-primary-foreground text-sm rounded-full w-5 h-5 flex items-center justify-center\">\n                {images.length}\n              </div>\n            )}\n          </a>\n        </div>\n        \n        {/* Hidden media items for lightbox gallery */}\n        {images.slice(1).map((media, index) => (\n          <a\n            key={index + 1}\n            href={media.url}\n            data-src={media.url}\n            data-sub-html={media.caption}\n            data-video={media.type === 'video' ? JSON.stringify({ source: [{ src: media.url, type: 'video/mp4' }], attributes: { preload: false, controls: true } }) : undefined}\n            data-poster={media.type === 'video' ? media.thumbnail : undefined}\n            style={{ display: 'none' }}\n            data-testid={`image-hidden-${rowId}-${index + 1}`}\n          >\n            <img src={media.url} alt={media.caption || `Hidden media ${index + 2}`} />\n          </a>\n        ))}\n      </div>\n      \n      {/* Edit Image Button - Only show in edit mode */}\n      {editMode && (\n        <Button\n          size=\"sm\"\n          variant=\"ghost\"\n          className=\"text-xs text-primary hover:text-primary/80\"\n          onClick={() => onAddImage()}\n          data-testid={`button-edit-images-${rowId}`}\n          title=\"Edit images\"\n        >\n          <Edit className=\"w-4 h-4\" />\n        </Button>\n      )}\n      \n    </div>\n  );\n}","size_bytes":8290},"server/routeOptimizer.ts":{"content":"import type { TableRow } from \"@shared/schema\";\n\n// Default QL Kitchen location\nconst QL_KITCHEN_LOCATION = {\n  latitude: 3.0738,\n  longitude: 101.5183,\n};\n\n// Constants for calculations\nconst AVERAGE_SPEED_KMH = 40; // Average driving speed in KL\nconst FUEL_CONSUMPTION_PER_KM = 0.12; // Liters per km for 1 ton refrigerated lorry (diesel)\n\ninterface Location {\n  id: string;\n  latitude: number;\n  longitude: number;\n  name: string;\n  trip?: string;\n}\n\n/**\n * Calculate distance between two coordinates using Haversine formula\n */\nfunction calculateDistance(\n  lat1: number,\n  lon1: number,\n  lat2: number,\n  lon2: number\n): number {\n  const R = 6371; // Earth's radius in kilometers\n  const dLat = ((lat2 - lat1) * Math.PI) / 180;\n  const dLon = ((lon2 - lon1) * Math.PI) / 180;\n\n  const a =\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos((lat1 * Math.PI) / 180) *\n      Math.cos((lat2 * Math.PI) / 180) *\n      Math.sin(dLon / 2) *\n      Math.sin(dLon / 2);\n\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  const distance = R * c;\n\n  return distance;\n}\n\n/**\n * Calculate total distance for a route\n */\nfunction calculateRouteDistance(\n  locations: Location[],\n  startLocation: { latitude: number; longitude: number }\n): number {\n  if (locations.length === 0) return 0;\n\n  let totalDistance = 0;\n  let currentLat = startLocation.latitude;\n  let currentLon = startLocation.longitude;\n\n  for (const location of locations) {\n    const distance = calculateDistance(\n      currentLat,\n      currentLon,\n      location.latitude,\n      location.longitude\n    );\n    totalDistance += distance;\n    currentLat = location.latitude;\n    currentLon = location.longitude;\n  }\n\n  return totalDistance;\n}\n\n/**\n * Nearest Neighbor Algorithm - Greedy approach\n * Selects the nearest unvisited location at each step\n */\nfunction nearestNeighborOptimization(\n  locations: Location[],\n  startLocation: { latitude: number; longitude: number },\n  prioritizeTrip: boolean = false\n): Location[] {\n  if (locations.length === 0) return [];\n\n  const unvisited = [...locations];\n  const route: Location[] = [];\n  let currentLat = startLocation.latitude;\n  let currentLon = startLocation.longitude;\n\n  while (unvisited.length > 0) {\n    let nearestIndex = 0;\n    let nearestDistance = Infinity;\n\n    for (let i = 0; i < unvisited.length; i++) {\n      const distance = calculateDistance(\n        currentLat,\n        currentLon,\n        unvisited[i].latitude,\n        unvisited[i].longitude\n      );\n\n      // Apply trip priority bonus\n      let adjustedDistance = distance;\n      if (prioritizeTrip && unvisited[i].trip) {\n        // Prefer grouping same trip together with 30% distance bonus\n        adjustedDistance = distance * 0.7;\n      }\n\n      if (adjustedDistance < nearestDistance) {\n        nearestDistance = adjustedDistance;\n        nearestIndex = i;\n      }\n    }\n\n    const nearest = unvisited.splice(nearestIndex, 1)[0];\n    route.push(nearest);\n    currentLat = nearest.latitude;\n    currentLon = nearest.longitude;\n  }\n\n  return route;\n}\n\n/**\n * 2-Opt Algorithm - Local search optimization\n * Improves route by eliminating crossing paths\n */\nfunction twoOptOptimization(route: Location[]): Location[] {\n  if (route.length < 4) return route;\n\n  let improved = true;\n  let optimizedRoute = [...route];\n\n  while (improved) {\n    improved = false;\n\n    for (let i = 0; i < optimizedRoute.length - 2; i++) {\n      for (let j = i + 2; j < optimizedRoute.length; j++) {\n        // Calculate current distance\n        const currentDistance =\n          (i > 0\n            ? calculateDistance(\n                optimizedRoute[i - 1].latitude,\n                optimizedRoute[i - 1].longitude,\n                optimizedRoute[i].latitude,\n                optimizedRoute[i].longitude\n              )\n            : 0) +\n          calculateDistance(\n            optimizedRoute[j - 1].latitude,\n            optimizedRoute[j - 1].longitude,\n            optimizedRoute[j].latitude,\n            optimizedRoute[j].longitude\n          );\n\n        // Calculate new distance after swap\n        const newDistance =\n          (i > 0\n            ? calculateDistance(\n                optimizedRoute[i - 1].latitude,\n                optimizedRoute[i - 1].longitude,\n                optimizedRoute[j - 1].latitude,\n                optimizedRoute[j - 1].longitude\n              )\n            : 0) +\n          calculateDistance(\n            optimizedRoute[i].latitude,\n            optimizedRoute[i].longitude,\n            optimizedRoute[j].latitude,\n            optimizedRoute[j].longitude\n          );\n\n        if (newDistance < currentDistance) {\n          // Reverse the segment between i and j-1\n          optimizedRoute = [\n            ...optimizedRoute.slice(0, i),\n            ...optimizedRoute.slice(i, j).reverse(),\n            ...optimizedRoute.slice(j),\n          ];\n          improved = true;\n        }\n      }\n    }\n  }\n\n  return optimizedRoute;\n}\n\n/**\n * Genetic Algorithm - Population-based optimization\n */\nfunction geneticAlgorithmOptimization(\n  locations: Location[],\n  startLocation: { latitude: number; longitude: number },\n  prioritizeTrip: boolean = false\n): Location[] {\n  if (locations.length === 0) return [];\n  if (locations.length < 5) {\n    // For small routes, use nearest neighbor + 2-opt\n    const initial = nearestNeighborOptimization(\n      locations,\n      startLocation,\n      prioritizeTrip\n    );\n    return twoOptOptimization(initial);\n  }\n\n  const POPULATION_SIZE = 50;\n  const GENERATIONS = 100;\n  const MUTATION_RATE = 0.1;\n  const ELITE_SIZE = 5;\n\n  // Create initial population\n  let population: Location[][] = [];\n\n  // Add nearest neighbor solution as seed\n  population.push(\n    nearestNeighborOptimization(locations, startLocation, prioritizeTrip)\n  );\n\n  // Generate random solutions\n  for (let i = 1; i < POPULATION_SIZE; i++) {\n    const shuffled = [...locations].sort(() => Math.random() - 0.5);\n    population.push(shuffled);\n  }\n\n  // Evolution loop\n  for (let gen = 0; gen < GENERATIONS; gen++) {\n    // Calculate fitness (inverse of distance)\n    const fitness = population.map((route) => {\n      const distance = calculateRouteDistance(route, startLocation);\n      return 1 / (distance + 1);\n    });\n\n    // Selection - keep elite\n    const sortedIndices = fitness\n      .map((f, i) => ({ fitness: f, index: i }))\n      .sort((a, b) => b.fitness - a.fitness);\n\n    const newPopulation: Location[][] = [];\n\n    // Keep elite\n    for (let i = 0; i < ELITE_SIZE; i++) {\n      newPopulation.push([...population[sortedIndices[i].index]]);\n    }\n\n    // Crossover and mutation\n    while (newPopulation.length < POPULATION_SIZE) {\n      // Tournament selection\n      const parent1 =\n        population[\n          sortedIndices[Math.floor(Math.random() * POPULATION_SIZE / 2)].index\n        ];\n      const parent2 =\n        population[\n          sortedIndices[Math.floor(Math.random() * POPULATION_SIZE / 2)].index\n        ];\n\n      // Order crossover\n      const child = orderCrossover(parent1, parent2);\n\n      // Mutation\n      if (Math.random() < MUTATION_RATE) {\n        swapMutation(child);\n      }\n\n      newPopulation.push(child);\n    }\n\n    population = newPopulation;\n  }\n\n  // Return best solution\n  const finalFitness = population.map((route) => {\n    const distance = calculateRouteDistance(route, startLocation);\n    return 1 / (distance + 1);\n  });\n\n  const bestIndex = finalFitness.indexOf(Math.max(...finalFitness));\n  return population[bestIndex];\n}\n\n/**\n * Order Crossover for genetic algorithm\n */\nfunction orderCrossover(parent1: Location[], parent2: Location[]): Location[] {\n  const size = parent1.length;\n  const start = Math.floor(Math.random() * size);\n  const end = Math.floor(Math.random() * (size - start)) + start;\n\n  const child: Location[] = new Array(size);\n\n  // Copy segment from parent1\n  for (let i = start; i <= end; i++) {\n    child[i] = parent1[i];\n  }\n\n  // Fill remaining from parent2\n  let currentIndex = (end + 1) % size;\n  for (let i = 0; i < size; i++) {\n    const parent2Index = (end + 1 + i) % size;\n    const location = parent2[parent2Index];\n\n    if (!child.includes(location)) {\n      child[currentIndex] = location;\n      currentIndex = (currentIndex + 1) % size;\n    }\n  }\n\n  return child;\n}\n\n/**\n * Swap mutation for genetic algorithm\n */\nfunction swapMutation(route: Location[]): void {\n  const i = Math.floor(Math.random() * route.length);\n  const j = Math.floor(Math.random() * route.length);\n  [route[i], route[j]] = [route[j], route[i]];\n}\n\n/**\n * Simulated Annealing Algorithm - Probabilistic optimization\n */\nfunction simulatedAnnealingOptimization(\n  locations: Location[],\n  startLocation: { latitude: number; longitude: number },\n  prioritizeTrip: boolean = false\n): Location[] {\n  if (locations.length === 0) return [];\n\n  // Start with nearest neighbor solution\n  let currentRoute = nearestNeighborOptimization(\n    locations,\n    startLocation,\n    prioritizeTrip\n  );\n  let currentDistance = calculateRouteDistance(currentRoute, startLocation);\n\n  let bestRoute = [...currentRoute];\n  let bestDistance = currentDistance;\n\n  // Simulated annealing parameters\n  let temperature = 1000;\n  const coolingRate = 0.995;\n  const minTemperature = 1;\n\n  while (temperature > minTemperature) {\n    // Generate neighbor solution by swapping two random locations\n    const newRoute = [...currentRoute];\n    const i = Math.floor(Math.random() * newRoute.length);\n    const j = Math.floor(Math.random() * newRoute.length);\n    [newRoute[i], newRoute[j]] = [newRoute[j], newRoute[i]];\n\n    const newDistance = calculateRouteDistance(newRoute, startLocation);\n    const delta = newDistance - currentDistance;\n\n    // Accept better solutions or worse solutions with probability\n    if (delta < 0 || Math.random() < Math.exp(-delta / temperature)) {\n      currentRoute = newRoute;\n      currentDistance = newDistance;\n\n      if (currentDistance < bestDistance) {\n        bestRoute = [...currentRoute];\n        bestDistance = currentDistance;\n      }\n    }\n\n    temperature *= coolingRate;\n  }\n\n  return bestRoute;\n}\n\n/**\n * Main optimization function\n */\nexport function optimizeRoute(\n  rows: TableRow[],\n  algorithm: \"nearest_neighbor\" | \"genetic\" | \"simulated_annealing\" = \"nearest_neighbor\",\n  startLocation: { latitude: number; longitude: number } = QL_KITCHEN_LOCATION,\n  prioritizeTrip: boolean = false\n) {\n  // Filter rows with valid coordinates\n  const locationsWithData = rows\n    .filter(\n      (row) =>\n        row.latitude &&\n        row.longitude &&\n        parseFloat(row.latitude) !== 0 &&\n        parseFloat(row.longitude) !== 0\n    )\n    .map((row) => ({\n      id: row.id,\n      latitude: parseFloat(row.latitude!),\n      longitude: parseFloat(row.longitude!),\n      name: row.location || \"Unknown\",\n      trip: row.delivery,\n    }));\n\n  if (locationsWithData.length === 0) {\n    throw new Error(\"No valid locations with coordinates found\");\n  }\n\n  // Calculate original order distance\n  const originalDistance = calculateRouteDistance(\n    locationsWithData,\n    startLocation\n  );\n\n  // Run optimization based on selected algorithm\n  let optimizedLocations: Location[];\n\n  switch (algorithm) {\n    case \"genetic\":\n      optimizedLocations = geneticAlgorithmOptimization(\n        locationsWithData,\n        startLocation,\n        prioritizeTrip\n      );\n      break;\n    case \"simulated_annealing\":\n      optimizedLocations = simulatedAnnealingOptimization(\n        locationsWithData,\n        startLocation,\n        prioritizeTrip\n      );\n      break;\n    case \"nearest_neighbor\":\n    default:\n      const initial = nearestNeighborOptimization(\n        locationsWithData,\n        startLocation,\n        prioritizeTrip\n      );\n      optimizedLocations = twoOptOptimization(initial);\n      break;\n  }\n\n  // Calculate optimized distance\n  const optimizedDistance = calculateRouteDistance(\n    optimizedLocations,\n    startLocation\n  );\n\n  // Calculate savings\n  const distanceSaved = originalDistance - optimizedDistance;\n  const timeSaved = (distanceSaved / AVERAGE_SPEED_KMH) * 60; // in minutes\n  const fuelSaved = distanceSaved * FUEL_CONSUMPTION_PER_KM; // in liters\n\n  return {\n    originalOrder: locationsWithData.map((l) => l.id),\n    optimizedOrder: optimizedLocations.map((l) => l.id),\n    originalDistance: parseFloat(originalDistance.toFixed(2)),\n    optimizedDistance: parseFloat(optimizedDistance.toFixed(2)),\n    distanceSaved: parseFloat(distanceSaved.toFixed(2)),\n    timeSaved: parseFloat(timeSaved.toFixed(2)),\n    fuelSaved: parseFloat(fuelSaved.toFixed(2)),\n    algorithm,\n    optimizationFactors: {\n      distanceReduction: parseFloat(\n        ((distanceSaved / originalDistance) * 100).toFixed(2)\n      ),\n      timeEfficiency: parseFloat(timeSaved.toFixed(2)),\n      fuelEfficiency: parseFloat(fuelSaved.toFixed(2)),\n    },\n  };\n}\n","size_bytes":12852},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2766},"client/src/components/editable-info-modal.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from \"@/components/ui/dialog\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Input } from \"@/components/ui/input\";\nimport { Save, X, MapPin, QrCode, Upload, ExternalLink, Globe } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { MiniMap } from \"@/components/mini-map\";\n\ninterface EditableInfoModalProps {\n  info: string;\n  rowId: string;\n  code: string;\n  location: string;\n  latitude?: string;\n  longitude?: string;\n  qrCode?: string;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSave: (rowId: string, updates: { info?: string; latitude?: string; longitude?: string; qrCode?: string }) => void;\n}\n\nexport function EditableInfoModal({ \n  info, \n  rowId, \n  code, \n  location, \n  latitude,\n  longitude,\n  qrCode,\n  open, \n  onOpenChange,\n  onSave \n}: EditableInfoModalProps) {\n  // Parse existing info to separate address and description\n  const parseInfo = (infoText: string) => {\n    if (!infoText) return { address: \"\", description: \"\", url: \"\" };\n    \n    // Check if it contains the delimiter\n    if (infoText.includes(\"|||DESCRIPTION|||\")) {\n      const parts = infoText.split(\"|||DESCRIPTION|||\");\n      const address = parts[0] || \"\";\n      const descriptionPart = parts[1] || \"\";\n      \n      // Check if description part contains URL\n      if (descriptionPart.includes(\"|||URL|||\")) {\n        const descParts = descriptionPart.split(\"|||URL|||\");\n        return {\n          address: address,\n          description: descParts[0] || \"\",\n          url: descParts[1] || \"\"\n        };\n      } else {\n        return {\n          address: address,\n          description: descriptionPart,\n          url: \"\"\n        };\n      }\n    } else {\n      // If no delimiter, existing content should be treated as address\n      return {\n        address: infoText,\n        description: \"\",\n        url: \"\"\n      };\n    }\n  };\n\n  const parsed = parseInfo(info || \"\");\n  const [editedAddress, setEditedAddress] = useState(parsed.address);\n  const [editedDescription, setEditedDescription] = useState(parsed.description);\n  const [editedUrl, setEditedUrl] = useState(parsed.url);\n  const [editedLatitude, setEditedLatitude] = useState(latitude || \"\");\n  const [editedLongitude, setEditedLongitude] = useState(longitude || \"\");\n  const [editedQrCode, setEditedQrCode] = useState(qrCode || \"\");\n  const [isUploading, setIsUploading] = useState(false);\n  const { toast } = useToast();\n\n  // Helper to extract short location name from full address\n  const getShortLocationName = (fullLocation: string): string => {\n    if (!fullLocation) return 'Location';\n    \n    // If it contains comma, take the first part\n    if (fullLocation.includes(',')) {\n      return fullLocation.split(',')[0].trim();\n    }\n    \n    // If it's very long (likely full address), take first 20 chars\n    if (fullLocation.length > 25) {\n      return fullLocation.substring(0, 20).trim() + '...';\n    }\n    \n    return fullLocation;\n  };\n\n  const handleSave = () => {\n    const updates: { info?: string; latitude?: string; longitude?: string; qrCode?: string } = {};\n    \n    // Combine address, description, and URL with delimiters  \n    // This only saves to the 'info' field, NOT the 'location' field\n    let combinedInfo = editedAddress;\n    if (editedDescription.trim() || editedUrl.trim()) {\n      combinedInfo += `|||DESCRIPTION|||${editedDescription}`;\n      if (editedUrl.trim()) {\n        combinedInfo += `|||URL|||${editedUrl}`;\n      }\n    }\n      \n    if (combinedInfo !== info) {\n      updates.info = combinedInfo;\n    }\n    \n    if (editedLatitude !== latitude) {\n      updates.latitude = editedLatitude || undefined;\n    }\n    \n    if (editedLongitude !== longitude) {\n      updates.longitude = editedLongitude || undefined;\n    }\n    \n    if (editedQrCode !== qrCode) {\n      updates.qrCode = editedQrCode || undefined;\n    }\n    \n    onSave(rowId, updates);\n    \n    // Clear fields after saving\n    setEditedAddress(\"\");\n    setEditedDescription(\"\");\n    setEditedUrl(\"\");\n    setEditedLatitude(\"\");\n    setEditedLongitude(\"\");\n    setEditedQrCode(\"\");\n    \n    onOpenChange(false);\n    toast({\n      title: \"Information Updated\",\n      description: \"Row information, coordinates and QR code have been saved successfully.\",\n    });\n  };\n\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    // Check if it's an image file\n    if (!file.type.startsWith('image/')) {\n      toast({\n        variant: \"destructive\",\n        title: \"Invalid File\",\n        description: \"Please select an image file for the QR code.\",\n      });\n      return;\n    }\n\n    setIsUploading(true);\n\n    try {\n      // Convert file to data URL\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        const dataUrl = e.target?.result as string;\n        setEditedQrCode(dataUrl);\n        setIsUploading(false);\n        toast({\n          title: \"QR Code Uploaded\",\n          description: \"QR code image has been uploaded successfully.\",\n        });\n      };\n      reader.onerror = () => {\n        setIsUploading(false);\n        toast({\n          variant: \"destructive\",\n          title: \"Upload Failed\",\n          description: \"Failed to upload the QR code image.\",\n        });\n      };\n      reader.readAsDataURL(file);\n    } catch (error) {\n      setIsUploading(false);\n      toast({\n        variant: \"destructive\",\n        title: \"Upload Error\",\n        description: \"An error occurred while uploading the image.\",\n      });\n    }\n\n    // Clear the input\n    event.target.value = '';\n  };\n\n  const handleCancel = () => {\n    // Clear fields when canceling for consistent behavior\n    setEditedAddress(\"\");\n    setEditedDescription(\"\");\n    setEditedUrl(\"\");\n    setEditedLatitude(\"\");\n    setEditedLongitude(\"\");\n    setEditedQrCode(\"\");\n    onOpenChange(false);\n  };\n\n  // Reset fields to original values when modal opens\n  const handleOpenChange = (newOpen: boolean) => {\n    if (newOpen) {\n      const parsed = parseInfo(info);\n      setEditedAddress(parsed.address);\n      setEditedDescription(parsed.description);\n      setEditedUrl(parsed.url);\n      setEditedLatitude(latitude || \"\");\n      setEditedLongitude(longitude || \"\");\n      setEditedQrCode(qrCode || \"\");\n    }\n    onOpenChange(newOpen);\n  };\n\n  // Check if coordinates are valid for mini map\n  const hasValidCoordinates = () => {\n    const lat = parseFloat(editedLatitude);\n    const lng = parseFloat(editedLongitude);\n    return !isNaN(lat) && !isNaN(lng) && lat >= -90 && lat <= 90 && lng >= -180 && lng <= 180;\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleOpenChange}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-hidden flex flex-col bg-white/95 dark:bg-black/95 backdrop-blur-xl border border-blue-200 dark:border-white/10 shadow-2xl rounded-xl\">\n        <DialogHeader className=\"flex-shrink-0 text-center pb-4\">\n          <DialogTitle className=\"text-center text-sm font-semibold bg-gradient-to-r from-blue-600 to-cyan-600 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent\">\n            Edit Info - {code || ''} - {getShortLocationName(location)}\n          </DialogTitle>\n          <DialogDescription className=\"text-center text-muted-foreground text-xs mt-2\">\n            Update location details, coordinates, and media information\n          </DialogDescription>\n        </DialogHeader>\n        \n        <div className=\"space-y-6 overflow-y-auto flex-1 pr-2 px-2 -mx-6 px-6\">\n          <div className=\"bg-blue-50/80 dark:bg-black/50 backdrop-blur-sm border border-blue-200 dark:border-white/15 rounded-lg p-4 shadow-sm\">\n            <label className=\"text-sm font-medium text-blue-700 dark:text-foreground/80 mb-2 block\">\n              üìç Full Address (Optional):\n            </label>\n            <Textarea\n              value={editedAddress}\n              onChange={(e) => setEditedAddress(e.target.value)}\n              placeholder=\"Enter full address details...\"\n              className=\"mt-2 min-h-[80px] text-sm bg-white/80 dark:bg-black/60 border-blue-200 dark:border-white/20 backdrop-blur-sm\"\n              data-testid={`textarea-address-${rowId}`}\n            />\n          </div>\n\n          <div className=\"bg-purple-50/80 dark:bg-black/50 backdrop-blur-sm border border-purple-200 dark:border-white/15 rounded-lg p-4 shadow-sm\">\n            <label className=\"text-sm font-medium text-purple-700 dark:text-foreground/80 mb-2 block\">\n              üìù Description (Optional):\n            </label>\n            <Textarea\n              value={editedDescription}\n              onChange={(e) => setEditedDescription(e.target.value)}\n              placeholder=\"Enter additional notes or description...\"\n              className=\"mt-2 min-h-[80px] text-sm bg-white/80 dark:bg-black/60 border-purple-200 dark:border-white/20 backdrop-blur-sm\"\n              data-testid={`textarea-description-${rowId}`}\n            />\n          </div>\n\n          {/* URL Section */}\n          <div className=\"bg-cyan-50/80 dark:bg-black/50 backdrop-blur-sm border border-cyan-200 dark:border-white/15 rounded-lg p-4 shadow-sm\">\n            <div className=\"flex items-center gap-2 mb-3\">\n              <label className=\"text-sm font-medium text-cyan-700 dark:text-foreground/80\">\n                <Globe className=\"w-4 h-4 inline mr-2\" />\n                üåê Website URL (Optional):\n              </label>\n              {editedUrl.trim() && (\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"h-auto p-1 text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 bg-white/80 dark:bg-black/40 hover:bg-white dark:hover:bg-black/50 backdrop-blur-sm border border-blue-200 dark:border-white/30\"\n                  onClick={() => {\n                    let targetUrl = editedUrl.trim();\n                    if (!targetUrl.startsWith('http://') && !targetUrl.startsWith('https://')) {\n                      targetUrl = 'https://' + targetUrl;\n                    }\n                    window.open(targetUrl, '_blank');\n                  }}\n                  title=\"Open URL in new tab\"\n                  data-testid={`button-test-url-${rowId}`}\n                >\n                  <ExternalLink className=\"w-3 h-3\" />\n                </Button>\n              )}\n            </div>\n            <Input\n              type=\"text\"\n              value={editedUrl}\n              onChange={(e) => setEditedUrl(e.target.value)}\n              placeholder=\"Enter website URL (e.g., https://example.com)...\"\n              className=\"mt-2 text-sm bg-white/80 dark:bg-black/60 border-cyan-200 dark:border-white/20 backdrop-blur-sm\"\n              data-testid={`input-url-${rowId}`}\n            />\n            <p className=\"text-xs text-muted-foreground mt-2\">\n              Add a website URL for quick access to relevant information.\n            </p>\n          </div>\n\n          {/* Coordinate Section */}\n          <div className=\"bg-green-50/80 dark:bg-black/50 backdrop-blur-sm border border-green-200 dark:border-white/15 rounded-lg p-4 shadow-sm\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <MapPin className=\"w-4 h-4 text-green-600 dark:text-blue-400\" />\n              <h4 className=\"text-sm font-medium text-green-700 dark:text-foreground/80\">üìç Location Coordinates</h4>\n            </div>\n            \n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-xs font-medium text-green-700 dark:text-foreground/70 mb-2 block\">\n                  Latitude:\n                </label>\n                <Input\n                  type=\"text\"\n                  value={editedLatitude}\n                  onChange={(e) => setEditedLatitude(e.target.value)}\n                  placeholder=\"e.g. 3.139003\"\n                  className=\"mt-1 text-sm bg-white/80 dark:bg-black/60 border-green-200 dark:border-white/20 backdrop-blur-sm\"\n                  data-testid={`input-latitude-${rowId}`}\n                />\n              </div>\n              <div>\n                <label className=\"text-xs font-medium text-green-700 dark:text-foreground/70 mb-2 block\">\n                  Longitude:\n                </label>\n                <Input\n                  type=\"text\"\n                  value={editedLongitude}\n                  onChange={(e) => setEditedLongitude(e.target.value)}\n                  placeholder=\"e.g. 101.686855\"\n                  className=\"mt-1 text-sm bg-white/80 dark:bg-black/60 border-green-200 dark:border-white/20 backdrop-blur-sm\"\n                  data-testid={`input-longitude-${rowId}`}\n                />\n              </div>\n            </div>\n\n            <p className=\"text-xs text-muted-foreground mt-3\">\n              üó∫Ô∏è Enter coordinates in decimal degrees format for accurate location mapping.\n            </p>\n          </div>\n\n          {/* QR Code Section */}\n          <div className=\"bg-indigo-50/80 dark:bg-black/50 backdrop-blur-sm border border-indigo-200 dark:border-white/15 rounded-lg p-4 shadow-sm\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <QrCode className=\"w-4 h-4 text-indigo-600 dark:text-purple-400\" />\n              <h4 className=\"text-sm font-medium text-indigo-700 dark:text-foreground/80\">üì± QR Code Photo</h4>\n            </div>\n            \n            <div className=\"space-y-3\">\n              <div>\n                <label className=\"text-xs font-medium text-indigo-700 dark:text-muted-foreground\">\n                  Upload QR Code Image:\n                </label>\n                <div className=\"flex gap-2 mt-2\">\n                  <input\n                    type=\"file\"\n                    accept=\"image/*\"\n                    onChange={handleFileUpload}\n                    className=\"hidden\"\n                    id={`qr-upload-${rowId}`}\n                    disabled={isUploading}\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => document.getElementById(`qr-upload-${rowId}`)?.click()}\n                    disabled={isUploading}\n                    className=\"flex-1 bg-white/80 dark:bg-black/40 hover:bg-white dark:hover:bg-black/50 backdrop-blur-sm border border-indigo-200 dark:border-white/30\"\n                    data-testid={`button-upload-qr-${rowId}`}\n                  >\n                    <Upload className=\"w-4 h-4 mr-2\" />\n                    {isUploading ? 'Uploading...' : 'Upload Image'}\n                  </Button>\n                </div>\n              </div>\n\n              <div className=\"text-xs text-center text-muted-foreground\">OR</div>\n\n              <div>\n                <label className=\"text-xs font-medium text-indigo-700 dark:text-muted-foreground\">\n                  Enter QR Code URL:\n                </label>\n                <Input\n                  type=\"text\"\n                  value={editedQrCode}\n                  onChange={(e) => setEditedQrCode(e.target.value)}\n                  placeholder=\"Enter QR code photo URL...\"\n                  className=\"mt-2 text-sm bg-white/10 dark:bg-black/10 border-white/20 dark:border-white/10 backdrop-blur-sm\"\n                  style={{fontSize: '11px'}}\n                  data-testid={`input-qrcode-${rowId}`}\n                />\n              </div>\n            </div>\n\n            {editedQrCode && (\n              <div className=\"mt-2\">\n                <label className=\"text-xs font-medium text-muted-foreground\">Preview:</label>\n                <div className=\"mt-1 border rounded-md overflow-hidden\">\n                  <img \n                    src={editedQrCode} \n                    alt=\"QR Code Preview\" \n                    className=\"w-full h-32 object-contain bg-white\"\n                    onError={(e) => {\n                      e.currentTarget.style.display = 'none';\n                    }}\n                  />\n                </div>\n              </div>\n            )}\n\n            <p className=\"text-xs text-muted-foreground\">\n              Add a QR code photo URL for quick access and scanning.\n            </p>\n          </div>\n\n          {/* Mini Map Preview */}\n          {hasValidCoordinates() && (\n            <div className=\"space-y-2 pt-2 border-t\">\n              <h4 className=\"text-sm font-medium\">Location Preview</h4>\n              <MiniMap \n                locations={[{\n                  latitude: parseFloat(editedLatitude),\n                  longitude: parseFloat(editedLongitude),\n                  label: location || 'Location',\n                  code: code\n                }]}\n                height=\"120px\"\n                showFullscreenButton={false}\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                Live preview of the location based on entered coordinates.\n              </p>\n            </div>\n          )}\n        </div>\n\n        <DialogFooter className=\"space-x-3 flex-shrink-0 mt-6 border-t border-white/20 dark:border-white/15 pt-4 bg-black/30 dark:bg-black/50 backdrop-blur-sm rounded-b-xl -mx-6 -mb-6 px-6 py-4\">\n          <Button \n            variant=\"outline\" \n            onClick={handleCancel}\n            className=\"border-red-600 text-red-600 hover:bg-red-50 dark:border-red-500 dark:text-red-500 dark:hover:bg-red-950/30 backdrop-blur-sm text-sm\"\n            data-testid={`button-cancel-info-${rowId}`}\n          >\n            <X className=\"w-4 h-4 mr-2\" />\n            Cancel\n          </Button>\n          <Button \n            onClick={handleSave}\n            className=\"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white border-0 shadow-lg shadow-blue-500/30 text-sm\"\n            data-testid={`button-save-info-${rowId}`}\n          >\n            <Save className=\"w-4 h-4 mr-2\" />\n            Save Info\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":18221},"client/src/components/editable-cell.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n\ninterface EditableCellProps {\n  value: any;\n  type: string;\n  onSave: (value: any) => void;\n  options?: string[];\n  dataKey?: string;\n}\n\nexport function EditableCell({ value, type, onSave, options, dataKey }: EditableCellProps) {\n  const [isEditing, setIsEditing] = useState(false);\n  const [editValue, setEditValue] = useState(value);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    setEditValue(value);\n  }, [value]);\n\n  useEffect(() => {\n    if (isEditing && inputRef.current) {\n      inputRef.current.focus();\n      inputRef.current.select();\n    }\n  }, [isEditing]);\n\n  const handleSave = () => {\n    let processedValue = editValue;\n    \n    if (type === 'number') {\n      processedValue = parseInt(editValue) || 0;\n    } else if (type === 'currency') {\n      processedValue = parseFloat(editValue.toString().replace(/[^0-9.]/g, '')) || 0;\n      processedValue = processedValue.toFixed(2);\n    }\n    \n    onSave(processedValue);\n    setIsEditing(false);\n  };\n\n  const handleCancel = () => {\n    setEditValue(value);\n    setIsEditing(false);\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      handleSave();\n    } else if (e.key === 'Escape') {\n      handleCancel();\n    }\n  };\n\n  const getPlaceholder = () => {\n    if (dataKey === 'latitude') {\n      return \"e.g. 3.139003 (decimal degrees)\";\n    }\n    if (dataKey === 'longitude') {\n      return \"e.g. 101.686855 (decimal degrees)\";\n    }\n    if (type === 'currency') {\n      return \"0.00\";\n    }\n    if (type === 'number') {\n      return \"Enter number\";\n    }\n    return undefined;\n  };\n\n  if (isEditing) {\n    if (type === 'select' && options) {\n      return (\n        <Select \n          value={editValue} \n          onValueChange={(newValue) => {\n            setEditValue(newValue);\n            onSave(newValue);\n            setIsEditing(false);\n          }}\n        >\n          <SelectTrigger className=\"w-full h-6 px-2 py-1 text-sm bg-transparent border-transparent\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            {options.map((option) => (\n              <SelectItem key={option} value={option}>\n                {option}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      );\n    }\n    \n    return (\n      <Input\n        ref={inputRef}\n        type={type === 'number' || type === 'currency' ? 'number' : 'text'}\n        step={type === 'currency' ? '0.01' : undefined}\n        value={type === 'currency' ? editValue.toString().replace(/[^0-9.]/g, '') : editValue}\n        onChange={(e) => setEditValue(e.target.value)}\n        onBlur={handleSave}\n        onKeyDown={handleKeyDown}\n        placeholder={getPlaceholder()}\n        className=\"w-full h-6 px-2 py-1 text-sm cell-editing glass-input border-none\"\n        data-testid=\"input-editable-cell\"\n      />\n    );\n  }\n\n  return (\n    <span\n      onClick={() => setIsEditing(true)}\n      className=\"cursor-pointer hover:bg-muted/50 rounded px-1 py-0.5 transition-colors\"\n      data-testid=\"text-editable-cell\"\n    >\n      {value}\n    </span>\n  );\n}\n","size_bytes":3324},"client/src/components/image-edit-section.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { ImageIcon, Plus, X, Edit, Trash, RotateCcw } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { ImageWithCaption, MediaWithCaption } from \"@shared/schema\";\nimport { UseMutationResult } from \"@tanstack/react-query\";\nimport { InlineLoading } from \"./skeleton-loader\";\nimport { MediaUploadModal } from \"./media-upload-modal\";\n\ninterface ImageEditSectionProps {\n  rowId: string;\n  images: ImageWithCaption[];\n  location?: string;\n  onClose: () => void;\n  onAddImage: UseMutationResult<any, Error, { rowId: string; imageUrl: string; caption?: string }, unknown>;\n  onUpdateImage: UseMutationResult<any, Error, { rowId: string; imageIndex: number; imageUrl?: string; caption?: string }, unknown>;\n  onDeleteImage: UseMutationResult<any, Error, { rowId: string; imageIndex?: number }, unknown>;\n}\n\nexport function ImageEditSection({ \n  rowId, \n  images, \n  location,\n  onClose, \n  onAddImage, \n  onUpdateImage, \n  onDeleteImage \n}: ImageEditSectionProps) {\n  const [mode, setMode] = useState<'add' | 'edit' | 'replace'>('add');\n  const [selectedImageIndex, setSelectedImageIndex] = useState<number>(0);\n  const [imageUrl, setImageUrl] = useState(\"\");\n  const [caption, setCaption] = useState(\"\");\n  const [deleteConfirmOpen, setDeleteConfirmOpen] = useState(false);\n  const [deleteMode, setDeleteMode] = useState<'single' | 'all'>('single');\n  const [mediaUploadOpen, setMediaUploadOpen] = useState(false);\n  const { toast } = useToast();\n\n  const isValidImageUrl = (url: string) => {\n    return /\\.(jpg|jpeg|png|gif|webp)(\\?.*)?$/i.test(url) || \n           url.includes('unsplash.com') || \n           url.includes('images.unsplash.com');\n  };\n\n  const handleMediaSave = async (media: MediaWithCaption) => {\n    try {\n      await onAddImage.mutateAsync({ \n        rowId, \n        imageUrl: media.url, \n        caption: media.caption \n      });\n      \n      toast({\n        title: \"Media Added\",\n        description: \"Media has been added successfully.\",\n      });\n      \n      setMediaUploadOpen(false);\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to add media.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleMediaSaveMultiple = async (mediaList: MediaWithCaption[]) => {\n    try {\n      for (const media of mediaList) {\n        await onAddImage.mutateAsync({ \n          rowId, \n          imageUrl: media.url, \n          caption: media.caption \n        });\n      }\n      \n      toast({\n        title: \"Album Added\",\n        description: `${mediaList.length} media items have been added successfully.`,\n      });\n      \n      setMediaUploadOpen(false);\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to add some media items.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleModeChange = (newMode: 'add' | 'edit' | 'replace') => {\n    if (newMode === 'add') {\n      setMediaUploadOpen(true);\n      return;\n    }\n    \n    setMode(newMode);\n    if (newMode === 'edit' && images.length > 0) {\n      setCaption(images[selectedImageIndex]?.caption || \"\");\n      setImageUrl(\"\");\n    } else if (newMode === 'replace' && images.length > 0) {\n      setImageUrl(images[selectedImageIndex]?.url || \"\");\n      setCaption(images[selectedImageIndex]?.caption || \"\");\n    } else {\n      setImageUrl(\"\");\n      setCaption(\"\");\n    }\n  };\n\n  const handleImageIndexChange = (index: string) => {\n    const newIndex = parseInt(index);\n    setSelectedImageIndex(newIndex);\n    if (mode === 'edit') {\n      setCaption(images[newIndex]?.caption || \"\");\n      setImageUrl(\"\");\n    } else if (mode === 'replace') {\n      setImageUrl(images[newIndex]?.url || \"\");\n      setCaption(images[newIndex]?.caption || \"\");\n    }\n  };\n\n  const handleSubmit = async () => {\n    if (mode === 'add') {\n      if (!imageUrl.trim()) {\n        toast({\n          title: \"Error\",\n          description: \"Please enter an image URL.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      if (!isValidImageUrl(imageUrl)) {\n        toast({\n          title: \"Error\",\n          description: \"Please enter a valid image URL.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      try {\n        await onAddImage.mutateAsync({ rowId, imageUrl, caption: caption.trim() });\n        toast({\n          title: \"Image Added\",\n          description: \"Image has been added successfully.\",\n        });\n        setImageUrl(\"\");\n        setCaption(\"\");\n      } catch (error) {\n        toast({\n          title: \"Error\",\n          description: \"Failed to add image.\",\n          variant: \"destructive\",\n        });\n      }\n    } else if (mode === 'edit') {\n      try {\n        await onUpdateImage.mutateAsync({ \n          rowId, \n          imageIndex: selectedImageIndex, \n          caption: caption.trim() \n        });\n        toast({\n          title: \"Caption Updated\",\n          description: \"Image caption has been updated successfully.\",\n        });\n      } catch (error) {\n        toast({\n          title: \"Error\",\n          description: \"Failed to update caption.\",\n          variant: \"destructive\",\n        });\n      }\n    } else if (mode === 'replace') {\n      if (!imageUrl.trim()) {\n        toast({\n          title: \"Error\",\n          description: \"Please enter an image URL.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      if (!isValidImageUrl(imageUrl)) {\n        toast({\n          title: \"Error\",\n          description: \"Please enter a valid image URL.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      try {\n        await onUpdateImage.mutateAsync({ \n          rowId, \n          imageIndex: selectedImageIndex, \n          imageUrl, \n          caption: caption.trim() \n        });\n        toast({\n          title: \"Image Replaced\",\n          description: \"Image has been replaced successfully.\",\n        });\n      } catch (error) {\n        toast({\n          title: \"Error\",\n          description: \"Failed to replace image.\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  };\n\n  const handleDeleteClick = (mode: 'single' | 'all') => {\n    setDeleteMode(mode);\n    setDeleteConfirmOpen(true);\n  };\n\n  const handleDeleteConfirm = async () => {\n    try {\n      if (deleteMode === 'all') {\n        await onDeleteImage.mutateAsync({ rowId });\n        toast({\n          title: \"All Images Deleted\",\n          description: \"All images have been deleted successfully.\",\n        });\n        onClose();\n      } else {\n        await onDeleteImage.mutateAsync({ rowId, imageIndex: selectedImageIndex });\n        toast({\n          title: \"Image Deleted\",\n          description: \"Image has been deleted successfully.\",\n        });\n        if (images.length <= 1) {\n          onClose();\n        }\n      }\n      setDeleteConfirmOpen(false);\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete image(s).\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const isPending = onAddImage.isPending || onUpdateImage.isPending || onDeleteImage.isPending;\n\n  // Detect changes for green text indicator\n  const hasChanges = (() => {\n    if (mode === 'add') {\n      return imageUrl.trim().length > 0;\n    } else if (mode === 'edit') {\n      const originalCaption = images[selectedImageIndex]?.caption || \"\";\n      return caption !== originalCaption;\n    } else if (mode === 'replace') {\n      const originalUrl = images[selectedImageIndex]?.url || \"\";\n      return imageUrl !== originalUrl;\n    }\n    return false;\n  })();\n\n  return (\n    <>\n      <Dialog open={true} onOpenChange={(open) => !open && onClose()}>\n        <DialogContent className=\"w-[90vw] max-w-[600px] max-h-[90vh] overflow-y-auto animate-in zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:zoom-out-90 duration-300 transition-all bg-white/70 dark:bg-black/30 backdrop-blur-2xl border-2 border-gray-200/60 dark:border-white/10 shadow-[0_20px_60px_0_rgba(0,0,0,0.25)] rounded-3xl\">\n          {/* iOS Frosted Glass Layer */}\n          <div className=\"absolute inset-0 -z-10 rounded-3xl bg-gradient-to-br from-white/60 via-white/40 to-white/50 dark:from-black/40 dark:via-black/20 dark:to-black/30 backdrop-blur-3xl border-0 shadow-inner\" />\n          \n          <DialogHeader className=\"relative z-10\">\n            <DialogTitle className=\"text-xs font-semibold flex items-center justify-center gap-2\">\n              <ImageIcon className=\"w-4 h-4 text-blue-400\" />\n              üì∑ Manage Media for {location || 'Row'}\n            </DialogTitle>\n          </DialogHeader>\n          \n          <div className=\"relative z-10 flex flex-col gap-4 py-4\">\n            {/* Mode Selection */}\n            <div className=\"bg-white/40 dark:bg-slate-800/40 backdrop-blur-sm border border-blue-400/20 dark:border-blue-500/20 rounded-lg p-3\">\n              <label className=\"text-xs font-medium text-foreground/90 mb-2 block\">üé¨ Action:</label>\n              <Select value={mode} onValueChange={handleModeChange}>\n                <SelectTrigger className=\"bg-white/60 dark:bg-slate-700/60 backdrop-blur-sm border-blue-400/30 dark:border-blue-500/30 text-xs\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"add\">üì∏ Add New Media</SelectItem>\n                  {images.length > 0 && <SelectItem value=\"edit\">‚úèÔ∏è Edit Caption</SelectItem>}\n                  {images.length > 0 && <SelectItem value=\"replace\">üîÑ Replace Media</SelectItem>}\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Media Selection (for edit/replace modes) */}\n            {(mode === 'edit' || mode === 'replace') && images.length > 1 && (\n              <div className=\"bg-white/40 dark:bg-slate-800/40 backdrop-blur-sm border border-blue-400/20 dark:border-blue-500/20 rounded-lg p-3\">\n                <label className=\"text-xs font-medium text-foreground/90 mb-2 block\">üéØ Select Media:</label>\n                <Select value={selectedImageIndex.toString()} onValueChange={handleImageIndexChange}>\n                  <SelectTrigger className=\"bg-white/60 dark:bg-slate-700/60 backdrop-blur-sm border-blue-400/30 dark:border-blue-500/30 text-xs\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {images.map((image, index) => (\n                      <SelectItem key={index} value={index.toString()}>\n                        {image.type === 'video' ? 'üé•' : 'üì∑'} Item {index + 1} {image.caption ? `- ${image.caption}` : ''}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n\n            {/* Current Media Preview (for edit/replace modes) */}\n            {(mode === 'edit' || mode === 'replace') && images[selectedImageIndex] && (\n              <div className=\"bg-white/40 dark:bg-slate-800/40 backdrop-blur-sm border border-blue-400/20 dark:border-blue-500/20 rounded-lg p-3\">\n                <label className=\"text-xs font-medium text-foreground/90 mb-2 block\">üñºÔ∏è Current {images[selectedImageIndex].type === 'video' ? 'Video' : 'Image'}:</label>\n                {images[selectedImageIndex].type === 'video' ? (\n                  <div className=\"relative\">\n                    <video\n                      src={images[selectedImageIndex].url}\n                      className=\"w-32 h-24 object-cover border border-white/20 rounded-lg\"\n                      controls={false}\n                      poster={images[selectedImageIndex].thumbnail}\n                    />\n                    <div className=\"absolute inset-0 flex items-center justify-center bg-black/30 rounded-lg\">\n                      <div className=\"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center\">\n                        <div className=\"w-0 h-0 border-l-[6px] border-l-white border-y-[4px] border-y-transparent ml-1\"></div>\n                      </div>\n                    </div>\n                  </div>\n                ) : (\n                  <img\n                    src={images[selectedImageIndex].url}\n                    alt={images[selectedImageIndex].caption || \"Current image\"}\n                    className=\"w-32 h-24 object-cover border border-white/20 rounded-lg\"\n                  />\n                )}\n              </div>\n            )}\n\n            {/* Media URL Input (for add/replace modes) */}\n            {(mode === 'add' || mode === 'replace') && (\n              <div className=\"bg-white/40 dark:bg-slate-800/40 backdrop-blur-sm border border-blue-400/20 dark:border-blue-500/20 rounded-lg p-3\">\n                <label className=\"text-xs font-medium text-foreground/90 mb-2 block\">\n                  üîó {mode === 'add' ? 'Media URL:' : 'New Media URL:'}\n                </label>\n                <Input\n                  type=\"url\"\n                  placeholder=\"Image, video, YouTube, or Vimeo URL...\"\n                  value={imageUrl}\n                  onChange={(e) => setImageUrl(e.target.value)}\n                  className=\"bg-white/60 dark:bg-slate-700/60 backdrop-blur-sm border-blue-400/30 dark:border-blue-500/30 w-full text-xs\"\n                  data-testid=\"input-image-url\"\n                />\n                {imageUrl && !isValidImageUrl(imageUrl) && (\n                  <p className=\"text-amber-400 text-xs mt-2\">‚ö†Ô∏è This looks like a video URL. For best compatibility, use direct image formats: jpg, png, gif, webp</p>\n                )}\n              </div>\n            )}\n\n            {/* Caption Input */}\n            <div className=\"bg-white/40 dark:bg-slate-800/40 backdrop-blur-sm border border-blue-400/20 dark:border-blue-500/20 rounded-lg p-3\">\n              <label className=\"text-xs font-medium text-foreground/90 mb-2 block\">üìù Caption:</label>\n              <Input\n                type=\"text\"\n                placeholder=\"Add caption (optional)...\"\n                value={caption}\n                onChange={(e) => setCaption(e.target.value)}\n                className=\"bg-white/60 dark:bg-slate-700/60 backdrop-blur-sm border-blue-400/30 dark:border-blue-500/30 w-full text-xs\"\n                data-testid=\"input-image-caption\"\n              />\n            </div>\n\n            {/* Delete Options */}\n            {images.length > 0 && (\n              <div className=\"bg-red-900/20 backdrop-blur-sm border border-red-500/30 rounded-lg p-3\">\n                <label className=\"text-xs font-medium text-red-400 mb-2 block\">üóëÔ∏è Delete Options:</label>\n                <div className=\"flex gap-3\">\n                  <Button\n                    variant=\"destructive\"\n                    onClick={() => handleDeleteClick('single')}\n                    disabled={isPending}\n                    className=\"flex-1 bg-transparent hover:bg-red-600/20 backdrop-blur-sm border-transparent text-red-400 hover:text-red-300 text-xs\"\n                    data-testid=\"button-delete-single\"\n                  >\n                    <Trash className=\"w-3 h-3 mr-1\" />\n                    Delete This Item\n                  </Button>\n                  <Button\n                    variant=\"destructive\"\n                    onClick={() => handleDeleteClick('all')}\n                    disabled={isPending}\n                    className=\"flex-1 bg-transparent hover:bg-red-600/20 backdrop-blur-sm border-transparent text-red-400 hover:text-red-300 text-xs\"\n                    data-testid=\"button-delete-all\"\n                  >\n                    <Trash className=\"w-3 h-3 mr-1\" />\n                    Delete All Items\n                  </Button>\n                </div>\n              </div>\n            )}\n          </div>\n          \n          <DialogFooter className=\"relative z-10 flex gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={onClose}\n              className=\"bg-transparent border-transparent text-red-500 hover:bg-red-500/10 backdrop-blur-sm text-xs\"\n              data-testid=\"button-cancel\"\n              disabled={isPending}\n            >\n              <X className=\"w-3 h-3 mr-1\" />\n              Cancel\n            </Button>\n            <Button \n              onClick={handleSubmit}\n              disabled={isPending}\n              className={`flex-1 bg-transparent backdrop-blur-sm border-transparent text-xs transition-all ${\n                hasChanges \n                  ? 'text-green-400 hover:text-green-300 hover:bg-green-600/20' \n                  : 'text-gray-400 dark:text-gray-500 hover:bg-gray-500/10'\n              }`}\n              data-testid=\"button-submit\"\n            >\n              {isPending ? (\n                <InlineLoading type=\"triple\" />\n              ) : (\n                <>\n                  {mode === 'add' && <Plus className=\"w-3 h-3 mr-1\" />}\n                  {mode === 'edit' && <Edit className=\"w-3 h-3 mr-1\" />}\n                  {mode === 'replace' && <RotateCcw className=\"w-3 h-3 mr-1\" />}\n                  {mode === 'add' ? 'Add Media' : mode === 'edit' ? 'Update Caption' : 'Replace Media'}\n                </>\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Delete Confirmation Dialog */}\n      <Dialog open={deleteConfirmOpen} onOpenChange={setDeleteConfirmOpen}>\n        <DialogContent className=\"sm:max-w-[425px] bg-white/70 dark:bg-black/30 backdrop-blur-2xl border-2 border-gray-200/60 dark:border-white/10 shadow-[0_20px_60px_0_rgba(0,0,0,0.25)] rounded-3xl\">\n          {/* iOS Frosted Glass Layer */}\n          <div className=\"absolute inset-0 -z-10 rounded-3xl bg-gradient-to-br from-white/60 via-white/40 to-white/50 dark:from-black/40 dark:via-black/20 dark:to-black/30 backdrop-blur-3xl border-0 shadow-inner\" />\n          \n          <DialogHeader className=\"relative z-10\">\n            <DialogTitle className=\"text-xs font-semibold\">Confirm Deletion</DialogTitle>\n            <DialogDescription className=\"text-xs\">\n              {deleteMode === 'all' \n                ? \"Are you sure you want to delete ALL images? This action cannot be undone.\"\n                : \"Are you sure you want to delete this image? This action cannot be undone.\"\n              }\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter className=\"relative z-10\">\n            <Button\n              variant=\"outline\"\n              onClick={() => setDeleteConfirmOpen(false)}\n              data-testid=\"button-cancel-delete\"\n              disabled={isPending}\n              className=\"bg-transparent border-transparent hover:bg-gray-500/10 backdrop-blur-sm text-xs\"\n            >\n              Cancel\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={handleDeleteConfirm}\n              data-testid=\"button-confirm-delete\"\n              disabled={isPending}\n              className=\"bg-transparent hover:bg-red-600/20 backdrop-blur-sm border-transparent text-red-400 hover:text-red-300 text-xs\"\n            >\n              Delete\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Media Upload Modal */}\n      <MediaUploadModal\n        open={mediaUploadOpen}\n        onOpenChange={setMediaUploadOpen}\n        onSave={handleMediaSave}\n        onSaveMultiple={handleMediaSaveMultiple}\n      />\n    </>\n  );\n}","size_bytes":19786},"client/src/components/saved-links-modal.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Trash2, Edit, ExternalLink, Copy, MoreVertical } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { SavedShareLink } from \"@shared/schema\";\n\ninterface SavedLinksModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport function SavedLinksModal({ open, onOpenChange }: SavedLinksModalProps) {\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [selectedLink, setSelectedLink] = useState<SavedShareLink | null>(null);\n  const [remark, setRemark] = useState(\"\");\n  const { toast } = useToast();\n\n  const { data: savedLinks = [], isLoading } = useQuery<SavedShareLink[]>({\n    queryKey: [\"/api/saved-share-links\"],\n    enabled: open,\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const response = await apiRequest(\"DELETE\", `/api/saved-share-links/${id}`);\n      if (!response.ok) {\n        throw new Error(\"Failed to delete saved link\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/saved-share-links\"] });\n      setDeleteDialogOpen(false);\n      setSelectedLink(null);\n      toast({\n        title: \"Link deleted\",\n        description: \"The saved link has been removed.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete saved link. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateRemarkMutation = useMutation({\n    mutationFn: async ({ id, remark }: { id: string; remark: string }) => {\n      const response = await apiRequest(\"PATCH\", `/api/saved-share-links/${id}/remark`, {\n        remark,\n      });\n      if (!response.ok) {\n        throw new Error(\"Failed to update remark\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/saved-share-links\"] });\n      setEditDialogOpen(false);\n      setSelectedLink(null);\n      setRemark(\"\");\n      toast({\n        title: \"Remark updated\",\n        description: \"The link remark has been updated.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update remark. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleDelete = (link: SavedShareLink) => {\n    setSelectedLink(link);\n    setDeleteDialogOpen(true);\n  };\n\n  const handleEdit = (link: SavedShareLink) => {\n    setSelectedLink(link);\n    setRemark(link.remark);\n    setEditDialogOpen(true);\n  };\n\n  const confirmDelete = () => {\n    if (selectedLink) {\n      deleteMutation.mutate(selectedLink.id);\n    }\n  };\n\n  const saveRemark = () => {\n    if (selectedLink) {\n      updateRemarkMutation.mutate({ id: selectedLink.id, remark });\n    }\n  };\n\n  const copyToClipboard = async (url: string) => {\n    try {\n      await navigator.clipboard.writeText(url);\n      toast({\n        title: \"Copied!\",\n        description: \"Link copied to clipboard.\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to copy to clipboard.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const formatDate = (date: Date | string) => {\n    const d = typeof date === \"string\" ? new Date(date) : date;\n    return d.toLocaleDateString(\"en-US\", {\n      month: \"short\",\n      day: \"numeric\",\n      year: \"numeric\",\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    });\n  };\n\n  return (\n    <>\n      <Dialog open={open} onOpenChange={onOpenChange}>\n        <DialogContent className=\"sm:max-w-[600px] animate-in zoom-in-95 duration-300 data-[state=closed]:animate-out data-[state=closed]:zoom-out-90 bg-white/70 dark:bg-black/30 backdrop-blur-2xl border-2 border-gray-200/60 dark:border-white/10 shadow-[0_20px_60px_0_rgba(0,0,0,0.25)] rounded-3xl\">\n          {/* iOS Frosted Glass Layer */}\n          <div className=\"absolute inset-0 -z-10 rounded-3xl bg-gradient-to-br from-white/60 via-white/40 to-white/50 dark:from-black/40 dark:via-black/20 dark:to-black/30 backdrop-blur-3xl border-0 shadow-inner\" />\n          <DialogHeader>\n            <DialogTitle>Saved Share Links</DialogTitle>\n            <DialogDescription>\n              Manage your saved share links. Add remarks to organize them better.\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"max-h-[400px] overflow-y-auto pr-2\">\n            {isLoading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <p className=\"text-muted-foreground\">Loading saved links...</p>\n              </div>\n            ) : savedLinks.length === 0 ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <p className=\"text-muted-foreground\">No saved links yet</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {savedLinks.map((link) => (\n                  <div\n                    key={link.id}\n                    className=\"p-4 rounded-2xl border border-white/20 dark:border-white/10 bg-white/20 dark:bg-black/20 backdrop-blur-xl hover:bg-white/30 dark:hover:bg-black/30 transition-all duration-300 hover:scale-[1.02] animate-in zoom-in-95\"\n                    data-testid={`saved-link-${link.id}`}\n                  >\n                    <div className=\"flex items-start justify-between gap-2 mb-2\">\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm font-medium truncate\">{link.remark || \"Untitled Link\"}</p>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          Created: {formatDate(link.createdAt)}\n                        </p>\n                      </div>\n                      <DropdownMenu>\n                        <DropdownMenuTrigger asChild>\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            className=\"h-8 w-8 p-0 shrink-0 transition-all duration-300 hover:scale-110 active:scale-95\"\n                            data-testid={`button-actions-${link.id}`}\n                            title=\"Actions\"\n                          >\n                            <MoreVertical className=\"h-4 w-4\" />\n                          </Button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent align=\"end\" className=\"w-44\">\n                          <DropdownMenuItem\n                            onClick={() => copyToClipboard(link.url)}\n                            className=\"cursor-pointer transition-all duration-200 hover:scale-[1.02]\"\n                            data-testid={`menu-copy-${link.id}`}\n                          >\n                            <Copy className=\"h-4 w-4 mr-2\" />\n                            Copy Link\n                          </DropdownMenuItem>\n                          <DropdownMenuItem\n                            onClick={() => window.open(link.url, \"_blank\")}\n                            className=\"cursor-pointer transition-all duration-200 hover:scale-[1.02]\"\n                            data-testid={`menu-open-${link.id}`}\n                          >\n                            <ExternalLink className=\"h-4 w-4 mr-2\" />\n                            Open Link\n                          </DropdownMenuItem>\n                          <DropdownMenuItem\n                            onClick={() => handleEdit(link)}\n                            className=\"cursor-pointer transition-all duration-200 hover:scale-[1.02]\"\n                            data-testid={`menu-edit-${link.id}`}\n                          >\n                            <Edit className=\"h-4 w-4 mr-2\" />\n                            Edit Remark\n                          </DropdownMenuItem>\n                          <DropdownMenuItem\n                            onClick={() => handleDelete(link)}\n                            className=\"cursor-pointer text-destructive focus:text-destructive transition-all duration-200 hover:scale-[1.02]\"\n                            data-testid={`menu-delete-${link.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4 mr-2\" />\n                            Delete Link\n                          </DropdownMenuItem>\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Input\n                        value={link.url}\n                        readOnly\n                        className=\"flex-1 h-8 text-xs\"\n                        data-testid={`input-url-${link.id}`}\n                      />\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent className=\"bg-white/70 dark:bg-black/30 backdrop-blur-2xl border-2 border-gray-200/60 dark:border-white/10 shadow-[0_20px_60px_0_rgba(0,0,0,0.25)] rounded-3xl\">\n          {/* iOS Frosted Glass Layer */}\n          <div className=\"absolute inset-0 -z-10 rounded-3xl bg-gradient-to-br from-white/60 via-white/40 to-white/50 dark:from-black/40 dark:via-black/20 dark:to-black/30 backdrop-blur-3xl border-0 shadow-inner\" />\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Saved Link</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete this saved link? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={confirmDelete}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              disabled={deleteMutation.isPending}\n            >\n              {deleteMutation.isPending ? \"Deleting...\" : \"Delete\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Edit Remark Dialog */}\n      <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n        <DialogContent className=\"sm:max-w-[425px] bg-white/70 dark:bg-black/30 backdrop-blur-2xl border-2 border-gray-200/60 dark:border-white/10 shadow-[0_20px_60px_0_rgba(0,0,0,0.25)] rounded-3xl\">\n          {/* iOS Frosted Glass Layer */}\n          <div className=\"absolute inset-0 -z-10 rounded-3xl bg-gradient-to-br from-white/60 via-white/40 to-white/50 dark:from-black/40 dark:via-black/20 dark:to-black/30 backdrop-blur-3xl border-0 shadow-inner\" />\n          <DialogHeader>\n            <DialogTitle>Edit Link Remark</DialogTitle>\n            <DialogDescription>\n              Add a note to help you remember what this link is for.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"py-4\">\n            <Label htmlFor=\"remark\">Remark</Label>\n            <Input\n              id=\"remark\"\n              value={remark}\n              onChange={(e) => setRemark(e.target.value)}\n              placeholder=\"e.g., Weekly sales report - Jan 2024\"\n              className=\"mt-2\"\n              data-testid=\"input-remark\"\n            />\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setEditDialogOpen(false)}>\n              Cancel\n            </Button>\n            <Button\n              onClick={saveRemark}\n              disabled={updateRemarkMutation.isPending}\n              data-testid=\"button-save-remark\"\n            >\n              {updateRemarkMutation.isPending ? \"Saving...\" : \"Save\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n","size_bytes":12810},"client/src/utils/tng-generator.ts":{"content":"// Touch n Go value generator utilities\n\nconst TNG_SITES = [\n  \"TnG KL Central\",\n  \"TnG Petaling Jaya\",\n  \"TnG Shah Alam\",\n  \"TnG Subang Jaya\",\n  \"TnG Damansara\",\n  \"TnG Mont Kiara\",\n  \"TnG KLCC\",\n  \"TnG Bukit Bintang\",\n  \"TnG Cheras\",\n  \"TnG Ampang\",\n  \"TnG Kepong\",\n  \"TnG Wangsa Maju\",\n  \"TnG Setapak\",\n  \"TnG Sentul\",\n  \"TnG Brickfields\"\n];\n\nconst ROUTE_ORIGINS = [\n  \"Central\",\n  \"North\",\n  \"South\", \n  \"East\",\n  \"West\",\n  \"Northeast\",\n  \"Southeast\",\n  \"Northwest\",\n  \"Southwest\"\n];\n\nconst ROUTE_DESTINATIONS = [\n  \"Central\",\n  \"North\", \n  \"South\",\n  \"East\",\n  \"West\",\n  \"Northeast\",\n  \"Southeast\", \n  \"Northwest\",\n  \"Southwest\"\n];\n\n// Generate random TnG Site name\nexport function generateTngSite(): string {\n  const randomIndex = Math.floor(Math.random() * TNG_SITES.length);\n  return TNG_SITES[randomIndex];\n}\n\n// Generate random TnG currency amount\nexport function generateTngRoute(): string {\n  // Generate random currency amounts between 5.00 and 50.00 MYR\n  const minAmount = 5.00;\n  const maxAmount = 50.00;\n  const randomAmount = Math.random() * (maxAmount - minAmount) + minAmount;\n  \n  // Round to 2 decimal places and return as string\n  return randomAmount.toFixed(2);\n}\n\n// Generate both TnG values at once\nexport function generateTngValues(): { tngSite: string; tngRoute: string } {\n  return {\n    tngSite: generateTngSite(),\n    tngRoute: generateTngRoute()\n  };\n}","size_bytes":1384},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/hooks/use-table-data.ts":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { TableRow, TableColumn, InsertTableRow, InsertTableColumn } from \"@shared/schema\";\n\nexport function useTableData() {\n  const queryClient = useQueryClient();\n\n  // Fetch table rows\n  const {\n    data: rows = [],\n    isLoading: rowsLoading,\n  } = useQuery<TableRow[]>({\n    queryKey: [\"/api/table-rows\"],\n  });\n\n  // Fetch table columns\n  const {\n    data: columns = [],\n    isLoading: columnsLoading,\n  } = useQuery<TableColumn[]>({\n    queryKey: [\"/api/table-columns\"],\n  });\n\n  // Create row mutation\n  const createRow = useMutation({\n    mutationFn: async (data: InsertTableRow) => {\n      const response = await apiRequest(\"POST\", \"/api/table-rows\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/table-rows\"] });\n    },\n  });\n\n  // Update row mutation\n  const updateRow = useMutation({\n    mutationFn: async ({ id, updates }: { id: string; updates: Partial<InsertTableRow> }) => {\n      const response = await apiRequest(\"PATCH\", `/api/table-rows/${id}`, updates);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/table-rows\"] });\n    },\n  });\n\n  // Delete row mutation\n  const deleteRow = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/table-rows/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/table-rows\"] });\n    },\n  });\n\n  // Reorder rows mutation\n  const reorderRows = useMutation({\n    mutationFn: async (rowIds: string[]) => {\n      const response = await apiRequest(\"POST\", \"/api/table-rows/reorder\", { rowIds });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/table-rows\"] });\n    },\n  });\n\n  // Create column mutation\n  const createColumn = useMutation({\n    mutationFn: async (data: InsertTableColumn) => {\n      const response = await apiRequest(\"POST\", \"/api/table-columns\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/table-columns\"] });\n    },\n  });\n\n  // Delete column mutation\n  const deleteColumn = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/table-columns/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/table-columns\"] });\n    },\n  });\n\n  // Reorder columns mutation\n  const reorderColumns = useMutation({\n    mutationFn: async (columnIds: string[]) => {\n      const response = await apiRequest(\"POST\", \"/api/table-columns/reorder\", { columnIds });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/table-columns\"] });\n    },\n  });\n\n  // Add image to row mutation\n  const addImageToRow = useMutation({\n    mutationFn: async ({ rowId, imageUrl, caption }: { rowId: string; imageUrl: string; caption?: string }) => {\n      const response = await apiRequest(\"POST\", `/api/table-rows/${rowId}/images`, { imageUrl, caption });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/table-rows\"] });\n    },\n  });\n\n  // Update image in row mutation\n  const updateImageInRow = useMutation({\n    mutationFn: async ({ rowId, imageIndex, imageUrl, caption }: { rowId: string; imageIndex: number; imageUrl?: string; caption?: string }) => {\n      const response = await apiRequest(\"PATCH\", `/api/table-rows/${rowId}/images/${imageIndex}`, { imageUrl, caption });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/table-rows\"] });\n    },\n  });\n\n  // Delete image(s) from row mutation\n  const deleteImageFromRow = useMutation({\n    mutationFn: async ({ rowId, imageIndex }: { rowId: string; imageIndex?: number }) => {\n      const url = imageIndex !== undefined \n        ? `/api/table-rows/${rowId}/images/${imageIndex}`\n        : `/api/table-rows/${rowId}/images`;\n      const response = await apiRequest(\"DELETE\", url);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/table-rows\"] });\n    },\n  });\n\n  return {\n    rows,\n    columns,\n    isLoading: rowsLoading || columnsLoading,\n    createRow,\n    updateRow,\n    deleteRow,\n    reorderRows,\n    createColumn,\n    deleteColumn,\n    reorderColumns,\n    addImageToRow,\n    updateImageInRow,\n    deleteImageFromRow,\n  };\n}\n","size_bytes":4649},"client/src/components/footer.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Pencil, Check, Link as LinkIcon, Type } from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface FooterProps {\n  editMode?: boolean;\n}\n\nexport function Footer({ editMode = false }: FooterProps) {\n  const currentYear = new Date().getFullYear();\n  const [isVisible, setIsVisible] = useState(false);\n  const [isLoaded, setIsLoaded] = useState(false);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [confirmDialogOpen, setConfirmDialogOpen] = useState(false);\n  const [companyName, setCompanyName] = useState(\"App v1.0.0\");\n  const [companyUrl, setCompanyUrl] = useState(\"\");\n  const { toast } = useToast();\n\n  // Fetch global company name\n  const { data: setting } = useQuery({\n    queryKey: ['/api/global-settings', 'footerCompanyName'],\n    queryFn: async () => {\n      const res = await fetch('/api/global-settings/footerCompanyName');\n      if (!res.ok && res.status !== 404) {\n        throw new Error('Failed to fetch company name');\n      }\n      return res.json();\n    },\n  });\n\n  // Fetch global company URL\n  const { data: urlSetting } = useQuery({\n    queryKey: ['/api/global-settings', 'footerCompanyUrl'],\n    queryFn: async () => {\n      const res = await fetch('/api/global-settings/footerCompanyUrl');\n      if (!res.ok && res.status !== 404) {\n        throw new Error('Failed to fetch company URL');\n      }\n      return res.json();\n    },\n  });\n\n  // Update mutations\n  const updateNameMutation = useMutation({\n    mutationFn: async (value: string) => {\n      const res = await apiRequest('POST', '/api/global-settings', {\n        key: 'footerCompanyName',\n        value,\n      });\n      return await res.json();\n    },\n  });\n\n  const updateUrlMutation = useMutation({\n    mutationFn: async (value: string) => {\n      const res = await apiRequest('POST', '/api/global-settings', {\n        key: 'footerCompanyUrl',\n        value,\n      });\n      return await res.json();\n    },\n  });\n\n  useEffect(() => {\n    if (setting?.value) {\n      setCompanyName(setting.value);\n    }\n  }, [setting]);\n\n  useEffect(() => {\n    if (urlSetting?.value) {\n      setCompanyUrl(urlSetting.value);\n    }\n  }, [urlSetting]);\n\n  useEffect(() => {\n    // Trigger entrance animation\n    const timer1 = setTimeout(() => setIsVisible(true), 100);\n    const timer2 = setTimeout(() => setIsLoaded(true), 300);\n    return () => {\n      clearTimeout(timer1);\n      clearTimeout(timer2);\n    };\n  }, []);\n\n  const handleSave = async () => {\n    try {\n      await updateNameMutation.mutateAsync(companyName);\n      await updateUrlMutation.mutateAsync(companyUrl);\n      \n      queryClient.invalidateQueries({ queryKey: ['/api/global-settings', 'footerCompanyName'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/global-settings', 'footerCompanyUrl'] });\n      \n      setEditDialogOpen(false);\n      toast({\n        title: \"Success\",\n        description: \"Footer updated successfully!\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: error instanceof Error ? error.message : \"Failed to update footer\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleLinkClick = (e: React.MouseEvent) => {\n    e.preventDefault();\n    setConfirmDialogOpen(true);\n  };\n\n  const handleConfirmNavigate = () => {\n    if (companyUrl) {\n      window.open(companyUrl, '_blank', 'noopener,noreferrer');\n      setConfirmDialogOpen(false);\n    }\n  };\n\n  return (\n    <>\n      <footer \n        className={`fixed bottom-0 left-0 right-0 bg-white/30 dark:bg-black/30 backdrop-blur-2xl border-t border-white/20 dark:border-white/10 px-4 py-3 text-sm transition-all duration-500 ease-out shadow-[0_8px_32px_0_rgba(0,0,0,0.12)] ${\n          isVisible ? 'translate-y-0 opacity-100' : 'translate-y-full opacity-0'\n        }`}\n      >\n        <div className=\"container mx-auto\">\n          <div className={`flex items-center justify-center gap-2 transition-all duration-700 ease-out text-[11px] ${\n            isLoaded ? 'scale-100 opacity-100' : 'scale-95 opacity-0'\n          }`}>\n            <div className=\"flex items-center gap-1 text-gray-500 dark:text-gray-400 font-semibold\">\n              <span className=\"text-xs\">¬©</span>\n              <span className=\"font-bold\">{currentYear}</span>\n              <span>All Rights Reserved</span>\n            </div>\n            <div className=\"w-1 h-1 bg-gray-400 rounded-full\"></div>\n            <div className=\"flex items-center gap-1\">\n              {companyUrl ? (\n                <button\n                  onClick={handleLinkClick}\n                  className=\"font-bold bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 dark:from-pink-400 dark:via-purple-400 dark:to-blue-400 bg-clip-text text-transparent hover:from-blue-500 hover:via-purple-500 hover:to-pink-500 dark:hover:from-blue-400 dark:hover:via-purple-400 dark:hover:to-pink-400 transition-all duration-500 cursor-pointer border-none bg-transparent p-0\"\n                  data-testid=\"button-company-name\"\n                >\n                  {companyName}\n                </button>\n              ) : (\n                <span className=\"font-bold bg-gradient-to-r from-gray-600 via-gray-400 to-gray-600 dark:from-gray-300 dark:via-gray-100 dark:to-gray-300 bg-clip-text text-transparent\">\n                  {companyName}\n                </span>\n              )}\n              {editMode && (\n                <Button\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  onClick={() => setEditDialogOpen(true)}\n                  className=\"h-5 w-5 p-0 ml-1 opacity-60 hover:opacity-100\"\n                  data-testid=\"button-edit-footer\"\n                >\n                  <Pencil className=\"h-3 w-3\" />\n                </Button>\n              )}\n            </div>\n          </div>\n        </div>\n      </footer>\n\n      {/* Confirmation Dialog for External Link */}\n      <Dialog open={confirmDialogOpen} onOpenChange={setConfirmDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <LinkIcon className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\n              Visit Website\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <p className=\"text-sm text-slate-600 dark:text-slate-400\">\n              You are about to visit:\n            </p>\n            <div className=\"p-3 bg-slate-100 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700\">\n              <div className=\"flex items-start gap-2\">\n                <LinkIcon className=\"w-4 h-4 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0\" />\n                <div className=\"flex-1 break-all\">\n                  <div className=\"text-xs text-slate-500 dark:text-slate-400 mb-1\">Website URL:</div>\n                  <div className=\"font-semibold text-blue-600 dark:text-blue-400 text-sm\">{companyUrl}</div>\n                </div>\n              </div>\n            </div>\n            <p className=\"text-xs text-slate-500 dark:text-slate-400\">\n              This will open in a new browser tab.\n            </p>\n          </div>\n          <DialogFooter className=\"sm:justify-between\">\n            <Button variant=\"outline\" onClick={() => setConfirmDialogOpen(false)} data-testid=\"button-cancel-navigate\">\n              Cancel\n            </Button>\n            <Button onClick={handleConfirmNavigate} className=\"bg-blue-600 hover:bg-blue-700\" data-testid=\"button-confirm-navigate\">\n              <LinkIcon className=\"w-4 h-4 mr-2\" />\n              Visit Website\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Footer Dialog */}\n      <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Edit Footer</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"company-name\">Company Name</Label>\n              <Input\n                id=\"company-name\"\n                value={companyName}\n                onChange={(e) => setCompanyName(e.target.value)}\n                placeholder=\"Enter company name\"\n                data-testid=\"input-company-name\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"company-url\" className={companyUrl ? \"text-blue-600 dark:text-blue-400\" : \"\"}>\n                Company Website URL (optional)\n              </Label>\n              <Input\n                id=\"company-url\"\n                value={companyUrl}\n                onChange={(e) => setCompanyUrl(e.target.value)}\n                placeholder=\"https://example.com\"\n                className={companyUrl ? \"border-blue-500 dark:border-blue-400 focus:ring-blue-500\" : \"\"}\n                data-testid=\"input-company-url\"\n              />\n            </div>\n\n            {/* Preview/Checklist Section */}\n            <div className=\"mt-6 p-4 bg-slate-100 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700\">\n              <h4 className=\"text-sm font-semibold mb-3 text-slate-700 dark:text-slate-300\">Preview Changes</h4>\n              <div className=\"space-y-2\">\n                <div className=\"flex items-start gap-2 text-sm\">\n                  <Check className=\"w-4 h-4 text-green-600 dark:text-green-400 mt-0.5 flex-shrink-0\" />\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <Type className=\"w-3.5 h-3.5 text-slate-500\" />\n                      <span className=\"text-slate-600 dark:text-slate-400\">Company Name:</span>\n                    </div>\n                    <div className=\"ml-5 font-semibold text-slate-800 dark:text-slate-200\">\n                      {companyName || <span className=\"text-slate-400 italic\">Not set</span>}\n                    </div>\n                  </div>\n                </div>\n                <div className=\"flex items-start gap-2 text-sm\">\n                  <Check className={`w-4 h-4 mt-0.5 flex-shrink-0 ${companyUrl ? 'text-blue-600 dark:text-blue-400' : 'text-slate-400'}`} />\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <LinkIcon className={`w-3.5 h-3.5 ${companyUrl ? 'text-blue-600 dark:text-blue-400' : 'text-slate-500'}`} />\n                      <span className=\"text-slate-600 dark:text-slate-400\">Website URL:</span>\n                    </div>\n                    <div className=\"ml-5\">\n                      {companyUrl ? (\n                        <div>\n                          <div className=\"font-semibold text-blue-600 dark:text-blue-400 break-all\">{companyUrl}</div>\n                          <div className=\"text-xs text-green-600 dark:text-green-400 mt-1\">\n                            ‚úì Company name will be clickable\n                          </div>\n                        </div>\n                      ) : (\n                        <span className=\"text-slate-400 italic\">Not set - name will not be a link</span>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setEditDialogOpen(false)} data-testid=\"button-cancel-footer\">\n              Cancel\n            </Button>\n            <Button onClick={handleSave} disabled={updateNameMutation.isPending || updateUrlMutation.isPending} data-testid=\"button-save-footer\">\n              {(updateNameMutation.isPending || updateUrlMutation.isPending) ? \"Saving...\" : \"Save\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}","size_bytes":12297},"client/src/utils/distance.ts":{"content":"// Haversine formula to calculate distance between two points in kilometers\nexport function calculateDistance(\n  lat1: number,\n  lon1: number,\n  lat2: number,\n  lon2: number\n): number {\n  const R = 6371; // Earth's radius in kilometers\n  const dLat = (lat2 - lat1) * (Math.PI / 180);\n  const dLon = (lon2 - lon1) * (Math.PI / 180);\n  const a =\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(lat1 * (Math.PI / 180)) *\n      Math.cos(lat2 * (Math.PI / 180)) *\n      Math.sin(dLon / 2) *\n      Math.sin(dLon / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c;\n}\n\n// Calculate cumulative distances from QL Kitchen through the route\nexport function calculateCumulativeDistances(rows: any[]): Map<string, number> {\n  const distances = new Map<string, number>();\n  \n  // Find QL Kitchen (warehouse) row\n  const qlKitchen = rows.find(row => row.route === \"Warehouse\" && row.sortOrder === -1);\n  \n  if (!qlKitchen || !qlKitchen.latitude || !qlKitchen.longitude) {\n    // If no QL Kitchen found, return empty distances\n    return distances;\n  }\n\n  // QL Kitchen has 0 distance\n  distances.set(qlKitchen.id, 0);\n\n  // Filter out QL Kitchen and sort remaining rows by their current order\n  const routeRows = rows\n    .filter(row => row.id !== qlKitchen.id)\n    .filter(row => row.latitude && row.longitude && \n                   !isNaN(parseFloat(row.latitude)) && \n                   !isNaN(parseFloat(row.longitude)));\n\n  let cumulativeDistance = 0;\n  let previousLat = parseFloat(qlKitchen.latitude);\n  let previousLon = parseFloat(qlKitchen.longitude);\n\n  for (const row of routeRows) {\n    const currentLat = parseFloat(row.latitude);\n    const currentLon = parseFloat(row.longitude);\n    \n    // Calculate distance from previous point to current point\n    const segmentDistance = calculateDistance(\n      previousLat,\n      previousLon,\n      currentLat,\n      currentLon\n    );\n    \n    cumulativeDistance += segmentDistance;\n    distances.set(row.id, cumulativeDistance);\n    \n    // Update previous coordinates for next iteration\n    previousLat = currentLat;\n    previousLon = currentLon;\n  }\n\n  return distances;\n}","size_bytes":2155},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-center align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2767},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/column-header.tsx":{"content":"import { GripVertical, X } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { TableColumn } from \"@shared/schema\";\n\ninterface ColumnHeaderProps {\n  column: TableColumn;\n  dragHandleProps: any;\n  onDelete: () => void;\n  isAuthenticated?: boolean;\n  editMode?: boolean;\n}\n\nexport function ColumnHeader({ column, dragHandleProps, onDelete, isAuthenticated = false, editMode = false }: ColumnHeaderProps) {\n  // Core columns that cannot be deleted (based on dataKey)\n  const coreColumnDataKeys = ['id', 'no', 'route', 'code', 'location', 'delivery', 'tngRoute', 'info', 'images', 'kilometer', 'tollPrice'];\n  const isCoreColumn = coreColumnDataKeys.includes(column.dataKey);\n  \n  return (\n    <div className=\"flex items-center justify-center w-[98%] mx-auto relative\">\n      <div {...dragHandleProps} className=\"text-center\">\n        <span className=\"block bg-gradient-to-r from-blue-600 to-cyan-600 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent font-medium\" style={{fontSize: '11px'}}>{column.name}</span>\n      </div>\n      {!isCoreColumn && (\n        <div className=\"absolute right-0 flex items-center gap-1 opacity-50 group-hover:opacity-100 transition-opacity\">\n          <Button\n            size=\"sm\"\n            variant=\"ghost\"\n            className={`h-auto p-0 text-sm ${!isAuthenticated ? 'opacity-50 cursor-not-allowed text-muted-foreground' : 'text-muted-foreground hover:text-destructive'}`}\n            onClick={() => isAuthenticated && onDelete()}\n            disabled={!isAuthenticated}\n            title={!isAuthenticated ? \"Authentication required to delete columns\" : \"Delete column\"}\n            data-testid={`button-delete-column-${column.dataKey}`}\n          >\n            <X className=\"w-3 h-3\" />\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":1827},"client/src/components/sliding-description.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { ChevronDown, ChevronRight } from \"lucide-react\";\n\ninterface SlidingDescriptionProps {\n  value: string;\n  onSave: (newValue: string) => void;\n  isEditable?: boolean;\n}\n\nexport function SlidingDescription({ value, onSave, isEditable = true }: SlidingDescriptionProps) {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [editValue, setEditValue] = useState(value);\n\n  useEffect(() => {\n    setEditValue(value);\n  }, [value]);\n\n  const handleChange = (newValue: string) => {\n    setEditValue(newValue);\n    onSave(newValue);\n  };\n\n  const displayValue = value || \"No information available\";\n  const shouldShowToggle = displayValue.length > 50;\n  const truncatedValue = shouldShowToggle && !isExpanded \n    ? displayValue.substring(0, 50) + \"...\" \n    : displayValue;\n\n  if (!isEditable) {\n    return (\n      <div className=\"space-y-2\">\n        <div className=\"flex items-start gap-2\">\n          {shouldShowToggle && (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-6 w-6 p-0 flex-shrink-0 mt-0.5\"\n              onClick={() => setIsExpanded(!isExpanded)}\n              data-testid=\"button-toggle-description\"\n            >\n              {isExpanded ? (\n                <ChevronDown className=\"w-3 h-3\" />\n              ) : (\n                <ChevronRight className=\"w-3 h-3\" />\n              )}\n            </Button>\n          )}\n          \n          <div className=\"flex-1 min-w-0\">\n            <div \n              className=\"flex-1 cursor-pointer transition-all duration-300 ease-in-out opacity-90\"\n              onClick={() => setIsExpanded(!isExpanded)}\n            >\n              {(() => {\n                const lines = (isExpanded ? displayValue : truncatedValue)\n                  .split('\\n')\n                  .map(line => line.trim())\n                  .filter(line => line.length > 0);\n                \n                // If multiple lines, display as description list\n                if (lines.length > 1) {\n                  return (\n                    <dl className=\"space-y-2\" style={{fontSize: '10px'}}>\n                      {lines.map((line, index) => (\n                        <div key={index} className=\"flex items-start gap-3\">\n                          <dt className=\"w-20 flex-shrink-0 font-semibold text-blue-600 dark:text-blue-400\">\n                            Item {index + 1}\n                          </dt>\n                          <dd className=\"flex-1 text-gray-700 dark:text-gray-300 m-0\">\n                            {line}\n                          </dd>\n                        </div>\n                      ))}\n                    </dl>\n                  );\n                }\n                \n                // Single line or no content\n                return (\n                  <div className=\"whitespace-pre-wrap break-words text-gray-700 dark:text-gray-300\" style={{fontSize: '10px'}}>\n                    {isExpanded ? displayValue : truncatedValue}\n                  </div>\n                );\n              })()}\n            </div>\n          </div>\n        </div>\n        {/* Sliding animation container */}\n        <div \n          className={`overflow-hidden transition-all duration-300 ease-in-out ${\n            isExpanded ? 'max-h-96 opacity-100' : 'max-h-0 opacity-0'\n          }`}\n        >\n          {shouldShowToggle && isExpanded && (\n            <div className=\"pl-8 text-muted-foreground\" style={{fontSize: '10px'}}>\n              Click to collapse\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      <Input\n        value={editValue}\n        onChange={(e) => handleChange(e.target.value)}\n        style={{fontSize: '10px'}}\n        placeholder=\"Enter information...\"\n        data-testid=\"input-sliding-description\"\n      />\n    </div>\n  );\n}\n","size_bytes":3979},"client/src/components/add-column-modal.tsx":{"content":"import { useState } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Columns } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface AddColumnModalProps {\n  onCreateColumn: (columnData: {\n    name: string;\n    dataKey: string;\n    type: string;\n    options?: string[];\n  }) => Promise<void>;\n  disabled?: boolean;\n}\n\nexport function AddColumnModal({ onCreateColumn, disabled }: AddColumnModalProps) {\n  const [open, setOpen] = useState(false);\n  const [name, setName] = useState(\"\");\n  const [dataKey, setDataKey] = useState(\"\");\n  const [type, setType] = useState(\"text\");\n  const [options, setOptions] = useState(\"\");\n  const [isCreating, setIsCreating] = useState(false);\n  const { toast } = useToast();\n\n  const columnTypes = [\n    { value: \"text\", label: \"Text\" },\n    { value: \"number\", label: \"Number\" },\n    { value: \"currency\", label: \"Currency (MYR)\" },\n    { value: \"select\", label: \"Select Options\" },\n    { value: \"images\", label: \"Images\" },\n  ];\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!name.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Column name is required.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!dataKey.trim()) {\n      toast({\n        title: \"Error\", \n        description: \"Data key is required.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsCreating(true);\n    \n    try {\n      const columnData: any = {\n        name: name.trim(),\n        dataKey: dataKey.trim(),\n        type,\n      };\n\n      // Add options for select type\n      if (type === \"select\" && options.trim()) {\n        columnData.options = options\n          .split(\"\\n\")\n          .map(option => option.trim())\n          .filter(option => option.length > 0);\n      }\n\n      await onCreateColumn(columnData);\n      \n      // Reset form\n      setName(\"\");\n      setDataKey(\"\");\n      setType(\"text\");\n      setOptions(\"\");\n      setOpen(false);\n      \n      toast({\n        title: \"Success\",\n        description: \"Column created successfully!\",\n      });\n    } catch (error) {\n      console.error(\"Error creating column:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to create column. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsCreating(false);\n    }\n  };\n\n  const generateDataKey = (columnName: string) => {\n    return columnName\n      .toLowerCase()\n      .replace(/[^a-z0-9]/g, '_')\n      .replace(/_{2,}/g, '_')\n      .replace(/^_|_$/g, '');\n  };\n\n  const handleNameChange = (value: string) => {\n    setName(value);\n    if (value && !dataKey) {\n      setDataKey(generateDataKey(value));\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          className=\"btn-glass w-8 h-8 p-0 pagination-button md:w-20 md:h-9 md:px-3\"\n          disabled={disabled}\n          data-testid=\"button-add-column\"\n          title=\"Add new field\"\n        >\n          <Columns className=\"w-4 h-4\" />\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-md\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Columns className=\"w-5 h-5\" />\n            Add New Field\n          </DialogTitle>\n        </DialogHeader>\n        \n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"column-name\">Field Name</Label>\n            <Input\n              id=\"column-name\"\n              placeholder=\"Enter column name...\"\n              value={name}\n              onChange={(e) => handleNameChange(e.target.value)}\n              data-testid=\"input-column-name\"\n              required\n            />\n          </div>\n          \n          <div className=\"space-y-2\">\n            <Label htmlFor=\"data-key\">Data Key</Label>\n            <Input\n              id=\"data-key\"\n              placeholder=\"data_key\"\n              value={dataKey}\n              onChange={(e) => setDataKey(e.target.value)}\n              data-testid=\"input-data-key\"\n              required\n            />\n            <p className=\"text-xs text-muted-foreground\">\n              Unique identifier for this column (auto-generated from name)\n            </p>\n          </div>\n          \n          <div className=\"space-y-2\">\n            <Label htmlFor=\"column-type\">Column Type</Label>\n            <Select value={type} onValueChange={setType}>\n              <SelectTrigger data-testid=\"select-column-type\">\n                <SelectValue placeholder=\"Select column type\" />\n              </SelectTrigger>\n              <SelectContent>\n                {columnTypes.map((columnType) => (\n                  <SelectItem key={columnType.value} value={columnType.value}>\n                    {columnType.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n          \n          {type === \"select\" && (\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"options\">Select Options</Label>\n              <Textarea\n                id=\"options\"\n                placeholder=\"Enter options (one per line)&#10;Option 1&#10;Option 2&#10;Option 3\"\n                value={options}\n                onChange={(e) => setOptions(e.target.value)}\n                data-testid=\"textarea-options\"\n                rows={4}\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                Enter each option on a new line\n              </p>\n            </div>\n          )}\n          \n          {type === \"currency\" && (\n            <div className=\"p-3 bg-muted rounded-md\">\n              <p className=\"text-sm text-muted-foreground\">\n                ‚ú® Currency columns will display values in Malaysian Ringgit (MYR) format\n              </p>\n            </div>\n          )}\n          \n          <div className=\"flex justify-end gap-2 pt-4\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => setOpen(false)}\n              disabled={isCreating}\n              data-testid=\"button-cancel-column\"\n            >\n              Cancel\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={isCreating}\n              data-testid=\"button-create-column\"\n            >\n              {isCreating ? \"Creating...\" : \"Create Column\"}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":7003},"client/src/components/skeleton-loader.tsx":{"content":"import { useState, useEffect } from 'react';\n\ninterface SkeletonLoaderProps {\n  rows?: number;\n  columns?: number;\n  className?: string;\n}\n\ninterface SkeletonRowProps {\n  columns?: number;\n  index?: number;\n}\n\ninterface SkeletonCellProps {\n  width?: string;\n  height?: string;\n  className?: string;\n}\n\nexport function SkeletonCell({ width = \"w-full\", height = \"h-4\", className = \"\" }: SkeletonCellProps) {\n  return (\n    <div className={`skeleton ${width} ${height} ${className}`} data-testid=\"skeleton-cell\" />\n  );\n}\n\nexport function SkeletonRow({ columns = 7, index = 0 }: SkeletonRowProps) {\n  return (\n    <tr className={`skeleton-row fade-in-stagger border-b border-border/20`} data-testid={`skeleton-row-${index}`}>\n      {/* Actions column */}\n      <td className=\"p-3 w-16\">\n        <div className=\"flex gap-1 justify-center\">\n          <SkeletonCell width=\"w-8\" height=\"h-8\" className=\"rounded-md\" />\n          <SkeletonCell width=\"w-8\" height=\"h-8\" className=\"rounded-md\" />\n          <SkeletonCell width=\"w-8\" height=\"h-8\" className=\"rounded-md\" />\n          <SkeletonCell width=\"w-8\" height=\"h-8\" className=\"rounded-md\" />\n        </div>\n      </td>\n\n      {/* No column */}\n      <td className=\"p-3 w-16\">\n        <SkeletonCell width=\"w-8\" height=\"h-4\" className=\"mx-auto\" />\n      </td>\n\n      {/* Dynamic columns */}\n      {Array.from({ length: columns - 2 }).map((_, colIndex) => (\n        <td key={colIndex} className=\"p-3\">\n          {colIndex === 1 ? ( // Location column (spans 3)\n            <SkeletonCell width=\"w-32\" height=\"h-4\" />\n          ) : colIndex === 2 || colIndex === 3 ? null : ( // Skip for colspan\n            <SkeletonCell width={colIndex === 0 ? \"w-16\" : \"w-20\"} height=\"h-4\" />\n          )}\n        </td>\n      ))}\n    </tr>\n  );\n}\n\nexport function SkeletonLoader({ rows = 5, columns = 7, className = \"\" }: SkeletonLoaderProps) {\n  return (\n    <div className={`w-full ${className}`} data-testid=\"skeleton-loader\">\n      <table className=\"w-full\">\n        <tbody>\n          {Array.from({ length: rows }).map((_, index) => (\n            <SkeletonRow key={index} columns={columns} index={index} />\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n\nexport function LoadingOverlay({ message = \"Loading...\", type = \"pulse\" }: { message?: string; type?: \"spinner\" | \"morphing\" | \"pulse\" | \"orbit\" | \"wave\" | \"ripple\" }) {\n  const [currentTip, setCurrentTip] = useState(0);\n  const [progress, setProgress] = useState(0);\n  const [loadingStatus, setLoadingStatus] = useState(\"Initializing\");\n  \n  const tips = [\n    \"üí° Add images to your rows for visual reference\",\n    \"üîó Share your table with custom links\",\n    \"üé® Customize marker colors on the map\",\n    \"üìä Drag and drop rows to reorder\",\n    \"üó∫Ô∏è View delivery routes with Google Maps\",\n    \"üì∏ Upload images from gallery or URL\",\n    \"üîÑ Toggle between delivery alternates\",\n    \"üìç Calculate distances automatically\",\n    \"üíæ Save your table layout preferences\",\n    \"üéØ Filter routes by delivery schedule\"\n  ];\n\n  useEffect(() => {\n    // Random tip rotation - change every 800ms\n    const tipInterval = setInterval(() => {\n      setCurrentTip(Math.floor(Math.random() * tips.length));\n    }, 800);\n\n    // Progress animation - 5 seconds total (0 to 100%)\n    const progressInterval = setInterval(() => {\n      setProgress((prev) => {\n        if (prev >= 100) return 100;\n        return prev + 2; // Increment by 2% every 100ms = 5 seconds total\n      });\n    }, 100);\n\n    // Update loading status based on progress\n    const statusInterval = setInterval(() => {\n      setProgress((currentProgress) => {\n        if (currentProgress < 20) {\n          setLoadingStatus(\"Initializing\");\n        } else if (currentProgress < 40) {\n          setLoadingStatus(\"Loading data\");\n        } else if (currentProgress < 60) {\n          setLoadingStatus(\"Processing\");\n        } else if (currentProgress < 80) {\n          setLoadingStatus(\"Almost there\");\n        } else if (currentProgress < 95) {\n          setLoadingStatus(\"Finalizing\");\n        } else {\n          setLoadingStatus(\"Complete\");\n        }\n        return currentProgress;\n      });\n    }, 100);\n\n    return () => {\n      clearInterval(tipInterval);\n      clearInterval(progressInterval);\n      clearInterval(statusInterval);\n    };\n  }, []);\n\n  const getLoader = () => {\n    switch (type) {\n      case \"morphing\":\n        return <div className=\"loading-morphing\" />;\n      case \"pulse\":\n        return <div className=\"loading-pulse-glow\" />;\n      case \"orbit\":\n        return <div className=\"loading-orbit\" />;\n      case \"wave\":\n        return (\n          <div className=\"loading-wave\">\n            <div className=\"wave-dot\" />\n            <div className=\"wave-dot\" />\n            <div className=\"wave-dot\" />\n            <div className=\"wave-dot\" />\n            <div className=\"wave-dot\" />\n          </div>\n        );\n      case \"ripple\":\n        return <div className=\"loading-ripple\" />;\n      case \"spinner\":\n      default:\n        return <div className=\"loading-spinner-lg\" />;\n    }\n  };\n\n  return (\n    <div className=\"table-loading-overlay\" data-testid=\"loading-overlay\">\n      <div className=\"flex flex-col items-center gap-8 zoom-in\">\n        {/* App Logo/Icon with enhanced animations */}\n        <div className=\"relative\">\n          {/* Main logo container with FamilyMart logo */}\n          <div className=\"w-24 h-24 rounded-3xl overflow-hidden shadow-2xl shadow-blue-500/50 flex items-center justify-center\">\n            <img \n              src=\"/assets/FamilyMart.png\" \n              alt=\"FamilyMart Logo\" \n              className=\"w-20 h-20 object-contain animate-pulse\"\n              style={{ animationDuration: '2s' }}\n            />\n          </div>\n          \n          {/* Outer rotating ring */}\n          <div className=\"absolute inset-0 -m-2 rounded-3xl border-4 border-blue-400/20 animate-spin\" style={{ animationDuration: '3s' }}></div>\n          \n          {/* Inner counter-rotating ring */}\n          <div className=\"absolute inset-0 m-1 rounded-3xl border-2 border-blue-300/30\" style={{ animation: 'spin 2s linear infinite reverse' }}></div>\n          \n          {/* Pulsing outer glow */}\n          <div className=\"absolute inset-0 -m-4 rounded-3xl bg-blue-500/10 animate-ping\" style={{ animationDuration: '2s' }}></div>\n        </div>\n        \n        {/* Loader Animation */}\n        <div className=\"scale-90\">\n          {getLoader()}\n        </div>\n        \n        {/* Message with better styling */}\n        <div className=\"text-center\">\n          <div className=\"text-xl font-bold text-white mb-2 tracking-wide\">\n            {message}\n          </div>\n          <div className=\"text-sm text-blue-200/90 font-medium transition-all duration-300\">\n            {tips[currentTip]}\n          </div>\n        </div>\n        \n        {/* Animated progress bar */}\n        <div className=\"w-72 space-y-2\">\n          <div className=\"h-1.5 bg-white/10 rounded-full overflow-hidden relative\">\n            <div \n              className=\"h-full bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600 rounded-full shadow-lg shadow-blue-500/50 transition-all duration-100 ease-linear\"\n              style={{ width: `${progress}%` }}\n            ></div>\n          </div>\n          <div className=\"flex justify-between text-xs text-blue-200/70\">\n            <span>{loadingStatus}</span>\n            <span className=\"font-mono font-bold\">{progress}%</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport function InlineLoading({ size = \"sm\", type = \"spinner\" }: { size?: \"sm\" | \"lg\"; type?: \"spinner\" | \"triple\" | \"particles\" }) {\n  if (type === \"triple\") {\n    return (\n      <div className=\"loading-triple-bounce\" data-testid=\"inline-loading\">\n        <div className=\"bounce\" />\n        <div className=\"bounce\" />\n        <div className=\"bounce\" />\n      </div>\n    );\n  }\n  \n  if (type === \"particles\") {\n    return <div className=\"loading-particles\" data-testid=\"inline-loading\" />;\n  }\n  \n  return (\n    <div className={`${size === \"lg\" ? \"loading-spinner-lg\" : \"loading-spinner\"}`} data-testid=\"inline-loading\" />\n  );\n}\n\nexport function LoadingDots({ type = \"wave\" }: { type?: \"dots\" | \"wave\" | \"triple\" }) {\n  if (type === \"wave\") {\n    return (\n      <div className=\"loading-wave\" data-testid=\"loading-dots\">\n        <div className=\"wave-dot\" />\n        <div className=\"wave-dot\" />\n        <div className=\"wave-dot\" />\n        <div className=\"wave-dot\" />\n        <div className=\"wave-dot\" />\n      </div>\n    );\n  }\n  \n  if (type === \"triple\") {\n    return (\n      <div className=\"loading-triple-bounce\" data-testid=\"loading-dots\">\n        <div className=\"bounce\" />\n        <div className=\"bounce\" />\n        <div className=\"bounce\" />\n      </div>\n    );\n  }\n  \n  return (\n    <span className=\"loading-dots\" data-testid=\"loading-dots\">\n      Loading\n    </span>\n  );\n}\n\n// Awesome loading showcase component\nexport function AwesomeLoadingShowcase() {\n  return (\n    <div className=\"grid grid-cols-2 md:grid-cols-3 gap-8 p-8 bg-card/50 rounded-lg border border-border\">\n      <div className=\"flex flex-col items-center gap-3\">\n        <div className=\"loading-morphing\" />\n        <span className=\"text-xs text-muted-foreground\">Morphing</span>\n      </div>\n      \n      <div className=\"flex flex-col items-center gap-3\">\n        <div className=\"loading-pulse-glow\" />\n        <span className=\"text-xs text-muted-foreground\">Pulse Glow</span>\n      </div>\n      \n      <div className=\"flex flex-col items-center gap-3\">\n        <div className=\"loading-orbit\" />\n        <span className=\"text-xs text-muted-foreground\">Orbit</span>\n      </div>\n      \n      <div className=\"flex flex-col items-center gap-3\">\n        <div className=\"loading-wave\">\n          <div className=\"wave-dot\" />\n          <div className=\"wave-dot\" />\n          <div className=\"wave-dot\" />\n          <div className=\"wave-dot\" />\n          <div className=\"wave-dot\" />\n        </div>\n        <span className=\"text-xs text-muted-foreground\">Wave</span>\n      </div>\n      \n      <div className=\"flex flex-col items-center gap-3\">\n        <div className=\"loading-particles\" />\n        <span className=\"text-xs text-muted-foreground\">Particles</span>\n      </div>\n      \n      <div className=\"flex flex-col items-center gap-3\">\n        <div className=\"loading-triple-bounce\">\n          <div className=\"bounce\" />\n          <div className=\"bounce\" />\n          <div className=\"bounce\" />\n        </div>\n        <span className=\"text-xs text-muted-foreground\">Triple Bounce</span>\n      </div>\n    </div>\n  );\n}\n\n","size_bytes":10624},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { insertTableRowSchema, insertTableColumnSchema, insertRouteOptimizationSchema, insertLayoutPreferencesSchema, insertPageSchema, insertSharedTableStateSchema, insertSavedShareLinkSchema, insertCustomTableSchema, insertCustomTableRowSchema, type RouteOptimizationRequest } from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { optimizeRoute } from \"./routeOptimizer\";\nimport { calculateTollPrice, calculateRoutesForDestinations } from \"./openrouteservice\";\n\n// UUID validation schema\nconst uuidSchema = z.string().uuid();\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Table rows routes\n  app.get(\"/api/table-rows\", async (req, res) => {\n    try {\n      const rows = await storage.getTableRows();\n      res.json(rows);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch table rows\" });\n    }\n  });\n\n  app.get(\"/api/table-rows/:id\", async (req, res) => {\n    try {\n      // Validate UUID parameter\n      const validationResult = uuidSchema.safeParse(req.params.id);\n      if (!validationResult.success) {\n        return res.status(400).json({ message: \"Invalid row ID format\" });\n      }\n      \n      const row = await storage.getTableRow(req.params.id);\n      if (!row) {\n        return res.status(404).json({ message: \"Row not found\" });\n      }\n      res.json(row);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch table row\" });\n    }\n  });\n\n  app.get(\"/api/ql-kitchen\", async (req, res) => {\n    try {\n      const row = await storage.getQlKitchenRow();\n      if (!row) {\n        return res.status(404).json({ message: \"QL Kitchen row not found\" });\n      }\n      res.json(row);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch QL Kitchen row\" });\n    }\n  });\n\n  app.post(\"/api/table-rows\", async (req, res) => {\n    try {\n      const validatedData = insertTableRowSchema.parse(req.body);\n      const row = await storage.createTableRow(validatedData);\n      res.status(201).json(row);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        res.status(500).json({ message: \"Failed to create table row\" });\n      }\n    }\n  });\n\n  app.patch(\"/api/table-rows/:id\", async (req, res) => {\n    try {\n      // Validate UUID parameter\n      const validationResult = uuidSchema.safeParse(req.params.id);\n      if (!validationResult.success) {\n        return res.status(400).json({ message: \"Invalid row ID format\" });\n      }\n      \n      // Normalize snake_case keys to camelCase for consistency\n      const normalizedBody = Object.fromEntries(\n        Object.entries(req.body).map(([key, value]) => {\n          const camelKey = key.replace(/_([a-z])/g, (match, letter) => letter.toUpperCase());\n          return [camelKey, value];\n        })\n      );\n\n      // Special validation for currency field (tngRoute)\n      if (normalizedBody.tngRoute !== undefined) {\n        const currencyValue = String(normalizedBody.tngRoute);\n        if (currencyValue !== \"\" && isNaN(Number(currencyValue))) {\n          return res.status(400).json({ \n            message: \"Invalid currency value\", \n            details: \"Currency value must be a number\" \n          });\n        }\n        // Format currency as decimal string with 2 decimal places if it's a number\n        if (currencyValue !== \"\" && !isNaN(Number(currencyValue))) {\n          normalizedBody.tngRoute = Number(currencyValue).toFixed(2);\n        }\n      }\n      \n      console.log('Attempting to update row with data:', JSON.stringify(normalizedBody, null, 2));\n      const updates = insertTableRowSchema.partial().parse(normalizedBody);\n      const row = await storage.updateTableRow(req.params.id, updates);\n      if (!row) {\n        return res.status(404).json({ message: \"Row not found\" });\n      }\n      res.json(row);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        console.error('Zod validation error:', JSON.stringify(error.errors, null, 2));\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        console.error(`Error updating row ${req.params.id}:`, error);\n        res.status(500).json({ message: \"Failed to update table row\" });\n      }\n    }\n  });\n\n  app.delete(\"/api/table-rows/:id\", async (req, res) => {\n    try {\n      // Validate UUID parameter\n      const validationResult = uuidSchema.safeParse(req.params.id);\n      if (!validationResult.success) {\n        return res.status(400).json({ message: \"Invalid row ID format\" });\n      }\n      \n      const success = await storage.deleteTableRow(req.params.id);\n      if (!success) {\n        return res.status(404).json({ message: \"Row not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete table row\" });\n    }\n  });\n\n  app.post(\"/api/table-rows/reorder\", async (req, res) => {\n    try {\n      const { rowIds } = req.body;\n      if (!Array.isArray(rowIds)) {\n        return res.status(400).json({ message: \"rowIds must be an array\" });\n      }\n      \n      // Validate all IDs are UUIDs\n      for (const id of rowIds) {\n        const validationResult = uuidSchema.safeParse(id);\n        if (!validationResult.success) {\n          return res.status(400).json({ message: \"All row IDs must be valid UUIDs\" });\n        }\n      }\n      const rows = await storage.reorderTableRows(rowIds);\n      res.json(rows);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to reorder table rows\" });\n    }\n  });\n\n  // Table columns routes\n  app.get(\"/api/table-columns\", async (req, res) => {\n    try {\n      const columns = await storage.getTableColumns();\n      res.json(columns);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch table columns\" });\n    }\n  });\n\n  app.post(\"/api/table-columns\", async (req, res) => {\n    try {\n      const validatedData = insertTableColumnSchema.parse(req.body);\n      const column = await storage.createTableColumn(validatedData);\n      res.status(201).json(column);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        res.status(500).json({ message: \"Failed to create table column\" });\n      }\n    }\n  });\n\n  app.patch(\"/api/table-columns/:id\", async (req, res) => {\n    try {\n      // Validate UUID parameter\n      const validationResult = uuidSchema.safeParse(req.params.id);\n      if (!validationResult.success) {\n        return res.status(400).json({ message: \"Invalid column ID format\" });\n      }\n      \n      const updates = insertTableColumnSchema.partial().parse(req.body);\n      const column = await storage.updateTableColumn(req.params.id, updates);\n      if (!column) {\n        return res.status(404).json({ message: \"Column not found\" });\n      }\n      res.json(column);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        res.status(500).json({ message: \"Failed to update table column\" });\n      }\n    }\n  });\n\n  app.post(\"/api/table-columns/reorder\", async (req, res) => {\n    try {\n      const { columnIds } = req.body;\n      if (!Array.isArray(columnIds)) {\n        return res.status(400).json({ message: \"columnIds must be an array\" });\n      }\n      \n      // Validate all IDs are UUIDs\n      for (const id of columnIds) {\n        const validationResult = uuidSchema.safeParse(id);\n        if (!validationResult.success) {\n          return res.status(400).json({ message: \"All column IDs must be valid UUIDs\" });\n        }\n      }\n      const columns = await storage.reorderTableColumns(columnIds);\n      res.json(columns);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to reorder table columns\" });\n    }\n  });\n\n  app.delete(\"/api/table-columns/:id\", async (req, res) => {\n    try {\n      // Validate UUID parameter\n      const validationResult = uuidSchema.safeParse(req.params.id);\n      if (!validationResult.success) {\n        return res.status(400).json({ message: \"Invalid column ID format\" });\n      }\n      \n      const success = await storage.deleteTableColumn(req.params.id);\n      if (!success) {\n        return res.status(404).json({ message: \"Column not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete table column\" });\n    }\n  });\n\n  // Add image to row\n  app.post(\"/api/table-rows/:id/images\", async (req, res) => {\n    try {\n      // Validate UUID parameter\n      const validationResult = uuidSchema.safeParse(req.params.id);\n      if (!validationResult.success) {\n        return res.status(400).json({ message: \"Invalid row ID format\" });\n      }\n      \n      const { imageUrl, caption } = req.body;\n      if (!imageUrl || typeof imageUrl !== 'string') {\n        return res.status(400).json({ message: \"imageUrl is required\" });\n      }\n\n      const row = await storage.getTableRow(req.params.id);\n      if (!row) {\n        return res.status(404).json({ message: \"Row not found\" });\n      }\n\n      // Check if image URL already exists to prevent duplicates\n      const existingImageUrls = row.images.map(img => img.url);\n      if (existingImageUrls.includes(imageUrl)) {\n        return res.status(400).json({ message: \"Image URL already exists for this row\" });\n      }\n\n      const newImage = {\n        url: imageUrl,\n        caption: caption && typeof caption === 'string' ? caption : \"\",\n        type: \"image\" as const,\n      };\n      const updatedImages = [...row.images, newImage];\n      const updatedRow = await storage.updateTableRow(req.params.id, { images: updatedImages });\n      res.json(updatedRow);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to add image to row\" });\n    }\n  });\n\n  // Update image in row\n  app.patch(\"/api/table-rows/:id/images/:imageIndex\", async (req, res) => {\n    try {\n      // Validate UUID parameter\n      const validationResult = uuidSchema.safeParse(req.params.id);\n      if (!validationResult.success) {\n        return res.status(400).json({ message: \"Invalid row ID format\" });\n      }\n      \n      const { imageUrl, caption } = req.body;\n      const imageIndex = parseInt(req.params.imageIndex);\n      \n      // Validate imageIndex is a valid integer\n      if (isNaN(imageIndex) || imageIndex < 0 || !Number.isInteger(imageIndex)) {\n        return res.status(400).json({ message: \"Image index must be a non-negative integer\" });\n      }\n\n      const row = await storage.getTableRow(req.params.id);\n      if (!row) {\n        return res.status(404).json({ message: \"Row not found\" });\n      }\n\n      if (imageIndex >= row.images.length) {\n        return res.status(400).json({ message: \"Invalid image index\" });\n      }\n\n      // Check if updating to a URL that already exists in another image\n      if (imageUrl !== undefined) {\n        const existingImageUrls = row.images.map((img, idx) => idx !== imageIndex ? img.url : null).filter(Boolean);\n        if (existingImageUrls.includes(imageUrl)) {\n          return res.status(400).json({ message: \"Image URL already exists for this row\" });\n        }\n      }\n\n      const updatedImages = [...row.images];\n      updatedImages[imageIndex] = {\n        url: imageUrl !== undefined ? imageUrl : updatedImages[imageIndex].url,\n        caption: caption !== undefined ? caption : updatedImages[imageIndex].caption,\n        type: updatedImages[imageIndex].type || \"image\",\n        thumbnail: updatedImages[imageIndex].thumbnail\n      };\n      \n      const updatedRow = await storage.updateTableRow(req.params.id, { images: updatedImages });\n      res.json(updatedRow);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update image\" });\n    }\n  });\n\n  // Delete image from row\n  app.delete(\"/api/table-rows/:id/images/:imageIndex?\", async (req, res) => {\n    try {\n      // Validate UUID parameter\n      const validationResult = uuidSchema.safeParse(req.params.id);\n      if (!validationResult.success) {\n        return res.status(400).json({ message: \"Invalid row ID format\" });\n      }\n      \n      const row = await storage.getTableRow(req.params.id);\n      if (!row) {\n        return res.status(404).json({ message: \"Row not found\" });\n      }\n\n      let updatedImages: typeof row.images;\n      if (req.params.imageIndex === undefined) {\n        // Delete all images\n        updatedImages = [];\n      } else {\n        // Delete specific image\n        const imageIndex = parseInt(req.params.imageIndex);\n        \n        // Validate imageIndex is a valid integer\n        if (isNaN(imageIndex) || imageIndex < 0 || !Number.isInteger(imageIndex)) {\n          return res.status(400).json({ message: \"Image index must be a non-negative integer\" });\n        }\n        \n        if (imageIndex >= row.images.length) {\n          return res.status(400).json({ message: \"Invalid image index\" });\n        }\n        updatedImages = row.images.filter((_, index) => index !== imageIndex);\n      }\n\n      const updatedRow = await storage.updateTableRow(req.params.id, { images: updatedImages });\n      res.json(updatedRow);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete image(s)\" });\n    }\n  });\n\n  // QR Image Proxy to handle CORS issues\n  app.get(\"/api/proxy-image\", async (req, res) => {\n    try {\n      const { url } = req.query;\n      \n      if (!url || typeof url !== 'string') {\n        return res.status(400).json({ error: \"URL parameter required\" });\n      }\n\n      // Security checks\n      if (!url.match(/^https?:\\/\\//)) {\n        return res.status(400).json({ error: \"Only HTTP/HTTPS URLs allowed\" });\n      }\n\n      if (url.length > 2000) {\n        return res.status(400).json({ error: \"URL too long\" });\n      }\n\n      // Fetch the image with timeout and size limit\n      const controller = new AbortController();\n      const timeout = setTimeout(() => controller.abort(), 5000);\n\n      const response = await fetch(url, {\n        signal: controller.signal,\n        headers: {\n          'User-Agent': 'QR-Scanner-Bot/1.0'\n        }\n      });\n\n      clearTimeout(timeout);\n\n      if (!response.ok) {\n        return res.status(response.status).json({ error: \"Failed to fetch image\" });\n      }\n\n      const contentType = response.headers.get('content-type');\n      if (!contentType || !contentType.startsWith('image/')) {\n        return res.status(415).json({ error: \"Not an image\" });\n      }\n\n      const contentLength = response.headers.get('content-length');\n      if (contentLength && parseInt(contentLength) > 10 * 1024 * 1024) {\n        return res.status(413).json({ error: \"Image too large\" });\n      }\n\n      // Set CORS headers and stream the image\n      res.set({\n        'Access-Control-Allow-Origin': '*',\n        'Content-Type': contentType,\n        'Cache-Control': 'public, max-age=300'\n      });\n\n      // Convert ReadableStream to Buffer and send\n      const buffer = await response.arrayBuffer();\n      res.send(Buffer.from(buffer));\n      \n    } catch (error: any) {\n      console.error(\"Proxy image error:\", error);\n      if (error.name === 'AbortError') {\n        res.status(408).json({ error: \"Request timeout\" });\n      } else {\n        res.status(500).json({ error: \"Internal server error\" });\n      }\n    }\n  });\n\n  // Calculate toll prices endpoint\n  app.post(\"/api/calculate-tolls\", async (req, res) => {\n    try {\n      const requestSchema = z.object({\n        rowIds: z.array(z.string().uuid()).optional(),\n      });\n\n      const validatedData = requestSchema.parse(req.body);\n\n      // Get rows to calculate tolls for\n      let rows;\n      if (validatedData.rowIds && validatedData.rowIds.length > 0) {\n        const allRows = await storage.getTableRows();\n        rows = allRows.filter(row => validatedData.rowIds!.includes(row.id));\n      } else {\n        rows = await storage.getTableRows();\n        // Filter out the QL Kitchen row (sortOrder -1)\n        rows = rows.filter(row => row.sortOrder !== -1);\n      }\n\n      // Calculate distances and toll prices for lorry-optimized routes\n      const routeData = await calculateRoutesForDestinations(rows);\n\n      // Update rows with distances and toll prices\n      for (const row of rows) {\n        const updates: any = {};\n        \n        if (routeData.distances[row.id] !== undefined) {\n          updates.kilometer = routeData.distances[row.id].toString();\n        }\n        \n        if (routeData.tollPrices[row.id] !== undefined) {\n          updates.tollPrice = routeData.tollPrices[row.id].toFixed(2);\n        }\n        \n        if (Object.keys(updates).length > 0) {\n          await storage.updateTableRow(row.id, updates);\n        }\n      }\n\n      res.json({ \n        success: true, \n        distances: routeData.distances,\n        tollPrices: routeData.tollPrices,\n        message: `Updated distances and toll prices for ${Object.keys(routeData.tollPrices).length} destinations`\n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid request data\", errors: error.errors });\n      } else {\n        console.error(\"Toll calculation error:\", error);\n        res.status(500).json({ message: \"Failed to calculate toll prices\" });\n      }\n    }\n  });\n\n  // Route Optimization endpoint\n  app.post(\"/api/optimize-route\", async (req, res) => {\n    try {\n      const requestSchema = z.object({\n        rowIds: z.array(z.string().uuid()).optional(),\n        startLocation: z.object({\n          latitude: z.number(),\n          longitude: z.number(),\n        }).optional(),\n        algorithm: z.enum(['nearest_neighbor', 'genetic', 'simulated_annealing']).optional(),\n        prioritizeTrip: z.boolean().optional(),\n        maxDistance: z.number().optional(),\n        vehicleSpecs: z.object({\n          type: z.string(),\n          fuelType: z.string(),\n          tollClass: z.number(),\n        }).optional(),\n      });\n\n      const validatedData = requestSchema.parse(req.body) as RouteOptimizationRequest;\n\n      // Get all rows or specific rows\n      let rows;\n      if (validatedData.rowIds && validatedData.rowIds.length > 0) {\n        const allRows = await storage.getTableRows();\n        rows = allRows.filter(row => validatedData.rowIds!.includes(row.id));\n      } else {\n        rows = await storage.getTableRows();\n        // Filter out the QL Kitchen row (sortOrder -1)\n        rows = rows.filter(row => row.sortOrder !== -1);\n      }\n\n      // Filter to only rows with valid coordinates\n      const validRows = rows.filter(row => \n        row.latitude && \n        row.longitude && \n        !isNaN(parseFloat(row.latitude)) && \n        !isNaN(parseFloat(row.longitude)) &&\n        parseFloat(row.latitude) !== 0 && \n        parseFloat(row.longitude) !== 0\n      );\n\n      if (validRows.length < 2) {\n        return res.status(400).json({ \n          message: `At least 2 locations with valid coordinates are required for optimization. Found ${validRows.length}.` \n        });\n      }\n\n      // Run optimization on valid rows only\n      const result = optimizeRoute(\n        validRows,\n        validatedData.algorithm || 'nearest_neighbor',\n        validatedData.startLocation,\n        validatedData.prioritizeDelivery || false\n      );\n\n      res.json(result);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid request data\", errors: error.errors });\n      } else if (error instanceof Error) {\n        res.status(400).json({ message: error.message });\n      } else {\n        console.error(\"Route optimization error:\", error);\n        res.status(500).json({ message: \"Failed to optimize route\" });\n      }\n    }\n  });\n\n  // Save route optimization result\n  app.post(\"/api/save-route\", async (req, res) => {\n    try {\n      const validatedData = insertRouteOptimizationSchema.parse(req.body);\n      const savedRoute = await storage.saveRoute(validatedData);\n      res.status(201).json(savedRoute);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        console.error(\"Save route error:\", error);\n        res.status(500).json({ message: \"Failed to save route\" });\n      }\n    }\n  });\n\n  // Get all saved routes\n  app.get(\"/api/saved-routes\", async (req, res) => {\n    try {\n      const savedRoutes = await storage.getSavedRoutes();\n      res.json(savedRoutes);\n    } catch (error) {\n      console.error(\"Get saved routes error:\", error);\n      res.status(500).json({ message: \"Failed to fetch saved routes\" });\n    }\n  });\n\n  // Get a specific saved route\n  app.get(\"/api/saved-routes/:id\", async (req, res) => {\n    try {\n      const validationResult = uuidSchema.safeParse(req.params.id);\n      if (!validationResult.success) {\n        return res.status(400).json({ message: \"Invalid route ID format\" });\n      }\n\n      const savedRoute = await storage.getSavedRoute(req.params.id);\n      if (!savedRoute) {\n        return res.status(404).json({ message: \"Saved route not found\" });\n      }\n      res.json(savedRoute);\n    } catch (error) {\n      console.error(\"Get saved route error:\", error);\n      res.status(500).json({ message: \"Failed to fetch saved route\" });\n    }\n  });\n\n  // Delete a saved route\n  app.delete(\"/api/saved-routes/:id\", async (req, res) => {\n    try {\n      const validationResult = uuidSchema.safeParse(req.params.id);\n      if (!validationResult.success) {\n        return res.status(400).json({ message: \"Invalid route ID format\" });\n      }\n\n      const success = await storage.deleteSavedRoute(req.params.id);\n      if (!success) {\n        return res.status(404).json({ message: \"Saved route not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Delete saved route error:\", error);\n      res.status(500).json({ message: \"Failed to delete saved route\" });\n    }\n  });\n\n  // Layout preferences routes\n  app.get(\"/api/layout\", async (req, res) => {\n    try {\n      const userIdSchema = z.string().min(1, \"userId cannot be empty\");\n      const validationResult = userIdSchema.safeParse(req.query.userId);\n      \n      if (!validationResult.success) {\n        return res.status(400).json({ \n          message: \"userId is required\",\n          errors: validationResult.error.errors \n        });\n      }\n      \n      const userId = validationResult.data;\n      const layout = await storage.getLayoutPreferences(userId);\n      \n      if (!layout) {\n        return res.status(404).json({ message: \"No saved layout found\" });\n      }\n      \n      res.json(layout);\n    } catch (error) {\n      console.error(\"Get layout preferences error:\", error);\n      res.status(500).json({ message: \"Failed to fetch layout preferences\" });\n    }\n  });\n\n  app.post(\"/api/layout\", async (req, res) => {\n    try {\n      const userIdSchema = z.string().min(1, \"userId cannot be empty\");\n      const userIdValidation = userIdSchema.safeParse(req.body.userId);\n      \n      if (!userIdValidation.success) {\n        return res.status(400).json({ \n          message: \"userId is required\",\n          errors: userIdValidation.error.errors \n        });\n      }\n      \n      const userId = userIdValidation.data;\n      const { userId: _, ...layoutData } = req.body;\n      const validatedData = insertLayoutPreferencesSchema.parse(layoutData);\n      const layout = await storage.saveLayoutPreferences(userId, validatedData);\n      res.status(200).json(layout);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        console.error(\"Save layout preferences error:\", error);\n        res.status(500).json({ message: \"Failed to save layout preferences\" });\n      }\n    }\n  });\n\n  // Pages routes\n  app.get(\"/api/pages\", async (req, res) => {\n    try {\n      const pages = await storage.getPages();\n      res.json(pages);\n    } catch (error) {\n      console.error(\"Get pages error:\", error);\n      res.status(500).json({ message: \"Failed to fetch pages\" });\n    }\n  });\n\n  app.get(\"/api/pages/:id\", async (req, res) => {\n    try {\n      const validationResult = uuidSchema.safeParse(req.params.id);\n      if (!validationResult.success) {\n        return res.status(400).json({ message: \"Invalid page ID format\" });\n      }\n      \n      const page = await storage.getPage(req.params.id);\n      if (!page) {\n        return res.status(404).json({ message: \"Page not found\" });\n      }\n      res.json(page);\n    } catch (error) {\n      console.error(\"Get page error:\", error);\n      res.status(500).json({ message: \"Failed to fetch page\" });\n    }\n  });\n\n  app.post(\"/api/pages\", async (req, res) => {\n    try {\n      const validatedData = insertPageSchema.parse(req.body);\n      const page = await storage.createPage(validatedData);\n      res.status(201).json(page);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        console.error(\"Create page error:\", error);\n        res.status(500).json({ message: \"Failed to create page\" });\n      }\n    }\n  });\n\n  app.patch(\"/api/pages/:id\", async (req, res) => {\n    try {\n      const validationResult = uuidSchema.safeParse(req.params.id);\n      if (!validationResult.success) {\n        return res.status(400).json({ message: \"Invalid page ID format\" });\n      }\n      \n      const updates = insertPageSchema.partial().parse(req.body);\n      const page = await storage.updatePage(req.params.id, updates);\n      if (!page) {\n        return res.status(404).json({ message: \"Page not found\" });\n      }\n      res.json(page);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        console.error(\"Update page error:\", error);\n        res.status(500).json({ message: \"Failed to update page\" });\n      }\n    }\n  });\n\n  app.delete(\"/api/pages/:id\", async (req, res) => {\n    try {\n      const validationResult = uuidSchema.safeParse(req.params.id);\n      if (!validationResult.success) {\n        return res.status(400).json({ message: \"Invalid page ID format\" });\n      }\n      \n      const success = await storage.deletePage(req.params.id);\n      if (!success) {\n        return res.status(404).json({ message: \"Page not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Delete page error:\", error);\n      res.status(500).json({ message: \"Failed to delete page\" });\n    }\n  });\n\n  // Global settings routes\n  app.get(\"/api/global-settings/:key\", async (req, res) => {\n    try {\n      const key = req.params.key;\n      const setting = await storage.getGlobalSetting(key);\n      if (!setting) {\n        // Return default value for footerCompanyName if not found\n        if (key === 'footerCompanyName') {\n          return res.json({ key, value: 'Vending Machine' });\n        }\n        return res.status(404).json({ message: \"Setting not found\" });\n      }\n      res.json(setting);\n    } catch (error) {\n      console.error(\"Get global setting error:\", error);\n      res.status(500).json({ message: \"Failed to fetch global setting\" });\n    }\n  });\n\n  app.post(\"/api/global-settings\", async (req, res) => {\n    try {\n      const schema = z.object({\n        key: z.string(),\n        value: z.string(),\n      });\n      const { key, value } = schema.parse(req.body);\n      const setting = await storage.setGlobalSetting(key, value);\n      res.json(setting);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        console.error(\"Set global setting error:\", error);\n        res.status(500).json({ message: \"Failed to save global setting\" });\n      }\n    }\n  });\n\n  // Shared table state routes\n  app.post(\"/api/share-table\", async (req, res) => {\n    try {\n      const validatedData = insertSharedTableStateSchema.parse(req.body);\n      const sharedState = await storage.createSharedTableState(validatedData);\n      res.status(201).json(sharedState);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        console.error(\"Create shared table state error:\", error);\n        res.status(500).json({ message: \"Failed to create shared table state\" });\n      }\n    }\n  });\n\n  app.get(\"/api/share-table/:shareId\", async (req, res) => {\n    try {\n      const shareId = req.params.shareId;\n      const sharedState = await storage.getSharedTableState(shareId);\n      if (!sharedState) {\n        return res.status(404).json({ message: \"Shared table state not found\" });\n      }\n      res.json(sharedState);\n    } catch (error) {\n      console.error(\"Get shared table state error:\", error);\n      res.status(500).json({ message: \"Failed to fetch shared table state\" });\n    }\n  });\n\n  // Saved share links routes\n  app.get(\"/api/saved-share-links\", async (req, res) => {\n    try {\n      const links = await storage.getSavedShareLinks();\n      res.json(links);\n    } catch (error) {\n      console.error(\"Get saved share links error:\", error);\n      res.status(500).json({ message: \"Failed to fetch saved share links\" });\n    }\n  });\n\n  app.post(\"/api/saved-share-links\", async (req, res) => {\n    try {\n      const validatedData = insertSavedShareLinkSchema.parse(req.body);\n      const savedLink = await storage.createSavedShareLink(validatedData);\n      res.status(201).json(savedLink);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        console.error(\"Create saved share link error:\", error);\n        res.status(500).json({ message: \"Failed to save share link\" });\n      }\n    }\n  });\n\n  app.patch(\"/api/saved-share-links/:id/remark\", async (req, res) => {\n    try {\n      const schema = z.object({\n        remark: z.string(),\n      });\n      const { remark } = schema.parse(req.body);\n      const updated = await storage.updateSavedShareLinkRemark(req.params.id, remark);\n      if (!updated) {\n        return res.status(404).json({ message: \"Saved share link not found\" });\n      }\n      res.json(updated);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        console.error(\"Update saved share link remark error:\", error);\n        res.status(500).json({ message: \"Failed to update remark\" });\n      }\n    }\n  });\n\n  app.delete(\"/api/saved-share-links/:id\", async (req, res) => {\n    try {\n      const success = await storage.deleteSavedShareLink(req.params.id);\n      if (!success) {\n        return res.status(404).json({ message: \"Saved share link not found\" });\n      }\n      res.json({ message: \"Saved share link deleted successfully\" });\n    } catch (error) {\n      console.error(\"Delete saved share link error:\", error);\n      res.status(500).json({ message: \"Failed to delete saved share link\" });\n    }\n  });\n\n  // Custom Tables routes\n  app.get(\"/api/custom-tables\", async (req, res) => {\n    try {\n      const tables = await storage.getCustomTables();\n      res.json(tables);\n    } catch (error) {\n      console.error(\"Get custom tables error:\", error);\n      res.status(500).json({ message: \"Failed to fetch custom tables\" });\n    }\n  });\n\n  app.get(\"/api/custom-tables/:id\", async (req, res) => {\n    try {\n      const table = await storage.getCustomTable(req.params.id);\n      if (!table) {\n        return res.status(404).json({ message: \"Custom table not found\" });\n      }\n      res.json(table);\n    } catch (error) {\n      console.error(\"Get custom table error:\", error);\n      res.status(500).json({ message: \"Failed to fetch custom table\" });\n    }\n  });\n\n  app.get(\"/api/custom-tables/:id/rows\", async (req, res) => {\n    try {\n      const rows = await storage.getCustomTableRows(req.params.id);\n      res.json(rows);\n    } catch (error) {\n      console.error(\"Get custom table rows error:\", error);\n      res.status(500).json({ message: \"Failed to fetch custom table rows\" });\n    }\n  });\n\n  app.get(\"/api/custom-tables/share/:shareId\", async (req, res) => {\n    try {\n      const table = await storage.getCustomTableByShareId(req.params.shareId);\n      if (!table) {\n        return res.status(404).json({ message: \"Custom table not found\" });\n      }\n      res.json(table);\n    } catch (error) {\n      console.error(\"Get custom table by shareId error:\", error);\n      res.status(500).json({ message: \"Failed to fetch custom table\" });\n    }\n  });\n\n  app.post(\"/api/custom-tables\", async (req, res) => {\n    try {\n      const { name, description, rowIds } = req.body;\n      \n      // Validate required fields\n      if (!name || !rowIds || !Array.isArray(rowIds) || rowIds.length === 0) {\n        return res.status(400).json({ message: \"Name and at least one row ID are required\" });\n      }\n\n      // Generate unique share ID\n      const shareId = Math.random().toString(36).substring(2, 8);\n      \n      // Create custom table\n      const tableData = insertCustomTableSchema.parse({\n        name,\n        shareId,\n        description: description || \"\",\n      });\n      \n      const customTable = await storage.createCustomTable(tableData, rowIds);\n      res.status(201).json(customTable);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        console.error(\"Create custom table error:\", error);\n        res.status(500).json({ message: \"Failed to create custom table\" });\n      }\n    }\n  });\n\n  app.patch(\"/api/custom-tables/:id\", async (req, res) => {\n    try {\n      const updates = insertCustomTableSchema.partial().parse(req.body);\n      const table = await storage.updateCustomTable(req.params.id, updates);\n      if (!table) {\n        return res.status(404).json({ message: \"Custom table not found\" });\n      }\n      res.json(table);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      } else {\n        console.error(\"Update custom table error:\", error);\n        res.status(500).json({ message: \"Failed to update custom table\" });\n      }\n    }\n  });\n\n  app.delete(\"/api/custom-tables/:id\", async (req, res) => {\n    try {\n      const success = await storage.deleteCustomTable(req.params.id);\n      if (!success) {\n        return res.status(404).json({ message: \"Custom table not found\" });\n      }\n      res.json({ message: \"Custom table deleted successfully\" });\n    } catch (error) {\n      console.error(\"Delete custom table error:\", error);\n      res.status(500).json({ message: \"Failed to delete custom table\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":35239},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/route-optimization-modal.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { RouteOptimizationRequest, RouteOptimizationResponse, TableRow } from \"@shared/schema\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Loader2, TrendingDown, Clock, Droplets, Route, Zap, CheckCircle2 } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface RouteOptimizationModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  rows: TableRow[];\n  selectedRowIds?: string[];\n}\n\nexport function RouteOptimizationModal({\n  open,\n  onOpenChange,\n  rows,\n  selectedRowIds,\n}: RouteOptimizationModalProps) {\n  const [algorithm, setAlgorithm] = useState<'nearest_neighbor' | 'genetic' | 'simulated_annealing'>('nearest_neighbor');\n  const [prioritizeDelivery, setPrioritizeDelivery] = useState(false);\n  const [optimizationResult, setOptimizationResult] = useState<RouteOptimizationResponse | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const optimizationMutation = useMutation({\n    mutationFn: async () => {\n      const requestData: RouteOptimizationRequest = {\n        ...(selectedRowIds && selectedRowIds.length > 0 ? { rowIds: selectedRowIds } : {}),\n        algorithm,\n        prioritizeDelivery,\n        vehicleSpecs: {\n          type: \"lorry refrigerator 1 ton\",\n          fuelType: \"diesel\",\n          tollClass: 1,\n        },\n      };\n      \n      const response = await apiRequest(\"POST\", \"/api/optimize-route\", requestData);\n      return await response.json();\n    },\n    onSuccess: (data: RouteOptimizationResponse) => {\n      // Validate response structure\n      if (!data || !Array.isArray(data.optimizedOrder) || data.optimizedOrder.length === 0) {\n        toast({\n          title: \"Invalid Response\",\n          description: \"The optimization response was invalid. Please try again.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      setOptimizationResult(data);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Optimization Failed\",\n        description: error.message || \"Failed to optimize route. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const applyOptimizationMutation = useMutation({\n    mutationFn: async () => {\n      if (!optimizationResult) return;\n      \n      // Build full reorder array: optimized rows first, then remaining rows in their current order\n      const optimizedIds = new Set(optimizationResult.optimizedOrder);\n      const remainingRows = rows\n        .filter(row => !optimizedIds.has(row.id))\n        .sort((a, b) => a.sortOrder - b.sortOrder)\n        .map(row => row.id);\n      \n      const fullOrderedIds = [...optimizationResult.optimizedOrder, ...remainingRows];\n      \n      // Reorder rows with full list\n      const response = await apiRequest(\"POST\", \"/api/table-rows/reorder\", { rowIds: fullOrderedIds });\n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/table-rows\"] });\n      toast({\n        title: \"Route Applied\",\n        description: \"The optimized route has been applied successfully!\",\n      });\n      handleClose();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to Apply Route\",\n        description: error.message || \"Failed to apply the optimized route. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleOptimize = () => {\n    setOptimizationResult(null);\n    optimizationMutation.mutate();\n  };\n\n  const handleApply = () => {\n    applyOptimizationMutation.mutate();\n  };\n\n  const handleClose = () => {\n    setOptimizationResult(null);\n    onOpenChange(false);\n  };\n\n  const getAlgorithmDescription = (algo: string) => {\n    switch (algo) {\n      case 'nearest_neighbor':\n        return 'Fast and efficient. Best for most routes. Finds nearby stops first.';\n      case 'genetic':\n        return 'AI-powered evolution. Best for complex routes with many stops.';\n      case 'simulated_annealing':\n        return 'Balanced approach. Good for medium-sized routes with obstacles.';\n      default:\n        return '';\n    }\n  };\n\n  const rowsToOptimize = selectedRowIds && selectedRowIds.length > 0\n    ? rows.filter(row => selectedRowIds.includes(row.id) && row.sortOrder !== -1)\n    : rows.filter(row => row.sortOrder !== -1);\n\n  const validRows = rowsToOptimize.filter(\n    row => row.latitude && row.longitude && parseFloat(row.latitude) !== 0 && parseFloat(row.longitude) !== 0\n  );\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2m max-h-[90vh] overflow-hidden flex flex-col bg-gradient-to-br from-background/95 via-background/98 to-background dark:from-black/95 dark:via-black/98 dark:to-black border-2 border-blue-500/20 dark:border-blue-400/20 transition-smooth\" data-testid=\"modal-route-optimization\">\n        <DialogHeader className=\"flex-shrink-0\">\n          <DialogTitle className=\"text-1m font-semibold flex items-center gap-2 text-blue-600 dark:text-blue-400\">\n            <Route className=\"w-6 h-6\" />\n            AI Route Optimization\n          </DialogTitle>\n          <DialogDescription className=\"text-base\">\n            Optimize your delivery route to save time, fuel, and distance using advanced AI algorithms.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"overflow-y-auto flex-1 -mx-6 px-6\">\n        {!optimizationResult ? (\n          <div className=\"space-y-6 mt-4\">\n            <div className=\"bg-blue-50/50 dark:bg-blue-950/30 p-4 rounded-lg border border-blue-200 dark:border-blue-800\">\n              <div className=\"flex items-start gap-3\">\n                <Zap className=\"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5\" />\n                <div>\n                  <h4 className=\"font-semibold text-blue-900 dark:text-blue-100 mb-1\">\n                    {validRows.length} stops ready to optimize\n                  </h4>\n                  <p className=\"text-sm text-slate-500 dark:text-slate-400\">\n                    {selectedRowIds && selectedRowIds.length > 0\n                      ? `Optimizing ${validRows.length} selected locations with valid coordinates`\n                      : `Optimizing all ${validRows.length} locations with valid coordinates`}\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-4\">\n              <div>\n                <Label className=\"text-base font-semibold mb-3 block\">Choose Algorithm</Label>\n                <RadioGroup value={algorithm} onValueChange={(value: any) => setAlgorithm(value)} className=\"space-y-3\">\n                  <div className=\"flex items-start space-x-3 p-3 rounded-lg border hover:bg-accent transition-colors\" data-testid=\"radio-algorithm-nearest-neighbor\">\n                    <RadioGroupItem value=\"nearest_neighbor\" id=\"nearest_neighbor\" />\n                    <div className=\"flex-1\">\n                      <Label htmlFor=\"nearest_neighbor\" className=\"font-medium cursor-pointer\">\n                        Nearest Neighbor (Recommended)\n                      </Label>\n                      <p className=\"text-sm text-muted-foreground mt-1\">\n                        {getAlgorithmDescription('nearest_neighbor')}\n                      </p>\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-start space-x-3 p-3 rounded-lg border hover:bg-accent transition-colors\" data-testid=\"radio-algorithm-genetic\">\n                    <RadioGroupItem value=\"genetic\" id=\"genetic\" />\n                    <div className=\"flex-1\">\n                      <Label htmlFor=\"genetic\" className=\"font-medium cursor-pointer\">\n                        Genetic Algorithm (Advanced)\n                      </Label>\n                      <p className=\"text-sm text-muted-foreground mt-1\">\n                        {getAlgorithmDescription('genetic')}\n                      </p>\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-start space-x-3 p-3 rounded-lg border hover:bg-accent transition-colors\" data-testid=\"radio-algorithm-simulated-annealing\">\n                    <RadioGroupItem value=\"simulated_annealing\" id=\"simulated_annealing\" />\n                    <div className=\"flex-1\">\n                      <Label htmlFor=\"simulated_annealing\" className=\"font-medium cursor-pointer\">\n                        Simulated Annealing\n                      </Label>\n                      <p className=\"text-sm text-muted-foreground mt-1\">\n                        {getAlgorithmDescription('simulated_annealing')}\n                      </p>\n                    </div>\n                  </div>\n                </RadioGroup>\n              </div>\n\n              <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg border\">\n                <div className=\"flex-1\">\n                  <Label htmlFor=\"prioritize-delivery\" className=\"font-medium cursor-pointer\">\n                    Prioritize Delivery Grouping\n                  </Label>\n                  <p className=\"text-sm text-muted-foreground mt-1\">\n                    Group locations with the same delivery type together\n                  </p>\n                </div>\n                <Switch\n                  id=\"prioritize-delivery\"\n                  checked={prioritizeDelivery}\n                  onCheckedChange={setPrioritizeDelivery}\n                  data-testid=\"switch-prioritize-delivery\"\n                />\n              </div>\n            </div>\n\n            <div className=\"flex gap-3 pt-4\">\n              <Button\n                onClick={handleOptimize}\n                disabled={optimizationMutation.isPending || validRows.length < 2}\n                variant=\"outline\"\n                className=\"flex-1\"\n                size=\"lg\"\n                data-testid=\"button-optimize\"\n              >\n                {optimizationMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                    Optimizing...\n                  </>\n                ) : (\n                  <>\n                    <Zap className=\"w-4 h-4 mr-2\" />\n                    Optimize Route\n                  </>\n                )}\n              </Button>\n              <Button\n                variant=\"outline\"\n                onClick={handleClose}\n                disabled={optimizationMutation.isPending}\n                className=\"border-red-600 text-red-600 hover:bg-red-50 dark:border-red-500 dark:text-red-500 dark:hover:bg-red-950/30\"\n                data-testid=\"button-cancel\"\n              >\n                Cancel\n              </Button>\n            </div>\n          </div>\n        ) : (\n          <div className=\"space-y-6 mt-4\">\n            <div className=\"bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-950/30 dark:to-blue-950/30 p-6 rounded-lg border-2 border-green-500/30 dark:border-green-400/30\">\n              <div className=\"flex items-center gap-3 mb-4\">\n                <CheckCircle2 className=\"w-6 h-6 text-green-600 dark:text-green-400\" />\n                <h3 className=\"text-xl font-bold text-green-900 dark:text-green-100\">\n                  Optimization Complete!\n                </h3>\n              </div>\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                <div className=\"bg-white/60 dark:bg-black/40 p-4 rounded-lg\" data-testid=\"stat-distance-saved\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <TrendingDown className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\n                    <span className=\"text-sm font-medium text-muted-foreground\">Distance</span>\n                  </div>\n                  <p className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">\n                    -{optimizationResult.distanceSaved.toFixed(1)} km\n                  </p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    {optimizationResult.optimizationFactors.distanceReduction.toFixed(1)}% reduction\n                  </p>\n                </div>\n\n                <div className=\"bg-white/60 dark:bg-black/40 p-4 rounded-lg\" data-testid=\"stat-time-saved\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <Clock className=\"w-5 h-5 text-purple-600 dark:text-purple-400\" />\n                    <span className=\"text-sm font-medium text-muted-foreground\">Time</span>\n                  </div>\n                  <p className=\"text-2xl font-bold text-purple-600 dark:text-purple-400\">\n                    {optimizationResult.timeSaved.toFixed(0)} min\n                  </p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">saved per trip</p>\n                </div>\n\n                <div className=\"bg-white/60 dark:bg-black/40 p-4 rounded-lg\" data-testid=\"stat-fuel-saved\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <Droplets className=\"w-5 h-5 text-green-600 dark:text-green-400\" />\n                    <span className=\"text-sm font-medium text-muted-foreground\">Fuel</span>\n                  </div>\n                  <p className=\"text-2xl font-bold text-green-600 dark:text-green-400\">\n                    {optimizationResult.fuelSaved.toFixed(2)} L\n                  </p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">less consumption</p>\n                </div>\n\n                <div className=\"bg-white/60 dark:bg-black/40 p-4 rounded-lg\" data-testid=\"stat-optimized-distance\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <Route className=\"w-5 h-5 text-orange-600 dark:text-orange-400\" />\n                    <span className=\"text-sm font-medium text-muted-foreground\">New Total</span>\n                  </div>\n                  <p className=\"text-2xl font-bold text-orange-600 dark:text-orange-400\">\n                    {optimizationResult.optimizedDistance.toFixed(1)} km\n                  </p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    from {optimizationResult.originalDistance.toFixed(1)} km\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-muted/30 p-4 rounded-lg border\">\n              <h4 className=\"font-semibold mb-2 flex items-center gap-2\">\n                <Zap className=\"w-4 h-4\" />\n                Algorithm Used\n              </h4>\n              <p className=\"text-sm text-muted-foreground\">\n                {optimizationResult.algorithm === 'nearest_neighbor' && 'Nearest Neighbor with 2-Opt optimization'}\n                {optimizationResult.algorithm === 'genetic' && 'Genetic Algorithm with population-based evolution'}\n                {optimizationResult.algorithm === 'simulated_annealing' && 'Simulated Annealing with probabilistic search'}\n              </p>\n            </div>\n\n            <div className=\"flex gap-3 pt-4\">\n              <Button\n                onClick={handleApply}\n                disabled={applyOptimizationMutation.isPending}\n                className=\"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700\"\n                size=\"lg\"\n                data-testid=\"button-apply-optimization\"\n              >\n                {applyOptimizationMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                    Applying...\n                  </>\n                ) : (\n                  <>\n                    <CheckCircle2 className=\"w-4 h-4 mr-2\" />\n                    Apply Optimized Route\n                  </>\n                )}\n              </Button>\n              <Button\n                variant=\"outline\"\n                onClick={handleClose}\n                disabled={applyOptimizationMutation.isPending}\n                data-testid=\"button-close\"\n              >\n                Close\n              </Button>\n            </div>\n          </div>\n        )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":16551},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/theme-provider.tsx":{"content":"import { createContext, useContext, useEffect, useState, ReactNode } from 'react';\n\ntype Theme = 'light' | 'dark';\n\ninterface ThemeContextType {\n  theme: Theme;\n  toggleTheme: () => void;\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nexport function ThemeProvider({ children }: { children: ReactNode }) {\n  const [theme, setTheme] = useState<Theme>(() => {\n    const savedTheme = localStorage.getItem('theme') as Theme;\n    return savedTheme || 'light';\n  });\n\n  useEffect(() => {\n    const root = document.documentElement;\n    \n    if (theme === 'dark') {\n      root.classList.add('dark');\n    } else {\n      root.classList.remove('dark');\n    }\n    \n    localStorage.setItem('theme', theme);\n  }, [theme]);\n\n  const toggleTheme = () => {\n    setTheme(prevTheme => prevTheme === 'light' ? 'dark' : 'light');\n  };\n\n  return (\n    <ThemeContext.Provider value={{ theme, toggleTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (context === undefined) {\n    throw new Error('useTheme must be used within a ThemeProvider');\n  }\n  return context;\n}\n","size_bytes":1171},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        xs: \"h-7 rounded-md px-2 text-xs\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1944},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\nexport function getUserId(): string {\n  const USER_ID_KEY = 'table_app_user_id';\n  \n  let userId = localStorage.getItem(USER_ID_KEY);\n  \n  if (!userId) {\n    userId = `user_${Date.now()}_${Math.random().toString(36).substring(2, 15)}`;\n    localStorage.setItem(USER_ID_KEY, userId);\n  }\n  \n  return userId;\n}\n","size_bytes":476},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/info-modal.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogTrigger, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Info, ListChecks, QrCode, ExternalLink, CheckCircle, Save, X, FileText, Loader2 } from \"lucide-react\";\nimport { SiGooglemaps, SiWaze } from \"react-icons/si\";\nimport { MiniMap } from \"@/components/mini-map\";\nimport { SlidingDescription } from \"@/components/sliding-description\";\nimport { EditableDescriptionList } from \"@/components/editable-description-list\";\nimport QrScanner from \"qr-scanner\";\n\ninterface InfoModalProps {\n  info: string;\n  rowId: string;\n  code?: string;\n  route?: string;\n  location?: string;\n  latitude?: string;\n  longitude?: string;\n  qrCode?: string;\n  no?: number;\n  markerColor?: string;\n  onUpdateRow?: (updates: any) => void;\n  editMode?: boolean;\n  allRows?: any[];\n  iconType?: 'info' | 'filetext';\n}\n\nexport function InfoModal({ info, rowId, code, route, location, latitude, longitude, qrCode, no, markerColor, onUpdateRow, editMode = false, allRows = [], iconType = 'info' }: InfoModalProps) {\n  const [open, setOpen] = useState(false);\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\n  const [scannedResult, setScannedResult] = useState<string>(\"\");\n  const [isScanning, setIsScanning] = useState(false);\n  const [showChecklistConfirm, setShowChecklistConfirm] = useState(false);\n  const [showNavigationConfirm, setShowNavigationConfirm] = useState(false);\n  const [navigationType, setNavigationType] = useState<'google' | 'waze'>('google');\n  const [showUrlConfirm, setShowUrlConfirm] = useState(false);\n  const [urlToOpen, setUrlToOpen] = useState<string>(\"\");\n  const [showSaveConfirm, setShowSaveConfirm] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n  const [showSuccessMessage, setShowSuccessMessage] = useState(false);\n  \n  // State for tracking edits\n  const [originalData, setOriginalData] = useState({ info: \"\", qrCode: \"\", latitude: \"\", longitude: \"\", markerColor: \"\" });\n  const [currentData, setCurrentData] = useState({ info: \"\", qrCode: \"\", latitude: \"\", longitude: \"\", markerColor: \"\" });\n  \n  // Initialize data when modal opens\n  useEffect(() => {\n    if (open) {\n      const data = {\n        info: info || \"\",\n        qrCode: qrCode || \"\",\n        latitude: latitude || \"\",\n        longitude: longitude || \"\",\n        markerColor: markerColor || \"#3388ff\"\n      };\n      setOriginalData(data);\n      setCurrentData(data);\n    }\n  }, [open, info, qrCode, latitude, longitude, markerColor]);\n  \n  // Check if there are any changes\n  const hasChanges = () => {\n    return (\n      currentData.info !== originalData.info ||\n      currentData.qrCode !== originalData.qrCode ||\n      currentData.latitude !== originalData.latitude ||\n      currentData.longitude !== originalData.longitude ||\n      currentData.markerColor !== originalData.markerColor\n    );\n  };\n\n  // Format code to 4 digits with leading zeros\n  const formatCode = (codeValue?: string) => {\n    if (!codeValue) return '0000';\n    const numericCode = parseInt(codeValue.replace(/\\D/g, ''), 10) || 0;\n    return numericCode.toString().padStart(4, '0');\n  };\n\n  const handleEditClick = () => {\n    setShowChecklistConfirm(true);\n  };\n\n  const handleConfirmEditClick = () => {\n    const formattedCode = formatCode(code);\n    const editUrl = `https://fmvending.web.app/refill-service/M${formattedCode}`;\n    window.open(editUrl, '_blank');\n    setShowChecklistConfirm(false);\n  };\n\n  const handleDirectionClick = () => {\n    setNavigationType('google');\n    setShowNavigationConfirm(true);\n  };\n\n  const handleConfirmDirectionClick = () => {\n    if (latitude && longitude && !isNaN(parseFloat(latitude)) && !isNaN(parseFloat(longitude))) {\n      const directionsUrl = `https://www.google.com/maps/dir/?api=1&destination=${latitude},${longitude}`;\n      window.open(directionsUrl, '_blank');\n    }\n    setShowNavigationConfirm(false);\n  };\n\n  const handleWazeClick = () => {\n    setNavigationType('waze');\n    setShowNavigationConfirm(true);\n  };\n\n  const handleConfirmWazeClick = () => {\n    if (latitude && longitude && !isNaN(parseFloat(latitude)) && !isNaN(parseFloat(longitude))) {\n      const wazeUrl = `https://waze.com/ul?ll=${latitude},${longitude}&navigate=yes`;\n      window.open(wazeUrl, '_blank');\n    }\n    setShowNavigationConfirm(false);\n  };\n\n  const handleQrCodeClick = async () => {\n    if (!qrCode) return;\n\n    setIsScanning(true);\n    try {\n      let imageSource: string | Blob = qrCode;\n\n      // If it's a remote URL, use our proxy to avoid CORS issues\n      if (qrCode.startsWith('http')) {\n        const proxyUrl = `/api/proxy-image?url=${encodeURIComponent(qrCode)}`;\n        const response = await fetch(proxyUrl);\n        if (!response.ok) {\n          throw new Error(`Failed to load image: ${response.statusText}`);\n        }\n        imageSource = await response.blob();\n      }\n\n      // Try to decode QR code from the image\n      const result = await QrScanner.scanImage(imageSource, { returnDetailedScanResult: true });\n      setScannedResult(result.data);\n      setShowConfirmDialog(true);\n    } catch (error) {\n      console.error(\"QR scanning error:\", error);\n      // Show error toast instead of incorrect navigation\n      alert(\"Could not read QR code from the image. Please check if the image contains a valid QR code.\");\n    } finally {\n      setIsScanning(false);\n    }\n  };\n\n  const handleConfirmNavigation = () => {\n    if (scannedResult) {\n      // Check if it's a valid URL, if not, treat it as a search query\n      let targetUrl = scannedResult;\n      \n      // If it doesn't start with http/https, assume it's a search or add https\n      if (!scannedResult.match(/^https?:\\/\\//)) {\n        // If it looks like a URL without protocol, add https\n        if (scannedResult.includes('.') && !scannedResult.includes(' ')) {\n          targetUrl = `https://${scannedResult}`;\n        } else {\n          // Otherwise, search on Google\n          targetUrl = `https://www.google.com/search?q=${encodeURIComponent(scannedResult)}`;\n        }\n      }\n      \n      window.open(targetUrl, '_blank');\n    }\n    setShowConfirmDialog(false);\n    setScannedResult(\"\");\n  };\n\n  const handleCancelNavigation = () => {\n    setShowConfirmDialog(false);\n    setScannedResult(\"\");\n  };\n\n  const handleUrlClick = (url: string) => {\n    let targetUrl = url.trim();\n    if (!targetUrl.startsWith('http://') && !targetUrl.startsWith('https://')) {\n      targetUrl = 'https://' + targetUrl;\n    }\n    setUrlToOpen(targetUrl);\n    setShowUrlConfirm(true);\n  };\n\n  const handleConfirmUrlOpen = () => {\n    if (urlToOpen) {\n      window.open(urlToOpen, '_blank');\n    }\n    setShowUrlConfirm(false);\n    setUrlToOpen(\"\");\n  };\n  \n  const handleSaveClick = () => {\n    if (hasChanges()) {\n      setShowSaveConfirm(true);\n    }\n  };\n\n  const handleConfirmSave = async () => {\n    setShowSaveConfirm(false);\n    setIsSaving(true);\n    \n    try {\n      if (hasChanges() && onUpdateRow) {\n        const updates: any = {};\n        \n        if (currentData.info !== originalData.info) {\n          updates.info = currentData.info;\n        }\n        if (currentData.qrCode !== originalData.qrCode) {\n          updates.qrCode = currentData.qrCode || null;\n        }\n        if (currentData.latitude !== originalData.latitude) {\n          updates.latitude = currentData.latitude ? parseFloat(currentData.latitude) : null;\n        }\n        if (currentData.longitude !== originalData.longitude) {\n          updates.longitude = currentData.longitude ? parseFloat(currentData.longitude) : null;\n        }\n        if (currentData.markerColor !== originalData.markerColor) {\n          updates.markerColor = currentData.markerColor;\n        }\n        \n        await onUpdateRow(updates);\n        \n        // Update original data to reflect saved changes\n        setOriginalData(currentData);\n        \n        // Show success message (keep modal open so user can see changes in the map)\n        setShowSuccessMessage(true);\n        setTimeout(() => {\n          setShowSuccessMessage(false);\n        }, 3000);\n      }\n    } finally {\n      setIsSaving(false);\n    }\n  };\n  \n  const handleCancel = () => {\n    // Revert to original data\n    setCurrentData(originalData);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"h-auto p-1 bg-transparent border-transparent hover:bg-transparent hover:border-transparent text-blue-400 hover:text-blue-500 dark:text-blue-300 dark:hover:text-blue-400\"\n          data-testid={`button-info-${rowId}`}\n        >\n          {editMode ? (\n            <Info className=\"w-4 h-4\" />\n          ) : (\n            <FileText className=\"w-4 h-4\" />\n          )}\n        </Button>\n      </DialogTrigger>\n      <DialogContent \n        className=\"max-w-lg overflow-hidden flex flex-col bg-white/70 dark:bg-black/30 backdrop-blur-2xl border-2 border-gray-200/60 dark:border-white/10 shadow-[0_20px_60px_0_rgba(0,0,0,0.25)] rounded-3xl transition-smooth data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-90 data-[state=open]:zoom-in-95 duration-300 ease-out\"\n        style={{\n          maxHeight: 'min(90vh, calc(100dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom) - 40px))',\n          touchAction: 'pan-y',\n        }}\n      >\n        {/* iOS Frosted Glass Layer */}\n        <div \n          className=\"absolute inset-0 -z-10 rounded-3xl bg-gradient-to-br from-white/60 via-white/40 to-white/50 dark:from-black/40 dark:via-black/20 dark:to-black/30 border-0 shadow-inner\" \n          style={{\n            backdropFilter: 'blur(40px)',\n            WebkitBackdropFilter: 'blur(40px)',\n          }}\n        />\n        <DialogHeader \n          className=\"pb-6 border-b border-blue-900 dark:border-cyan-400/50 flex-shrink-0\"\n          style={{ paddingTop: 'max(1.5rem, env(safe-area-inset-top))' }}\n        >\n          <DialogTitle className=\"font-semibold text-center text-slate-900 dark:text-slate-400\" style={{fontSize: '10px'}}>\n            {location || 'Location'}\n          </DialogTitle>\n          <div className=\"text-center text-muted-foreground pt-2\" style={{fontSize: '10px'}}>\n            {code || ''}\n          </div>\n        </DialogHeader>\n        \n        <div \n          className=\"py-6 space-y-6 overflow-y-auto flex-1\"\n          style={{\n            WebkitOverflowScrolling: 'touch',\n            overscrollBehavior: 'contain',\n          }}\n        >\n          {/* Mini Map Section */}\n          {latitude && longitude && !isNaN(parseFloat(latitude)) && !isNaN(parseFloat(longitude)) && (\n            <div className=\"bg-transparent backdrop-blur-sm rounded-xl p-4 space-y-3 shadow-sm\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-2 h-2 bg-green-400 dark:bg-green-300 rounded-full animate-pulse\"></div>\n                <h4 className=\"font-semibold text-green-500 dark:text-green-300\" style={{fontSize: '10px'}}>üó∫Ô∏è Location Map</h4>\n              </div>\n              <MiniMap \n                locations={(() => {\n                  const currentLocation = {\n                    latitude: parseFloat(latitude),\n                    longitude: parseFloat(longitude),\n                    label: location || 'Location',\n                    code: route || code,\n                    isCurrent: true,\n                    markerColor: currentData.markerColor || markerColor\n                  };\n                  \n                  // For fullscreen: collect all locations from allRows with valid coordinates\n                  const allLocations = allRows\n                    .filter(row => \n                      row.latitude && \n                      row.longitude && \n                      !isNaN(parseFloat(String(row.latitude))) && \n                      !isNaN(parseFloat(String(row.longitude)))\n                    )\n                    .map(row => ({\n                      latitude: parseFloat(String(row.latitude)),\n                      longitude: parseFloat(String(row.longitude)),\n                      label: row.location || 'Location',\n                      code: row.route || row.code,\n                      isCurrent: row.id === rowId,\n                      markerColor: row.markerColor\n                    }));\n                  \n                  // For mini view, show only current location\n                  // For fullscreen, it will show all locations\n                  return allLocations.length > 1 ? allLocations : [currentLocation];\n                })()}\n                height=\"160px\"\n                showFullscreenButton={true}\n              />\n              \n              {/* Full Address Caption */}\n              <div className=\"mt-3 pt-3 border-t border-blue-200/50 dark:border-white/10\">\n                <SlidingDescription\n                  value={(() => {\n                    const infoValue = currentData.info || \"\";\n                    if (!infoValue) return \"\";\n                    if (infoValue.includes(\"|||DESCRIPTION|||\")) {\n                      return infoValue.split(\"|||DESCRIPTION|||\")[0] || \"\";\n                    }\n                    return infoValue;\n                  })()}\n                  onSave={(value) => {\n                    const currentInfo = currentData.info || \"\";\n                    let newInfo = value;\n                    \n                    // Preserve description if it exists\n                    if (currentInfo.includes(\"|||DESCRIPTION|||\")) {\n                      const description = currentInfo.split(\"|||DESCRIPTION|||\")[1] || \"\";\n                      if (description.trim()) {\n                        newInfo = `${value}|||DESCRIPTION|||${description}`;\n                      }\n                    }\n                    \n                    setCurrentData(prev => ({ ...prev, info: newInfo }));\n                  }}\n                  isEditable={editMode}\n                />\n              </div>\n            </div>\n          )}\n\n          {/* Description Section */}\n          <div className=\"bg-transparent backdrop-blur-sm rounded-xl p-4 space-y-3 shadow-sm\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-2 h-2 bg-purple-500 dark:bg-purple-400 rounded-full\"></div>\n              <h4 className=\"font-semibold text-purple-600 dark:text-purple-400\" style={{fontSize: '10px'}}>üìù Description</h4>\n            </div>\n            <EditableDescriptionList\n              value={(() => {\n                const infoValue = currentData.info || \"\";\n                if (!infoValue) return \"\";\n                if (infoValue.includes(\"|||DESCRIPTION|||\")) {\n                  const withDescription = infoValue.split(\"|||DESCRIPTION|||\")[1] || \"\";\n                  if (withDescription.includes(\"|||URL|||\")) {\n                    return withDescription.split(\"|||URL|||\")[0] || \"\";\n                  }\n                  return withDescription;\n                }\n                return \"\";\n              })()}\n              onSave={(value) => {\n                const currentInfo = currentData.info || \"\";\n                let address = \"\";\n                let url = \"\";\n                \n                // Parse current info to extract address and URL\n                if (currentInfo.includes(\"|||DESCRIPTION|||\")) {\n                  address = currentInfo.split(\"|||DESCRIPTION|||\")[0] || \"\";\n                  const descriptionPart = currentInfo.split(\"|||DESCRIPTION|||\")[1] || \"\";\n                  if (descriptionPart.includes(\"|||URL|||\")) {\n                    url = descriptionPart.split(\"|||URL|||\")[1] || \"\";\n                  }\n                } else {\n                  // If no description separator, check for URL separator\n                  if (currentInfo.includes(\"|||URL|||\")) {\n                    address = currentInfo.split(\"|||URL|||\")[0] || \"\";\n                    url = currentInfo.split(\"|||URL|||\")[1] || \"\";\n                  } else {\n                    address = currentInfo;\n                  }\n                }\n                \n                // Rebuild info with updated description\n                let newInfo = address.trim();\n                \n                // Add description if it has content\n                if (value.trim()) {\n                  newInfo += `|||DESCRIPTION|||${value.trim()}`;\n                }\n                \n                // Add URL if it exists\n                if (url.trim()) {\n                  // If we have description, append URL to it\n                  if (value.trim()) {\n                    newInfo += `|||URL|||${url.trim()}`;\n                  } else {\n                    // If no description but have URL, add it directly\n                    newInfo += `|||DESCRIPTION||||||URL|||${url.trim()}`;\n                  }\n                }\n                \n                setCurrentData(prev => ({ ...prev, info: newInfo }));\n              }}\n              isEditable={editMode}\n            />\n          </div>\n\n          {/* URL Section - Only show in edit mode */}\n          {editMode && (\n            <div className=\"bg-transparent backdrop-blur-sm rounded-xl p-4 space-y-3 shadow-sm\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-2 h-2 bg-cyan-500 dark:bg-cyan-400 rounded-full\"></div>\n                <h4 className=\"font-semibold text-cyan-600 dark:text-cyan-400\" style={{fontSize: '10px'}}>üåê Website URL</h4>\n              </div>\n              <SlidingDescription\n                value={(() => {\n                  const infoValue = currentData.info || \"\";\n                  if (!infoValue) return \"\";\n                  if (infoValue.includes(\"|||URL|||\")) {\n                    return infoValue.split(\"|||URL|||\").pop() || \"\";\n                  }\n                  return \"\";\n                })()}\n                onSave={(value) => {\n                  const currentInfo = currentData.info || \"\";\n                  let address = \"\";\n                  let description = \"\";\n                  \n                  // Parse current info\n                  if (currentInfo.includes(\"|||DESCRIPTION|||\")) {\n                    address = currentInfo.split(\"|||DESCRIPTION|||\")[0] || \"\";\n                    const descriptionPart = currentInfo.split(\"|||DESCRIPTION|||\")[1] || \"\";\n                    if (descriptionPart.includes(\"|||URL|||\")) {\n                      description = descriptionPart.split(\"|||URL|||\")[0] || \"\";\n                    } else {\n                      description = descriptionPart;\n                    }\n                  } else {\n                    address = currentInfo;\n                  }\n                  \n                  // Combine with new URL\n                  let newInfo = address;\n                  if (description.trim() || value.trim()) {\n                    newInfo += `|||DESCRIPTION|||${description}`;\n                    if (value.trim()) {\n                      newInfo += `|||URL|||${value}`;\n                    }\n                  }\n                  \n                  setCurrentData(prev => ({ ...prev, info: newInfo }));\n                }}\n                isEditable={editMode}\n              />\n            </div>\n          )}\n\n          {/* QR Code URL Section - Only show in edit mode */}\n          {editMode && (\n            <div className=\"bg-transparent backdrop-blur-sm rounded-xl p-4 space-y-3 shadow-sm\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-2 h-2 bg-purple-500 dark:bg-purple-400 rounded-full\"></div>\n                <h4 className=\"font-semibold text-purple-600 dark:text-purple-400\" style={{fontSize: '10px'}}><QrCode className=\"w-4 h-4 inline mr-1\" />QR Code URL</h4>\n              </div>\n              <div className=\"space-y-2\">\n                <Input\n                  value={currentData.qrCode}\n                  onChange={(e) => setCurrentData(prev => ({ ...prev, qrCode: e.target.value }))}\n                  placeholder=\"Enter QR code image URL...\"\n                  style={{fontSize: '10px'}}\n                  data-testid=\"input-qr-code\"\n                />\n                <p className=\"text-muted-foreground\" style={{fontSize: '10px'}}>URL to the QR code image</p>\n              </div>\n            </div>\n          )}\n\n          {/* Location Coordinates Section - Only show in edit mode */}\n          {editMode && (\n            <div className=\"bg-transparent backdrop-blur-sm rounded-xl p-4 space-y-3 shadow-sm\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-2 h-2 bg-green-500 dark:bg-green-400 rounded-full\"></div>\n                <h4 className=\"font-semibold text-green-600 dark:text-green-400\" style={{fontSize: '10px'}}>üìç Coordinates</h4>\n              </div>\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"latitude\" style={{fontSize: '10px'}}>Latitude</Label>\n                  <Input\n                    id=\"latitude\"\n                    type=\"number\"\n                    step=\"any\"\n                    value={currentData.latitude}\n                    onChange={(e) => setCurrentData(prev => ({ ...prev, latitude: e.target.value }))}\n                    placeholder=\"e.g., 3.1390\"\n                    style={{fontSize: '10px'}}\n                    data-testid=\"input-latitude\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"longitude\" style={{fontSize: '10px'}}>Longitude</Label>\n                  <Input\n                    id=\"longitude\"\n                    type=\"number\"\n                    step=\"any\"\n                    value={currentData.longitude}\n                    onChange={(e) => setCurrentData(prev => ({ ...prev, longitude: e.target.value }))}\n                    placeholder=\"e.g., 101.6869\"\n                    style={{fontSize: '10px'}}\n                    data-testid=\"input-longitude\"\n                  />\n                </div>\n              </div>\n              <p className=\"text-muted-foreground\" style={{fontSize: '10px'}}>GPS coordinates for map location</p>\n              \n              {/* Marker Color Picker */}\n              <div className=\"space-y-2 pt-3\">\n                <Label htmlFor=\"markerColor\" style={{fontSize: '10px'}}>üé® Marker Color</Label>\n                <div className=\"flex items-center gap-3\">\n                  <Input\n                    id=\"markerColor\"\n                    type=\"color\"\n                    value={currentData.markerColor}\n                    onChange={(e) => setCurrentData(prev => ({ ...prev, markerColor: e.target.value }))}\n                    className=\"w-20 h-10 cursor-pointer\"\n                    data-testid=\"input-marker-color\"\n                  />\n                  <Input\n                    type=\"text\"\n                    value={currentData.markerColor}\n                    onChange={(e) => setCurrentData(prev => ({ ...prev, markerColor: e.target.value }))}\n                    placeholder=\"#3b82f6\"\n                    className=\"flex-1\"\n                    style={{fontSize: '10px'}}\n                    pattern=\"^#[0-9A-Fa-f]{6}$\"\n                  />\n                </div>\n                <p className=\"text-muted-foreground\" style={{fontSize: '10px'}}>Custom color for map marker pin</p>\n              </div>\n              \n              {/* Save/Cancel Buttons - Right below coordinates */}\n              <div className=\"flex justify-end gap-2 pt-4 border-t border-blue-200 dark:border-blue-800/50\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => {\n                    setCurrentData(originalData);\n                    setOpen(false);\n                  }}\n                  className=\"bg-transparent border-transparent hover:bg-transparent hover:border-transparent text-red-600 hover:text-red-700\"\n                  style={{fontSize: '10px'}}\n                  data-testid=\"button-cancel-info\"\n                >\n                  <X className=\"w-4 h-4 mr-1\" />\n                  Cancel\n                </Button>\n                <Button\n                  size=\"sm\"\n                  onClick={handleSaveClick}\n                  disabled={isSaving || !hasChanges()}\n                  className={hasChanges() ? 'bg-transparent border-transparent hover:bg-transparent hover:border-transparent text-green-600 hover:text-green-700' : 'bg-transparent border-transparent text-gray-400 cursor-not-allowed'}\n                  style={{fontSize: '10px'}}\n                  data-testid=\"button-save-info\"\n                >\n                  {isSaving ? (\n                    <>\n                      <Loader2 className=\"w-4 h-4 mr-1 animate-spin\" />\n                      Saving...\n                    </>\n                  ) : (\n                    <>\n                      <Save className=\"w-4 h-4 mr-1\" />\n                      Save\n                    </>\n                  )}\n                </Button>\n              </div>\n            </div>\n          )}\n\n        </div>\n        <DialogFooter \n          className=\"pt-6 mt-2 border-t border-blue-900 dark:border-cyan-400/50 bg-blue-50/50 dark:bg-black/30 backdrop-blur-sm rounded-b-2xl -mx-6 -mb-6 px-6\"\n          style={{ paddingBottom: 'max(1rem, env(safe-area-inset-bottom))' }}\n        >\n          <div className=\"flex flex-col gap-4 w-full\">\n            {/* Action Buttons Row */}\n            <div className=\"flex justify-between items-center w-full\">\n              <div className=\"flex gap-2 flex-wrap\">\n              {location !== \"QL Kitchen\" && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={handleEditClick}\n                  className=\"bg-transparent border-transparent hover:bg-transparent hover:border-transparent\"\n                  data-testid={`button-edit-${rowId}`}\n                >\n                  <ListChecks className=\"w-4 h-4 text-green-600\" />\n                </Button>\n              )}\n              {qrCode && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={handleQrCodeClick}\n                  disabled={isScanning}\n                  className=\"bg-transparent border-transparent hover:bg-transparent hover:border-transparent\"\n                  data-testid={`button-qrcode-${rowId}`}\n                >\n                  <QrCode className=\"w-4 h-4 text-purple-600\" />\n                  {isScanning && <span className=\"ml-1 text-xs\">Scanning...</span>}\n                </Button>\n              )}\n              {(() => {\n                const url = (() => {\n                  if (!info) return \"\";\n                  if (info.includes(\"|||URL|||\")) {\n                    return info.split(\"|||URL|||\").pop() || \"\";\n                  }\n                  return \"\";\n                })();\n                \n                return url.trim() ? (\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => handleUrlClick(url)}\n                    className=\"bg-transparent border-transparent hover:bg-transparent hover:border-transparent\"\n                    data-testid={`button-open-url-${rowId}`}\n                  >\n                    <ExternalLink className=\"w-4 h-4 text-cyan-600\" />\n                  </Button>\n                ) : null;\n              })()}\n              {latitude && longitude && !isNaN(parseFloat(latitude)) && !isNaN(parseFloat(longitude)) && (\n                <>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={handleDirectionClick}\n                    className=\"bg-transparent border-transparent hover:bg-transparent hover:border-transparent\"\n                    data-testid={`button-direction-${rowId}`}\n                  >\n                    <SiGooglemaps className=\"w-4 h-4 text-red-500\" />\n                  </Button>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={handleWazeClick}\n                    className=\"bg-transparent border-transparent hover:bg-transparent hover:border-transparent\"\n                    data-testid={`button-waze-${rowId}`}\n                  >\n                    <SiWaze className=\"w-4 h-4 text-blue-500\" />\n                  </Button>\n                </>\n              )}\n              </div>\n            </div>\n          </div>\n        </DialogFooter>\n      </DialogContent>\n      \n      {/* QR Confirmation Dialog */}\n      <Dialog open={showConfirmDialog} onOpenChange={handleCancelNavigation}>\n        <DialogContent className=\"max-w-md animate-in zoom-in-95 duration-200 bg-gradient-to-br from-background/95 via-background/98 to-background dark:from-black/95 dark:via-black/98 dark:to-black border-2 border-blue-500/20 dark:border-blue-400/20\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2 text-blue-600 dark:text-blue-400\">\n              <CheckCircle className=\"w-5 h-5\" />\n              QR Code Detected\n            </DialogTitle>\n            <DialogDescription>\n              A QR code was scanned and contains a link.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            <div className=\"bg-blue-50/50 dark:bg-blue-950/30 p-4 rounded-lg border border-blue-200 dark:border-blue-800\">\n              <div className=\"flex items-start gap-3\">\n                <ExternalLink className=\"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5\" />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2\">Detected content:</p>\n                  <div className=\"bg-background/50 dark:bg-black/50 p-2 rounded text-sm font-mono break-all\">\n                    {scannedResult}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <p className=\"text-sm text-muted-foreground\">\n              Do you want to navigate to this link? It will open in a new tab.\n            </p>\n          </div>\n\n          <DialogFooter className=\"flex-col-reverse sm:flex-row gap-2\">\n            <Button \n              variant=\"outline\" \n              onClick={handleCancelNavigation}\n              data-testid=\"button-cancel-qr-navigation\"\n            >\n              Cancel\n            </Button>\n            <Button \n              onClick={handleConfirmNavigation}\n              className=\"bg-green-600 hover:bg-green-700\"\n              data-testid=\"button-confirm-qr-navigation\"\n            >\n              <ExternalLink className=\"w-4 h-4 mr-2\" />\n              Open Link\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Checklist Confirmation Dialog */}\n      <Dialog open={showChecklistConfirm} onOpenChange={setShowChecklistConfirm}>\n        <DialogContent className=\"max-w-md animate-in zoom-in-95 duration-200 bg-gradient-to-br from-background/95 via-background/98 to-background dark:from-black/95 dark:via-black/98 dark:to-black border-2 border-blue-500/20 dark:border-blue-400/20\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2 text-blue-600 dark:text-blue-400\">\n              <ListChecks className=\"w-5 h-5\" />\n              Open Checklist\n            </DialogTitle>\n            <DialogDescription>\n              Access the refill service checklist for this location.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            <div className=\"bg-blue-50/50 dark:bg-blue-950/30 p-4 rounded-lg border border-blue-200 dark:border-blue-800\">\n              <div className=\"flex items-start gap-3\">\n                <ExternalLink className=\"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5\" />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2\">External Link:</p>\n                  <div className=\"bg-background/50 dark:bg-black/50 p-2 rounded text-sm font-mono break-all\">\n                    https://fmvending.web.app/refill-service/M{formatCode(code)}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <p className=\"text-sm text-muted-foreground\">\n              Do you want to open the refill service checklist? It will open in a new tab.\n            </p>\n          </div>\n\n          <DialogFooter className=\"flex-col-reverse sm:flex-row gap-2\">\n            <Button \n              variant=\"outline\" \n              onClick={() => setShowChecklistConfirm(false)}\n              data-testid=\"button-cancel-checklist\"\n            >\n              Cancel\n            </Button>\n            <Button \n              onClick={handleConfirmEditClick}\n              className=\"bg-green-600 hover:bg-green-700\"\n              data-testid=\"button-confirm-checklist\"\n            >\n              <ListChecks className=\"w-4 h-4 mr-2\" />\n              Open Checklist\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Navigation Confirmation Dialog */}\n      <Dialog open={showNavigationConfirm} onOpenChange={setShowNavigationConfirm}>\n        <DialogContent className=\"max-w-md animate-in zoom-in-95 duration-200 bg-gradient-to-br from-background/95 via-background/98 to-background dark:from-black/95 dark:via-black/98 dark:to-black border-2 border-blue-500/20 dark:border-blue-400/20\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2 text-blue-600 dark:text-blue-400\">\n              {navigationType === 'google' ? (\n                <SiGooglemaps className=\"w-5 h-5\" />\n              ) : (\n                <SiWaze className=\"w-5 h-5\" />\n              )}\n              Open Navigation\n            </DialogTitle>\n            <DialogDescription>\n              Navigate to this location using {navigationType === 'google' ? 'Google Maps' : 'Waze'}.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            <div className=\"bg-blue-50/50 dark:bg-blue-950/30 p-4 rounded-lg border border-blue-200 dark:border-blue-800\">\n              <div className=\"flex items-start gap-3\">\n                <ExternalLink className=\"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5\" />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2\">Navigation to:</p>\n                  <div className=\"bg-background/50 dark:bg-black/50 p-2 rounded text-sm\">\n                    {location || 'Location'} ({latitude}, {longitude})\n                  </div>\n                  <p className=\"text-sm text-muted-foreground mt-2\">Using {navigationType === 'google' ? 'Google Maps' : 'Waze'}</p>\n                </div>\n              </div>\n            </div>\n\n            <p className=\"text-sm text-muted-foreground\">\n              Do you want to open navigation to this location? It will open in a new tab.\n            </p>\n          </div>\n\n          <DialogFooter className=\"flex-col-reverse sm:flex-row gap-2\">\n            <Button \n              variant=\"outline\" \n              onClick={() => setShowNavigationConfirm(false)}\n              data-testid=\"button-cancel-navigation\"\n            >\n              Cancel\n            </Button>\n            <Button \n              onClick={navigationType === 'google' ? handleConfirmDirectionClick : handleConfirmWazeClick}\n              className={navigationType === 'google' ? 'bg-red-600 hover:bg-red-700' : 'bg-blue-600 hover:bg-blue-700'}\n              data-testid=\"button-confirm-navigation\"\n            >\n              {navigationType === 'google' ? (\n                <SiGooglemaps className=\"w-4 h-4 mr-2\" />\n              ) : (\n                <SiWaze className=\"w-4 h-4 mr-2\" />\n              )}\n              Open {navigationType === 'google' ? 'Google Maps' : 'Waze'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* URL Confirmation Dialog */}\n      <Dialog open={showUrlConfirm} onOpenChange={setShowUrlConfirm}>\n        <DialogContent className=\"max-w-md animate-in zoom-in-95 duration-200 bg-gradient-to-br from-background/95 via-background/98 to-background dark:from-black/95 dark:via-black/98 dark:to-black border-2 border-blue-500/20 dark:border-blue-400/20\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2 text-blue-600 dark:text-blue-400\">\n              <ExternalLink className=\"w-5 h-5\" />\n              Open External Link\n            </DialogTitle>\n            <DialogDescription>\n              This will open a website in a new tab.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            <div className=\"bg-blue-50/50 dark:bg-blue-950/30 p-4 rounded-lg border border-blue-200 dark:border-blue-800\">\n              <div className=\"flex items-start gap-3\">\n                <ExternalLink className=\"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5\" />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2\">Website URL:</p>\n                  <div className=\"bg-background/50 dark:bg-black/50 p-2 rounded text-sm font-mono break-all\">\n                    {urlToOpen}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <p className=\"text-sm text-muted-foreground\">\n              Do you want to open this external link? It will open in a new tab and may use your data.\n            </p>\n          </div>\n\n          <DialogFooter className=\"flex-col-reverse sm:flex-row gap-2\">\n            <Button \n              variant=\"outline\" \n              onClick={() => setShowUrlConfirm(false)}\n              data-testid=\"button-cancel-url\"\n            >\n              Cancel\n            </Button>\n            <Button \n              onClick={handleConfirmUrlOpen}\n              className=\"bg-cyan-600 hover:bg-cyan-700\"\n              data-testid=\"button-confirm-url\"\n            >\n              <ExternalLink className=\"w-4 h-4 mr-2\" />\n              Open Link\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Save Confirmation Dialog */}\n      <Dialog open={showSaveConfirm} onOpenChange={setShowSaveConfirm}>\n        <DialogContent className=\"max-w-md animate-in zoom-in-95 duration-200 bg-gradient-to-br from-background/95 via-background/98 to-background dark:from-black/95 dark:via-black/98 dark:to-black border-2 border-green-500/20 dark:border-green-400/20\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2 text-green-600 dark:text-green-400\">\n              <Save className=\"w-5 h-5\" />\n              Save Changes\n            </DialogTitle>\n            <DialogDescription>\n              Are you sure you want to save these changes to the location information?\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            <div className=\"bg-green-50/50 dark:bg-green-950/30 p-4 rounded-lg border border-green-200 dark:border-green-800\">\n              <div className=\"flex items-start gap-3\">\n                <CheckCircle className=\"w-5 h-5 text-green-600 dark:text-green-400 mt-0.5\" />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-semibold text-green-900 dark:text-green-100 mb-2\">Changes to be saved:</p>\n                  <ul className=\"text-sm space-y-1\">\n                    {currentData.info !== originalData.info && (\n                      <li className=\"text-green-700 dark:text-green-300\">‚Ä¢ Location details updated</li>\n                    )}\n                    {currentData.qrCode !== originalData.qrCode && (\n                      <li className=\"text-green-700 dark:text-green-300\">‚Ä¢ QR code URL updated</li>\n                    )}\n                    {currentData.latitude !== originalData.latitude && (\n                      <li className=\"text-green-700 dark:text-green-300\">‚Ä¢ Latitude updated</li>\n                    )}\n                    {currentData.longitude !== originalData.longitude && (\n                      <li className=\"text-green-700 dark:text-green-300\">‚Ä¢ Longitude updated</li>\n                    )}\n                    {currentData.markerColor !== originalData.markerColor && (\n                      <li className=\"text-green-700 dark:text-green-300\">‚Ä¢ Marker color updated</li>\n                    )}\n                  </ul>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <DialogFooter className=\"flex-col-reverse sm:flex-row gap-2\">\n            <Button \n              variant=\"outline\" \n              onClick={() => setShowSaveConfirm(false)}\n              data-testid=\"button-cancel-save\"\n            >\n              Cancel\n            </Button>\n            <Button \n              onClick={handleConfirmSave}\n              className=\"bg-green-600 hover:bg-green-700\"\n              data-testid=\"button-confirm-save\"\n            >\n              <Save className=\"w-4 h-4 mr-2\" />\n              Save Changes\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Success Message */}\n      {showSuccessMessage && (\n        <div className=\"fixed top-4 right-4 z-[100] animate-in slide-in-from-top-2 duration-300\">\n          <Alert className=\"bg-green-600 text-white border-green-700 shadow-lg\">\n            <CheckCircle className=\"h-4 w-4\" />\n            <AlertDescription className=\"ml-2\">\n              <strong>Success!</strong> Information saved successfully.\n            </AlertDescription>\n          </Alert>\n        </div>\n      )}\n    </Dialog>\n  );\n}","size_bytes":42331},"client/src/components/navigation.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Database, Settings, Save, DoorOpen, Rows, Receipt, Layout, Sun, Moon, Bookmark, Plus, ChevronDown, Menu, BookOpen, LayoutGrid, ListChecks } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { AddColumnModal } from \"./add-column-modal\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\n\ninterface NavigationProps {\n  editMode?: boolean;\n  onEditModeRequest?: () => void;\n  onShowCustomization?: () => void;\n  onAddRow?: () => void;\n  onSaveData?: () => void;\n  onGenerateTng?: () => void;\n  onAddColumn?: (columnData: { name: string; dataKey: string; type: string; options?: string[] }) => Promise<void>;\n  onOptimizeRoute?: () => void;\n  onCalculateTolls?: () => void;\n  onSaveLayout?: () => void;\n  onSavedLinks?: () => void;\n  onShowTutorial?: () => void;\n  isAuthenticated?: boolean;\n  theme?: string;\n  onToggleTheme?: () => void;\n}\n\nexport function Navigation({ editMode, onEditModeRequest, onShowCustomization, onAddRow, onSaveData, onGenerateTng, onAddColumn, onOptimizeRoute, onCalculateTolls, onSaveLayout, onSavedLinks, onShowTutorial, isAuthenticated, theme, onToggleTheme }: NavigationProps) {\n  const [currentTime, setCurrentTime] = useState(new Date());\n  const [, navigate] = useLocation();\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      setCurrentTime(new Date());\n    }, 1000);\n\n    return () => clearInterval(timer);\n  }, []);\n\n  const formatDateTime = (date: Date) => {\n    const options: Intl.DateTimeFormatOptions = {\n      weekday: 'short',\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit',\n    };\n    return date.toLocaleString('en-US', options);\n  };\n\n  return (\n    <nav className=\"sticky top-0 z-50 w-full border-b border-white/20 dark:border-white/10 bg-white/30 dark:bg-black/30 backdrop-blur-2xl shadow-[0_8px_32px_0_rgba(0,0,0,0.12)]\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"flex h-14 items-center justify-between text-[12px]\">\n          {/* Logo/Brand */}\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"flex items-center space-x-2 hover:opacity-80 transition-opacity\">\n              <div className=\"flex h-8 w-8 items-center justify-center rounded-lg overflow-hidden\">\n                <img \n                  src=\"/assets/FamilyMart.png\" \n                  alt=\"Logo\" \n                  className=\"h-full w-full object-cover\"\n                />\n              </div>\n              <div className=\"flex flex-col\">\n                <span className=\"font-bold text-slate-600 dark:text-slate-300\" style={{ fontSize: '14px' }}>\n                  {editMode ? \"Edit Mode\" : \"Route Management\"}\n                </span>\n              </div>\n            </div>\n          </div>\n\n          {/* Navigation - Single Menu Button */}\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"btn-glass w-8 h-8 md:w-auto md:h-9 p-0 md:px-3 pagination-button group transition-all duration-300 ease-out hover:scale-110 hover:shadow-lg hover:shadow-blue-500/20 active:scale-95 active:shadow-none\"\n                data-testid=\"button-main-menu\"\n                title=\"Menu\"\n              >\n                <LayoutGrid className=\"w-4 h-4 text-blue-600 dark:text-blue-400 transition-all duration-300\" />\n                <span className=\"hidden md:inline ml-2 text-xs transition-all duration-300\">Menu</span>\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent \n              align=\"end\" \n              className=\"w-56 bg-white/70 dark:bg-black/70 backdrop-blur-2xl border-2 border-gray-200/60 dark:border-white/10 shadow-[0_20px_60px_0_rgba(0,0,0,0.25)] rounded-2xl\"\n            >\n              {/* Saved Links */}\n              <DropdownMenuItem \n                onClick={onSavedLinks}\n                className=\"cursor-pointer\"\n                data-testid=\"menu-saved-links\"\n              >\n                <Bookmark className=\"w-4 h-4 mr-2 text-amber-500 dark:text-amber-400\" />\n                <span style={{fontSize: '10px'}}>Saved Links</span>\n              </DropdownMenuItem>\n\n              {/* Custom Tables */}\n              <DropdownMenuItem \n                onClick={() => navigate('/custom-tables')}\n                className=\"cursor-pointer\"\n                data-testid=\"menu-custom-tables\"\n              >\n                <ListChecks className=\"w-4 h-4 mr-2 text-purple-500 dark:text-purple-400\" />\n                <span style={{fontSize: '10px'}}>Custom Tables</span>\n              </DropdownMenuItem>\n\n              {/* Theme Toggle */}\n              <DropdownMenuItem \n                onClick={onToggleTheme}\n                className=\"cursor-pointer\"\n                data-testid=\"menu-toggle-theme\"\n              >\n                {theme === 'dark' ? (\n                  <>\n                    <Sun className=\"w-4 h-4 mr-2 text-yellow-500\" />\n                    <span style={{fontSize: '10px'}}>Light Mode</span>\n                  </>\n                ) : (\n                  <>\n                    <Moon className=\"w-4 h-4 mr-2 text-blue-500\" />\n                    <span style={{fontSize: '10px'}}>Dark Mode</span>\n                  </>\n                )}\n              </DropdownMenuItem>\n\n              {/* Help Guide */}\n              <DropdownMenuItem \n                onClick={() => navigate('/help')}\n                className=\"cursor-pointer\"\n                data-testid=\"menu-help-guide\"\n              >\n                <BookOpen className=\"w-4 h-4 mr-2 text-green-600 dark:text-green-400\" />\n                <span style={{fontSize: '10px'}}>User Guide</span>\n              </DropdownMenuItem>\n\n              <DropdownMenuSeparator className=\"bg-gray-200/50 dark:bg-gray-700/50\" />\n\n              {/* Edit Mode Options */}\n              {editMode ? (\n                <>\n                  <DropdownMenuItem \n                    onClick={onAddRow}\n                    className=\"cursor-pointer\"\n                    data-testid=\"menu-add-row\"\n                  >\n                    <Rows className=\"w-4 h-4 mr-2\" />\n                    <span style={{fontSize: '10px'}}>Add Row</span>\n                  </DropdownMenuItem>\n                  {onAddColumn && (\n                    <DropdownMenuItem \n                      onClick={() => {\n                        // Trigger add column modal\n                        const addColumnButton = document.querySelector('[data-testid=\"button-add-column\"]') as HTMLButtonElement;\n                        if (addColumnButton) addColumnButton.click();\n                      }}\n                      className=\"cursor-pointer\"\n                      data-testid=\"menu-add-column\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-2\" />\n                      <span style={{fontSize: '10px'}}>Add Column</span>\n                    </DropdownMenuItem>\n                  )}\n                  <DropdownMenuSeparator className=\"bg-gray-200/50 dark:bg-gray-700/50\" />\n                  <DropdownMenuItem \n                    onClick={onEditModeRequest}\n                    className=\"cursor-pointer text-red-600 dark:text-red-400 focus:text-red-600 dark:focus:text-red-400\"\n                    data-testid=\"menu-exit-edit\"\n                  >\n                    <DoorOpen className=\"w-4 h-4 mr-2\" />\n                    <span style={{fontSize: '10px'}}>Exit Edit Mode</span>\n                  </DropdownMenuItem>\n                </>\n              ) : (\n                <DropdownMenuItem \n                  onClick={onEditModeRequest}\n                  className=\"cursor-pointer\"\n                  data-testid=\"menu-enter-edit\"\n                >\n                  <Settings className=\"w-4 h-4 mr-2 text-red-900 dark:text-red-400\" />\n                  <span style={{fontSize: '10px'}}>Edit Mode</span>\n                </DropdownMenuItem>\n              )}\n            </DropdownMenuContent>\n          </DropdownMenu>\n\n          {/* Hidden Add Column Modal - triggered from dropdown */}\n          {editMode && onAddColumn && (\n            <div className=\"hidden\">\n              <AddColumnModal\n                onCreateColumn={onAddColumn}\n                disabled={!isAuthenticated}\n              />\n            </div>\n          )}\n        </div>\n\n      </div>\n    </nav>\n  );\n}","size_bytes":8619},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/pages/shared-table.tsx":{"content":"import React, { useEffect, useState, useMemo } from \"react\";\nimport { useRoute } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { DataTable } from \"@/components/data-table\";\nimport { useTableData } from \"@/hooks/use-table-data\";\nimport { LoadingOverlay } from \"@/components/skeleton-loader\";\nimport { Footer } from \"@/components/footer\";\nimport { Database } from \"lucide-react\";\nimport { calculateDistance } from \"@/utils/distance\";\nimport type { SharedTableState, TableColumn, TableRow } from \"@shared/schema\";\n\nexport default function SharedTablePage() {\n  const [, params] = useRoute(\"/share/:shareId\");\n  const shareId = params?.shareId;\n\n  const { \n    rows, \n    columns, \n    isLoading,\n  } = useTableData();\n\n  // Fetch shared table state\n  const { data: sharedState, isLoading: isLoadingState, error } = useQuery<SharedTableState>({\n    queryKey: ['/api/share-table', shareId],\n    enabled: !!shareId,\n  });\n\n  // Local state for interactive features (delivery filter ONLY - route filter hidden but still applied)\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [deliveryFilters, setDeliveryFilters] = useState<string[]>([]);\n  const [routeFilters, setRouteFilters] = useState<string[]>([]); // Hidden but applied from shared state\n  const [selectedRowForImage, setSelectedRowForImage] = useState<string | null>(null);\n\n  // Initialize filters from shared state\n  useEffect(() => {\n    if (sharedState?.tableState) {\n      setSearchTerm(sharedState.tableState.filters.searchTerm || \"\");\n      setDeliveryFilters(sharedState.tableState.filters.deliveryFilters || []);\n      setRouteFilters(sharedState.tableState.filters.routeFilters || []); // Apply route filters from shared state\n    }\n  }, [sharedState]);\n\n  // Apply filters and column visibility from shared state + local state\n  const { filteredRows, displayColumns, deliveryOptions } = useMemo(() => {\n    if (rows.length === 0 || columns.length === 0) {\n      return { \n        filteredRows: rows, \n        displayColumns: columns,\n        deliveryOptions: []\n      };\n    }\n\n    // Get unique delivery types\n    const deliveries = Array.from(new Set(rows.map(row => row.delivery).filter(Boolean))) as string[];\n\n    // Filter rows (clone to avoid mutating query cache)\n    let filtered = [...rows];\n    \n    // Apply delivery alternate day-based filtering\n    const today = new Date().getDay(); // 0=Sun, 1=Mon, 2=Tue, 3=Wed, 4=Thu, 5=Fri, 6=Sat\n    const isAlt1Day = [1, 3, 5, 0].includes(today); // Mon, Wed, Fri, Sun\n    const isAlt2Day = [2, 4, 6].includes(today); // Tue, Thu, Sat\n    \n    // Sort based on delivery alternate and current day\n    filtered = filtered.sort((a, b) => {\n      const aAlt = a.deliveryAlt || \"normal\";\n      const bAlt = b.deliveryAlt || \"normal\";\n      \n      // Inactive always at bottom\n      if (aAlt === \"inactive\" && bAlt !== \"inactive\") return 1;\n      if (aAlt !== \"inactive\" && bAlt === \"inactive\") return -1;\n      \n      // Priority based on day\n      if (isAlt1Day) {\n        // Alt1 and normal at top, alt2 at bottom\n        if ((aAlt === \"alt1\" || aAlt === \"normal\") && bAlt === \"alt2\") return -1;\n        if (aAlt === \"alt2\" && (bAlt === \"alt1\" || bAlt === \"normal\")) return 1;\n      } else if (isAlt2Day) {\n        // Alt2 and normal at top, alt1 at bottom\n        if ((aAlt === \"alt2\" || aAlt === \"normal\") && bAlt === \"alt1\") return -1;\n        if (aAlt === \"alt1\" && (bAlt === \"alt2\" || bAlt === \"normal\")) return 1;\n      }\n      \n      return 0;\n    });\n    \n    // Apply route filters from shared state (hidden but applied)\n    if (routeFilters.length > 0) {\n      filtered = filtered.filter(row => routeFilters.includes(row.route));\n    }\n\n    // Apply search filter\n    if (searchTerm) {\n      filtered = filtered.filter(row => \n        Object.values(row).some(value => \n          String(value).toLowerCase().includes(searchTerm.toLowerCase())\n        )\n      );\n    }\n\n    // Apply delivery filters (hide selected types)\n    if (deliveryFilters.length > 0) {\n      filtered = filtered.filter(row => !deliveryFilters.includes(row.delivery));\n    }\n\n    // Filter and reorder columns based on shared state\n    let visibleCols = columns;\n    if (sharedState?.tableState) {\n      const { columnVisibility, columnOrder } = sharedState.tableState;\n      // Note: columnVisibility only stores hidden columns (false), visible ones are undefined\n      visibleCols = columns.filter(col => columnVisibility[col.id] !== false);\n      const orderedCols = columnOrder\n        .map(id => visibleCols.find(col => col.id === id))\n        .filter((col): col is TableColumn => col !== undefined);\n      visibleCols = orderedCols;\n    }\n\n    // Hide latitude, longitude, and tollPrice columns (not in edit mode)\n    visibleCols = visibleCols.filter(col => \n      col.dataKey !== 'latitude' && col.dataKey !== 'longitude' && col.dataKey !== 'tollPrice'\n    );\n\n    return { \n      filteredRows: filtered, \n      displayColumns: visibleCols,\n      deliveryOptions: deliveries\n    };\n  }, [rows, columns, sharedState, searchTerm, deliveryFilters, routeFilters]);\n\n  // Calculate distances for kilometer column\n  const rowsWithDistances = useMemo(() => {\n    // Find QL Kitchen coordinates from full rows collection\n    const qlKitchenRow = rows.find(row => row.location === \"QL Kitchen\");\n    \n    if (!qlKitchenRow || !qlKitchenRow.latitude || !qlKitchenRow.longitude) {\n      return filteredRows.map(row => ({ ...row, kilometer: \"‚Äî\", segmentDistance: 0 }));\n    }\n\n    const qlLat = parseFloat(qlKitchenRow.latitude);\n    const qlLng = parseFloat(qlKitchenRow.longitude);\n\n    if (!Number.isFinite(qlLat) || !Number.isFinite(qlLng)) {\n      return filteredRows.map(row => ({ ...row, kilometer: \"‚Äî\", segmentDistance: 0 }));\n    }\n\n    // Check if any filters are active\n    const hasActiveFilters = searchTerm !== \"\" || routeFilters.length > 0 || deliveryFilters.length > 0;\n\n    if (!hasActiveFilters) {\n      // NO FILTERS: Calculate direct distance from QL Kitchen to each route\n      return filteredRows.map((row) => {\n        if (row.location === \"QL Kitchen\") {\n          return { ...row, kilometer: 0, segmentDistance: 0 };\n        }\n\n        if (!row.latitude || !row.longitude) {\n          return { ...row, kilometer: \"‚Äî\", segmentDistance: 0 };\n        }\n\n        const currentLat = parseFloat(row.latitude);\n        const currentLng = parseFloat(row.longitude);\n\n        if (!Number.isFinite(currentLat) || !Number.isFinite(currentLng)) {\n          return { ...row, kilometer: \"‚Äî\", segmentDistance: 0 };\n        }\n\n        const directDistance = calculateDistance(qlLat, qlLng, currentLat, currentLng);\n        return { ...row, kilometer: directDistance, segmentDistance: directDistance };\n      });\n    } else {\n      // FILTERS ACTIVE: Calculate cumulative distance\n      let cumulativeDistance = 0;\n      let previousLat = qlLat;\n      let previousLng = qlLng;\n\n      return filteredRows.map((row) => {\n        if (row.location === \"QL Kitchen\") {\n          cumulativeDistance = 0;\n          previousLat = qlLat;\n          previousLng = qlLng;\n          return { ...row, kilometer: 0, segmentDistance: 0 };\n        }\n\n        if (!row.latitude || !row.longitude) {\n          return { ...row, kilometer: \"‚Äî\", segmentDistance: 0 };\n        }\n\n        const currentLat = parseFloat(row.latitude);\n        const currentLng = parseFloat(row.longitude);\n\n        if (!Number.isFinite(currentLat) || !Number.isFinite(currentLng)) {\n          return { ...row, kilometer: \"‚Äî\", segmentDistance: 0 };\n        }\n\n        const segmentDistance = calculateDistance(previousLat, previousLng, currentLat, currentLng);\n        cumulativeDistance += segmentDistance;\n\n        previousLat = currentLat;\n        previousLng = currentLng;\n\n        return { ...row, kilometer: cumulativeDistance, segmentDistance };\n      });\n    }\n  }, [rows, filteredRows, searchTerm, routeFilters, deliveryFilters]);\n\n  // Create read-only mutations (they work but don't persist)\n  const readOnlyUpdateMutation = useMutation({\n    mutationFn: async (data: { id: string; updates: Partial<any> }) => {\n      console.log(\"Read-only mode: Changes not saved\", data);\n      return data;\n    },\n  });\n\n  const readOnlyDeleteMutation = useMutation<void, Error, string>({\n    mutationFn: async (id: string) => {\n      console.log(\"Read-only mode: Delete not allowed\", id);\n    },\n  });\n\n  const readOnlyReorderRowsMutation = useMutation<TableRow[], Error, string[]>({\n    mutationFn: async (rowIds: string[]) => {\n      const reordered = rowIds\n        .map(id => rows.find(r => r.id === id))\n        .filter((r): r is TableRow => r !== undefined);\n      return reordered;\n    },\n  });\n\n  const readOnlyReorderColumnsMutation = useMutation<TableColumn[], Error, string[]>({\n    mutationFn: async (columnIds: string[]) => {\n      const reordered = columnIds\n        .map(id => columns.find(c => c.id === id))\n        .filter((c): c is TableColumn => c !== undefined);\n      return reordered;\n    },\n  });\n\n  const readOnlyDeleteColumnMutation = useMutation<void, Error, string>({\n    mutationFn: async (id: string) => {\n      console.log(\"Read-only mode: Column delete not allowed\", id);\n    },\n  });\n\n  const handleClearAllFilters = () => {\n    setSearchTerm(\"\");\n    setDeliveryFilters([]);\n  };\n\n  // Enhanced loading state - ensure minimum 10 second display\n  const [minLoadingComplete, setMinLoadingComplete] = React.useState(false);\n\n  React.useEffect(() => {\n    // Minimum 5 second loading timer\n    const timer = setTimeout(() => {\n      setMinLoadingComplete(true);\n    }, 5000);\n\n    return () => clearTimeout(timer);\n  }, []);\n\n  // Show loading overlay until both data is loaded AND 10 seconds have passed\n  if (isLoading || isLoadingState || !minLoadingComplete) {\n    return (\n      <div className=\"min-h-screen relative\">\n        <LoadingOverlay message=\"Loading shared table...\" type=\"wave\" />\n      </div>\n    );\n  }\n\n  if (error || !sharedState) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"flex h-16 w-16 mx-auto items-center justify-center rounded-lg bg-red-100 dark:bg-red-900/20 text-red-600 dark:text-red-400\">\n            <Database className=\"h-8 w-8\" />\n          </div>\n          <h1 className=\"text-2xl font-bold text-slate-900 dark:text-slate-100\">\n            Shared Table Not Found\n          </h1>\n          <p className=\"text-slate-600 dark:text-slate-400\">\n            The shared table you're looking for doesn't exist or has been removed.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      {/* Header */}\n      <nav className=\"sticky top-0 z-50 w-full border-b-2 border-blue-500/50 dark:border-blue-400/50 bg-gradient-to-r from-blue-500/10 via-blue-600/10 to-blue-700/10 dark:from-blue-500/20 dark:via-blue-600/20 dark:to-blue-700/20 backdrop-blur supports-[backdrop-filter]:bg-background/60 shadow-lg shadow-blue-500/20\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"flex h-14 items-center justify-between text-[12px]\">\n            <div className=\"flex items-center space-x-2\">\n              <div className=\"flex items-center space-x-2 hover:opacity-80 transition-opacity\">\n                <div className=\"flex h-8 w-8 items-center justify-center rounded-lg overflow-hidden\">\n                  <img \n                    src=\"/assets/FamilyMart.png\" \n                    alt=\"Logo\" \n                    className=\"h-full w-full object-cover\"\n                  />\n                </div>\n                <span className=\"font-bold text-slate-600 dark:text-slate-300\" style={{ fontSize: '14px' }}>\n                  Shared Table View\n                </span>\n              </div>\n            </div>\n            <div className=\"text-xs text-slate-500 dark:text-slate-400\">\n              Interactive View\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      <main className=\"pt-4\">\n        <div className=\"container mx-auto px-4 py-8\">\n          {/* Data Table with all interactive features enabled */}\n          <DataTable\n            rows={rowsWithDistances}\n            columns={displayColumns}\n            editMode={false}\n            isSharedView={true}\n            hideShareButton={true}\n            onUpdateRow={readOnlyUpdateMutation as any}\n            onDeleteRow={readOnlyDeleteMutation as any}\n            onReorderRows={readOnlyReorderRowsMutation as any}\n            onReorderColumns={readOnlyReorderColumnsMutation as any}\n            onDeleteColumn={readOnlyDeleteColumnMutation as any}\n            onSelectRowForImage={setSelectedRowForImage}\n            onShowCustomization={() => {}}\n            onOptimizeRoute={() => {}}\n            isAuthenticated={false}\n            searchTerm={searchTerm}\n            onSearchTermChange={setSearchTerm}\n            filterValue={[]}\n            onFilterValueChange={() => {}}\n            deliveryFilterValue={deliveryFilters}\n            onDeliveryFilterValueChange={setDeliveryFilters}\n            routeOptions={[]}\n            deliveryOptions={deliveryOptions}\n            onClearAllFilters={handleClearAllFilters}\n            filteredRowsCount={rowsWithDistances.length}\n            totalRowsCount={rows.length}\n          />\n        </div>\n      </main>\n\n      <Footer editMode={false} />\n    </>\n  );\n}\n","size_bytes":13414},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/ui/toggle.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3\",\n        sm: \"h-9 px-2.5\",\n        lg: \"h-11 px-5\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1449},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"server/routes-import.ts":{"content":"import { Router } from 'express';\nimport { getDb } from './db';\nimport { tableRows } from '../shared/schema';\nimport { eq } from 'drizzle-orm';\nimport { z } from 'zod';\n\nconst router = Router();\n\n// Schema for bulk import\nconst bulkImportRowSchema = z.object({\n  no: z.union([z.string(), z.number()]),\n  code: z.string(),\n  location: z.string(),\n  delivery: z.string(),\n  route: z.string().optional().default(''),\n  info: z.string().optional().default(''),\n});\n\nconst bulkImportSchema = z.object({\n  rows: z.array(bulkImportRowSchema),\n  skipDuplicates: z.boolean().optional().default(true),\n});\n\n// POST /api/import/bulk - Bulk import rows\nrouter.post('/bulk', async (req, res) => {\n  try {\n    const { rows, skipDuplicates } = bulkImportSchema.parse(req.body);\n    \n    const db = getDb();\n    const results = {\n      imported: 0,\n      skipped: 0,\n      errors: [] as string[],\n    };\n    \n    for (const row of rows) {\n      try {\n        // Convert no to integer, handle special case \"‚àû\" for QL Kitchen\n        let noValue = 0;\n        if (row.no === '‚àû' || row.no === 'infinity' || row.no === -1) {\n          noValue = -1;\n        } else {\n          noValue = typeof row.no === 'number' ? row.no : parseInt(String(row.no)) || 0;\n        }\n        \n        // Check if row already exists (by code)\n        if (skipDuplicates) {\n          const existing = await db.select().from(tableRows).where(eq(tableRows.code, row.code)).limit(1);\n          \n          if (existing.length > 0) {\n            results.skipped++;\n            continue;\n          }\n        }\n        \n        // Insert new row\n        await db.insert(tableRows).values({\n          no: noValue,\n          code: row.code,\n          location: row.location,\n          delivery: row.delivery,\n          route: row.route || '',\n          info: row.info || '',\n          tngSite: '',\n          tngRoute: '',\n          destination: '0.00',\n          tollPrice: '0.00',\n          latitude: null,\n          longitude: null,\n          images: [],\n          qrCode: '',\n          sortOrder: noValue === -1 ? -1 : noValue,\n          active: true,\n        });\n        \n        results.imported++;\n        \n      } catch (error) {\n        results.errors.push(`Error importing ${row.code}: ${error instanceof Error ? error.message : 'Unknown error'}`);\n      }\n    }\n    \n    res.json({\n      success: true,\n      results,\n      message: `Imported ${results.imported} rows, skipped ${results.skipped} duplicates`,\n    });\n    \n  } catch (error) {\n    console.error('Bulk import error:', error);\n    res.status(400).json({\n      success: false,\n      error: error instanceof Error ? error.message : 'Unknown error',\n    });\n  }\n});\n\n// POST /api/import/csv - Import from CSV text\nrouter.post('/csv', async (req, res) => {\n  try {\n    const { csv, skipDuplicates = true } = z.object({\n      csv: z.string(),\n      skipDuplicates: z.boolean().optional().default(true),\n    }).parse(req.body);\n    \n    // Parse CSV (simple implementation)\n    const lines = csv.trim().split('\\n');\n    const headers = lines[0].split(',').map(h => h.trim().toLowerCase());\n    \n    const rows = lines.slice(1).map(line => {\n      const values = line.split(',').map(v => v.trim());\n      const row: any = {};\n      \n      headers.forEach((header, index) => {\n        row[header] = values[index] || '';\n      });\n      \n      return {\n        no: row.no || '0',\n        code: row.code || '',\n        location: row.location || '',\n        delivery: row.delivery || '',\n        route: row.route || '',\n        info: row.info || '',\n      };\n    }).filter(row => row.code && row.location); // Filter out empty rows\n    \n    // Use the bulk import logic\n    const db = getDb();\n    const results = {\n      imported: 0,\n      skipped: 0,\n      errors: [] as string[],\n    };\n    \n    for (const row of rows) {\n      try {\n        let noValue = 0;\n        if (row.no === '‚àû' || row.no === 'infinity') {\n          noValue = -1;\n        } else {\n          noValue = parseInt(row.no) || 0;\n        }\n        \n        if (skipDuplicates) {\n          const existing = await db.select().from(tableRows).where(eq(tableRows.code, row.code)).limit(1);\n          if (existing.length > 0) {\n            results.skipped++;\n            continue;\n          }\n        }\n        \n        await db.insert(tableRows).values({\n          no: noValue,\n          code: row.code,\n          location: row.location,\n          delivery: row.delivery,\n          route: row.route || '',\n          info: row.info || '',\n          tngSite: '',\n          tngRoute: '',\n          destination: '0.00',\n          tollPrice: '0.00',\n          latitude: null,\n          longitude: null,\n          images: [],\n          qrCode: '',\n          sortOrder: noValue === -1 ? -1 : noValue,\n          active: true,\n        });\n        \n        results.imported++;\n        \n      } catch (error) {\n        results.errors.push(`Error importing ${row.code}: ${error instanceof Error ? error.message : 'Unknown error'}`);\n      }\n    }\n    \n    res.json({\n      success: true,\n      results,\n      message: `Imported ${results.imported} rows from CSV, skipped ${results.skipped} duplicates`,\n    });\n    \n  } catch (error) {\n    console.error('CSV import error:', error);\n    res.status(400).json({\n      success: false,\n      error: error instanceof Error ? error.message : 'Unknown error',\n    });\n  }\n});\n\nexport default router;\n","size_bytes":5416},"client/src/components/tutorial.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { X, ChevronRight, ChevronLeft, HelpCircle, CheckCircle2 } from 'lucide-react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\n\ninterface TutorialStep {\n  id: string;\n  title: string;\n  description: string;\n  targetSelector?: string;\n  position?: 'top' | 'bottom' | 'left' | 'right' | 'center';\n  mode?: 'view' | 'edit' | 'both';\n}\n\nconst allTutorialSteps: TutorialStep[] = [\n  {\n    id: 'welcome',\n    title: 'üëã Welcome to Route Manager',\n    description: 'This interactive guide will show you how to manage your delivery routes efficiently. Navigate using Next/Previous buttons, or skip anytime. You can restart this tutorial from the help button in the corner.',\n    position: 'center',\n    mode: 'both',\n  },\n  {\n    id: 'theme',\n    title: 'üåì Theme Toggle',\n    description: 'Switch between light and dark modes for comfortable viewing. The dark mode features a premium deep black design with optimized contrast.',\n    targetSelector: '[data-testid=\"button-toggle-theme\"]',\n    position: 'bottom',\n    mode: 'both',\n  },\n  // VIEW MODE STEPS\n  {\n    id: 'view-search',\n    title: 'üîç Smart Search & Filtering',\n    description: 'Search across all locations and use filters to find specific routes, deliveries, or destinations instantly. Combine filters for precise results.',\n    targetSelector: '[data-testid=\"search-input\"]',\n    position: 'top',\n    mode: 'view',\n  },\n  {\n    id: 'view-customize',\n    title: 'üëÅÔ∏è Customize Table View',\n    description: 'Click to show/hide columns and drag to reorder them. Your custom layout is automatically saved when you exit edit mode and persists across sessions.',\n    targetSelector: '[data-testid=\"button-show\"]',\n    position: 'top',\n    mode: 'view',\n  },\n  {\n    id: 'view-share',\n    title: 'üîó Share Table State',\n    description: 'Generate a shareable URL that includes your current filters, search terms, and column settings. Perfect for team collaboration.',\n    targetSelector: '[data-testid=\"button-share-table\"]',\n    position: 'bottom',\n    mode: 'view',\n  },\n  {\n    id: 'view-links',\n    title: 'üîñ Saved Links',\n    description: 'Access your previously saved share links from the navigation bar. View, manage, and quickly access all your saved table states.',\n    targetSelector: '[data-testid=\"button-saved-links\"]',\n    position: 'bottom',\n    mode: 'view',\n  },\n  {\n    id: 'view-map',\n    title: 'üó∫Ô∏è View Map',\n    description: 'Click on any row\\'s map button to see the location on an interactive map with route visualization and fullscreen support.',\n    targetSelector: '.table-container',\n    position: 'top',\n    mode: 'view',\n  },\n  {\n    id: 'view-edit-mode',\n    title: '‚úèÔ∏è Switch to Edit Mode',\n    description: 'Enter edit mode to add locations, calculate toll prices, modify data, and manage your routes. All changes can be saved.',\n    targetSelector: '[data-testid=\"button-edit-mode\"]',\n    position: 'bottom',\n    mode: 'view',\n  },\n  // EDIT MODE STEPS\n  {\n    id: 'edit-add-row',\n    title: '‚ûï Add New Location',\n    description: 'Add new route stops by clicking here. Fill in location details, coordinates, delivery info, and upload images if needed.',\n    targetSelector: '[data-testid=\"button-add-row\"]',\n    position: 'bottom',\n    mode: 'edit',\n  },\n  {\n    id: 'edit-add-column',\n    title: 'üìä Add Custom Column',\n    description: 'Create custom columns to track additional data points specific to your operations and workflow needs.',\n    targetSelector: '[data-testid=\"button-add-column\"]',\n    position: 'bottom',\n    mode: 'edit',\n  },\n  {\n    id: 'edit-tolls',\n    title: 'üí∞ Auto-Calculate Tolls',\n    description: 'Use Google Maps Routes API to automatically calculate toll prices and distances for lorry vehicles. Supports class 1 toll pricing with traffic-aware routing.',\n    targetSelector: '[data-testid=\"button-calculate-tolls\"]',\n    position: 'bottom',\n    mode: 'edit',\n  },\n  {\n    id: 'edit-optimize',\n    title: 'üöÄ Route Optimization',\n    description: 'Use AI algorithms to optimize your delivery route for minimum distance, time, and fuel consumption. Choose from multiple optimization strategies.',\n    targetSelector: '[data-testid=\"button-optimize-route\"]',\n    position: 'bottom',\n    mode: 'edit',\n  },\n  {\n    id: 'edit-save',\n    title: 'üíæ Save All Changes',\n    description: 'Save your modifications to persist all edits. Changes include new rows, updated data, column modifications, and reordering.',\n    targetSelector: '[data-testid=\"button-save-data\"]',\n    position: 'bottom',\n    mode: 'edit',\n  },\n  {\n    id: 'edit-exit',\n    title: 'üö™ Return to View Mode',\n    description: 'Exit edit mode to return to the read-only view. Your column layout preferences are automatically saved when you exit. Remember to save data changes before exiting to avoid data loss.',\n    targetSelector: '[data-testid=\"button-edit-mode\"]',\n    position: 'bottom',\n    mode: 'edit',\n  },\n  {\n    id: 'complete',\n    title: 'üéâ Tutorial Complete!',\n    description: 'You\\'re now ready to manage routes like a pro! Access this guide anytime via the help button. Happy routing!',\n    position: 'center',\n    mode: 'both',\n  },\n];\n\ninterface TutorialProps {\n  editMode?: boolean;\n  onClose?: () => void;\n}\n\nexport function Tutorial({ editMode = false, onClose }: TutorialProps) {\n  const [isActive, setIsActive] = useState(true);\n  const [currentStep, setCurrentStep] = useState(0);\n  const [showHelpButton, setShowHelpButton] = useState(true);\n\n  // Filter steps based on current mode\n  const tutorialSteps = allTutorialSteps.filter(\n    step => step.mode === 'both' || step.mode === (editMode ? 'edit' : 'view')\n  );\n\n  // Force tutorial to start when component mounts (from Help button)\n  useEffect(() => {\n    setIsActive(true);\n    setCurrentStep(0);\n  }, []);\n\n  // Reset to first step when mode changes\n  useEffect(() => {\n    if (isActive && currentStep > 0) {\n      setCurrentStep(0);\n    }\n  }, [editMode]);\n\n  const handleNext = () => {\n    if (currentStep < tutorialSteps.length - 1) {\n      setCurrentStep(currentStep + 1);\n    } else {\n      completeTutorial();\n    }\n  };\n\n  const handlePrevious = () => {\n    if (currentStep > 0) {\n      setCurrentStep(currentStep - 1);\n    }\n  };\n\n  const completeTutorial = () => {\n    localStorage.setItem('tutorial_completed', 'true');\n    setIsActive(false);\n    setCurrentStep(0);\n    onClose?.();\n  };\n\n  const skipTutorial = () => {\n    localStorage.setItem('tutorial_completed', 'true');\n    setIsActive(false);\n    setCurrentStep(0);\n    onClose?.();\n  };\n\n  const restartTutorial = () => {\n    setCurrentStep(0);\n    setIsActive(true);\n  };\n\n  const step = tutorialSteps[currentStep];\n\n  useEffect(() => {\n    if (!isActive || !step.targetSelector) return;\n\n    const targetElement = document.querySelector(step.targetSelector);\n    if (targetElement) {\n      targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });\n    } else {\n      // If target element not found, skip to next step after a brief delay\n      const timer = setTimeout(() => {\n        if (currentStep < tutorialSteps.length - 1) {\n          setCurrentStep(currentStep + 1);\n        }\n      }, 1000);\n      return () => clearTimeout(timer);\n    }\n  }, [currentStep, isActive, step.targetSelector]);\n\n  // Don't render anything when tutorial is not active (Help button now in Navigation)\n  if (!isActive) return null;\n\n  // Center positioned dialogs\n  if (step.position === 'center') {\n    return (\n      <Dialog open={true} onOpenChange={() => {}}>\n        <DialogContent className=\"max-w-lg bg-gradient-to-br from-background/95 via-background/98 to-background dark:from-black/95 dark:via-black/98 dark:to-black border-2 border-blue-500/30 dark:border-blue-400/30\" aria-describedby=\"tutorial-description\">\n          <DialogHeader>\n            <DialogTitle className=\"text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent\">\n              {step.title}\n            </DialogTitle>\n            <DialogDescription id=\"tutorial-description\" className=\"text-base pt-3 leading-relaxed\">\n              {step.description}\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"flex items-center justify-between pt-6 border-t border-border/50\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"text-sm font-medium text-muted-foreground\">\n                Step {currentStep + 1} of {tutorialSteps.length}\n              </div>\n              <div className=\"flex gap-1\">\n                {Array.from({ length: tutorialSteps.length }).map((_, i) => (\n                  <div\n                    key={i}\n                    className={`h-1.5 rounded-full transition-all ${\n                      i === currentStep \n                        ? 'w-6 bg-gradient-to-r from-blue-600 to-purple-600' \n                        : 'w-1.5 bg-muted'\n                    }`}\n                  />\n                ))}\n              </div>\n            </div>\n            <div className=\"flex gap-2\">\n              {currentStep > 0 && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={handlePrevious}\n                  data-testid=\"button-tutorial-previous\"\n                  className=\"gap-1\"\n                >\n                  <ChevronLeft className=\"w-4 h-4\" />\n                  Previous\n                </Button>\n              )}\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={skipTutorial}\n                data-testid=\"button-tutorial-skip\"\n                className=\"text-muted-foreground hover:text-foreground\"\n              >\n                Skip\n              </Button>\n              <Button\n                size=\"sm\"\n                onClick={handleNext}\n                className=\"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white gap-1\"\n                data-testid=\"button-tutorial-next\"\n              >\n                {currentStep === tutorialSteps.length - 1 ? (\n                  <>\n                    Finish\n                    <CheckCircle2 className=\"w-4 h-4\" />\n                  </>\n                ) : (\n                  <>\n                    Next\n                    <ChevronRight className=\"w-4 h-4\" />\n                  </>\n                )}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    );\n  }\n\n  // Positioned tooltips\n  const targetElement = step.targetSelector ? document.querySelector(step.targetSelector) : null;\n  const rect = targetElement?.getBoundingClientRect();\n\n  // If target not found, return null and let useEffect handle skipping\n  if (!rect) {\n    return null;\n  }\n\n  const tooltipStyle: React.CSSProperties = {\n    position: 'fixed',\n    zIndex: 60,\n  };\n\n  // Adjust position based on available space and button location\n  const spaceBelow = window.innerHeight - rect.bottom;\n  const spaceAbove = rect.top;\n  const tooltipWidth = 320; // Compact tooltip width\n  \n  switch (step.position) {\n    case 'bottom':\n      // If button is in bottom half and no space below, show tooltip above instead\n      if (spaceBelow < 250 && spaceAbove > 250) {\n        tooltipStyle.bottom = `${window.innerHeight - rect.top + 12}px`;\n      } else {\n        tooltipStyle.top = `${rect.bottom + 12}px`;\n      }\n      \n      // Calculate centered position but ensure it doesn't overflow right\n      let leftPosition = rect.left + rect.width / 2 - tooltipWidth / 2;\n      const rightEdge = leftPosition + tooltipWidth;\n      \n      // If tooltip overflows right edge, adjust to fit within viewport with padding\n      if (rightEdge > window.innerWidth - 20) {\n        leftPosition = window.innerWidth - tooltipWidth - 20;\n      }\n      \n      // If tooltip overflows left edge, adjust\n      if (leftPosition < 20) {\n        leftPosition = 20;\n      }\n      \n      tooltipStyle.left = `${leftPosition}px`;\n      tooltipStyle.transform = 'none';\n      break;\n    case 'top':\n      tooltipStyle.bottom = `${window.innerHeight - rect.top + 12}px`;\n      \n      // Same horizontal positioning logic for top\n      let topLeftPosition = rect.left + rect.width / 2 - tooltipWidth / 2;\n      const topRightEdge = topLeftPosition + tooltipWidth;\n      \n      if (topRightEdge > window.innerWidth - 20) {\n        topLeftPosition = window.innerWidth - tooltipWidth - 20;\n      }\n      if (topLeftPosition < 20) {\n        topLeftPosition = 20;\n      }\n      \n      tooltipStyle.left = `${topLeftPosition}px`;\n      tooltipStyle.transform = 'none';\n      break;\n    case 'left':\n      tooltipStyle.top = `${rect.top + rect.height / 2}px`;\n      tooltipStyle.right = `${window.innerWidth - rect.left + 12}px`;\n      tooltipStyle.transform = 'translateY(-50%)';\n      break;\n    case 'right':\n      tooltipStyle.top = `${rect.top + rect.height / 2}px`;\n      tooltipStyle.left = `${rect.right + 12}px`;\n      tooltipStyle.transform = 'translateY(-50%)';\n      break;\n  }\n\n  return (\n    <>\n      {/* Enhanced Highlight with glow */}\n      <div\n        className=\"fixed z-[9999] pointer-events-none rounded-lg ring-4 ring-blue-500/60 dark:ring-blue-400/60 animate-pulse\"\n        style={{\n          top: rect.top - 6,\n          left: rect.left - 6,\n          width: rect.width + 12,\n          height: rect.height + 12,\n          boxShadow: '0 0 20px rgba(59, 130, 246, 0.5)',\n        }}\n      />\n\n      {/* Premium Tooltip */}\n      <div\n        style={tooltipStyle}\n        className=\"fixed z-[10000] bg-gradient-to-br from-background/95 via-background/98 to-background dark:from-black/95 dark:via-black/98 dark:to-black border-2 border-blue-500/30 dark:border-blue-400/30 rounded-xl p-4 shadow-2xl w-[320px] backdrop-blur-xl animate-in fade-in zoom-in-95 duration-300\"\n      >\n        <div className=\"flex items-start justify-between mb-3\">\n          <h3 className=\"text-lg font-bold bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent pr-2\">\n            {step.title}\n          </h3>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"h-7 w-7 p-0 hover:bg-destructive/10 hover:text-destructive\"\n            onClick={skipTutorial}\n            data-testid=\"button-tutorial-close\"\n          >\n            <X className=\"w-4 h-4\" />\n          </Button>\n        </div>\n        <p className=\"text-sm text-muted-foreground leading-relaxed mb-4\">{step.description}</p>\n        <div className=\"flex items-center justify-between pt-3 border-t border-border/50\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"text-xs font-medium text-muted-foreground\">\n              {currentStep + 1}/{tutorialSteps.length}\n            </div>\n            <div className=\"flex gap-1\">\n              {Array.from({ length: Math.min(tutorialSteps.length, 8) }).map((_, i) => (\n                <div\n                  key={i}\n                  className={`h-1 rounded-full transition-all ${\n                    i === currentStep \n                      ? 'w-4 bg-gradient-to-r from-blue-600 to-purple-600' \n                      : 'w-1 bg-muted'\n                  }`}\n                />\n              ))}\n            </div>\n          </div>\n          <div className=\"flex gap-2\">\n            {currentStep > 0 && (\n              <Button \n                variant=\"outline\" \n                size=\"sm\" \n                onClick={handlePrevious} \n                data-testid=\"button-tutorial-previous\"\n                className=\"h-8 px-3\"\n              >\n                <ChevronLeft className=\"w-4 h-4\" />\n              </Button>\n            )}\n            <Button \n              size=\"sm\" \n              onClick={handleNext} \n              className=\"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white h-8 px-3 gap-1\" \n              data-testid=\"button-tutorial-next\"\n            >\n              {currentStep === tutorialSteps.length - 1 ? 'Finish' : 'Next'}\n              {currentStep !== tutorialSteps.length - 1 && <ChevronRight className=\"w-4 h-4\" />}\n            </Button>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}\n","size_bytes":16487},"server/openrouteservice.ts":{"content":"import type { TableRow } from \"@shared/schema\";\n\nconst OPENROUTESERVICE_API_KEY = process.env.OPENROUTESERVICE_API_KEY;\nconst QL_KITCHEN_LOCATION = {\n  latitude: 3.0738,\n  longitude: 101.5183,\n};\n\ninterface ORSRouteResponse {\n  routes?: Array<{\n    summary: {\n      distance: number;  // in meters\n      duration: number;  // in seconds\n    };\n    segments?: Array<{\n      distance: number;\n      duration: number;\n    }>;\n  }>;\n}\n\ninterface RouteCalculationResult {\n  distanceKm: number;\n  tollPrice: number;\n}\n\n/**\n * Calculate route distance from QL Kitchen to a destination using OpenRouteService\n * Optimized for lorry (HGV) vehicle routing\n * @param destination The destination row with latitude and longitude\n * @returns Object containing distance in kilometers and toll price (0 for now as ORS doesn't provide toll info)\n */\nexport async function calculateRouteForLorry(destination: TableRow): Promise<RouteCalculationResult> {\n  if (!OPENROUTESERVICE_API_KEY) {\n    console.warn(\"OpenRouteService API key not configured\");\n    return { distanceKm: 0, tollPrice: 0 };\n  }\n\n  if (!destination.latitude || !destination.longitude) {\n    console.warn(`No coordinates for destination: ${destination.location}`);\n    return { distanceKm: 0, tollPrice: 0 };\n  }\n\n  try {\n    const url = \"https://api.openrouteservice.org/v2/directions/driving-hgv/json\";\n    \n    // OpenRouteService uses [longitude, latitude] format (opposite of Google Maps!)\n    const requestBody = {\n      coordinates: [\n        [QL_KITCHEN_LOCATION.longitude, QL_KITCHEN_LOCATION.latitude],\n        [parseFloat(destination.longitude.toString()), parseFloat(destination.latitude.toString())]\n      ],\n      preference: \"shortest\", // Shortest route (can also use \"fastest\" or \"recommended\")\n      units: \"m\", // Return distances in meters\n      language: \"en\",\n      geometry: false, // We don't need the full geometry, just distance\n      instructions: false, // We don't need turn-by-turn instructions\n      elevation: false,\n      extra_info: [],\n      options: {\n        vehicle_type: \"hgv\", // Heavy Goods Vehicle (lorry)\n        avoid_features: [\"ferries\"], // Avoid ferries for lorries\n      }\n    };\n\n    const response = await fetch(url, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": OPENROUTESERVICE_API_KEY,\n        \"Accept\": \"application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8\"\n      },\n      body: JSON.stringify(requestBody),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      \n      // Handle rate limiting specifically\n      if (response.status === 429) {\n        console.warn(`OpenRouteService rate limit exceeded for ${destination.location}. Please wait before retrying.`);\n      } else {\n        console.error(`OpenRouteService API error: ${response.status} - ${errorText}`);\n      }\n      \n      return { distanceKm: 0, tollPrice: 0 };\n    }\n\n    const data: ORSRouteResponse = await response.json();\n    \n    if (!data.routes || data.routes.length === 0) {\n      console.warn(`No route found for destination: ${destination.location}`);\n      return { distanceKm: 0, tollPrice: 0 };\n    }\n\n    const route = data.routes[0];\n    \n    // Extract distance in kilometers (ORS returns meters)\n    const distanceKm = route.summary?.distance \n      ? Math.round((route.summary.distance / 1000) * 10) / 10 \n      : 0;\n    \n    // Note: OpenRouteService doesn't provide toll information\n    // Toll prices would need to be calculated separately or from another service\n    const tollPrice = 0;\n    \n    return { distanceKm, tollPrice };\n  } catch (error) {\n    console.error(`Error calculating route for ${destination.location}:`, error);\n    return { distanceKm: 0, tollPrice: 0 };\n  }\n}\n\n/**\n * Legacy function for backward compatibility\n * @deprecated Use calculateRouteForLorry instead\n */\nexport async function calculateTollPrice(destination: TableRow): Promise<number> {\n  const result = await calculateRouteForLorry(destination);\n  return result.tollPrice;\n}\n\n/**\n * Calculate routes (distance and toll prices) for multiple destinations in batch\n * Uses lorry-optimized routing with shortest road preference\n * @param destinations Array of destination rows\n * @returns Object with distances and toll prices for each destination\n */\nexport async function calculateRoutesForDestinations(\n  destinations: TableRow[]\n): Promise<{ distances: Record<string, number>; tollPrices: Record<string, number> }> {\n  const distances: Record<string, number> = {};\n  const tollPrices: Record<string, number> = {};\n\n  // Process destinations serially with rate limiting\n  // OpenRouteService free tier: 40 requests/minute, 2000 requests/day\n  // To stay safely under 40/min, we wait 1500ms between each request (40 requests per 60 seconds)\n  \n  for (let i = 0; i < destinations.length; i++) {\n    const dest = destinations[i];\n    \n    try {\n      const result = await calculateRouteForLorry(dest);\n      distances[dest.id] = result.distanceKm;\n      tollPrices[dest.id] = result.tollPrice;\n    } catch (error) {\n      console.error(`Failed to calculate route for ${dest.location}:`, error);\n      distances[dest.id] = 0;\n      tollPrices[dest.id] = 0;\n    }\n\n    // Wait 1500ms between requests to respect 40 req/min limit\n    // Skip delay after the last request\n    if (i < destinations.length - 1) {\n      await new Promise(resolve => setTimeout(resolve, 1500));\n    }\n  }\n\n  return { distances, tollPrices };\n}\n\n/**\n * Legacy function for backward compatibility\n * @deprecated Use calculateRoutesForDestinations instead\n */\nexport async function calculateTollPricesForDestinations(\n  destinations: TableRow[]\n): Promise<Record<string, number>> {\n  const result = await calculateRoutesForDestinations(destinations);\n  return result.tollPrices;\n}\n","size_bytes":5854},"client/src/pages/help.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { \n  BookOpen, \n  Home, \n  Table2, \n  Edit3, \n  Route, \n  Map, \n  Image, \n  Truck, \n  Share2,\n  Lightbulb,\n  Play,\n  Keyboard,\n  AlertCircle,\n  Database\n} from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\n\nexport default function HelpPage() {\n  return (\n    <div className=\"min-h-screen w-full bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950\">\n      <div className=\"max-w-4xl mx-auto p-4 sm:p-6 lg:p-8\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 rounded-lg bg-blue-500/10 border border-blue-500/20\">\n              <BookOpen className=\"h-6 w-6 text-blue-400\" />\n            </div>\n            <h1 className=\"text-3xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent\">\n              User Guide\n            </h1>\n          </div>\n          <Link href=\"/\">\n            <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\n              <Home className=\"h-4 w-4\" />\n              Back\n            </Button>\n          </Link>\n        </div>\n\n        <Card className=\"bg-slate-900/50 border-slate-800 backdrop-blur-sm\">\n          <CardHeader>\n            <CardTitle className=\"text-slate-100 flex items-center gap-2\">\n              <Database className=\"h-5 w-5 text-blue-400\" />\n              Welcome to the Route Management System\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ScrollArea className=\"h-[calc(100vh-250px)] pr-4\">\n              <div className=\"space-y-6 text-slate-300 leading-relaxed text-sm\">\n                \n                <section>\n                  <h2 className=\"text-lg font-semibold text-slate-100 mb-3 flex items-center gap-2\">\n                    <BookOpen className=\"h-4 w-4 text-blue-400\" />\n                    What is This App?\n                  </h2>\n                  <p className=\"text-sm\">\n                    This is a comprehensive delivery route management system designed to help you efficiently manage \n                    delivery location data. You can organize, edit, and optimize delivery routes with ease using an \n                    interactive drag-and-drop interface. The system is built to streamline your logistics operations \n                    and improve delivery efficiency.\n                  </p>\n                </section>\n\n                <section>\n                  <h2 className=\"text-lg font-semibold text-slate-100 mb-3\">Key Features</h2>\n                  \n                  <div className=\"space-y-4\">\n                    <div>\n                      <h3 className=\"font-semibold text-blue-400 mb-2 flex items-center gap-2 text-sm\">\n                        <Table2 className=\"h-4 w-4\" />\n                        1. Table Management\n                      </h3>\n                      <ul className=\"list-disc list-inside space-y-1 ml-4 text-sm\">\n                        <li>Add, edit, and delete location data rows</li>\n                        <li>Drag-and-drop to reorder entries</li>\n                        <li>Show/hide columns based on your needs</li>\n                        <li>Search and filter to quickly find data</li>\n                        <li>Real-time calculations and statistics</li>\n                      </ul>\n                    </div>\n\n                    <div>\n                      <h3 className=\"font-semibold text-blue-400 mb-2 flex items-center gap-2 text-sm\">\n                        <Edit3 className=\"h-4 w-4\" />\n                        2. Edit Mode\n                      </h3>\n                      <ul className=\"list-disc list-inside space-y-1 ml-4 text-sm\">\n                        <li>Click the menu button (‚ò∞) and select \"Enter Edit Mode\"</li>\n                        <li>Add, modify, or delete data while in edit mode</li>\n                        <li>Drag-and-drop to rearrange columns</li>\n                        <li>Customize marker colors for map visualization</li>\n                        <li>Click \"Exit Edit Mode\" when finished</li>\n                      </ul>\n                    </div>\n\n                    <div>\n                      <h3 className=\"font-semibold text-blue-400 mb-2 flex items-center gap-2 text-sm\">\n                        <Route className=\"h-4 w-4\" />\n                        3. Route Optimization\n                      </h3>\n                      <ul className=\"list-disc list-inside space-y-1 ml-4 text-sm\">\n                        <li>Click \"Optimize Route\" to calculate optimal delivery sequences</li>\n                        <li>System automatically calculates distances and arranges the shortest routes</li>\n                        <li>Supports Heavy Goods Vehicle (HGV/Lorry) routing profiles</li>\n                        <li>View distances in kilometers from your base location (QL Kitchen)</li>\n                        <li>Batch processing with intelligent rate limiting</li>\n                      </ul>\n                    </div>\n\n                    <div>\n                      <h3 className=\"font-semibold text-blue-400 mb-2 flex items-center gap-2 text-sm\">\n                        <Map className=\"h-4 w-4\" />\n                        4. Map View\n                      </h3>\n                      <ul className=\"list-disc list-inside space-y-1 ml-4 text-sm\">\n                        <li>Click the info icon (‚ìò) to view locations on the map</li>\n                        <li>Marker colors can be customized in edit mode</li>\n                        <li>Fullscreen map view for better visualization</li>\n                        <li>Automatic route calculation from base location</li>\n                        <li>Interactive markers with location details</li>\n                      </ul>\n                    </div>\n\n                    <div>\n                      <h3 className=\"font-semibold text-blue-400 mb-2 flex items-center gap-2 text-sm\">\n                        <Image className=\"h-4 w-4\" />\n                        5. Image Gallery\n                      </h3>\n                      <ul className=\"list-disc list-inside space-y-1 ml-4 text-sm\">\n                        <li>Upload images for each location</li>\n                        <li>Support for multiple images per location</li>\n                        <li>Lightbox view to see images in full size</li>\n                        <li>Upload from your device or enter image URLs</li>\n                        <li>Support for various image formats and large files</li>\n                      </ul>\n                    </div>\n\n                    <div>\n                      <h3 className=\"font-semibold text-blue-400 mb-2 flex items-center gap-2 text-sm\">\n                        <Truck className=\"h-4 w-4\" />\n                        6. Delivery Alternate System\n                      </h3>\n                      <ul className=\"list-disc list-inside space-y-1 ml-4 text-sm\">\n                        <li>4 delivery states: Normal, Alt 1, Alt 2, Inactive</li>\n                        <li>Alt 1: Deliveries on Monday/Wednesday/Friday/Sunday</li>\n                        <li>Alt 2: Deliveries on Tuesday/Thursday/Saturday</li>\n                        <li>Automatic sorting based on current day</li>\n                        <li>Color-coded visual indicators for each state</li>\n                        <li>Off-schedule entries displayed with reduced brightness</li>\n                      </ul>\n                    </div>\n\n                    <div>\n                      <h3 className=\"font-semibold text-blue-400 mb-2 flex items-center gap-2 text-sm\">\n                        <Share2 className=\"h-4 w-4\" />\n                        7. Share Table\n                      </h3>\n                      <ul className=\"list-disc list-inside space-y-1 ml-4 text-sm\">\n                        <li>Click \"Share Table\" to generate a shareable link</li>\n                        <li>Save links with custom names for easy reference</li>\n                        <li>Share links with team members for view-only access</li>\n                        <li>Access saved links from the menu</li>\n                        <li>Shared tables maintain your current filters and column visibility</li>\n                      </ul>\n                    </div>\n                  </div>\n                </section>\n\n                <section>\n                  <h2 className=\"text-lg font-semibold text-slate-100 mb-3 flex items-center gap-2\">\n                    <Lightbulb className=\"h-4 w-4 text-yellow-400\" />\n                    Usage Tips\n                  </h2>\n                  <ul className=\"list-disc list-inside space-y-2 ml-4 text-sm\">\n                    <li>\n                      <span className=\"font-semibold\">Default Columns:</span> By default, only 4 columns \n                      are displayed (No, Code, Location, Delivery). Use \"Show/Hide Columns\" to \n                      toggle additional columns.\n                    </li>\n                    <li>\n                      <span className=\"font-semibold\">Drag Handle:</span> Use the drag icon (‚ãÆ‚ãÆ) on the left \n                      side of each row to drag-and-drop and reorder entries.\n                    </li>\n                    <li>\n                      <span className=\"font-semibold\">Search:</span> Use the search box to quickly find data. \n                      Search works across all visible columns.\n                    </li>\n                    <li>\n                      <span className=\"font-semibold\">Filters:</span> Filter by Route or Delivery status \n                      using the dropdown filters for focused views.\n                    </li>\n                    <li>\n                      <span className=\"font-semibold\">Calculations:</span> The \"Totals\" row at the bottom \n                      automatically calculates sum/count based on visible data (after filters/search).\n                    </li>\n                    <li>\n                      <span className=\"font-semibold\">Inactive Rows:</span> Toggle the active/inactive state \n                      to temporarily hide locations. Inactive rows automatically sort to the bottom.\n                    </li>\n                    <li>\n                      <span className=\"font-semibold\">Header Content:</span> Slide left/right to view \n                      different header pages if multiple pages are configured.\n                    </li>\n                    <li>\n                      <span className=\"font-semibold\">Layout Preferences:</span> Your column visibility and order \n                      preferences are saved per user and persist across sessions.\n                    </li>\n                  </ul>\n                </section>\n\n                <section>\n                  <h2 className=\"text-lg font-semibold text-slate-100 mb-3 flex items-center gap-2\">\n                    <Play className=\"h-4 w-4 text-green-400\" />\n                    Getting Started\n                  </h2>\n                  <ol className=\"list-decimal list-inside space-y-2 ml-4 text-sm\">\n                    <li>Browse the existing table data to familiarize yourself with the interface</li>\n                    <li>Use search and filters to explore the data</li>\n                    <li>Click the menu button (‚ò∞) to access additional options</li>\n                    <li>Enter Edit Mode to make changes to the data</li>\n                    <li>Try drag-and-drop to reorder rows and customize your view</li>\n                    <li>Click the info icon (‚ìò) to view locations on the map</li>\n                    <li>Use \"Optimize Route\" to calculate efficient delivery sequences</li>\n                    <li>Exit Edit Mode when you're done making changes</li>\n                  </ol>\n                </section>\n\n                <section>\n                  <h2 className=\"text-lg font-semibold text-slate-100 mb-3 flex items-center gap-2\">\n                    <Keyboard className=\"h-4 w-4 text-purple-400\" />\n                    Keyboard Shortcuts\n                  </h2>\n                  <ul className=\"list-disc list-inside space-y-1 ml-4 text-sm\">\n                    <li><kbd className=\"px-2 py-1 text-xs bg-slate-800 rounded border border-slate-700\">Esc</kbd> - Close modal/dialog windows</li>\n                    <li><kbd className=\"px-2 py-1 text-xs bg-slate-800 rounded border border-slate-700\">Enter</kbd> - Submit forms and confirm actions</li>\n                  </ul>\n                </section>\n\n                <section className=\"bg-blue-500/10 border border-blue-500/20 rounded-lg p-4\">\n                  <h2 className=\"text-lg font-semibold text-blue-400 mb-2 flex items-center gap-2\">\n                    <AlertCircle className=\"h-4 w-4\" />\n                    Important Notes\n                  </h2>\n                  <ul className=\"list-disc list-inside space-y-1 ml-4 text-sm\">\n                    <li><span className=\"font-semibold\">Route Optimization:</span> Uses OpenRouteService API for commercial vehicle routing</li>\n                    <li><span className=\"font-semibold\">Toll Information:</span> Toll prices are not available and will display as 0</li>\n                    <li><span className=\"font-semibold\">Rate Limits:</span> Free tier allows 40 requests per minute, 2000 requests per day</li>\n                    <li><span className=\"font-semibold\">Batch Processing:</span> For routes with many locations, the system processes requests sequentially to respect rate limits</li>\n                    <li><span className=\"font-semibold\">Data Privacy:</span> Your layout preferences and settings are stored locally per user</li>\n                  </ul>\n                </section>\n\n                <section className=\"bg-green-500/10 border border-green-500/20 rounded-lg p-4\">\n                  <h2 className=\"text-lg font-semibold text-green-400 mb-2\">Best Practices</h2>\n                  <ul className=\"list-disc list-inside space-y-1 ml-4 text-sm\">\n                    <li>Regularly save your work using the \"Save Layout\" option</li>\n                    <li>Use descriptive names when saving share links for easy identification</li>\n                    <li>Keep location coordinates accurate for optimal route calculations</li>\n                    <li>Use the delivery alternate system to organize regular delivery schedules</li>\n                    <li>Take advantage of filters to focus on specific routes or delivery types</li>\n                  </ul>\n                </section>\n\n                <section>\n                  <p className=\"text-center text-slate-400 italic mt-8 text-sm\">\n                    For technical support or questions, please contact your system administrator.\n                  </p>\n                  <p className=\"text-center text-slate-500 text-xs mt-4\">\n                    Route Management System ‚Ä¢ Version 1.0.0\n                  </p>\n                </section>\n\n              </div>\n            </ScrollArea>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":15126},"client/src/pages/custom-table-list.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Plus, Share2, Trash2, Copy, Check, Home } from \"lucide-react\";\nimport type { TableRow, CustomTable } from \"@shared/schema\";\nimport { Footer } from \"@/components/footer\";\nimport { LoadingOverlay } from \"@/components/skeleton-loader\";\nimport { useTheme } from \"@/components/theme-provider\";\nimport { useLocation } from \"wouter\";\n\nexport default function CustomTableList() {\n  const [selectedRows, setSelectedRows] = useState<Set<string>>(new Set());\n  const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false);\n  const [tableName, setTableName] = useState(\"\");\n  const [tableDescription, setTableDescription] = useState(\"\");\n  const [shareUrl, setShareUrl] = useState(\"\");\n  const [copiedId, setCopiedId] = useState(\"\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [deliveryFilter, setDeliveryFilter] = useState<string[]>([]);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { theme, toggleTheme } = useTheme();\n  const [, setLocation] = useLocation();\n\n  // Fetch all table rows\n  const { data: tableRows = [], isLoading: isLoadingRows } = useQuery<TableRow[]>({\n    queryKey: [\"/api/table-rows\"],\n  });\n\n  // Fetch custom tables\n  const { data: customTables = [], isLoading: isLoadingTables } = useQuery<CustomTable[]>({\n    queryKey: [\"/api/custom-tables\"],\n  });\n\n  // Filter table rows based on search and delivery filter\n  const filteredRows = tableRows.filter((row) => {\n    // Search filter\n    const matchesSearch = searchTerm === \"\" || \n      Object.values(row).some(value => \n        String(value).toLowerCase().includes(searchTerm.toLowerCase())\n      );\n\n    // Delivery filter (hide selected delivery types)\n    const matchesDelivery = deliveryFilter.length === 0 || \n      !deliveryFilter.includes(row.delivery);\n\n    return matchesSearch && matchesDelivery;\n  });\n\n  // Get unique delivery types\n  const deliveryOptions = Array.from(\n    new Set(tableRows.map(row => row.delivery).filter(Boolean))\n  ) as string[];\n\n  // Create custom table mutation\n  const createTableMutation = useMutation({\n    mutationFn: async (data: { name: string; description: string; rowIds: string[] }) => {\n      const response = await apiRequest(\"POST\", \"/api/custom-tables\", data);\n      if (!response.ok) {\n        throw new Error(\"Failed to create custom table\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/custom-tables\"] });\n      setIsCreateDialogOpen(false);\n      setTableName(\"\");\n      setTableDescription(\"\");\n      setSelectedRows(new Set());\n      toast({\n        title: \"Custom table created!\",\n        description: \"Your custom table has been created successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create custom table. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete custom table mutation\n  const deleteTableMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const response = await apiRequest(\"DELETE\", `/api/custom-tables/${id}`);\n      if (!response.ok) {\n        throw new Error(\"Failed to delete custom table\");\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/custom-tables\"] });\n      toast({\n        title: \"Table deleted\",\n        description: \"Custom table has been deleted.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete custom table.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const toggleRowSelection = (rowId: string) => {\n    const newSelection = new Set(selectedRows);\n    if (newSelection.has(rowId)) {\n      newSelection.delete(rowId);\n    } else {\n      newSelection.add(rowId);\n    }\n    setSelectedRows(newSelection);\n  };\n\n  const handleCreateTable = () => {\n    if (!tableName.trim()) {\n      toast({\n        title: \"Name required\",\n        description: \"Please enter a table name.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (selectedRows.size === 0) {\n      toast({\n        title: \"No locations selected\",\n        description: \"Please select at least one location.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    createTableMutation.mutate({\n      name: tableName,\n      description: tableDescription,\n      rowIds: Array.from(selectedRows),\n    });\n  };\n\n  const copyShareLink = async (customTable: CustomTable) => {\n    const url = `${window.location.origin}/custom/${customTable.shareId}`;\n    try {\n      await navigator.clipboard.writeText(url);\n      setCopiedId(customTable.id);\n      setShareUrl(url);\n      toast({\n        title: \"Link copied!\",\n        description: \"Share link copied to clipboard.\",\n      });\n      setTimeout(() => setCopiedId(\"\"), 2000);\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to copy link.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  if (isLoadingRows || isLoadingTables) {\n    return <LoadingOverlay type=\"orbit\" />;\n  }\n\n  return (\n    <>\n      {/* Simple Header with Home Button */}\n      <nav className=\"sticky top-0 z-50 w-full border-b border-white/20 dark:border-white/10 bg-white/30 dark:bg-black/30 backdrop-blur-2xl shadow-[0_8px_32px_0_rgba(0,0,0,0.12)]\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"flex h-14 items-center justify-between text-[12px]\">\n            {/* Logo/Brand */}\n            <div className=\"flex items-center space-x-2\">\n              <div className=\"flex items-center space-x-2 hover:opacity-80 transition-opacity\">\n                <div className=\"flex h-8 w-8 items-center justify-center rounded-lg overflow-hidden\">\n                  <img \n                    src=\"/assets/FamilyMart.png\" \n                    alt=\"Logo\" \n                    className=\"h-full w-full object-cover\"\n                  />\n                </div>\n                <div className=\"flex flex-col\">\n                  <span className=\"font-bold text-slate-600 dark:text-slate-300\" style={{ fontSize: '14px' }}>\n                    Custom Table Lists\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            {/* Home Button */}\n            <Button\n              onClick={() => setLocation(\"/\")}\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"btn-glass w-8 h-8 md:w-auto md:h-9 p-0 md:px-3 pagination-button group transition-all duration-300 ease-out hover:scale-110 hover:shadow-lg hover:shadow-blue-500/20 active:scale-95 active:shadow-none\"\n              title=\"Home\"\n            >\n              <Home className=\"w-4 h-4 text-blue-600 dark:text-blue-400 transition-all duration-300\" />\n              <span className=\"hidden md:inline ml-2 text-xs transition-all duration-300\">Home</span>\n            </Button>\n          </div>\n        </div>\n      </nav>\n\n      <main className=\"min-h-screen bg-gray-50 dark:bg-black pt-6 pb-20\">\n        <div className=\"max-w-7xl mx-auto px-6\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <h5 className=\"font-bold mb-2 bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-400 dark:to-indigo-400 bg-clip-text text-transparent text-[14px]\">\n            Custom Table Lists\n          </h5>\n          <p className=\"text-gray-600 dark:text-gray-400\">\n            Select locations to create custom tables and share them with others\n          </p>\n        </div>\n\n        {/* Action Bar */}\n        <div className=\"flex justify-between items-center mb-6\">\n          <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n            {selectedRows.size} location(s) selected\n          </div>\n          <Button\n            onClick={() => setIsCreateDialogOpen(true)}\n            disabled={selectedRows.size === 0}\n            className={`bg-transparent border border-gray-300 dark:border-gray-700 ${\n              selectedRows.size > 0 \n                ? \"text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/10\" \n                : \"text-gray-400 dark:text-gray-600\"\n            } disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent transition-colors`}\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Create Custom Table\n          </Button>\n        </div>\n\n        {/* Location Selection Table */}\n        <div className=\"bg-white/90 dark:bg-black/30 backdrop-blur-2xl border-2 border-gray-300 dark:border-white/10 shadow-xl rounded-3xl overflow-hidden mb-8\">\n          {/* Header with Search */}\n          <div className=\"p-6 pb-4 border-b border-gray-300 dark:border-white/10\">\n            <h2 className=\"text-sm font-semibold mb-4 bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-400 dark:to-indigo-400 bg-clip-text text-transparent\">\n              Select Locations\n            </h2>\n            <div className=\"flex gap-3\">\n              <Input\n                placeholder=\"Search locations...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"max-w-sm bg-white dark:bg-black/20 border-gray-300 dark:border-white/20 text-sm h-8 shadow-sm\"\n              />\n              <div className=\"text-xs text-gray-600 dark:text-gray-400 flex items-center px-3 bg-white dark:bg-black/20 rounded-md border border-gray-300 dark:border-white/20 shadow-sm font-medium\">\n                {selectedRows.size} selected\n              </div>\n            </div>\n          </div>\n\n          {/* Table with Scroll */}\n          <div className=\"overflow-x-auto overflow-y-auto max-h-[600px] scrollbar-thin scrollbar-thumb-gray-400 dark:scrollbar-thumb-gray-600 scrollbar-track-transparent\">\n            <table className=\"w-full min-w-[600px]\">\n              <thead className=\"bg-gradient-to-r from-slate-200 to-slate-300 dark:from-slate-800/50 dark:to-slate-900/50 sticky top-0 z-10\">\n                <tr className=\"border-b-2 border-gray-300 dark:border-white/10\">\n                  <th className=\"px-4 py-2 text-left text-xs font-semibold whitespace-nowrap\">\n                    <Checkbox\n                      checked={selectedRows.size === filteredRows.length && filteredRows.length > 0}\n                      onCheckedChange={(checked) => {\n                        if (checked) {\n                          setSelectedRows(new Set(filteredRows.map(row => row.id)));\n                        } else {\n                          setSelectedRows(new Set());\n                        }\n                      }}\n                    />\n                  </th>\n                  <th className=\"px-4 py-2 text-left text-xs font-semibold whitespace-nowrap\">No</th>\n                  <th className=\"px-4 py-2 text-left text-xs font-semibold whitespace-nowrap\">Route</th>\n                  <th className=\"px-4 py-2 text-left text-xs font-semibold whitespace-nowrap\">Code</th>\n                  <th className=\"px-4 py-2 text-left text-xs font-semibold whitespace-nowrap\">Location</th>\n                  <th className=\"px-4 py-2 text-left text-xs font-semibold whitespace-nowrap\">Delivery</th>\n                </tr>\n              </thead>\n              <tbody>\n                {filteredRows.length === 0 ? (\n                  <tr>\n                    <td colSpan={6} className=\"px-4 py-12 text-center text-gray-600 dark:text-gray-400\">\n                      {searchTerm ? \"No locations found matching your search\" : \"No locations available\"}\n                    </td>\n                  </tr>\n                ) : (\n                  filteredRows.map((row, index) => {\n                    const isSelected = selectedRows.has(row.id);\n                    return (\n                      <tr\n                        key={row.id}\n                        className={`border-b border-gray-200 dark:border-gray-900 hover:bg-blue-50 dark:hover:bg-blue-900/10 transition-colors cursor-pointer ${\n                          isSelected ? \"text-green-600 dark:text-green-400 font-semibold\" : \"text-gray-900 dark:text-gray-100\"\n                        }`}\n                        onClick={() => toggleRowSelection(row.id)}\n                      >\n                        <td className=\"px-4 py-2\">\n                          <Checkbox\n                            checked={isSelected}\n                            onCheckedChange={() => toggleRowSelection(row.id)}\n                            onClick={(e) => e.stopPropagation()}\n                          />\n                        </td>\n                        <td className={`px-4 py-2 text-xs font-medium whitespace-nowrap ${isSelected ? \"font-semibold\" : \"\"}`}>\n                          {row.no}\n                        </td>\n                        <td className=\"px-4 py-2 text-xs whitespace-nowrap\">\n                          <span className=\"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300\">\n                            {row.route}\n                          </span>\n                        </td>\n                        <td className={`px-4 py-2 text-xs whitespace-nowrap ${isSelected ? \"font-semibold\" : \"\"}`}>\n                          {row.code}\n                        </td>\n                        <td className={`px-4 py-2 text-xs font-semibold max-w-[300px] truncate ${isSelected ? \"font-bold\" : \"\"}`} title={row.location}>\n                          {row.location}\n                        </td>\n                        <td className=\"px-4 py-2 text-xs whitespace-nowrap\">\n                          <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-medium ${\n                            row.delivery === 'Daily' \n                              ? 'bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300'\n                              : row.delivery === 'Alt 1'\n                              ? 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300'\n                              : row.delivery === 'Alt 2'\n                              ? 'bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-300'\n                              : 'bg-gray-100 dark:bg-gray-900/30 text-gray-800 dark:text-gray-300'\n                          }`}>\n                            {row.delivery}\n                          </span>\n                        </td>\n                      </tr>\n                    );\n                  })\n                )}\n              </tbody>\n            </table>\n          </div>\n\n          {/* Footer */}\n          <div className=\"p-4 bg-gradient-to-r from-slate-200 to-slate-300 dark:from-slate-800/50 dark:to-slate-900/50 border-t border-gray-300 dark:border-white/10\">\n            <div className=\"text-xs text-gray-600 dark:text-gray-400 font-medium\">\n              Showing {filteredRows.length} of {tableRows.length} location(s)\n            </div>\n          </div>\n        </div>\n\n        {/* Existing Custom Tables */}\n        <div className=\"bg-white/90 dark:bg-black/30 backdrop-blur-2xl border-2 border-gray-300 dark:border-white/10 shadow-xl rounded-3xl p-6\">\n          <h2 className=\"text-xl font-semibold mb-4 text-gray-900 dark:text-white\">My Custom Tables</h2>\n          {customTables.length === 0 ? (\n            <p className=\"text-center text-gray-600 dark:text-gray-400 py-8\">\n              No custom tables yet. Create one to get started!\n            </p>\n          ) : (\n            <div className=\"space-y-4\">\n              {customTables.map((table) => (\n                <div\n                  key={table.id}\n                  className=\"flex items-center justify-between p-4 bg-transparent rounded-xl border border-gray-300 dark:border-gray-800/40 hover:bg-gray-50 dark:hover:bg-white/5 transition-colors\"\n                >\n                  <div className=\"flex-1\">\n                    <h3 className=\"font-semibold text-lg text-gray-900 dark:text-white\">{table.name}</h3>\n                    {table.description && (\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400\">{table.description}</p>\n                    )}\n                    <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-1\">\n                      Created {new Date(table.createdAt).toLocaleDateString()}\n                    </p>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      onClick={() => copyShareLink(table)}\n                      size=\"sm\"\n                      variant=\"outline\"\n                      className=\"bg-transparent border-transparent hover:bg-blue-500/10\"\n                      title=\"Copy share link\"\n                    >\n                      {copiedId === table.id ? (\n                        <Check className=\"h-4 w-4 text-green-500\" />\n                      ) : (\n                        <Share2 className=\"h-4 w-4\" />\n                      )}\n                    </Button>\n                    <Button\n                      onClick={() => window.open(`/custom/${table.shareId}`, \"_blank\")}\n                      size=\"sm\"\n                      variant=\"outline\"\n                      className=\"bg-transparent border-transparent hover:bg-blue-500/10\"\n                    >\n                      View\n                    </Button>\n                    <Button\n                      onClick={() => deleteTableMutation.mutate(table.id)}\n                      size=\"sm\"\n                      variant=\"outline\"\n                      className=\"bg-transparent border-transparent hover:bg-red-500/10 text-red-500\"\n                      title=\"Delete table\"\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Create Table Dialog */}\n        <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>\n        <DialogContent \n          className=\"bg-white/90 dark:bg-black/30 backdrop-blur-2xl border-2 border-gray-300 dark:border-white/10 shadow-xl rounded-3xl\"\n          style={{\n            maxHeight: 'min(80vh, calc(100dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom) - 40px))',\n            touchAction: 'pan-y',\n          }}\n        >\n          <div \n            className=\"absolute inset-0 -z-10 rounded-3xl bg-gradient-to-br from-white/60 via-white/40 to-white/50 dark:from-black/40 dark:via-black/20 dark:to-black/30 border-0 shadow-inner\" \n            style={{\n              backdropFilter: 'blur(40px)',\n              WebkitBackdropFilter: 'blur(40px)',\n            }}\n          />\n          <DialogHeader \n            className=\"relative z-10\"\n            style={{ paddingTop: 'max(1.5rem, env(safe-area-inset-top))' }}\n          >\n            <DialogTitle>Create Custom Table</DialogTitle>\n            <DialogDescription>\n              Enter a name and optional description for your custom table.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4 relative z-10\">\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Table Name *</label>\n              <Input\n                value={tableName}\n                onChange={(e) => setTableName(e.target.value)}\n                placeholder=\"e.g., Weekend Deliveries\"\n                className=\"bg-white/10 dark:bg-black/10 backdrop-blur-sm border-transparent\"\n              />\n            </div>\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Description (optional)</label>\n              <Input\n                value={tableDescription}\n                onChange={(e) => setTableDescription(e.target.value)}\n                placeholder=\"Add a description...\"\n                className=\"bg-white/10 dark:bg-black/10 backdrop-blur-sm border-transparent\"\n              />\n            </div>\n            <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n              {selectedRows.size} location(s) will be included in this table\n            </div>\n          </div>\n          <DialogFooter \n            className=\"relative z-10\"\n            style={{ paddingBottom: 'max(1rem, env(safe-area-inset-bottom))' }}\n          >\n            <Button\n              variant=\"outline\"\n              onClick={() => setIsCreateDialogOpen(false)}\n              className=\"bg-transparent border-transparent text-red-500 hover:bg-red-500/10\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleCreateTable}\n              disabled={createTableMutation.isPending}\n              className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n            >\n              {createTableMutation.isPending ? \"Creating...\" : \"Create Table\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n        </div>\n      </main>\n      <Footer />\n    </>\n  );\n}\n","size_bytes":21507},"client/src/pages/custom-table.tsx":{"content":"import React, { useEffect, useState, useMemo } from \"react\";\nimport { useRoute } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { DataTable } from \"@/components/data-table\";\nimport { useTableData } from \"@/hooks/use-table-data\";\nimport { LoadingOverlay } from \"@/components/skeleton-loader\";\nimport { Footer } from \"@/components/footer\";\nimport { Database } from \"lucide-react\";\nimport { calculateDistance } from \"@/utils/distance\";\nimport type { CustomTable, TableColumn, TableRow } from \"@shared/schema\";\n\nexport default function CustomTableView() {\n  const [, params] = useRoute(\"/custom/:shareId\");\n  const shareId = params?.shareId;\n\n  const { \n    columns, \n    isLoading,\n  } = useTableData();\n\n  // Fetch custom table details\n  const { data: customTable, isLoading: isLoadingTable, error } = useQuery<CustomTable>({\n    queryKey: [`/api/custom-tables/share/${shareId}`],\n    enabled: !!shareId,\n  });\n\n  // Fetch custom table rows\n  const { data: rows = [], isLoading: isLoadingRows } = useQuery<TableRow[]>({\n    queryKey: [`/api/custom-tables/${customTable?.id}/rows`],\n    enabled: !!customTable?.id,\n  });\n\n  // Local state for interactive features (delivery filter ONLY - route filter hidden but still applied)\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [deliveryFilters, setDeliveryFilters] = useState<string[]>([]);\n  const [routeFilters, setRouteFilters] = useState<string[]>([]);\n  const [selectedRowForImage, setSelectedRowForImage] = useState<string | null>(null);\n\n  // Apply filters and column visibility\n  const { filteredRows, displayColumns, deliveryOptions } = useMemo(() => {\n    if (rows.length === 0 || columns.length === 0) {\n      return { \n        filteredRows: rows, \n        displayColumns: columns,\n        deliveryOptions: []\n      };\n    }\n\n    // Get unique delivery types\n    const deliveries = Array.from(new Set(rows.map(row => row.delivery).filter(Boolean))) as string[];\n\n    // Filter rows (clone to avoid mutating query cache)\n    let filtered = [...rows];\n    \n    // Apply delivery alternate day-based filtering\n    const today = new Date().getDay(); // 0=Sun, 1=Mon, 2=Tue, 3=Wed, 4=Thu, 5=Fri, 6=Sat\n    const isAlt1Day = [1, 3, 5, 0].includes(today); // Mon, Wed, Fri, Sun\n    const isAlt2Day = [2, 4, 6].includes(today); // Tue, Thu, Sat\n    \n    // Sort based on delivery alternate and current day\n    filtered = filtered.sort((a, b) => {\n      const aAlt = a.deliveryAlt || \"normal\";\n      const bAlt = b.deliveryAlt || \"normal\";\n      \n      // Inactive always at bottom\n      if (aAlt === \"inactive\" && bAlt !== \"inactive\") return 1;\n      if (aAlt !== \"inactive\" && bAlt === \"inactive\") return -1;\n      \n      // Priority based on day\n      if (isAlt1Day) {\n        // Alt1 and normal at top, alt2 at bottom\n        if ((aAlt === \"alt1\" || aAlt === \"normal\") && bAlt === \"alt2\") return -1;\n        if (aAlt === \"alt2\" && (bAlt === \"alt1\" || bAlt === \"normal\")) return 1;\n      } else if (isAlt2Day) {\n        // Alt2 and normal at top, alt1 at bottom\n        if ((aAlt === \"alt2\" || aAlt === \"normal\") && bAlt === \"alt1\") return -1;\n        if (aAlt === \"alt1\" && (bAlt === \"alt2\" || bAlt === \"normal\")) return 1;\n      }\n      \n      return 0;\n    });\n    \n    // Apply route filters\n    if (routeFilters.length > 0) {\n      filtered = filtered.filter(row => routeFilters.includes(row.route));\n    }\n\n    // Apply search filter\n    if (searchTerm) {\n      filtered = filtered.filter(row => \n        Object.values(row).some(value => \n          String(value).toLowerCase().includes(searchTerm.toLowerCase())\n        )\n      );\n    }\n\n    // Apply delivery filters (hide selected types)\n    if (deliveryFilters.length > 0) {\n      filtered = filtered.filter(row => !deliveryFilters.includes(row.delivery));\n    }\n\n    // Use all columns as visible, but hide latitude, longitude, and tollPrice (not in edit mode)\n    const visibleCols = columns.filter(col => \n      col.dataKey !== 'latitude' && col.dataKey !== 'longitude' && col.dataKey !== 'tollPrice'\n    );\n\n    return { \n      filteredRows: filtered, \n      displayColumns: visibleCols,\n      deliveryOptions: deliveries\n    };\n  }, [rows, columns, searchTerm, deliveryFilters, routeFilters]);\n\n  // Calculate distances for kilometer column\n  const rowsWithDistances = useMemo(() => {\n    // Find QL Kitchen coordinates from full rows collection\n    const qlKitchenRow = rows.find(row => row.location === \"QL Kitchen\");\n    \n    if (!qlKitchenRow || !qlKitchenRow.latitude || !qlKitchenRow.longitude) {\n      return filteredRows.map(row => ({ ...row, kilometer: \"‚Äî\", segmentDistance: 0 }));\n    }\n\n    const qlLat = parseFloat(qlKitchenRow.latitude);\n    const qlLng = parseFloat(qlKitchenRow.longitude);\n\n    if (!Number.isFinite(qlLat) || !Number.isFinite(qlLng)) {\n      return filteredRows.map(row => ({ ...row, kilometer: \"‚Äî\", segmentDistance: 0 }));\n    }\n\n    // Check if any filters are active\n    const hasActiveFilters = searchTerm !== \"\" || routeFilters.length > 0 || deliveryFilters.length > 0;\n\n    if (!hasActiveFilters) {\n      // NO FILTERS: Calculate direct distance from QL Kitchen to each route\n      return filteredRows.map((row) => {\n        if (row.location === \"QL Kitchen\") {\n          return { ...row, kilometer: 0, segmentDistance: 0 };\n        }\n\n        if (!row.latitude || !row.longitude) {\n          return { ...row, kilometer: \"‚Äî\", segmentDistance: 0 };\n        }\n\n        const currentLat = parseFloat(row.latitude);\n        const currentLng = parseFloat(row.longitude);\n\n        if (!Number.isFinite(currentLat) || !Number.isFinite(currentLng)) {\n          return { ...row, kilometer: \"‚Äî\", segmentDistance: 0 };\n        }\n\n        const directDistance = calculateDistance(qlLat, qlLng, currentLat, currentLng);\n        return { ...row, kilometer: directDistance, segmentDistance: directDistance };\n      });\n    } else {\n      // FILTERS ACTIVE: Calculate cumulative distance\n      let cumulativeDistance = 0;\n      let previousLat = qlLat;\n      let previousLng = qlLng;\n\n      return filteredRows.map((row) => {\n        if (row.location === \"QL Kitchen\") {\n          cumulativeDistance = 0;\n          previousLat = qlLat;\n          previousLng = qlLng;\n          return { ...row, kilometer: 0, segmentDistance: 0 };\n        }\n\n        if (!row.latitude || !row.longitude) {\n          return { ...row, kilometer: \"‚Äî\", segmentDistance: 0 };\n        }\n\n        const currentLat = parseFloat(row.latitude);\n        const currentLng = parseFloat(row.longitude);\n\n        if (!Number.isFinite(currentLat) || !Number.isFinite(currentLng)) {\n          return { ...row, kilometer: \"‚Äî\", segmentDistance: 0 };\n        }\n\n        const segmentDistance = calculateDistance(previousLat, previousLng, currentLat, currentLng);\n        cumulativeDistance += segmentDistance;\n\n        previousLat = currentLat;\n        previousLng = currentLng;\n\n        return { ...row, kilometer: cumulativeDistance, segmentDistance };\n      });\n    }\n  }, [rows, filteredRows, searchTerm, routeFilters, deliveryFilters]);\n\n  // Create read-only mutations (they work but don't persist)\n  const readOnlyUpdateMutation = useMutation({\n    mutationFn: async (data: { id: string; updates: Partial<any> }) => {\n      console.log(\"Read-only mode: Changes not saved\", data);\n      return data;\n    },\n  });\n\n  const readOnlyDeleteMutation = useMutation<void, Error, string>({\n    mutationFn: async (id: string) => {\n      console.log(\"Read-only mode: Delete not allowed\", id);\n    },\n  });\n\n  const readOnlyReorderRowsMutation = useMutation<TableRow[], Error, string[]>({\n    mutationFn: async (rowIds: string[]) => {\n      const reordered = rowIds\n        .map(id => rows.find(r => r.id === id))\n        .filter((r): r is TableRow => r !== undefined);\n      return reordered;\n    },\n  });\n\n  const readOnlyReorderColumnsMutation = useMutation<TableColumn[], Error, string[]>({\n    mutationFn: async (columnIds: string[]) => {\n      const reordered = columnIds\n        .map(id => columns.find(c => c.id === id))\n        .filter((c): c is TableColumn => c !== undefined);\n      return reordered;\n    },\n  });\n\n  const readOnlyDeleteColumnMutation = useMutation<void, Error, string>({\n    mutationFn: async (id: string) => {\n      console.log(\"Read-only mode: Column delete not allowed\", id);\n    },\n  });\n\n  const handleClearAllFilters = () => {\n    setSearchTerm(\"\");\n    setDeliveryFilters([]);\n  };\n\n  // Enhanced loading state - ensure minimum 5 second display\n  const [minLoadingComplete, setMinLoadingComplete] = React.useState(false);\n\n  React.useEffect(() => {\n    // Minimum 5 second loading timer\n    const timer = setTimeout(() => {\n      setMinLoadingComplete(true);\n    }, 5000);\n\n    return () => clearTimeout(timer);\n  }, []);\n\n  // Show loading overlay until data is loaded AND minimum timer complete\n  if (isLoading || isLoadingTable || isLoadingRows || !minLoadingComplete) {\n    return (\n      <div className=\"min-h-screen relative\">\n        <LoadingOverlay message=\"Loading Custom Table...\" type=\"ripple\" />\n      </div>\n    );\n  }\n\n  if (error || !customTable) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"flex h-16 w-16 mx-auto items-center justify-center rounded-lg bg-red-100 dark:bg-red-900/20 text-red-600 dark:text-red-400\">\n            <Database className=\"h-8 w-8\" />\n          </div>\n          <h1 className=\"text-2xl font-bold text-slate-900 dark:text-slate-100\">\n            Custom Table Not Found\n          </h1>\n          <p className=\"text-slate-600 dark:text-slate-400\">\n            The custom table you're looking for doesn't exist or has been removed.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      {/* Header */}\n      <nav className=\"sticky top-0 z-50 w-full border-b-2 border-blue-500/50 dark:border-blue-400/50 bg-gradient-to-r from-blue-500/10 via-blue-600/10 to-blue-700/10 dark:from-blue-500/20 dark:via-blue-600/20 dark:to-blue-700/20 backdrop-blur supports-[backdrop-filter]:bg-background/60 shadow-lg shadow-blue-500/20\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"flex h-14 items-center justify-between text-[12px]\">\n            <div className=\"flex items-center space-x-2\">\n              <div className=\"flex items-center space-x-2 hover:opacity-80 transition-opacity\">\n                <div className=\"flex h-8 w-8 items-center justify-center rounded-lg overflow-hidden\">\n                  <img \n                    src=\"/assets/FamilyMart.png\" \n                    alt=\"Logo\" \n                    className=\"h-full w-full object-cover\"\n                  />\n                </div>\n                <span className=\"font-bold text-slate-600 dark:text-slate-300\" style={{ fontSize: '14px' }}>\n                  {customTable.name}\n                </span>\n              </div>\n            </div>\n            <div className=\"text-xs text-slate-500 dark:text-slate-400\">\n              Custom Table View\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      <main className=\"pt-4\">\n        <div className=\"container mx-auto px-4 py-8\">\n          {/* Data Table with all interactive features enabled */}\n          <DataTable\n            rows={rowsWithDistances}\n            columns={displayColumns}\n            editMode={false}\n            isSharedView={true}\n            hideShareButton={true}\n            onUpdateRow={readOnlyUpdateMutation as any}\n            onDeleteRow={readOnlyDeleteMutation as any}\n            onReorderRows={readOnlyReorderRowsMutation as any}\n            onReorderColumns={readOnlyReorderColumnsMutation as any}\n            onDeleteColumn={readOnlyDeleteColumnMutation as any}\n            onSelectRowForImage={setSelectedRowForImage}\n            onShowCustomization={() => {}}\n            onOptimizeRoute={() => {}}\n            isAuthenticated={false}\n            searchTerm={searchTerm}\n            onSearchTermChange={setSearchTerm}\n            filterValue={[]}\n            onFilterValueChange={() => {}}\n            deliveryFilterValue={deliveryFilters}\n            onDeliveryFilterValueChange={setDeliveryFilters}\n            routeOptions={[]}\n            deliveryOptions={deliveryOptions}\n            onClearAllFilters={handleClearAllFilters}\n            filteredRowsCount={rowsWithDistances.length}\n            totalRowsCount={rows.length}\n          />\n        </div>\n      </main>\n\n      <Footer editMode={false} />\n    </>\n  );\n}\n","size_bytes":12572}},"version":2}